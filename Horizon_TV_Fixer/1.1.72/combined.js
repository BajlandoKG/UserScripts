/*!
 * jQuery JavaScript Library v1.7.1
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Mon Nov 21 21:11:03 2011 -0500
 */
(function(window,undefined){var document=window.document,navigator=window.navigator,location=window.location;var jQuery=(function(){var jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},_jQuery=window.jQuery,_$=window.$,rootjQuery,quickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rnotwhite=/\S/,trimLeft=/^\s+/,trimRight=/\s+$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,rdashAlpha=/-([a-z]|[0-9])/ig,rmsPrefix=/^-ms-/,fcamelCase=function(all,letter){return(letter+"").toUpperCase()},userAgent=navigator.userAgent,browserMatch,readyList,DOMContentLoaded,toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,push=Array.prototype.push,slice=Array.prototype.slice,trim=String.prototype.trim,indexOf=Array.prototype.indexOf,class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this}if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}if(selector==="body"&&!context&&document.body){this.context=document;this[0]=document.body;this.selector=selector;this.length=1;return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=quickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context?context.ownerDocument||context:document);ret=rsingleTag.exec(selector);if(ret){if(jQuery.isPlainObject(context)){selector=[document.createElement(ret[1])];jQuery.fn.attr.call(selector,context,true)}else{selector=[doc.createElement(ret[1])]}}else{ret=jQuery.buildFragment([match[1]],[doc]);selector=(ret.cacheable?jQuery.clone(ret.fragment):ret.fragment).childNodes}return jQuery.merge(this,selector)}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else{if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}}else{if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return slice.call(this,0)},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num])},pushStack:function(elems,name,selector){var ret=this.constructor();if(jQuery.isArray(elems)){push.apply(ret,elems)}else{jQuery.merge(ret,elems)}ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector}else{if(name){ret.selector=this.selector+"."+name+"("+selector+")"}}return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.bindReady();readyList.add(fn);return this},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(slice.apply(this,arguments),"slice",slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if((wait===true&&!--jQuery.readyWait)||(wait!==true&&!jQuery.isReady)){if(!document.body){return setTimeout(jQuery.ready,1)}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.fireWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}}},bindReady:function(){if(readyList){return}readyList=jQuery.Callbacks("once memory");if(document.readyState==="complete"){return setTimeout(jQuery.ready,1)}if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var toplevel=false;try{toplevel=window.frameElement==null}catch(e){}if(document.documentElement.doScroll&&toplevel){doScrollCheck()}}}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj&&typeof obj==="object"&&"setInterval" in obj},isNumeric:function(obj){return !isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return obj==null?String(obj):class2type[toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var key;for(key in obj){}return key===undefined||hasOwn.call(obj,key)},isEmptyObject:function(obj){for(var name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseJSON:function(data){if(typeof data!=="string"||!data){return null}data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))()}jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(data){if(data&&rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase()},each:function(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||jQuery.isFunction(object);if(args){if(isObj){for(name in object){if(callback.apply(object[name],args)===false){break}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break}}}}else{if(isObj){for(name in object){if(callback.call(object[name],name,object[name])===false){break}}}else{for(;i<length;){if(callback.call(object[i],i,object[i++])===false){break}}}}return object},trim:trim?function(text){return text==null?"":trim.call(text)}:function(text){return text==null?"":text.toString().replace(trimLeft,"").replace(trimRight,"")},makeArray:function(array,results){var ret=results||[];if(array!=null){var type=jQuery.type(array);if(array.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(array)){push.call(ret,array)}else{jQuery.merge(ret,array)}}return ret},inArray:function(elem,array,i){var len;if(array){if(indexOf){return indexOf.call(array,elem,i)}len=array.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in array&&array[i]===elem){return i}}}return -1},merge:function(first,second){var i=first.length,j=0;if(typeof second.length==="number"){for(var l=second.length;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var ret=[],retVal;inv=!!inv;for(var i=0,length=elems.length;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value}}}return ret.concat.apply([],ret)},guid:1,proxy:function(fn,context){if(typeof context==="string"){var tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}var args=slice.call(arguments,2),proxy=function(){return fn.apply(context,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||proxy.guid||jQuery.guid++;return proxy},access:function(elems,key,value,exec,fn,pass){var length=elems.length;if(typeof key==="object"){for(var k in key){jQuery.access(elems,k,key[k],exec,fn,value)}return elems}if(value!==undefined){exec=!pass&&exec&&jQuery.isFunction(value);for(var i=0;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass)}return elems}return length?fn(elems[0],key):undefined},now:function(){return(new Date()).getTime()},uaMatch:function(ua){ua=ua.toLowerCase();var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}},sub:function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context)}jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context)}return jQuery.fn.init.call(this,selector,context,rootjQuerySub)};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub},browser:{}});jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});browserMatch=jQuery.uaMatch(userAgent);if(browserMatch.browser){jQuery.browser[browserMatch.browser]=true;jQuery.browser.version=browserMatch.version}if(jQuery.browser.webkit){jQuery.browser.safari=true}if(rnotwhite.test("\xA0")){trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/}rootjQuery=jQuery(document);if(document.addEventListener){DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready()}}else{if(document.attachEvent){DOMContentLoaded=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready()}}}}function doScrollCheck(){if(jQuery.isReady){return}try{document.documentElement.doScroll("left")}catch(e){setTimeout(doScrollCheck,1);return}jQuery.ready()}return jQuery})();var flagsCache={};function createFlags(flags){var object=flagsCache[flags]={},i,length;flags=flags.split(/\s+/);for(i=0,length=flags.length;i<length;i++){object[flags[i]]=true}return object}jQuery.Callbacks=function(flags){flags=flags?(flagsCache[flags]||createFlags(flags)):{};var list=[],stack=[],memory,firing,firingStart,firingLength,firingIndex,add=function(args){var i,length,elem,type,actual;for(i=0,length=args.length;i<length;i++){elem=args[i];type=jQuery.type(elem);if(type==="array"){add(elem)}else{if(type==="function"){if(!flags.unique||!self.has(elem)){list.push(elem)}}}}},fire=function(context,args){args=args||[];memory=!flags.memory||[context,args];firing=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(context,args)===false&&flags.stopOnFalse){memory=true;break}}firing=false;if(list){if(!flags.once){if(stack&&stack.length){memory=stack.shift();self.fireWith(memory[0],memory[1])}}else{if(memory===true){self.disable()}else{list=[]}}}},self={add:function(){if(list){var length=list.length;add(arguments);if(firing){firingLength=list.length}else{if(memory&&memory!==true){firingStart=length;fire(memory[0],memory[1])}}}return this},remove:function(){if(list){var args=arguments,argIndex=0,argLength=args.length;for(;argIndex<argLength;argIndex++){for(var i=0;i<list.length;i++){if(args[argIndex]===list[i]){if(firing){if(i<=firingLength){firingLength--;if(i<=firingIndex){firingIndex--}}}list.splice(i--,1);if(flags.unique){break}}}}}return this},has:function(fn){if(list){var i=0,length=list.length;for(;i<length;i++){if(fn===list[i]){return true}}}return false},empty:function(){list=[];return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return !list},lock:function(){stack=undefined;if(!memory||memory===true){self.disable()}return this},locked:function(){return !stack},fireWith:function(context,args){if(stack){if(firing){if(!flags.once){stack.push([context,args])}}else{if(!(flags.once&&memory)){fire(context,args)}}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return !!memory}};return self};var sliceDeferred=[].slice;jQuery.extend({Deferred:function(func){var doneList=jQuery.Callbacks("once memory"),failList=jQuery.Callbacks("once memory"),progressList=jQuery.Callbacks("memory"),state="pending",lists={resolve:doneList,reject:failList,notify:progressList},promise={done:doneList.add,fail:failList.add,progress:progressList.add,state:function(){return state},isResolved:doneList.fired,isRejected:failList.fired,then:function(doneCallbacks,failCallbacks,progressCallbacks){deferred.done(doneCallbacks).fail(failCallbacks).progress(progressCallbacks);return this},always:function(){deferred.done.apply(deferred,arguments).fail.apply(deferred,arguments);return this},pipe:function(fnDone,fnFail,fnProgress){return jQuery.Deferred(function(newDefer){jQuery.each({done:[fnDone,"resolve"],fail:[fnFail,"reject"],progress:[fnProgress,"notify"]},function(handler,data){var fn=data[0],action=data[1],returned;if(jQuery.isFunction(fn)){deferred[handler](function(){returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().then(newDefer.resolve,newDefer.reject,newDefer.notify)}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned])}})}else{deferred[handler](newDefer[action])}})}).promise()},promise:function(obj){if(obj==null){obj=promise}else{for(var key in promise){obj[key]=promise[key]}}return obj}},deferred=promise.promise({}),key;for(key in lists){deferred[key]=lists[key].fire;deferred[key+"With"]=lists[key].fireWith}deferred.done(function(){state="resolved"},failList.disable,progressList.lock).fail(function(){state="rejected"},doneList.disable,progressList.lock);if(func){func.call(deferred,deferred)}return deferred},when:function(firstParam){var args=sliceDeferred.call(arguments,0),i=0,length=args.length,pValues=new Array(length),count=length,pCount=length,deferred=length<=1&&firstParam&&jQuery.isFunction(firstParam.promise)?firstParam:jQuery.Deferred(),promise=deferred.promise();function resolveFunc(i){return function(value){args[i]=arguments.length>1?sliceDeferred.call(arguments,0):value;if(!(--count)){deferred.resolveWith(deferred,args)}}}function progressFunc(i){return function(value){pValues[i]=arguments.length>1?sliceDeferred.call(arguments,0):value;deferred.notifyWith(promise,pValues)}}if(length>1){for(;i<length;i++){if(args[i]&&args[i].promise&&jQuery.isFunction(args[i].promise)){args[i].promise().then(resolveFunc(i),deferred.reject,progressFunc(i))}else{--count}}if(!count){deferred.resolveWith(deferred,args)}}else{if(deferred!==firstParam){deferred.resolveWith(deferred,length?[firstParam]:[])}}return promise}});jQuery.support=(function(){var support,all,a,select,opt,input,marginDiv,fragment,tds,events,eventName,i,isSupported,div=document.createElement("div"),documentElement=document.documentElement;div.setAttribute("className","t");div.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];if(!all||!all.length||!a){return{}}select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.55/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=false}if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",function(){support.noCloneEvent=false});div.cloneNode(true).fireEvent("onclick")}input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);div.innerHTML="";if(window.getComputedStyle){marginDiv=document.createElement("div");marginDiv.style.width="0";marginDiv.style.marginRight="0";div.style.width="2px";div.appendChild(marginDiv);support.reliableMarginRight=(parseInt((window.getComputedStyle(marginDiv,null)||{marginRight:0}).marginRight,10)||0)===0}if(div.attachEvent){for(i in {submit:1,change:1,focusin:1}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function")}support[i+"Bubbles"]=isSupported}}fragment.removeChild(div);fragment=select=opt=marginDiv=div=input=null;jQuery(function(){var container,outer,inner,table,td,offsetSupport,conMarginTop,ptlm,vb,style,html,body=document.getElementsByTagName("body")[0];if(!body){return}conMarginTop=1;ptlm="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;";vb="visibility:hidden;border:0;";style="style='"+ptlm+"border:5px solid #000;padding:0;'";html="<div "+style+"><div></div></div><table "+style+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";container=document.createElement("div");container.style.cssText=vb+"width:0;height:0;position:static;top:0;margin-top:"+conMarginTop+"px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.width=div.style.paddingLeft="1px";jQuery.boxModel=support.boxModel=div.offsetWidth===2;if(typeof div.style.zoom!=="undefined"){div.style.display="inline";div.style.zoom=1;support.inlineBlockNeedsLayout=(div.offsetWidth===2);div.style.display="";div.innerHTML="<div style='width:4px;'></div>";support.shrinkWrapBlocks=(div.offsetWidth!==2)}div.style.cssText=ptlm+vb;div.innerHTML=html;outer=div.firstChild;inner=outer.firstChild;td=outer.nextSibling.firstChild.firstChild;offsetSupport={doesNotAddBorder:(inner.offsetTop!==5),doesAddBorderForTableAndCells:(td.offsetTop===5)};inner.style.position="fixed";inner.style.top="20px";offsetSupport.fixedPosition=(inner.offsetTop===20||inner.offsetTop===15);inner.style.position=inner.style.top="";outer.style.overflow="hidden";outer.style.position="relative";offsetSupport.subtractsBorderForOverflowNotVisible=(inner.offsetTop===-5);offsetSupport.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==conMarginTop);body.removeChild(container);div=container=null;jQuery.extend(support,offsetSupport)});return support})();var rbrace=/^(?:\{.*\}|\[.*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return !!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return}var privateCache,thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey,isEvents=name==="events";if((!id||!cache[id]||(!isEvents&&!pvt&&!cache[id].data))&&getByName&&data===undefined){return}if(!id){if(isNode){elem[internalKey]=id=++jQuery.uuid}else{id=internalKey}}if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop}}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}privateCache=thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(isEvents&&!thisCache[name]){return privateCache.events}if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,i,l,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:internalKey;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(" ")}}}for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]]}if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(jQuery.support.deleteExpando||!cache.setInterval){delete cache[id]}else{cache[id]=null}if(isNode){if(jQuery.support.deleteExpando){delete elem[internalKey]}else{if(elem.removeAttribute){elem.removeAttribute(internalKey)}else{elem[internalKey]=null}}}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true)},acceptData:function(elem){if(elem.nodeName){var match=jQuery.noData[elem.nodeName.toLowerCase()];if(match){return !(match===true||elem.getAttribute("classid")!==match)}}return true}});jQuery.fn.extend({data:function(key,value){var parts,attr,name,data=null;if(typeof key==="undefined"){if(this.length){data=jQuery.data(this[0]);if(this[0].nodeType===1&&!jQuery._data(this[0],"parsedAttrs")){attr=this[0].attributes;for(var i=0,l=attr.length;i<l;i++){name=attr[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.substring(5));dataAttr(this[0],name,data[name])}}jQuery._data(this[0],"parsedAttrs",true)}}return data}else{if(typeof key==="object"){return this.each(function(){jQuery.data(this,key)})}}parts=key.split(".");parts[1]=parts[1]?"."+parts[1]:"";if(value===undefined){data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]);if(data===undefined&&this.length){data=jQuery.data(this[0],key);data=dataAttr(this[0],key,data)}return data===undefined&&parts[1]?this.data(parts[0]):data}else{return this.each(function(){var self=jQuery(this),args=[parts[0],value];self.triggerHandler("setData"+parts[1]+"!",args);jQuery.data(this,key,value);self.triggerHandler("changeData"+parts[1]+"!",args)})}},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:jQuery.isNumeric(data)?parseFloat(data):rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){for(var name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue}if(name!=="toJSON"){return false}}return true}function handleQueueMarkDefer(elem,type,src){var deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",defer=jQuery._data(elem,deferDataKey);if(defer&&(src==="queue"||!jQuery._data(elem,queueDataKey))&&(src==="mark"||!jQuery._data(elem,markDataKey))){setTimeout(function(){if(!jQuery._data(elem,queueDataKey)&&!jQuery._data(elem,markDataKey)){jQuery.removeData(elem,deferDataKey,true);defer.fire()}},0)}}jQuery.extend({_mark:function(elem,type){if(elem){type=(type||"fx")+"mark";jQuery._data(elem,type,(jQuery._data(elem,type)||0)+1)}},_unmark:function(force,elem,type){if(force!==true){type=elem;elem=force;force=false}if(elem){type=type||"fx";var key=type+"mark",count=force?0:((jQuery._data(elem,key)||1)-1);if(count){jQuery._data(elem,key,count)}else{jQuery.removeData(elem,key,true);handleQueueMarkDefer(elem,type,"mark")}}},queue:function(elem,type,data){var q;if(elem){type=(type||"fx")+"queue";q=jQuery._data(elem,type);if(data){if(!q||jQuery.isArray(data)){q=jQuery._data(elem,type,jQuery.makeArray(data))}else{q.push(data)}}return q||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),fn=queue.shift(),hooks={};if(fn==="inprogress"){fn=queue.shift()}if(fn){if(type==="fx"){queue.unshift("inprogress")}jQuery._data(elem,type+".run",hooks);fn.call(elem,function(){jQuery.dequeue(elem,type)},hooks)}if(!queue.length){jQuery.removeData(elem,type+"queue "+type+".run",true);handleQueueMarkDefer(elem,type,"queue")}}});jQuery.fn.extend({queue:function(type,data){if(typeof type!=="string"){data=type;type="fx"}if(data===undefined){return jQuery.queue(this[0],type)}return this.each(function(){var queue=jQuery.queue(this,type,data);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,object){if(typeof type!=="string"){object=type;type=undefined}type=type||"fx";var defer=jQuery.Deferred(),elements=this,i=elements.length,count=1,deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",tmp;function resolve(){if(!(--count)){defer.resolveWith(elements,[elements])}}while(i--){if((tmp=jQuery.data(elements[i],deferDataKey,undefined,true)||(jQuery.data(elements[i],queueDataKey,undefined,true)||jQuery.data(elements[i],markDataKey,undefined,true))&&jQuery.data(elements[i],deferDataKey,jQuery.Callbacks("once memory"),true))){count++;tmp.add(resolve)}}resolve();return defer.promise()}});var rclass=/[\n\t\r]/g,rspace=/\s+/,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea)?$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,nodeHook,boolHook,fixSpecified;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,name,value,true,jQuery.attr)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,name,value,true,jQuery.prop)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(value&&typeof value==="string"){classNames=value.split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(!~setClass.indexOf(" "+classNames[c]+" ")){setClass+=classNames[c]+" "}}elem.className=jQuery.trim(setClass)}}}}return this},removeClass:function(value){var classNames,i,l,elem,className,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if((value&&typeof value==="string")||value===undefined){classNames=(value||"").split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){if(value){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ")}elem.className=jQuery.trim(className)}else{elem.className=""}}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className)}}else{if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className)}this.className=this.className||value===false?"":jQuery._data(this,"__className__")||""}}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>-1){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.nodeName.toLowerCase()]||jQuery.valHooks[elem.type];if(hooks&&"get" in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var self=jQuery(this),val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,self.val())}else{val=value}if(val==null){val=""}else{if(typeof val==="number"){val+=""}else{if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}}}hooks=jQuery.valHooks[this.nodeName.toLowerCase()]||jQuery.valHooks[this.type];if(!hooks||!("set" in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return !val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0){return null}i=one?index:0;max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}if(one&&!values.length&&options.length){return jQuery(options[index]).val()}return values},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0});if(!values.length){elem.selectedIndex=-1}return values}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(pass&&name in jQuery.attrFn){return jQuery(elem)[name](value)}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value)}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}else{if(hooks&&"set" in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,""+value);return value}}}else{if(hooks&&"get" in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=elem.getAttribute(name);return ret===null?undefined:ret}}},removeAttr:function(elem,value){var propName,attrNames,name,l,i=0;if(value&&elem.nodeType===1){attrNames=value.toLowerCase().split(rspace);l=attrNames.length;for(;i<l;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;jQuery.attr(elem,name,"");elem.removeAttribute(getSetAttribute?name:propName);if(rboolean.test(name)&&propName in elem){elem[propName]=false}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed")}else{if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name)}return name in elem?elem.value:null},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name)}elem.value=value}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{return(elem[name]=value)}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{return elem[name]}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined}}}});jQuery.attrHooks.tabindex=jQuery.propHooks.tabIndex;boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name)}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true}elem.setAttribute(name,name.toLowerCase())}return name}};if(!getSetAttribute){fixSpecified={name:true,id:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.nodeValue!=="":ret.specified)?ret.nodeValue:undefined},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret)}return(ret.nodeValue=value+"")}};jQuery.attrHooks.tabindex.set=nodeHook.set;jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value}}})});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false"}nodeHook.set(elem,value,name)}}}if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret}})})}if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined},set:function(elem,value){return(elem.style.cssText=""+value)}}}if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null}})}if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding"}if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value}}})}jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0)}}})});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*)?(?:\.(.+))?$/,rhoverHack=/\bhover(\.\S+)?\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rquickIs=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,quickParse=function(selector){var quick=rquickIs.exec(selector);if(quick){quick[1]=(quick[1]||"").toLowerCase();quick[3]=quick[3]&&new RegExp("(?:^|\\s)"+quick[3]+"(?:\\s|$)")}return quick},quickIs=function(elem,m){var attrs=elem.attributes||{};return((!m[1]||elem.nodeName.toLowerCase()===m[1])&&(!m[2]||(attrs.id||{}).value===m[2])&&(!m[3]||m[3].test((attrs["class"]||{}).value)))},hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1")};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,quick,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler}if(!handler.guid){handler.guid=jQuery.guid++}events=elemData.events;if(!events){elemData.events=events={}}eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,quick:quickParse(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else{if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle)}}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},global:{},remove:function(elem,types,handler,selector,mappedTypes){var elemData=jQuery.hasData(elem)&&jQuery._data(elem),t,tns,type,origType,namespaces,origCount,j,events,special,handle,eventType,handleObj;if(!elemData||!(events=elemData.events)){return}types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){handle=elemData.handle;if(handle){handle.elem=null}jQuery.removeData(elem,["events","handle"],true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return}var type=event.type||event,namespaces=[],cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType;if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return}event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true)}}return}event.result=undefined;if(!event.target){event.target=elem}data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return}eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;old=null;for(;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur}if(old&&old===elem.ownerDocument){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType])}}for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event||window.event);var handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=[].slice.call(arguments,0),run_all=!event.exclusive&&!event.namespace,handlerQueue=[],i,j,cur,jqcur,ret,selMatch,matched,matches,handleObj,sel,related;args[0]=event;event.delegateTarget=this;if(delegateCount&&!event.target.disabled&&!(event.button&&event.type==="click")){jqcur=jQuery(this);jqcur.context=this.ownerDocument||this;for(cur=event.target;cur!=this;cur=cur.parentNode||this){selMatch={};matches=[];jqcur[0]=cur;for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=(handleObj.quick?quickIs(cur,handleObj.quick):jqcur.is(sel))}if(selMatch[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,matches:matches})}}}if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)})}for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation()}}}}}return event.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)))}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}if(event.metaKey===undefined){event.metaKey=event.ctrlKey}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{ready:{setup:jQuery.bindReady},load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}}:function(elem,type,handle){if(elem.detachEvent){elem.detachEvent("on"+type,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};function returnFalse(){return false}function returnTrue(){return true}jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector,ret;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!form._submit_attached){jQuery.event.add(form,"submit._submit",function(event){if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true)}});form._submit_attached=true}})},teardown:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.remove(this,"._submit")}}}if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false;jQuery.event.simulate("change",this,event,true)}})}return false}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!elem._change_attached){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true)}});elem._change_attached=true}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,"._change");return rformElems.test(this.nodeName)}}}if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else{if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}}if(fn===false){fn=returnFalse}else{if(!fn){return this}}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on.call(this,types,selector,data,fn,1)},off:function(types,selector,fn){if(types&&types.preventDefault&&types.handleObj){var handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.type+"."+handleObj.namespace:handleObj.type,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(var type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length==1?this.off(selector,"**"):this.off(types,selector,fn)},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true)}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false};toggler.guid=guid;while(i<args.length){args[i++].guid=guid}return this.click(toggler)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null}return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)};if(jQuery.attrFn){jQuery.attrFn[name]=true}if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks}if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks}});
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,expando="sizcache"+(Math.random()+"").replace(".",""),done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true,rBackslash=/\\/g,rReturn=/\r\n/g,rNonWord=/\W/;[0,0].sort(function(){baseHasDuplicate=false;return 0});var Sizzle=function(selector,context,results,seed){results=results||[];context=context||document;var origContext=context;if(context.nodeType!==1&&context.nodeType!==9){return[]}if(!selector||typeof selector!=="string"){return results}var m,set,checkSet,extra,ret,cur,pop,i,prune=true,contextXML=Sizzle.isXML(context),parts=[],soFar=selector;do{chunker.exec("");m=chunker.exec(soFar);if(m){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break}}}while(m);if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context,seed)}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift()}set=posProcess(selector,set,seed)}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0]}if(context){ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set)}else{prune=false}while(parts.length){cur=parts.pop();pop=cur;if(!Expr.relative[cur]){cur=""}else{pop=parts.pop()}if(pop==null){pop=context}Expr.relative[cur](checkSet,pop,contextXML)}}else{checkSet=parts=[]}}if(!checkSet){checkSet=set}if(!checkSet){Sizzle.error(cur||selector)}if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet)}else{if(context&&context.nodeType===1){for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&Sizzle.contains(context,checkSet[i]))){results.push(set[i])}}}else{for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i])}}}}}else{makeArray(checkSet,results)}if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results)}return results};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1)}}}}return results};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)};Sizzle.matchesSelector=function(node,expr){return Sizzle(expr,null,null,[node]).length>0};Sizzle.find=function(expr,context,isXML){var set,i,len,match,type,left;if(!expr){return[]}for(i=0,len=Expr.order.length;i<len;i++){type=Expr.order[i];if((match=Expr.leftMatch[type].exec(expr))){left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(rBackslash,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break}}}}if(!set){set=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName("*"):[]}return{set:set,expr:expr}};Sizzle.filter=function(expr,set,inplace,not){var match,anyFound,type,found,item,filter,left,i,pass,old=expr,result=[],curLoop=set,isXMLFilter=set&&set[0]&&Sizzle.isXML(set[0]);while(expr&&set.length){for(type in Expr.filter){if((match=Expr.leftMatch[type].exec(expr))!=null&&match[2]){filter=Expr.filter[type];left=match[1];anyFound=false;match.splice(1,1);if(left.substr(left.length-1)==="\\"){continue}if(curLoop===result){result=[]}if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true}else{if(match===true){continue}}}if(match){for(i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);pass=not^found;if(inplace&&found!=null){if(pass){anyFound=true}else{curLoop[i]=false}}else{if(pass){result.push(item);anyFound=true}}}}}if(found!==undefined){if(!inplace){curLoop=result}expr=expr.replace(Expr.match[type],"");if(!anyFound){return[]}break}}}if(expr===old){if(anyFound==null){Sizzle.error(expr)}else{break}}old=expr}return curLoop};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};var getText=Sizzle.getText=function(elem){var i,node,nodeType=elem.nodeType,ret="";if(nodeType){if(nodeType===1||nodeType===9){if(typeof elem.textContent==="string"){return elem.textContent}else{if(typeof elem.innerText==="string"){return elem.innerText.replace(rReturn,"")}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue}}}else{for(i=0;(node=elem[i]);i++){if(node.nodeType!==8){ret+=getText(node)}}}return ret};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")},type:function(elem){return elem.getAttribute("type")}},relative:{"+":function(checkSet,part){var isPartStr=typeof part==="string",isTag=isPartStr&&!rNonWord.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag){part=part.toLowerCase()}for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}checkSet[i]=isPartStrNotTag||elem&&elem.nodeName.toLowerCase()===part?elem||false:elem===part}}if(isPartStrNotTag){Sizzle.filter(part,checkSet,true)}},">":function(checkSet,part){var elem,isPartStr=typeof part==="string",i=0,l=checkSet.length;if(isPartStr&&!rNonWord.test(part)){part=part.toLowerCase();for(;i<l;i++){elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName.toLowerCase()===part?parent:false}}}else{for(;i<l;i++){elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part}}if(isPartStr){Sizzle.filter(part,checkSet,true)}}},"":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!rNonWord.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck}checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML)},"~":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!rNonWord.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck}checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m&&m.parentNode?[m]:[]}},NAME:function(match,context){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i])}}return ret.length===0?null:ret}},TAG:function(match,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(match[1])}}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(rBackslash,"")+" ";if(isXML){return match}for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").replace(/[\t\n\r]/g," ").indexOf(match)>=0)){if(!inplace){result.push(elem)}}else{if(inplace){curLoop[i]=false}}}}return false},ID:function(match){return match[1].replace(rBackslash,"")},TAG:function(match,curLoop){return match[1].replace(rBackslash,"").toLowerCase()},CHILD:function(match){if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0])}match[2]=match[2].replace(/^\+|\s*/g,"");var test=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(match[2]==="even"&&"2n"||match[2]==="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0}else{if(match[2]){Sizzle.error(match[0])}}match[0]=done++;return match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1]=match[1].replace(rBackslash,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name]}match[4]=(match[4]||match[5]||"").replace(rBackslash,"");if(match[2]==="~="){match[4]=" "+match[4]+" "}return match},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop)}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret)}return false}}else{if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true}}return match},POS:function(match){match.unshift(true);return match}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden"},disabled:function(elem){return elem.disabled===true},checked:function(elem){return elem.checked===true},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},parent:function(elem){return !!elem.firstChild},empty:function(elem){return !elem.firstChild},has:function(elem,i,match){return !!Sizzle(match[3],elem).length},header:function(elem){return(/h\d/i).test(elem.nodeName)},text:function(elem){var attr=elem.getAttribute("type"),type=elem.type;return elem.nodeName.toLowerCase()==="input"&&"text"===type&&(attr===type||attr===null)},radio:function(elem){return elem.nodeName.toLowerCase()==="input"&&"radio"===elem.type},checkbox:function(elem){return elem.nodeName.toLowerCase()==="input"&&"checkbox"===elem.type},file:function(elem){return elem.nodeName.toLowerCase()==="input"&&"file"===elem.type},password:function(elem){return elem.nodeName.toLowerCase()==="input"&&"password"===elem.type},submit:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"submit"===elem.type},image:function(elem){return elem.nodeName.toLowerCase()==="input"&&"image"===elem.type},reset:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"reset"===elem.type},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&"button"===elem.type||name==="button"},input:function(elem){return(/input|select|textarea|button/i).test(elem.nodeName)},focus:function(elem){return elem===elem.ownerDocument.activeElement}},setFilters:{first:function(elem,i){return i===0},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2===0},odd:function(elem,i){return i%2===1},lt:function(elem,i,match){return i<match[3]-0},gt:function(elem,i,match){return i>match[3]-0},nth:function(elem,i,match){return match[3]-0===i},eq:function(elem,i,match){return match[3]-0===i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array)}else{if(name==="contains"){return(elem.textContent||elem.innerText||getText([elem])||"").indexOf(match[3])>=0}else{if(name==="not"){var not=match[3];for(var j=0,l=not.length;j<l;j++){if(not[j]===elem){return false}}return true}else{Sizzle.error(name)}}}},CHILD:function(elem,match){var first,last,doneName,parent,cache,count,diff,type=match[1],node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false}}if(type==="first"){return true}node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false}}return true;case"nth":first=match[2];last=match[3];if(first===1&&last===0){return true}doneName=match[0];parent=elem.parentNode;if(parent&&(parent[expando]!==doneName||!elem.nodeIndex)){count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count}}parent[expando]=doneName}diff=elem.nodeIndex-last;if(first===0){return diff===0}else{return(diff%first===0&&diff/first>=0)}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||!!elem.nodeName&&elem.nodeName.toLowerCase()===match},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1},ATTR:function(elem,match){var name=match[1],result=Sizzle.attr?Sizzle.attr(elem,name):Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":!type&&Sizzle.attr?result!=null:type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!==check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array)}}}};var origPOS=Expr.match.POS,fescape=function(all,num){return"\\"+(num-0+1)};for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+(/(?![^\[]*\])(?![^\(]*\))/.source));Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source.replace(/\\(\d+)/g,fescape))}var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results}return array};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(e){makeArray=function(array,results){var i=0,ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array)}else{if(typeof array.length==="number"){for(var l=array.length;i<l;i++){ret.push(array[i])}}else{for(;array[i];i++){ret.push(array[i])}}}return ret}}var sortOrder,siblingCheck;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1}return a.compareDocumentPosition(b)&4?-1:1}}else{sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0}else{if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}}var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b)}else{if(!aup){return -1}else{if(!bup){return 1}}}while(cur){ap.unshift(cur);cur=cur.parentNode}cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode}al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i])}}return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1)};siblingCheck=function(a,b,ret){if(a===b){return ret}var cur=a.nextSibling;while(cur){if(cur===b){return -1}cur=cur.nextSibling}return 1}}(function(){var form=document.createElement("div"),id="script"+(new Date()).getTime(),root=document.documentElement;form.innerHTML="<a name='"+id+"'/>";root.insertBefore(form,root.firstChild);if(document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match}}root.removeChild(form);root=form=null})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i])}}results=tmp}return results}}div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}}div=null})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div"),id="__sizzle__";div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return}Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&!Sizzle.isXML(context)){var match=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(query);if(match&&(context.nodeType===1||context.nodeType===9)){if(match[1]){return makeArray(context.getElementsByTagName(query),extra)}else{if(match[2]&&Expr.find.CLASS&&context.getElementsByClassName){return makeArray(context.getElementsByClassName(match[2]),extra)}}}if(context.nodeType===9){if(query==="body"&&context.body){return makeArray([context.body],extra)}else{if(match&&match[3]){var elem=context.getElementById(match[3]);if(elem&&elem.parentNode){if(elem.id===match[3]){return makeArray([elem],extra)}}else{return makeArray([],extra)}}}try{return makeArray(context.querySelectorAll(query),extra)}catch(qsaError){}}else{if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){var oldContext=context,old=context.getAttribute("id"),nid=old||id,hasParent=context.parentNode,relativeHierarchySelector=/^\s*[+~]/.test(query);if(!old){context.setAttribute("id",nid)}else{nid=nid.replace(/'/g,"\\$&")}if(relativeHierarchySelector&&hasParent){context=context.parentNode}try{if(!relativeHierarchySelector||hasParent){return makeArray(context.querySelectorAll("[id='"+nid+"'] "+query),extra)}}catch(pseudoError){}finally{if(!old){oldContext.removeAttribute("id")}}}}}return oldSizzle(query,context,extra,seed)};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop]}div=null})()}(function(){var html=document.documentElement,matches=html.matchesSelector||html.mozMatchesSelector||html.webkitMatchesSelector||html.msMatchesSelector;if(matches){var disconnectedMatch=!matches.call(document.createElement("div"),"div"),pseudoWorks=false;try{matches.call(document.documentElement,"[test!='']:sizzle")}catch(pseudoError){pseudoWorks=true}Sizzle.matchesSelector=function(node,expr){expr=expr.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!Sizzle.isXML(node)){try{if(pseudoWorks||!Expr.match.PSEUDO.test(expr)&&!/!=/.test(expr)){var ret=matches.call(node,expr);if(ret||!disconnectedMatch||node.document&&node.document.nodeType!==11){return ret}}}catch(e){}}return Sizzle(expr,null,null,[node]).length>0}}})();(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(!div.getElementsByClassName||div.getElementsByClassName("e").length===0){return}div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return}Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1])}};div=null})();function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=false;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1&&!isXML){elem[expando]=doneName;elem.sizset=i}if(elem.nodeName.toLowerCase()===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=false;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1){if(!isXML){elem[expando]=doneName;elem.sizset=i}if(typeof cur!=="string"){if(elem===cur){match=true;break}}else{if(Sizzle.filter(cur,[elem]).length>0){match=elem;break}}}elem=elem[dir]}checkSet[i]=match}}}if(document.documentElement.contains){Sizzle.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):true)}}else{if(document.documentElement.compareDocumentPosition){Sizzle.contains=function(a,b){return !!(a.compareDocumentPosition(b)&16)}}else{Sizzle.contains=function(){return false}}}Sizzle.isXML=function(elem){var documentElement=(elem?elem.ownerDocument||elem:0).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};var posProcess=function(selector,context,seed){var match,tmpSet=[],later="",root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"")}selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet,seed)}return Sizzle.filter(later,tmpSet)};Sizzle.attr=jQuery.attr;Sizzle.selectors.attrMap={};jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.filters;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})();var runtil=/Until$/,rparentsprev=/^(?:parents|prevUntil|prevAll)/,rmultiselector=/,/,isSimple=/^.[^:#\[\.,]*$/,slice=Array.prototype.slice,POS=jQuery.expr.match.POS,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var self=this,i,l;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true}}})}var ret=this.pushStack("","find",selector),length,n,r;for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break}}}}}return ret},has:function(target){var targets=jQuery(target);return this.filter(function(){for(var i=0,l=targets.length;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector)},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector)},is:function(selector){return !!selector&&(typeof selector==="string"?POS.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0)},closest:function(selectors,context){var ret=[],i,l,cur=this[0];if(jQuery.isArray(selectors)){var level=1;while(cur&&cur.ownerDocument&&cur!==context){for(i=0;i<selectors.length;i++){if(jQuery(cur).is(selectors[i])){ret.push({selector:selectors[i],elem:cur,level:level})}}cur=cur.parentNode;level++}return ret}var pos=POS.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(i=0,l=this.length;i<l;i++){cur=this[i];while(cur){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break}else{cur=cur.parentNode;if(!cur||!cur.ownerDocument||cur===context||cur.nodeType===11){break}}}}ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors)},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all))},andSelf:function(){return this.add(this.prevObject)}});function isDisconnected(node){return !node||!node.parentNode||node.parentNode.nodeType===11}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return jQuery.nth(elem,2,"nextSibling")},prev:function(elem){return jQuery.nth(elem,2,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret)}ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if((this.length>1||rmultiselector.test(selector))&&rparentsprev.test(name)){ret=ret.reverse()}return this.pushStack(ret,name,slice.call(arguments).join(","))}});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")"}return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems)},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},nth:function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir]){if(cur.nodeType===1&&++num===result){break}}return cur},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n)}}return r}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep})}else{if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep})}else{if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep)}else{qualifier=jQuery.filter(qualifier,filtered)}}}}return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}var nodeNames="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:\d+|null)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")","i"),rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)/,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document);wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"div<div>","</div>"]}jQuery.fn.extend({text:function(text){if(jQuery.isFunction(text)){return this.each(function(i){var self=jQuery(this);self.text(text.call(this,i,self.text()))})}if(typeof text!=="object"&&text!==undefined){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text))}return jQuery.text(this)},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1){this.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1){this.insertBefore(elem,this.firstChild)}})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this)})}else{if(arguments.length){var set=jQuery.clean(arguments);set.push.apply(set,this.toArray());return this.pushStack(set,"before",arguments)}}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)})}else{if(arguments.length){var set=this.pushStack(this,"after",arguments);set.push.apply(set,jQuery.clean(arguments));return set}}},remove:function(selector,keepData){for(var i=0,elem;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem])}if(elem.parentNode){elem.parentNode.removeChild(elem)}}}return this},empty:function(){for(var i=0,elem;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"))}while(elem.firstChild){elem.removeChild(elem.firstChild)}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){if(value===undefined){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(rinlinejQuery,""):null}else{if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(var i=0,l=this.length;i<l;i++){if(this[i].nodeType===1){jQuery.cleanData(this[i].getElementsByTagName("*"));this[i].innerHTML=value}}}catch(e){this.empty().append(value)}}else{if(jQuery.isFunction(value)){this.each(function(i){var self=jQuery(this);self.html(value.call(this,i,self.html()))})}else{this.empty().append(value)}}}return this},replaceWith:function(value){if(this[0]&&this[0].parentNode){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old))})}if(typeof value!=="string"){value=jQuery(value).detach()}return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value)}else{jQuery(parent).append(value)}})}else{return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this}},detach:function(selector){return this.remove(selector,true)},domManip:function(args,table,callback){var results,first,fragment,parent,value=args[0],scripts=[];if(!jQuery.support.checkClone&&arguments.length===3&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback,true)})}if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback)})}if(this[0]){parent=value&&value.parentNode;if(jQuery.support.parentNode&&parent&&parent.nodeType===11&&parent.childNodes.length===this.length){results={fragment:parent}}else{results=jQuery.buildFragment(args,this,scripts)}fragment=results.fragment;if(fragment.childNodes.length===1){first=fragment=fragment.firstChild}else{first=fragment.firstChild}if(first){table=table&&jQuery.nodeName(first,"tr");for(var i=0,l=this.length,lastIndex=l-1;i<l;i++){callback.call(table?root(this[i],first):this[i],results.cacheable||(l>1&&i<lastIndex)?jQuery.clone(fragment,true,true):fragment)}}if(scripts.length){jQuery.each(scripts,evalScript)}}return this}});function root(elem,cur){return jQuery.nodeName(elem,"table")?(elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody"))):elem}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type+(events[type][i].namespace?".":"")+events[type][i].namespace,events[type][i],events[type][i].data)}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return}if(dest.clearAttributes){dest.clearAttributes()}if(dest.mergeAttributes){dest.mergeAttributes(src)}nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){dest.outerHTML=src.outerHTML}else{if(nodeName==="input"&&(src.type==="checkbox"||src.type==="radio")){if(src.checked){dest.defaultChecked=dest.checked=src.checked}if(dest.value!==src.value){dest.value=src.value}}else{if(nodeName==="option"){dest.selected=src.defaultSelected}else{if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}}}dest.removeAttribute(jQuery.expando)}jQuery.buildFragment=function(args,nodes,scripts){var fragment,cacheable,cacheresults,doc,first=args[0];if(nodes&&nodes[0]){doc=nodes[0].ownerDocument||nodes[0]}if(!doc.createDocumentFragment){doc=document}if(args.length===1&&typeof first==="string"&&first.length<512&&doc===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;cacheresults=jQuery.fragments[first];if(cacheresults&&cacheresults!==1){fragment=cacheresults}}if(!fragment){fragment=doc.createDocumentFragment();jQuery.clean(args,doc,fragment,scripts)}if(cacheable){jQuery.fragments[first]=cacheresults?fragment:1}return{fragment:fragment,cacheable:cacheable}};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var ret=[],insert=jQuery(selector),parent=this.length===1&&this[0].parentNode;if(parent&&parent.nodeType===11&&parent.childNodes.length===1&&insert.length===1){insert[original](this[0]);return this}else{for(var i=0,l=insert.length;i<l;i++){var elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems)}return this.pushStack(ret,name,insert.selector)}}});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*")}else{if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*")}else{return[]}}}function fixDefaultChecked(elem){if(elem.type==="checkbox"||elem.type==="radio"){elem.defaultChecked=elem.checked}}function findInputs(elem){var nodeName=(elem.nodeName||"").toLowerCase();if(nodeName==="input"){fixDefaultChecked(elem)}else{if(nodeName!=="script"&&typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked)}}}function shimCloneNode(elem){var div=document.createElement("div");safeFragment.appendChild(div);div.innerHTML=elem.outerHTML;return div.firstChild}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone=jQuery.support.html5Clone||!rnoshimcache.test("<"+elem.nodeName)?elem.cloneNode(true):shimCloneNode(elem);if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i])}}}if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i])}}}srcElements=destElements=null;return clone},clean:function(elems,context,fragment,scripts){var checkScriptType;context=context||document;if(typeof context.createElement==="undefined"){context=context.ownerDocument||context[0]&&context[0].ownerDocument||document}var ret=[],j;for(var i=0,elem;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+=""}if(!elem){continue}if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem)}else{elem=elem.replace(rxhtmlTag,"<$1></$2>");var tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,depth=wrap[0],div=context.createElement("div");if(context===document){safeFragment.appendChild(div)}else{createSafeFragment(context).appendChild(div)}div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild}if(!jQuery.support.tbody){var hasBody=rtbody.test(elem),tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j])}}}if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild)}elem=div.childNodes}}var len;if(!jQuery.support.appendChecked){if(elem[0]&&typeof(len=elem.length)==="number"){for(j=0;j<len;j++){findInputs(elem[j])}}else{findInputs(elem)}}if(elem.nodeType){ret.push(elem)}else{ret=jQuery.merge(ret,elem)}}if(fragment){checkScriptType=function(elem){return !elem.type||rscriptType.test(elem.type)};for(i=0;ret[i];i++){if(scripts&&jQuery.nodeName(ret[i],"script")&&(!ret[i].type||ret[i].type.toLowerCase()==="text/javascript")){scripts.push(ret[i].parentNode?ret[i].parentNode.removeChild(ret[i]):ret[i])}else{if(ret[i].nodeType===1){var jsTags=jQuery.grep(ret[i].getElementsByTagName("script"),checkScriptType);ret.splice.apply(ret,[i+1,0].concat(jsTags))}fragment.appendChild(ret[i])}}}return ret},cleanData:function(elems){var data,id,cache=jQuery.cache,special=jQuery.event.special,deleteExpando=jQuery.support.deleteExpando;for(var i=0,elem;(elem=elems[i])!=null;i++){if(elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()]){continue}id=elem[jQuery.expando];if(id){data=cache[id];if(data&&data.events){for(var type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}if(data.handle){data.handle.elem=null}}if(deleteExpando){delete elem[jQuery.expando]}else{if(elem.removeAttribute){elem.removeAttribute(jQuery.expando)}}delete cache[id]}}}});function evalScript(i,elem){if(elem.src){jQuery.ajax({url:elem.src,async:false,dataType:"script"})}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,"/*$0*/"))}if(elem.parentNode){elem.parentNode.removeChild(elem)}}var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rupper=/([A-Z]|^ms)/g,rnumpx=/^-?\d+(?:px)?$/i,rnum=/^-?\d/,rrelNum=/^([\-+])=([\-+.\de]+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssWidth=["Left","Right"],cssHeight=["Top","Bottom"],curCSS,getComputedStyle,currentStyle;jQuery.fn.css=function(name,value){if(arguments.length===2&&value===undefined){return this}return jQuery.access(this,name,value,true,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)})};jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity","opacity");return ret===""?"1":ret}else{return elem.style.opacity}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,origName=jQuery.camelCase(name),style=elem.style,hooks=jQuery.cssHooks[origName];name=jQuery.cssProps[origName]||origName;if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(+(ret[1]+1)*+ret[2])+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!hooks||!("set" in hooks)||(value=hooks.set(elem,value))!==undefined){try{style[name]=value}catch(e){}}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra){var ret,hooks;name=jQuery.camelCase(name);hooks=jQuery.cssHooks[name];name=jQuery.cssProps[name]||name;if(name==="cssFloat"){name="float"}if(hooks&&"get" in hooks&&(ret=hooks.get(elem,true,extra))!==undefined){return ret}else{if(curCSS){return curCSS(elem,name)}}},swap:function(elem,options,callback){var old={};for(var name in options){old[name]=elem.style[name];elem.style[name]=options[name]}callback.call(elem);for(name in options){elem.style[name]=old[name]}}});jQuery.curCSS=jQuery.css;jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){var val;if(computed){if(elem.offsetWidth!==0){return getWH(elem,name,extra)}else{jQuery.swap(elem,cssShow,function(){val=getWH(elem,name,extra)})}return val}},set:function(elem,value){if(rnumpx.test(value)){value=parseFloat(value);if(value>=0){return value+"px"}}else{return value}}}});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(parseFloat(RegExp.$1)/100)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}}jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){var ret;jQuery.swap(elem,{display:"inline-block"},function(){if(computed){ret=curCSS(elem,"margin-right","marginRight")}else{ret=elem.style.marginRight}});return ret}}}});if(document.defaultView&&document.defaultView.getComputedStyle){getComputedStyle=function(elem,name){var ret,defaultView,computedStyle;name=name.replace(rupper,"-$1").toLowerCase();if((defaultView=elem.ownerDocument.defaultView)&&(computedStyle=defaultView.getComputedStyle(elem,null))){ret=computedStyle.getPropertyValue(name);if(ret===""&&!jQuery.contains(elem.ownerDocument.documentElement,elem)){ret=jQuery.style(elem,name)}}return ret}}if(document.documentElement.currentStyle){currentStyle=function(elem,name){var left,rsLeft,uncomputed,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret===null&&style&&(uncomputed=style[name])){ret=uncomputed}if(!rnumpx.test(ret)&&rnum.test(ret)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":(ret||0);ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft}}return ret===""?"auto":ret}}curCSS=getComputedStyle||currentStyle;function getWH(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,which=name==="width"?cssWidth:cssHeight,i=0,len=which.length;if(val>0){if(extra!=="border"){for(;i<len;i++){if(!extra){val-=parseFloat(jQuery.css(elem,"padding"+which[i]))||0}if(extra==="margin"){val+=parseFloat(jQuery.css(elem,extra+which[i]))||0}else{val-=parseFloat(jQuery.css(elem,"border"+which[i]+"Width"))||0}}}return val+"px"}val=curCSS(elem,name,name);if(val<0||val==null){val=elem.style[name]||0}val=parseFloat(val)||0;if(extra){for(;i<len;i++){val+=parseFloat(jQuery.css(elem,"padding"+which[i]))||0;if(extra!=="padding"){val+=parseFloat(jQuery.css(elem,"border"+which[i]+"Width"))||0}if(extra==="margin"){val+=parseFloat(jQuery.css(elem,extra+which[i]))||0}}}return val+"px"}if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){var width=elem.offsetWidth,height=elem.offsetHeight;return(width===0&&height===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||jQuery.css(elem,"display"))==="none")};jQuery.expr.filters.visible=function(elem){return !jQuery.expr.filters.hidden(elem)}}var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rselectTextarea=/^(?:select|textarea)/i,rspacesAjax=/\s+/,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,_load=jQuery.fn.load,prefilters={},transports={},ajaxLocation,ajaxLocParts,allTypes=["*/"]+["*"];try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}if(jQuery.isFunction(func)){var dataTypes=dataTypeExpression.toLowerCase().split(rspacesAjax),i=0,length=dataTypes.length,dataType,list,placeBefore;for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*"}list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func)}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters),selection;for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected)}}}if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected)}return selection}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}}jQuery.fn.extend({load:function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}else{if(!this.length){return this}}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)}var type="GET";if(params){if(jQuery.isFunction(params)){callback=params;params=undefined}else{if(typeof params==="object"){params=jQuery.param(params,jQuery.ajaxSettings.traditional);type="POST"}}}var self=this;jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status,responseText){responseText=jqXHR.responseText;if(jqXHR.isResolved()){jqXHR.done(function(r){responseText=r});self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText)}if(callback){self.each(callback,[responseText,status,jqXHR])}}});return this},serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f)}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type})}});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings)}else{settings=target;target=jQuery.ajaxSettings}ajaxExtend(target,settings);return target},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},ifModifiedKey,requestHeaders={},requestHeadersNames={},responseHeadersString,responseHeaders,transport,timeoutTimer,parts,state=0,fireGlobals,i,jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match===undefined?null:match},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},abort:function(statusText){statusText=statusText||"abort";if(transport){transport.abort(statusText)}done(0,statusText);return this}};function done(status,nativeStatusText,responses,headers){if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;var isSuccess,success,error,statusText=nativeStatusText,response=responses?ajaxHandleResponses(s,jqXHR,responses):undefined,lastModified,etag;if(status>=200&&status<300||status===304){if(s.ifModified){if((lastModified=jqXHR.getResponseHeader("Last-Modified"))){jQuery.lastModified[ifModifiedKey]=lastModified}if((etag=jqXHR.getResponseHeader("Etag"))){jQuery.etag[ifModifiedKey]=etag}}if(status===304){statusText="notmodified";isSuccess=true}else{try{success=ajaxConvert(s,response);statusText="success";isSuccess=true}catch(e){statusText="parsererror";error=e}}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=""+(nativeStatusText||statusText);if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop")}}}deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]]}}else{tmp=map[jqXHR.status];jqXHR.then(tmp,tmp)}}return this};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(rspacesAjax);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return false}fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data}ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"")}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey])}if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey])}}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){jqXHR.abort();return false}for(i in {success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}return jqXHR},param:function(a,traditional){var s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value)})}else{for(var prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")}});function buildParams(prefix,obj,traditional,add){if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"||jQuery.isArray(v)?i:"")+"]",v,traditional,add)}})}else{if(!traditional&&obj!=null&&typeof obj==="object"){for(var name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}}jQuery.extend({active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields,ct,type,finalDataType,firstDataType;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type]}}while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0] in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response){if(s.dataFilter){response=s.dataFilter(response,s.dataType)}var dataTypes=s.dataTypes,converters={},i,key,length=dataTypes.length,tmp,current=dataTypes[0],prev,conversion,conv,conv1,conv2;for(i=1;i<length;i++){if(i===1){for(key in s.converters){if(typeof key==="string"){converters[key.toLowerCase()]=s.converters[key]}}}prev=current;current=dataTypes[i];if(current==="*"){current=prev}else{if(prev!=="*"&&prev!==current){conversion=prev+" "+current;conv=converters[conversion]||converters["* "+current];if(!conv){conv2=undefined;for(conv1 in converters){tmp=conv1.split(" ");if(tmp[0]===prev||tmp[0]==="*"){conv2=converters[tmp[1]+" "+current];if(conv2){conv1=converters[conv1];if(conv1===true){conv=conv2}else{if(conv2===true){conv=conv1}}break}}}}if(!(conv||conv2)){jQuery.error("No conversion from "+conversion.replace(" "," to "))}if(conv!==true){response=conv?conv(response):conv2(conv1(response))}}}}return response}var jsc=jQuery.now(),jsre=/(\=)\?(&|$)|\?\?/i;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return jQuery.expando+"_"+(jsc++)}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var inspectData=s.contentType==="application/x-www-form-urlencoded"&&(typeof s.data==="string");if(s.dataTypes[0]==="jsonp"||s.jsonp!==false&&(jsre.test(s.url)||inspectData&&jsre.test(s.data))){var responseContainer,jsonpCallback=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,previous=window[jsonpCallback],url=s.url,data=s.data,replace="$1"+jsonpCallback+"$2";if(s.jsonp!==false){url=url.replace(jsre,replace);if(s.url===url){if(inspectData){data=data.replace(jsre,replace)}if(s.data===data){url+=(/\?/.test(url)?"&":"?")+s.jsonp+"="+jsonpCallback}}}s.url=url;s.data=data;window[jsonpCallback]=function(response){responseContainer=[response]};jqXHR.always(function(){window[jsonpCallback]=previous;if(responseContainer&&jQuery.isFunction(previous)){window[jsonpCallback](responseContainer[0])}});s.converters["script json"]=function(){if(!responseContainer){jQuery.error(jsonpCallback+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";return"script"}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET";s.global=false}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script)}script=undefined;if(!isAbort){callback(200,"success")}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(0,1)}}}}});var xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1)}}:false,xhrId=0,xhrCallbacks;function createStandardXHR(){try{return new window.XMLHttpRequest()}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return !this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials" in xhr)})})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var xhr=s.xhr(),handle,i;if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password)}else{xhr.open(s.type,s.url,s.async)}if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i]}}if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType)}if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}try{for(i in headers){xhr.setRequestHeader(i,headers[i])}}catch(_){}xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle]}}if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml}responses.text=xhr.responseText;try{statusText=xhr.statusText}catch(e){statusText=""}if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404}else{if(status===1223){status=204}}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException)}}if(responses){complete(status,statusText,responses,responseHeaders)}};if(!s.async||xhr.readyState===4){callback()}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort)}xhrCallbacks[handle]=callback}xhr.onreadystatechange=callback}},abort:function(){if(callback){callback(0,1)}}}}})}var elemdisplay={},iframe,iframeDoc,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,timerId,fxAttrs=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],fxNow;jQuery.fn.extend({show:function(speed,easing,callback){var elem,display;if(speed||speed===0){return this.animate(genFx("show",3),speed,easing,callback)}else{for(var i=0,j=this.length;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(!jQuery._data(elem,"olddisplay")&&display==="none"){display=elem.style.display=""}if(display===""&&jQuery.css(elem,"display")==="none"){jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName))}}}for(i=0;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(display===""||display==="none"){elem.style.display=jQuery._data(elem,"olddisplay")||""}}}return this}},hide:function(speed,easing,callback){if(speed||speed===0){return this.animate(genFx("hide",3),speed,easing,callback)}else{var elem,display,i=0,j=this.length;for(;i<j;i++){elem=this[i];if(elem.style){display=jQuery.css(elem,"display");if(display!=="none"&&!jQuery._data(elem,"olddisplay")){jQuery._data(elem,"olddisplay",display)}}}for(i=0;i<j;i++){if(this[i].style){this[i].style.display="none"}}return this}},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2,callback){var bool=typeof fn==="boolean";if(jQuery.isFunction(fn)&&jQuery.isFunction(fn2)){this._toggle.apply(this,arguments)}else{if(fn==null||bool){this.each(function(){var state=bool?fn:jQuery(this).is(":hidden");jQuery(this)[state?"show":"hide"]()})}else{this.animate(genFx("toggle",3),fn,fn2,callback)}}return this},fadeTo:function(speed,to,easing,callback){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);if(jQuery.isEmptyObject(prop)){return this.each(optall.complete,[false])}prop=jQuery.extend({},prop);function doAnimation(){if(optall.queue===false){jQuery._mark(this)}var opt=jQuery.extend({},optall),isElement=this.nodeType===1,hidden=isElement&&jQuery(this).is(":hidden"),name,val,p,e,parts,start,end,unit,method;opt.animatedProperties={};for(p in prop){name=jQuery.camelCase(p);if(p!==name){prop[name]=prop[p];delete prop[p]}val=prop[name];if(jQuery.isArray(val)){opt.animatedProperties[name]=val[1];val=prop[name]=val[0]}else{opt.animatedProperties[name]=opt.specialEasing&&opt.specialEasing[name]||opt.easing||"swing"}if(val==="hide"&&hidden||val==="show"&&!hidden){return opt.complete.call(this)}if(isElement&&(name==="height"||name==="width")){opt.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(jQuery.css(this,"display")==="inline"&&jQuery.css(this,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||defaultDisplay(this.nodeName)==="inline"){this.style.display="inline-block"}else{this.style.zoom=1}}}}if(opt.overflow!=null){this.style.overflow="hidden"}for(p in prop){e=new jQuery.fx(this,opt,p);val=prop[p];if(rfxtypes.test(val)){method=jQuery._data(this,"toggle"+p)||(val==="toggle"?hidden?"show":"hide":0);if(method){jQuery._data(this,"toggle"+p,method==="show"?"hide":"show");e[method]()}else{e[val]()}}else{parts=rfxnum.exec(val);start=e.cur();if(parts){end=parseFloat(parts[2]);unit=parts[3]||(jQuery.cssNumber[p]?"":"px");if(unit!=="px"){jQuery.style(this,p,(end||1)+unit);start=((end||1)/e.cur())*start;jQuery.style(this,p,start+unit)}if(parts[1]){end=((parts[1]==="-="?-1:1)*end)+start}e.custom(start,end,unit)}else{e.custom(start,val,"")}}}return true}return optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var index,hadTimers=false,timers=jQuery.timers,data=jQuery._data(this);if(!gotoEnd){jQuery._unmark(true,this)}function stopQueue(elem,data,index){var hooks=data[index];jQuery.removeData(elem,index,true);hooks.stop(gotoEnd)}if(type==null){for(index in data){if(data[index]&&data[index].stop&&index.indexOf(".run")===index.length-4){stopQueue(this,data,index)}}}else{if(data[index=type+".run"]&&data[index].stop){stopQueue(this,data,index)}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){if(gotoEnd){timers[index](true)}else{timers[index].saveState()}hadTimers=true;timers.splice(index,1)}}if(!(gotoEnd&&hadTimers)){jQuery.dequeue(this,type)}})}});function createFxNow(){setTimeout(clearFxNow,0);return(fxNow=jQuery.now())}function clearFxNow(){fxNow=undefined}function genFx(type,num){var obj={};jQuery.each(fxAttrs.concat.apply([],fxAttrs.slice(0,num)),function(){obj[this]=type});return obj}jQuery.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.extend({speed:function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(noUnmark){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}else{if(noUnmark!==false){jQuery._unmark(this)}}};return opt},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p},swing:function(p,n,firstNum,diff){return((-Math.cos(p*Math.PI)/2)+0.5)*diff+firstNum}},timers:[],fx:function(elem,options,prop){this.options=options;this.elem=elem;this.prop=prop;options.orig=options.orig||{}}});jQuery.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var parsed,r=jQuery.css(this.elem,this.prop);return isNaN(parsed=parseFloat(r))?!r||r==="auto"?0:r:parsed},custom:function(from,to,unit){var self=this,fx=jQuery.fx;this.startTime=fxNow||createFxNow();this.end=to;this.now=this.start=from;this.pos=this.state=0;this.unit=unit||this.unit||(jQuery.cssNumber[this.prop]?"":"px");function t(gotoEnd){return self.step(gotoEnd)}t.queue=this.options.queue;t.elem=this.elem;t.saveState=function(){if(self.options.hide&&jQuery._data(self.elem,"fxshow"+self.prop)===undefined){jQuery._data(self.elem,"fxshow"+self.prop,self.start)}};if(t()&&jQuery.timers.push(t)&&!timerId){timerId=setInterval(fx.tick,fx.interval)}},show:function(){var dataShow=jQuery._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=dataShow||jQuery.style(this.elem,this.prop);this.options.show=true;if(dataShow!==undefined){this.custom(this.cur(),dataShow)}else{this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur())}jQuery(this.elem).show()},hide:function(){this.options.orig[this.prop]=jQuery._data(this.elem,"fxshow"+this.prop)||jQuery.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(gotoEnd){var p,n,complete,t=fxNow||createFxNow(),done=true,elem=this.elem,options=this.options;if(gotoEnd||t>=options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();options.animatedProperties[this.prop]=true;for(p in options.animatedProperties){if(options.animatedProperties[p]!==true){done=false}}if(done){if(options.overflow!=null&&!jQuery.support.shrinkWrapBlocks){jQuery.each(["","X","Y"],function(index,value){elem.style["overflow"+value]=options.overflow[index]})}if(options.hide){jQuery(elem).hide()}if(options.hide||options.show){for(p in options.animatedProperties){jQuery.style(elem,p,options.orig[p]);jQuery.removeData(elem,"fxshow"+p,true);jQuery.removeData(elem,"toggle"+p,true)}}complete=options.complete;if(complete){options.complete=false;complete.call(elem)}}return false}else{if(options.duration==Infinity){this.now=t}else{n=t-this.startTime;this.state=n/options.duration;this.pos=jQuery.easing[options.animatedProperties[this.prop]](this.state,n,0,1,options.duration);this.now=this.start+((this.end-this.start)*this.pos)}this.update()}return true}};jQuery.extend(jQuery.fx,{tick:function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}},interval:13,stop:function(){clearInterval(timerId);timerId=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(fx){jQuery.style(fx.elem,"opacity",fx.now)},_default:function(fx){if(fx.elem.style&&fx.elem.style[fx.prop]!=null){fx.elem.style[fx.prop]=fx.now+fx.unit}else{fx.elem[fx.prop]=fx.now}}}});jQuery.each(["width","height"],function(i,prop){jQuery.fx.step[prop]=function(fx){jQuery.style(fx.elem,prop,Math.max(0,fx.now)+fx.unit)}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}function defaultDisplay(nodeName){if(!elemdisplay[nodeName]){var body=document.body,elem=jQuery("<"+nodeName+">").appendTo(body),display=elem.css("display");elem.remove();if(display==="none"||display===""){if(!iframe){iframe=document.createElement("iframe");iframe.frameBorder=iframe.width=iframe.height=0}body.appendChild(iframe);if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write((document.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");iframeDoc.close()}elem=iframeDoc.createElement(nodeName);iframeDoc.body.appendChild(elem);display=jQuery.css(elem,"display");body.removeChild(iframe)}elemdisplay[nodeName]=display}return elemdisplay[nodeName]}var rtable=/^t(?:able|d|h)$/i,rroot=/^(?:body|html)$/i;if("getBoundingClientRect" in document.documentElement){jQuery.fn.offset=function(options){var elem=this[0],box;if(options){return this.each(function(i){jQuery.offset.setOffset(this,options,i)})}if(!elem||!elem.ownerDocument){return null}if(elem===elem.ownerDocument.body){return jQuery.offset.bodyOffset(elem)}try{box=elem.getBoundingClientRect()}catch(e){}var doc=elem.ownerDocument,docElem=doc.documentElement;if(!box||!jQuery.contains(docElem,elem)){return box?{top:box.top,left:box.left}:{top:0,left:0}}var body=doc.body,win=getWindow(doc),clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||jQuery.support.boxModel&&docElem.scrollTop||body.scrollTop,scrollLeft=win.pageXOffset||jQuery.support.boxModel&&docElem.scrollLeft||body.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:top,left:left}}}else{jQuery.fn.offset=function(options){var elem=this[0];if(options){return this.each(function(i){jQuery.offset.setOffset(this,options,i)})}if(!elem||!elem.ownerDocument){return null}if(elem===elem.ownerDocument.body){return jQuery.offset.bodyOffset(elem)}var computedStyle,offsetParent=elem.offsetParent,prevOffsetParent=elem,doc=elem.ownerDocument,docElem=doc.documentElement,body=doc.body,defaultView=doc.defaultView,prevComputedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle,top=elem.offsetTop,left=elem.offsetLeft;while((elem=elem.parentNode)&&elem!==body&&elem!==docElem){if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"){break}computedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle;top-=elem.scrollTop;left-=elem.scrollLeft;if(elem===offsetParent){top+=elem.offsetTop;left+=elem.offsetLeft;if(jQuery.support.doesNotAddBorder&&!(jQuery.support.doesAddBorderForTableAndCells&&rtable.test(elem.nodeName))){top+=parseFloat(computedStyle.borderTopWidth)||0;left+=parseFloat(computedStyle.borderLeftWidth)||0}prevOffsetParent=offsetParent;offsetParent=elem.offsetParent}if(jQuery.support.subtractsBorderForOverflowNotVisible&&computedStyle.overflow!=="visible"){top+=parseFloat(computedStyle.borderTopWidth)||0;left+=parseFloat(computedStyle.borderLeftWidth)||0}prevComputedStyle=computedStyle}if(prevComputedStyle.position==="relative"||prevComputedStyle.position==="static"){top+=body.offsetTop;left+=body.offsetLeft}if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"){top+=Math.max(docElem.scrollTop,body.scrollTop);left+=Math.max(docElem.scrollLeft,body.scrollLeft)}return{top:top,left:left}}}jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0}return{top:top,left:left}},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative"}var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft}if("using" in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return null}var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent})}});jQuery.each(["Left","Top"],function(i,name){var method="scroll"+name;jQuery.fn[method]=function(val){var elem,win;if(val===undefined){elem=this[0];if(!elem){return null}win=getWindow(elem);return win?("pageXOffset" in win)?win[i?"pageYOffset":"pageXOffset"]:jQuery.support.boxModel&&win.document.documentElement[method]||win.document.body[method]:elem[method]}return this.each(function(){win=getWindow(this);if(win){win.scrollTo(!i?val:jQuery(win).scrollLeft(),i?val:jQuery(win).scrollTop())}else{this[method]=val}})}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.each(["Height","Width"],function(i,name){var type=name.toLowerCase();jQuery.fn["inner"+name]=function(){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,"padding")):this[type]():null};jQuery.fn["outer"+name]=function(margin){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,margin?"margin":"border")):this[type]():null};jQuery.fn[type]=function(size){var elem=this[0];if(!elem){return size==null?null:this}if(jQuery.isFunction(size)){return this.each(function(i){var self=jQuery(this);self[type](size.call(this,i,self[type]()))})}if(jQuery.isWindow(elem)){var docElemProp=elem.document.documentElement["client"+name],body=elem.document.body;return elem.document.compatMode==="CSS1Compat"&&docElemProp||body&&body["client"+name]||docElemProp}else{if(elem.nodeType===9){return Math.max(elem.documentElement["client"+name],elem.body["scroll"+name],elem.documentElement["scroll"+name],elem.body["offset"+name],elem.documentElement["offset"+name])}else{if(size===undefined){var orig=jQuery.css(elem,type),ret=parseFloat(orig);return jQuery.isNumeric(ret)?ret:orig}else{return this.css(type,typeof size==="string"?size:size+"px")}}}}});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery})}})(window);
/*!
 * jQuery UI 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function($,undefined){$.ui=$.ui||{};if($.ui.version){return}$.extend($.ui,{version:"1.8.16",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});$.fn.extend({propAttr:$.fn.prop||$.fn.attr,_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem)}},delay)}):this._focus.apply(this,arguments)},scrollParent:function(){var scrollParent;if(($.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.curCSS(this,"position",1))&&(/(auto|scroll)/).test($.curCSS(this,"overflow",1)+$.curCSS(this,"overflow-y",1)+$.curCSS(this,"overflow-x",1))}).eq(0)}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.curCSS(this,"overflow",1)+$.curCSS(this,"overflow-y",1)+$.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex)}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value}}elem=elem.parent()}}return 0},disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.curCSS(elem,"padding"+this,true))||0;if(border){size-=parseFloat($.curCSS(elem,"border"+this+"Width",true))||0}if(margin){size-=parseFloat($.curCSS(elem,"margin"+this,true))||0}});return size}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this)}return this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size)}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px")})}});function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();if("area"===nodeName){var map=element.parentNode,mapName=map.name,img;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false}img=$("img[usemap=#"+mapName+"]")[0];return !!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"==nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return !$(element).parents().andSelf().filter(function(){return $.curCSS(this,"visibility")==="hidden"||$.expr.filters.hidden(this)}).length}$.extend($.expr[":"],{data:function(elem,i,match){return !!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart" in div;body.removeChild(div).style.display="none"});$.extend($.ui,{plugin:{add:function(module,option,set){var proto=$.ui[module].prototype;for(var i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var set=instance.plugins[name];if(!set||!instance.element[0].parentNode){return}for(var i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args)}}}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false}var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true}el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has},isOverAxis:function(x,reference,size){return(x>reference)&&(x<(reference+size))},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width)}})})(jQuery);
/*!
 * jQuery UI Widget 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function($,undefined){if($.cleanData){var _cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove")}catch(e){}}_cleanData(elems)}}else{var _remove=$.fn.remove;$.fn.remove=function(selector,keepData){return this.each(function(){if(!keepData){if(!selector||$.filter(selector,[this]).length){$("*",this).add([this]).each(function(){try{$(this).triggerHandler("remove")}catch(e){}})}}return _remove.call($(this),selector,keepData)})}}$.widget=function(name,base,prototype){var namespace=name.split(".")[0],fullName;name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName]=function(elem){return !!$.data(elem,name)};$[namespace]=$[namespace]||{};$[namespace][name]=function(options,element){if(arguments.length){this._createWidget(options,element)}};var basePrototype=new base();basePrototype.options=$.extend(true,{},basePrototype.options);$[namespace][name].prototype=$.extend(true,basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:$[namespace][name].prototype.widgetEventPrefix||name,widgetBaseClass:fullName},prototype);$.widget.bridge(name,$[namespace][name])};$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=Array.prototype.slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.extend.apply(null,[true,options].concat(args)):options;if(isMethodCall&&options.charAt(0)==="_"){return returnValue}if(isMethodCall){this.each(function(){var instance=$.data(this,name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue;return false}})}else{this.each(function(){var instance=$.data(this,name);if(instance){instance.option(options||{})._init()}else{$.data(this,name,new object(options,this))}})}return returnValue}};$.Widget=function(options,element){if(arguments.length){this._createWidget(options,element)}};$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(options,element){$.data(element,this.widgetName,this);this.element=$(element);this.options=$.extend(true,{},this.options,this._getCreateOptions(),options);var self=this;this.element.bind("remove."+this.widgetName,function(){self.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(key,value){var options=key;if(arguments.length===0){return $.extend({},this.options)}if(typeof key==="string"){if(value===undefined){return this.options[key]}options={};options[key]=value}this._setOptions(options);return this},_setOptions:function(options){var self=this;$.each(options,function(key,value){self._setOption(key,value)});return this},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget()[value?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",value)}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(type,event,data){var callback=this.options[type];event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();data=data||{};if(event.originalEvent){for(var i=$.event.props.length,prop;i;){prop=$.event.props[--i];event[prop]=event.originalEvent[prop]}}this.element.trigger(event,data);return !($.isFunction(callback)&&callback.call(this.element[0],event,data)===false||event.isDefaultPrevented())}}})(jQuery);
/*!
 * jQuery UI Mouse 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
(function($,undefined){var mouseHandled=false;$(document).mouseup(function(e){mouseHandled=false});$.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var self=this;this.element.bind("mousedown."+this.widgetName,function(event){return self._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,self.widgetName+".preventClickEvent")){$.removeData(event.target,self.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(event){if(mouseHandled){return}(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var self=this,btnIsLeft=(event.which==1),elIsCancel=(typeof this.options.cancel=="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){self.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return self._mouseMove(event)};this._mouseUpDelegate=function(event){return self._mouseUp(event)};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function(event){if($.browser.msie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event)}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event))}return !this._mouseStarted},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target==this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}return false},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance)},_mouseDelayMet:function(event){return this.mouseDelayMet},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return true}})})(jQuery);(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative"}(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit()},destroy:function(){if(!this.element.data("draggable")){return}this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).is(".ui-resizable-handle")){return false}this.handle=this._getHandle(event);if(!this.handle){return false}if(o.iframeFix){$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body")})}return true},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));if(o.containment){this._setContainment()}if(this._trigger("start",event)===false){this._clear();return false}this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this.helper.addClass("ui-draggable-dragging");this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event)}return true},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp({});return false}this.position=ui.position}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}return false},_mouseStop:function(event){var dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event)}if(this.dropped){dropped=this.dropped;this.dropped=false}if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original"){return false}if((this.options.revert=="invalid"&&!dropped)||(this.options.revert=="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){var self=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(self._trigger("stop",event)!==false){self._clear()}})}else{if(this._trigger("stop",event)!==false){this._clear()}}return false},_mouseUp:function(event){if(this.options.iframeFix===true){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event)}return $.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?true:false;$(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==event.target){handle=true}});return handle},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper=="clone"?this.element.clone().removeAttr("id"):this.element);if(!helper.parents("body").length){helper.appendTo((o.appendTo=="parent"?this.element[0].parentNode:o.appendTo))}if(helper[0]!=this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position"))){helper.css("position","absolute")}return helper},_adjustOffsetFromHelper:function(obj){if(typeof obj=="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left" in obj){this.offset.click.left=obj.left+this.margins.left}if("right" in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top" in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom" in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&$.browser.msie)){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;if(o.containment=="parent"){o.containment=this.helper[0].parentNode}if(o.containment=="document"||o.containment=="window"){this.containment=[o.containment=="document"?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=="document"?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=="document"?0:$(window).scrollLeft())+$(o.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=="document"?0:$(window).scrollTop())+($(o.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment);var ce=c[0];if(!ce){return}var co=c.offset();var over=($(ce).css("overflow")!="hidden");this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c}else{if(o.containment.constructor==Array){this.containment=o.containment}}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position}var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))}},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else{containment=this.containment}if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top}}if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?(!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:(!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?(!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:(!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0])):left}}return{top:(pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type=="drag"){this.positionAbs=this._convertPositionTo("absolute")}return $.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});$.extend($.ui.draggable,{version:"1.8.16"});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,"sortable");if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable)}})},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=true}this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper=="original"){this.instance.currentItem.css({top:"auto",left:"auto"})}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable)}})},drag:function(event,ui){var inst=$(this).data("draggable"),self=this;var checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left;var itemHeight=o.height,itemWidth=o.width;var itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth)};$.each(inst.sortables,function(i){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(self).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0]};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst}if(this.instance.currentItem){this.instance._mouseDrag(event)}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove()}inst._trigger("fromSortable",event);inst.dropped=false}}})}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$("body"),o=$(this).data("draggable").options;if(t.css("cursor")){o._cursor=t.css("cursor")}t.css("cursor",o.cursor)},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._cursor){$("body").css("cursor",o._cursor)}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("opacity")){o._opacity=t.css("opacity")}t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._opacity){$(ui.helper).css("opacity",o._opacity)}}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"){i.overflowOffset=i.scrollParent.offset()}},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"){if(!o.axis||o.axis!="x"){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed}else{if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed}}}if(!o.axis||o.axis!="y"){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed}else{if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed}}}}else{if(!o.axis||o.axis!="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else{if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}}}if(!o.axis||o.axis!="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else{if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event)}}});$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!=String?(o.snap.items||":data(draggable)"):o.snap).each(function(){var $t=$(this);var $o=$t.offset();if(this!=i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})}})},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options;var d=o.snapTolerance;var x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!((l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d)||(l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d)||(l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d)||(l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d))){if(inst.snapElements[i].snapping){(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})))}inst.snapElements[i].snapping=false;continue}if(o.snapMode!="inner"){var ts=Math.abs(t-y2)<=d;var bs=Math.abs(b-y1)<=d;var ls=Math.abs(l-x2)<=d;var rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left}}var first=(ts||bs||ls||rs);if(o.snapMode!="outer"){var ts=Math.abs(t-y1)<=d;var bs=Math.abs(b-y2)<=d;var ls=Math.abs(l-x1)<=d;var rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left}}if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})))}inst.snapElements[i].snapping=(ts||bs||ls||rs||first)}}});$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options;var group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(!group.length){return}var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i});this[0].style.zIndex=min+group.length}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("zIndex")){o._zIndex=t.css("zIndex")}t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex)}}})})(jQuery);(function($,undefined){$.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"},_create:function(){var o=this.options,accept=o.accept;this.isover=0;this.isout=1;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);(o.addClasses&&this.element.addClass("ui-droppable"))},destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];for(var i=0;i<drop.length;i++){if(drop[i]==this){drop.splice(i,1)}}this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(key,value){if(key=="accept"){this.accept=$.isFunction(value)?value:function(d){return d.is(value)}}$.Widget.prototype._setOption.apply(this,arguments)},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.addClass(this.options.activeClass)}(draggable&&this._trigger("activate",event,this.ui(draggable)))},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}(draggable&&this._trigger("deactivate",event,this.ui(draggable)))},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0]){return}if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass){this.element.addClass(this.options.hoverClass)}this._trigger("over",event,this.ui(draggable))}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0]){return}if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("out",event,this.ui(draggable))}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0]){return false}var childrenIntersection=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,"droppable");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false}});if(childrenIntersection){return false}if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("drop",event,this.ui(draggable));return this.element}return false},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs}}});$.extend($.ui.droppable,{version:"1.8.16"});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset){return false}var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height;var l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case"fit":return(l<=x1&&x2<=r&&t<=y1&&y2<=b);break;case"intersect":return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);break;case"pointer":var draggableLeft=((draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left),draggableTop=((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top),isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;break;case"touch":return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));break;default:return false;break}};$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[];var type=event?event.type:null;var list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element)))){continue}for(var j=0;j<list.length;j++){if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop}}m[i].visible=m[i].element.css("display")!="none";if(!m[i].visible){continue}if(type=="mousedown"){m[i]._activate.call(m[i],event)}m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight}}},drop:function(draggable,event){var dropped=false;$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options){return}if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance)){dropped=dropped||this._drop.call(this,event)}if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=1;this.isover=0;this._deactivate.call(this,event)}});return dropped},dragStart:function(draggable,event){draggable.element.parents(":not(body,html)").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}})},drag:function(draggable,event){if(draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return}var intersects=$.ui.intersect(draggable,this,this.options.tolerance);var c=!intersects&&this.isover==1?"isout":(intersects&&this.isover==0?"isover":null);if(!c){return}var parentInstance;if(this.options.greedy){var parent=this.element.parents(":data(droppable):eq(0)");if(parent.length){parentInstance=$.data(parent[0],"droppable");parentInstance.greedyChild=(c=="isover"?1:0)}}if(parentInstance&&c=="isover"){parentInstance.isover=0;parentInstance.isout=1;parentInstance._out.call(parentInstance,event)}this[c]=1;this[c=="isout"?"isover":"isout"]=0;this[c=="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c=="isout"){parentInstance.isout=0;parentInstance.isover=1;parentInstance._over.call(parentInstance,event)}})},dragStop:function(draggable,event){draggable.element.parents(":not(body,html)").unbind("scroll.droppable");if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}}}})(jQuery);(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var self=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){if(/relative/.test(this.element.css("position"))&&$.browser.opera){this.element.css({position:"relative",top:"auto",left:"auto"})}this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=o.handles||(!$(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all"){this.handles="n,e,s,w,se,sw,ne,nw"}var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname="ui-resizable-"+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');if(/sw|se|ne|nw/.test(handle)){axis.css({zIndex:++o.zIndex})}if("se"==handle){axis.addClass("ui-icon ui-icon-gripsmall-diagonal-se")}this.handles[handle]=".ui-resizable-"+handle;this.element.append(axis)}}this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String){this.handles[i]=$(this.handles[i],this.element).show()}if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");target.css(padPos,padWrapper);this._proportionallyResize()}if(!$(this.handles[i]).length){continue}}};this._renderAxis(this.element);this._handles=$(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!self.resizing){if(this.className){var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)}self.axis=axis&&axis[1]?axis[1]:"se"}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").hover(function(){if(o.disabled){return}$(this).removeClass("ui-resizable-autohide");self._handles.show()},function(){if(o.disabled){return}if(!self.resizing){$(this).addClass("ui-resizable-autohide");self._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;wrapper.after(this.originalElement.css({position:wrapper.css("position"),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css("top"),left:wrapper.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);_destroy(this.originalElement);return this},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true}}return !this.options.disabled&&handle},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is(".ui-draggable")||(/absolute/).test(el.css("position"))){el.css({position:"absolute",top:iniPos.top,left:iniPos.left})}if($.browser.opera&&(/relative/).test(el.css("position"))){el.css({position:"relative",top:"auto",left:"auto"})}this._renderProxy();var curleft=num(this.helper.css("left")),curtop=num(this.helper.css("top"));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=="number")?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$(".ui-resizable-"+this.axis).css("cursor");$("body").css("cursor",cursor=="auto"?this.axis+"-resize":cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},self=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger){return false}var data=trigger.apply(this,[event,dx,dy]),ie6=$.browser.msie&&$.browser.version<7,csdif=this.sizeDiff;this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey){data=this._updateRatio(data,event)}data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize()}this._updateCache(data);this._trigger("resize",event,this.ui());return false},_mouseStop:function(event){this.resizing=false;var o=this.options,self=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],"left")?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var s={width:(self.helper.width()-soffsetw),height:(self.helper.height()-soffseth)},left=(parseInt(self.element.css("left"),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css("top"),10)+(self.position.top-self.originalPosition.top))||null;if(!o.animate){this.element.css($.extend(s,{top:top,left:left}))}self.helper.height(self.size.height);self.helper.width(self.size.width);if(this._helper&&!o.animate){this._proportionallyResize()}}$("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper){this.helper.remove()}return false},_updateVirtualBoundaries:function(forceAspectRatio){var o=this.options,pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth){b.minWidth=pMinWidth}if(pMinHeight>b.minHeight){b.minHeight=pMinHeight}if(pMaxWidth<b.maxWidth){b.maxWidth=pMaxWidth}if(pMaxHeight<b.maxHeight){b.maxHeight=pMaxHeight}}this._vBoundaries=b},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left)){this.position.left=data.left}if(isNumber(data.top)){this.position.top=data.top}if(isNumber(data.height)){this.size.height=data.height}if(isNumber(data.width)){this.size.width=data.width}},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(isNumber(data.height)){data.width=(data.height*this.aspectRatio)}else{if(isNumber(data.width)){data.height=(data.width/this.aspectRatio)}}if(a=="sw"){data.left=cpos.left+(csize.width-data.width);data.top=null}if(a=="nw"){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width)}return data},_respectSize:function(data,event){var el=this.helper,o=this._vBoundaries,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw){data.width=o.minWidth}if(isminh){data.height=o.minHeight}if(ismaxw){data.width=o.maxWidth}if(ismaxh){data.height=o.maxHeight}var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw){data.left=dw-o.minWidth}if(ismaxw&&cw){data.left=dw-o.maxWidth}if(isminh&&ch){data.top=dh-o.minHeight}if(ismaxh&&ch){data.top=dh-o.maxHeight}var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top){data.top=null}else{if(isNotwh&&!data.top&&data.left){data.left=null}}return data},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length){return}var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css("borderTopWidth"),prel.css("borderRightWidth"),prel.css("borderBottomWidth"),prel.css("borderLeftWidth")],p=[prel.css("paddingTop"),prel.css("paddingRight"),prel.css("paddingBottom"),prel.css("paddingLeft")];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding})}if($.browser.msie&&!(!($(element).is(":hidden")||$(element).parents(":hidden").length))){continue}prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0})}},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6=$.browser.msie&&$.browser.version<7,ie6offset=(ie6?1:0),pxyoffset=(ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:"absolute",left:this.elementOffset.left-ie6offset+"px",top:this.elementOffset.top-ie6offset+"px",zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection()}else{this.helper=this.element}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx}},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx}},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy}},s:function(event,dx,dy){return{height:this.originalSize.height+dy}},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]))},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]))},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]))},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]))}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()))},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});$.extend($.ui.resizable,{version:"1.8.16"});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css("left"),10),top:parseInt(el.css("top"),10),position:el.css("position")})})};if(typeof(o.alsoResize)=="object"&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize)}else{$.each(o.alsoResize,function(exp){_store(exp)})}}else{_store(o.alsoResize)}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,os=self.originalSize,op=self.originalPosition;var delta={height:(self.size.height-os.height)||0,width:(self.size.width-os.width)||0,top:(self.position.top-op.top)||0,left:(self.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?["width","height"]:["width","height","top","left"];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0){style[prop]=sum||null}});if($.browser.opera&&/relative/.test(el.css("position"))){self._revertToRelativePosition=true;el.css({position:"absolute",top:"auto",left:"auto"})}el.css(style)})};if(typeof(o.alsoResize)=="object"&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c)})}else{_alsoResize(o.alsoResize)}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _reset=function(exp){$(exp).each(function(){var el=$(this);el.css({position:el.data("resizable-alsoresize").position})})};if(self._revertToRelativePosition){self._revertToRelativePosition=false;if(typeof(o.alsoResize)=="object"&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp){_reset(exp)})}else{_reset(o.alsoResize)}}$(this).removeData("resizable-alsoresize")}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var pr=self._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],"left")?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var style={width:(self.size.width-soffsetw),height:(self.size.height-soffseth)},left=(parseInt(self.element.css("left"),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css("top"),10)+(self.position.top-self.originalPosition.top))||null;self.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(self.element.css("width"),10),height:parseInt(self.element.css("height"),10),top:parseInt(self.element.css("top"),10),left:parseInt(self.element.css("left"),10)};if(pr&&pr.length){$(pr[0]).css({width:data.width,height:data.height})}self._updateCache(data);self._propagate("resize",event)}})}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,el=self.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce){return}self.containerElement=$(ce);if(/document/.test(oc)||oc==document){self.containerOffset={left:0,top:0};self.containerPosition={left:0,top:0};self.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight}}else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name))});self.containerOffset=element.offset();self.containerPosition=element.position();self.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=self.containerOffset,ch=self.containerSize.height,cw=self.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);self.parentData={element:ce,left:co.left,top:co.top,width:width,height:height}}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,ps=self.containerSize,co=self.containerOffset,cs=self.size,cp=self.position,pRatio=self._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=self.containerElement;if(ce[0]!=document&&(/static/).test(ce.css("position"))){cop=co}if(cp.left<(self._helper?co.left:0)){self.size.width=self.size.width+(self._helper?(self.position.left-co.left):(self.position.left-cop.left));if(pRatio){self.size.height=self.size.width/o.aspectRatio}self.position.left=o.helper?co.left:0}if(cp.top<(self._helper?co.top:0)){self.size.height=self.size.height+(self._helper?(self.position.top-co.top):self.position.top);if(pRatio){self.size.width=self.size.height*o.aspectRatio}self.position.top=self._helper?co.top:0}self.offset.left=self.parentData.left+self.position.left;self.offset.top=self.parentData.top+self.position.top;var woset=Math.abs((self._helper?self.offset.left-cop.left:(self.offset.left-cop.left))+self.sizeDiff.width),hoset=Math.abs((self._helper?self.offset.top-cop.top:(self.offset.top-co.top))+self.sizeDiff.height);var isParent=self.containerElement.get(0)==self.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(self.containerElement.css("position"));if(isParent&&isOffsetRelative){woset-=self.parentData.left}if(woset+self.size.width>=self.parentData.width){self.size.width=self.parentData.width-woset;if(pRatio){self.size.height=self.size.width/self.aspectRatio}}if(hoset+self.size.height>=self.parentData.height){self.size.height=self.parentData.height-hoset;if(pRatio){self.size.width=self.size.height*self.aspectRatio}}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options,cp=self.position,co=self.containerOffset,cop=self.containerPosition,ce=self.containerElement;var helper=$(self.helper),ho=helper.offset(),w=helper.outerWidth()-self.sizeDiff.width,h=helper.outerHeight()-self.sizeDiff.height;if(self._helper&&!o.animate&&(/relative/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h})}if(self._helper&&!o.animate&&(/static/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h})}}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size;self.ghost=self.originalElement.clone();self.ghost.css({opacity:0.25,display:"block",position:"relative",height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof o.ghost=="string"?o.ghost:"");self.ghost.appendTo(self.helper)},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost){self.ghost.css({position:"relative",height:self.size.height,width:self.size.width})}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost&&self.helper){self.helper.get(0).removeChild(self.ghost.get(0))}}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size,os=self.originalSize,op=self.originalPosition,a=self.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy}else{if(/^(ne)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy}else{if(/^(sw)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.left=op.left-ox}else{self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;self.position.left=op.left-ox}}}}});var num=function(v){return parseInt(v,10)||0};var isNumber=function(value){return !isNaN(parseInt(value,10))}})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch"},_create:function(){var self=this;this.element.addClass("ui-selectable");this.dragged=false;var selectees;this.refresh=function(){selectees=$(self.options.filter,self.element[0]);selectees.each(function(){var $this=$(this);var pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass("ui-selected"),selecting:$this.hasClass("ui-selecting"),unselecting:$this.hasClass("ui-unselecting")})})};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this},_mouseStart:function(event){var self=this;this.opos=[event.pageX,event.pageY];if(this.options.disabled){return}var options=this.options;this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({left:event.clientX,top:event.clientY,width:0,height:0});if(options.autoRefresh){this.refresh()}this.selectees.filter(".ui-selected").each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey){selectee.$element.removeClass("ui-selected");selectee.selected=false;selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element})}});$(event.target).parents().andSelf().each(function(){var selectee=$.data(this,"selectable-item");if(selectee){var doSelect=!event.metaKey||!selectee.$element.hasClass("ui-selected");selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){self._trigger("selecting",event,{selecting:selectee.element})}else{self._trigger("unselecting",event,{unselecting:selectee.element})}return false}})},_mouseDrag:function(event){var self=this;this.dragged=true;if(this.options.disabled){return}var options=this.options;var x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){var tmp=x2;x2=x1;x1=tmp}if(y1>y2){var tmp=y2;y2=y1;y1=tmp}this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item");if(!selectee||selectee.element==self.element[0]){return}var hit=false;if(options.tolerance=="touch"){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1))}else{if(options.tolerance=="fit"){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2)}}if(hit){if(selectee.selected){selectee.$element.removeClass("ui-selected");selectee.selected=false}if(selectee.unselecting){selectee.$element.removeClass("ui-unselecting");selectee.unselecting=false}if(!selectee.selecting){selectee.$element.addClass("ui-selecting");selectee.selecting=true;self._trigger("selecting",event,{selecting:selectee.element})}}else{if(selectee.selecting){if(event.metaKey&&selectee.startselected){selectee.$element.removeClass("ui-selecting");selectee.selecting=false;selectee.$element.addClass("ui-selected");selectee.selected=true}else{selectee.$element.removeClass("ui-selecting");selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass("ui-unselecting");selectee.unselecting=true}self._trigger("unselecting",event,{unselecting:selectee.element})}}if(selectee.selected){if(!event.metaKey&&!selectee.startselected){selectee.$element.removeClass("ui-selected");selectee.selected=false;selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element})}}}});return false},_mouseStop:function(event){var self=this;this.dragged=false;var options=this.options;$(".ui-unselecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass("ui-unselecting");selectee.unselecting=false;selectee.startselected=false;self._trigger("unselected",event,{unselected:selectee.element})});$(".ui-selecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass("ui-selecting").addClass("ui-selected");selectee.selecting=false;selectee.selected=true;selectee.startselected=true;self._trigger("selected",event,{selected:selectee.element})});this._trigger("stop",event);this.helper.remove();return false}});$.extend($.ui.selectable,{version:"1.8.16"})})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==="x"||(/left|right/).test(this.items[0].item.css("float"))||(/inline|table-cell/).test(this.items[0].item.css("display")):false;this.offset=this.element.offset();this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData("sortable-item")}return this},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget()[value?"addClass":"removeClass"]("ui-sortable-disabled")}else{$.Widget.prototype._setOption.apply(this,arguments)}},_mouseCapture:function(event,overrideHandle){if(this.reverting){return false}if(this.options.disabled||this.options.type=="static"){return false}this._refreshItems(event);var currentItem=null,self=this,nodes=$(event.target).parents().each(function(){if($.data(this,"sortable-item")==self){currentItem=$(this);return false}});if($.data(event.target,"sortable-item")==self){currentItem=$(event.target)}if(!currentItem){return false}if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target){validHandle=true}});if(!validHandle){return false}}this.currentItem=currentItem;this._removeCurrentsFromItems();return true},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options,self=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(o.containment){this._setContainment()}if(o.cursor){if($("body").css("cursor")){this._storedCursor=$("body").css("cursor")}$("body").css("cursor",o.cursor)}if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",o.opacity)}if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",o.zIndex)}if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,self._uiHash(this))}}if($.ui.ddmanager){$.ui.ddmanager.current=this}if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed}else{if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed}}if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed}else{if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed}}}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else{if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}}if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else{if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection){continue}if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.ui.contains(this.placeholder[0],itemElement)&&(this.options.type=="semi-dynamic"?!$.ui.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item)}else{break}this._trigger("change",event,this._uiHash());break}}this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(event,noPropagation){if(!event){return}if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event)}if(this.options.revert){var self=this;var cur=self.placeholder.offset();self.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-self.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-self.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){self._clear(event)})}else{this._clear(event,noPropagation)}return false},cancel:function(){var self=this;if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,self._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,self._uiHash(this));this.containers[i].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem)}else{$(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||(/(.+)[-=_](.+)/));if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))}});if(!str.length&&o.key){str.push(o.key+"=")}return str.join("&")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")});return ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"])){return isOverElement}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b)}},_intersectsWithPointer:function(item){var isOverElementHeight=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement){return false}return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1))},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf))}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf))}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left")},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var self=this;var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],"sortable");if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst])}}}}queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this)})}return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data(sortable-item)");for(var i=0;i<this.items.length;i++){for(var j=0;j<list.length;j++){if(list[j]==this.items[i].item[0]){this.items.splice(i,1)}}}},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var self=this;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],"sortable");if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst)}}}}for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data("sortable-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})}}},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance!=this.currentContainer&&this.currentContainer&&item.item[0]!=this.currentItem[0]){continue}var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight()}var p=t.offset();item.left=p.left;item.top=p.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}}return this},_createPlaceholder:function(that){var self=that||this,o=self.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(self.currentItem[0].nodeName)).addClass(className||self.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className){el.style.visibility="hidden"}return el},update:function(container,p){if(className&&!o.forcePlaceholderSize){return}if(!p.height()){p.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css("paddingTop")||0,10)-parseInt(self.currentItem.css("paddingBottom")||0,10))}if(!p.width()){p.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css("paddingLeft")||0,10)-parseInt(self.currentItem.css("paddingRight")||0,10))}}}}self.placeholder=$(o.placeholder.element.call(self.element,self.currentItem));self.currentItem.after(self.placeholder);o.placeholder.update(self,self.placeholder)},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.currentItem[0],this.containers[i].element[0])){continue}if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.ui.contains(this.containers[i].element[0],innermostContainer.element[0])){continue}innermostContainer=this.containers[i];innermostIndex=i}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(!innermostContainer){return}if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}else{if(this.currentContainer!=this.containers[innermostIndex]){var dist=10000;var itemWithLeastDistance=null;var base=this.positionAbs[this.containers[innermostIndex].floating?"left":"top"];for(var j=this.items.length-1;j>=0;j--){if(!$.ui.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue}var cur=this.items[j][this.containers[innermostIndex].floating?"left":"top"];if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j]}}if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return}this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=="clone"?this.currentItem.clone():this.currentItem);if(!helper.parents("body").length){$(o.appendTo!="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0])}if(helper[0]==this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(helper[0].style.width==""||o.forceHelperSize){helper.width(this.currentItem.width())}if(helper[0].style.height==""||o.forceHelperSize){helper.height(this.currentItem.height())}return helper},_adjustOffsetFromHelper:function(obj){if(typeof obj=="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left" in obj){this.offset.click.left=obj.left+this.margins.left}if("right" in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top" in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom" in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&$.browser.msie)){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;if(o.containment=="parent"){o.containment=this.helper[0].parentNode}if(o.containment=="document"||o.containment=="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!="hidden");this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position}var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top+this.offset.relative.top*mod+this.offsetParent.offset().top*mod-($.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-($.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))}},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top}}if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left}}return{top:(pageY-this.offset.click.top-this.offset.relative.top-this.offsetParent.offset().top+($.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+($.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=="down"?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var self=this,counter=this.counter;window.setTimeout(function(){if(counter==self.counter){self.refreshPositions(!hardRefresh)}},0)},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[],self=this;if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static"){this._storedCSS[i]=""}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())})}if(!$.ui.contains(this.element[0],this.currentItem[0])){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())})}for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.containers[i].element[0],this.currentItem[0])&&!noPropagation){delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}).call(this,this.containers[i]));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}).call(this,this.containers[i]))}}}for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this))}}).call(this,this.containers[i]))}if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this))}}).call(this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this._storedCursor){$("body").css("cursor",this._storedCursor)}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex)}this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}return false}if(!noPropagation){this._trigger("beforeStop",event,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0]){this.helper.remove()}this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(inst){var self=inst||this;return{helper:self.helper,placeholder:self.placeholder||$([]),position:self.position,originalPosition:self.originalPosition,offset:self.positionAbs,item:self.currentItem,sender:inst?inst.element:null}}});$.extend($.ui.sortable,{version:"1.8.16"})})(jQuery);jQuery.effects||(function($,undefined){$.effects={};$.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(i,attr){$.fx.step[attr]=function(fx){if(!fx.colorInit){fx.start=getColor(fx.elem,attr);fx.end=getRGB(fx.end);fx.colorInit=true}fx.elem.style[attr]="rgb("+Math.max(Math.min(parseInt((fx.pos*(fx.end[0]-fx.start[0]))+fx.start[0],10),255),0)+","+Math.max(Math.min(parseInt((fx.pos*(fx.end[1]-fx.start[1]))+fx.start[1],10),255),0)+","+Math.max(Math.min(parseInt((fx.pos*(fx.end[2]-fx.start[2]))+fx.start[2],10),255),0)+")"}});function getRGB(color){var result;if(color&&color.constructor==Array&&color.length==3){return color}if(result=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color)){return[parseInt(result[1],10),parseInt(result[2],10),parseInt(result[3],10)]}if(result=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color)){return[parseFloat(result[1])*2.55,parseFloat(result[2])*2.55,parseFloat(result[3])*2.55]}if(result=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color)){return[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]}if(result=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color)){return[parseInt(result[1]+result[1],16),parseInt(result[2]+result[2],16),parseInt(result[3]+result[3],16)]}if(result=/rgba\(0, 0, 0, 0\)/.exec(color)){return colors.transparent}return colors[$.trim(color).toLowerCase()]}function getColor(elem,attr){var color;do{color=$.curCSS(elem,attr);if(color!=""&&color!="transparent"||$.nodeName(elem,"body")){break}attr="backgroundColor"}while(elem=elem.parentNode);return getRGB(color)}var colors={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function getElementStyles(){var style=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,newStyle={},key,camelCase;if(style&&style.length&&style[0]&&style[style[0]]){var len=style.length;while(len--){key=style[len];if(typeof style[key]=="string"){camelCase=key.replace(/\-(\w)/g,function(all,letter){return letter.toUpperCase()});newStyle[camelCase]=style[key]}}}else{for(key in style){if(typeof style[key]==="string"){newStyle[key]=style[key]}}}return newStyle}function filterStyles(styles){var name,value;for(name in styles){value=styles[name];if(value==null||$.isFunction(value)||name in shorthandStyles||(/scrollbar/).test(name)||(!(/color/i).test(name)&&isNaN(parseFloat(value)))){delete styles[name]}}return styles}function styleDifference(oldStyle,newStyle){var diff={_:0},name;for(name in newStyle){if(oldStyle[name]!=newStyle[name]){diff[name]=newStyle[name]}}return diff}$.effects.animateClass=function(value,duration,easing,callback){if($.isFunction(easing)){callback=easing;easing=null}return this.queue(function(){var that=$(this),originalStyleAttr=that.attr("style")||" ",originalStyle=filterStyles(getElementStyles.call(this)),newStyle,className=that.attr("class");$.each(classAnimationActions,function(i,action){if(value[action]){that[action+"Class"](value[action])}});newStyle=filterStyles(getElementStyles.call(this));that.attr("class",className);that.animate(styleDifference(originalStyle,newStyle),{queue:false,duration:duration,easing:easing,complete:function(){$.each(classAnimationActions,function(i,action){if(value[action]){that[action+"Class"](value[action])}});if(typeof that.attr("style")=="object"){that.attr("style").cssText="";that.attr("style").cssText=originalStyleAttr}else{that.attr("style",originalStyleAttr)}if(callback){callback.apply(this,arguments)}$.dequeue(this)}})})};$.fn.extend({_addClass:$.fn.addClass,addClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{add:classNames},speed,easing,callback]):this._addClass(classNames)},_removeClass:$.fn.removeClass,removeClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{remove:classNames},speed,easing,callback]):this._removeClass(classNames)},_toggleClass:$.fn.toggleClass,toggleClass:function(classNames,force,speed,easing,callback){if(typeof force=="boolean"||force===undefined){if(!speed){return this._toggleClass(classNames,force)}else{return $.effects.animateClass.apply(this,[(force?{add:classNames}:{remove:classNames}),speed,easing,callback])}}else{return $.effects.animateClass.apply(this,[{toggle:classNames},force,speed,easing])}},switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.apply(this,[{add:add,remove:remove},speed,easing,callback])}});$.extend($.effects,{version:"1.8.16",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.data("ec.storage."+set[i],element[0].style[set[i]])}}},restore:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.css(set[i],element.data("ec.storage."+set[i]))}}},setMode:function(el,mode){if(mode=="toggle"){mode=el.is(":hidden")?"show":"hide"}return mode},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/original.height}switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/original.width}return{x:x,y:y}},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent()}var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),active=document.activeElement;element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).focus()}wrapper=element.parent();if(element.css("position")=="static"){wrapper.css({position:"relative"});element.css({position:"relative"})}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto"}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return wrapper.css(props).show()},removeWrapper:function(element){var parent,active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){parent=element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).focus()}return parent}return element},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1]}});return value}});function _normalizeArguments(effect,options,speed,callback){if(typeof effect=="object"){callback=options;speed=null;options=effect;effect=options.effect}if($.isFunction(options)){callback=options;speed=null;options={}}if(typeof options=="number"||$.fx.speeds[options]){callback=speed;speed=options;options={}}if($.isFunction(speed)){callback=speed;speed=null}options=options||{};speed=speed||options.duration;speed=$.fx.off?0:typeof speed=="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;callback=callback||options.complete;return[effect,options,speed,callback]}function standardSpeed(speed){if(!speed||typeof speed==="number"||$.fx.speeds[speed]){return true}if(typeof speed==="string"&&!$.effects[speed]){return true}return false}$.fn.extend({effect:function(effect,options,speed,callback){var args=_normalizeArguments.apply(this,arguments),args2={options:args[1],duration:args[2],callback:args[3]},mode=args2.options.mode,effectMethod=$.effects[effect];if($.fx.off||!effectMethod){if(mode){return this[mode](args2.duration,args2.callback)}else{return this.each(function(){if(args2.callback){args2.callback.call(this)}})}}return effectMethod.call(this,args2)},_show:$.fn.show,show:function(speed){if(standardSpeed(speed)){return this._show.apply(this,arguments)}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode="show";return this.effect.apply(this,args)}},_hide:$.fn.hide,hide:function(speed){if(standardSpeed(speed)){return this._hide.apply(this,arguments)}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode="hide";return this.effect.apply(this,args)}},__toggle:$.fn.toggle,toggle:function(speed){if(standardSpeed(speed)||typeof speed==="boolean"||$.isFunction(speed)){return this.__toggle.apply(this,arguments)}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode="toggle";return this.effect.apply(this,args)}},cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit]}});return val}});$.easing.jswing=$.easing.swing;$.extend($.easing,{def:"easeOutQuad",swing:function(x,t,b,c,d){return $.easing[$.easing.def](x,t,b,c,d)},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(x,t,b,c,d){return -c*(t/=d)*(t-2)+b},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return -c/2*((--t)*(t-2)-1)+b},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b}return c/2*((t-=2)*t*t+2)+b},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b},easeOutQuart:function(x,t,b,c,d){return -c*((t=t/d-1)*t*t*t-1)+b},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t+b}return -c/2*((t-=2)*t*t*t-2)+b},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},easeInSine:function(x,t,b,c,d){return -c*Math.cos(t/d*(Math.PI/2))+c+b},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},easeInOutSine:function(x,t,b,c,d){return -c/2*(Math.cos(Math.PI*t/d)-1)+b},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},easeInOutExpo:function(x,t,b,c,d){if(t==0){return b}if(t==d){return b+c}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b}return c/2*(-Math.pow(2,-10*--t)+2)+b},easeInCirc:function(x,t,b,c,d){return -c*(Math.sqrt(1-(t/=d)*t)-1)+b},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1){return -c/2*(Math.sqrt(1-t*t)-1)+b}return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*0.3}if(a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return -(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*0.3}if(a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){p=d*(0.3*1.5)}if(a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return -0.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*0.5+c+b},easeInBack:function(x,t,b,c,d,s){if(s==undefined){s=1.70158}return c*(t/=d)*t*((s+1)*t-s)+b},easeOutBack:function(x,t,b,c,d,s){if(s==undefined){s=1.70158}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined){s=1.70158}if((t/=d/2)<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b},easeInBounce:function(x,t,b,c,d){return c-$.easing.easeOutBounce(x,d-t,0,c,d)+b},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b}else{if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+0.75)+b}else{if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+0.9375)+b}else{return c*(7.5625*(t-=(2.625/2.75))*t+0.984375)+b}}}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2){return $.easing.easeInBounce(x,t*2,0,c,d)*0.5+b}return $.easing.easeOutBounce(x,t*2-d,0,c,d)*0.5+c*0.5+b}})})(jQuery);(function($,undefined){$.effects.blind=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right"];var mode=$.effects.setMode(el,o.options.mode||"hide");var direction=o.options.direction||"vertical";$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});var ref=(direction=="vertical")?"height":"width";var distance=(direction=="vertical")?wrapper.height():wrapper.width();if(mode=="show"){wrapper.css(ref,0)}var animation={};animation[ref]=mode=="show"?distance:0;wrapper.animate(animation,o.duration,o.options.easing,function(){if(mode=="hide"){el.hide()}$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(el[0],arguments)}el.dequeue()})})}})(jQuery);(function($,undefined){$.effects.bounce=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right"];var mode=$.effects.setMode(el,o.options.mode||"effect");var direction=o.options.direction||"up";var distance=o.options.distance||20;var times=o.options.times||5;var speed=o.duration||250;if(/show|hide/.test(mode)){props.push("opacity")}$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=="up"||direction=="down")?"top":"left";var motion=(direction=="up"||direction=="left")?"pos":"neg";var distance=o.options.distance||(ref=="top"?el.outerHeight({margin:true})/3:el.outerWidth({margin:true})/3);if(mode=="show"){el.css("opacity",0).css(ref,motion=="pos"?-distance:distance)}if(mode=="hide"){distance=distance/(times*2)}if(mode!="hide"){times--}if(mode=="show"){var animation={opacity:1};animation[ref]=(motion=="pos"?"+=":"-=")+distance;el.animate(animation,speed/2,o.options.easing);distance=distance/2;times--}for(var i=0;i<times;i++){var animation1={},animation2={};animation1[ref]=(motion=="pos"?"-=":"+=")+distance;animation2[ref]=(motion=="pos"?"+=":"-=")+distance;el.animate(animation1,speed/2,o.options.easing).animate(animation2,speed/2,o.options.easing);distance=(mode=="hide")?distance*2:distance/2}if(mode=="hide"){var animation={opacity:0};animation[ref]=(motion=="pos"?"-=":"+=")+distance;el.animate(animation,speed/2,o.options.easing,function(){el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(this,arguments)}})}else{var animation1={},animation2={};animation1[ref]=(motion=="pos"?"-=":"+=")+distance;animation2[ref]=(motion=="pos"?"+=":"-=")+distance;el.animate(animation1,speed/2,o.options.easing).animate(animation2,speed/2,o.options.easing,function(){$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(this,arguments)}})}el.queue("fx",function(){el.dequeue()});el.dequeue()})}})(jQuery);(function($,undefined){$.effects.clip=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right","height","width"];var mode=$.effects.setMode(el,o.options.mode||"hide");var direction=o.options.direction||"vertical";$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});var animate=el[0].tagName=="IMG"?wrapper:el;var ref={size:(direction=="vertical")?"height":"width",position:(direction=="vertical")?"top":"left"};var distance=(direction=="vertical")?animate.height():animate.width();if(mode=="show"){animate.css(ref.size,0);animate.css(ref.position,distance/2)}var animation={};animation[ref.size]=mode=="show"?distance:0;animation[ref.position]=mode=="show"?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=="hide"){el.hide()}$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(el[0],arguments)}el.dequeue()}})})}})(jQuery);(function($,undefined){$.effects.drop=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right","opacity"];var mode=$.effects.setMode(el,o.options.mode||"hide");var direction=o.options.direction||"left";$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=="up"||direction=="down")?"top":"left";var motion=(direction=="up"||direction=="left")?"pos":"neg";var distance=o.options.distance||(ref=="top"?el.outerHeight({margin:true})/2:el.outerWidth({margin:true})/2);if(mode=="show"){el.css("opacity",0).css(ref,motion=="pos"?-distance:distance)}var animation={opacity:mode=="show"?1:0};animation[ref]=(mode=="show"?(motion=="pos"?"+=":"-="):(motion=="pos"?"-=":"+="))+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=="hide"){el.hide()}$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(this,arguments)}el.dequeue()}})})}})(jQuery);(function($,undefined){$.effects.explode=function(o){return this.queue(function(){var rows=o.options.pieces?Math.round(Math.sqrt(o.options.pieces)):3;var cells=o.options.pieces?Math.round(Math.sqrt(o.options.pieces)):3;o.options.mode=o.options.mode=="toggle"?($(this).is(":visible")?"hide":"show"):o.options.mode;var el=$(this).show().css("visibility","hidden");var offset=el.offset();offset.top-=parseInt(el.css("marginTop"),10)||0;offset.left-=parseInt(el.css("marginLeft"),10)||0;var width=el.outerWidth(true);var height=el.outerHeight(true);for(var i=0;i<rows;i++){for(var j=0;j<cells;j++){el.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*(width/cells),top:-i*(height/rows)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:width/cells,height:height/rows,left:offset.left+j*(width/cells)+(o.options.mode=="show"?(j-Math.floor(cells/2))*(width/cells):0),top:offset.top+i*(height/rows)+(o.options.mode=="show"?(i-Math.floor(rows/2))*(height/rows):0),opacity:o.options.mode=="show"?0:1}).animate({left:offset.left+j*(width/cells)+(o.options.mode=="show"?0:(j-Math.floor(cells/2))*(width/cells)),top:offset.top+i*(height/rows)+(o.options.mode=="show"?0:(i-Math.floor(rows/2))*(height/rows)),opacity:o.options.mode=="show"?1:0},o.duration||500)}}setTimeout(function(){o.options.mode=="show"?el.css({visibility:"visible"}):el.css({visibility:"visible"}).hide();if(o.callback){o.callback.apply(el[0])}el.dequeue();$("div.ui-effects-explode").remove()},o.duration||500)})}})(jQuery);(function($,undefined){$.effects.fade=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||"hide");elem.animate({opacity:mode},{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){(o.callback&&o.callback.apply(this,arguments));elem.dequeue()}})})}})(jQuery);(function($,undefined){$.effects.fold=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right"];var mode=$.effects.setMode(el,o.options.mode||"hide");var size=o.options.size||15;var horizFirst=!(!o.options.horizFirst);var duration=o.duration?o.duration/2:$.fx.speeds._default/2;$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});var widthFirst=((mode=="show")!=horizFirst);var ref=widthFirst?["width","height"]:["height","width"];var distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];var percent=/([0-9]+)%/.exec(size);if(percent){size=parseInt(percent[1],10)/100*distance[mode=="hide"?0:1]}if(mode=="show"){wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0})}var animation1={},animation2={};animation1[ref[0]]=mode=="show"?distance[0]:size;animation2[ref[1]]=mode=="show"?distance[1]:0;wrapper.animate(animation1,duration,o.options.easing).animate(animation2,duration,o.options.easing,function(){if(mode=="hide"){el.hide()}$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(el[0],arguments)}el.dequeue()})})}})(jQuery);(function($,undefined){$.effects.highlight=function(o){return this.queue(function(){var elem=$(this),props=["backgroundImage","backgroundColor","opacity"],mode=$.effects.setMode(elem,o.options.mode||"show"),animation={backgroundColor:elem.css("backgroundColor")};if(mode=="hide"){animation.opacity=0}$.effects.save(elem,props);elem.show().css({backgroundImage:"none",backgroundColor:o.options.color||"#ffff99"}).animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){(mode=="hide"&&elem.hide());$.effects.restore(elem,props);(mode=="show"&&!$.support.opacity&&this.style.removeAttribute("filter"));(o.callback&&o.callback.apply(this,arguments));elem.dequeue()}})})}})(jQuery);(function($,undefined){$.effects.pulsate=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||"show");times=((o.options.times||5)*2)-1;duration=o.duration?o.duration/2:$.fx.speeds._default/2,isVisible=elem.is(":visible"),animateTo=0;if(!isVisible){elem.css("opacity",0).show();animateTo=1}if((mode=="hide"&&isVisible)||(mode=="show"&&!isVisible)){times--}for(var i=0;i<times;i++){elem.animate({opacity:animateTo},duration,o.options.easing);animateTo=(animateTo+1)%2}elem.animate({opacity:animateTo},duration,o.options.easing,function(){if(animateTo==0){elem.hide()}(o.callback&&o.callback.apply(this,arguments))});elem.queue("fx",function(){elem.dequeue()}).dequeue()})}})(jQuery);(function($,undefined){$.effects.puff=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||"hide"),percent=parseInt(o.options.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width()};$.extend(o.options,{fade:true,mode:mode,percent:mode=="hide"?percent:100,from:mode=="hide"?original:{height:original.height*factor,width:original.width*factor}});elem.effect("scale",o.options,o.duration,o.callback);elem.dequeue()})};$.effects.scale=function(o){return this.queue(function(){var el=$(this);var options=$.extend(true,{},o.options);var mode=$.effects.setMode(el,o.options.mode||"effect");var percent=parseInt(o.options.percent,10)||(parseInt(o.options.percent,10)==0?0:(mode=="hide"?0:100));var direction=o.options.direction||"both";var origin=o.options.origin;if(mode!="effect"){options.origin=origin||["middle","center"];options.restore=true}var original={height:el.height(),width:el.width()};el.from=o.options.from||(mode=="show"?{height:0,width:0}:original);var factor={y:direction!="horizontal"?(percent/100):1,x:direction!="vertical"?(percent/100):1};el.to={height:original.height*factor.y,width:original.width*factor.x};if(o.options.fade){if(mode=="show"){el.from.opacity=0;el.to.opacity=1}if(mode=="hide"){el.from.opacity=1;el.to.opacity=0}}options.from=el.from;options.to=el.to;options.mode=mode;el.effect("size",options,o.duration,o.callback);el.dequeue()})};$.effects.size=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right","width","height","overflow","opacity"];var props1=["position","top","bottom","left","right","overflow","opacity"];var props2=["width","height","overflow"];var cProps=["fontSize"];var vProps=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];var hProps=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"];var mode=$.effects.setMode(el,o.options.mode||"effect");var restore=o.options.restore||false;var scale=o.options.scale||"both";var origin=o.options.origin;var original={height:el.height(),width:el.width()};el.from=o.options.from||original;el.to=o.options.to||original;if(origin){var baseline=$.effects.getBaseline(origin,original);el.from.top=(original.height-el.from.height)*baseline.y;el.from.left=(original.width-el.from.width)*baseline.x;el.to.top=(original.height-el.to.height)*baseline.y;el.to.left=(original.width-el.to.width)*baseline.x}var factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale=="box"||scale=="both"){if(factor.from.y!=factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to)}if(factor.from.x!=factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to)}}if(scale=="content"||scale=="both"){if(factor.from.y!=factor.to.y){props=props.concat(cProps);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to)}}$.effects.save(el,restore?props:props1);el.show();$.effects.createWrapper(el);el.css("overflow","hidden").css(el.from);if(scale=="content"||scale=="both"){vProps=vProps.concat(["marginTop","marginBottom"]).concat(cProps);hProps=hProps.concat(["marginLeft","marginRight"]);props2=props.concat(vProps).concat(hProps);el.find("*[width]").each(function(){child=$(this);if(restore){$.effects.save(child,props2)}var c_original={height:child.height(),width:child.width()};child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x};if(factor.from.y!=factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to)}if(factor.from.x!=factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to)}child.css(child.from);child.animate(child.to,o.duration,o.options.easing,function(){if(restore){$.effects.restore(child,props2)}})})}el.animate(el.to,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(el.to.opacity===0){el.css("opacity",el.from.opacity)}if(mode=="hide"){el.hide()}$.effects.restore(el,restore?props:props1);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(this,arguments)}el.dequeue()}})})}})(jQuery);(function($,undefined){$.effects.shake=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right"];var mode=$.effects.setMode(el,o.options.mode||"effect");var direction=o.options.direction||"left";var distance=o.options.distance||20;var times=o.options.times||3;var speed=o.duration||o.options.duration||140;$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=="up"||direction=="down")?"top":"left";var motion=(direction=="up"||direction=="left")?"pos":"neg";var animation={},animation1={},animation2={};animation[ref]=(motion=="pos"?"-=":"+=")+distance;animation1[ref]=(motion=="pos"?"+=":"-=")+distance*2;animation2[ref]=(motion=="pos"?"-=":"+=")+distance*2;el.animate(animation,speed,o.options.easing);for(var i=1;i<times;i++){el.animate(animation1,speed,o.options.easing).animate(animation2,speed,o.options.easing)}el.animate(animation1,speed,o.options.easing).animate(animation,speed/2,o.options.easing,function(){$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(this,arguments)}});el.queue("fx",function(){el.dequeue()});el.dequeue()})}})(jQuery);(function($,undefined){$.effects.slide=function(o){return this.queue(function(){var el=$(this),props=["position","top","bottom","left","right"];var mode=$.effects.setMode(el,o.options.mode||"show");var direction=o.options.direction||"left";$.effects.save(el,props);el.show();$.effects.createWrapper(el).css({overflow:"hidden"});var ref=(direction=="up"||direction=="down")?"top":"left";var motion=(direction=="up"||direction=="left")?"pos":"neg";var distance=o.options.distance||(ref=="top"?el.outerHeight({margin:true}):el.outerWidth({margin:true}));if(mode=="show"){el.css(ref,motion=="pos"?(isNaN(distance)?"-"+distance:-distance):distance)}var animation={};animation[ref]=(mode=="show"?(motion=="pos"?"+=":"-="):(motion=="pos"?"-=":"+="))+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=="hide"){el.hide()}$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback){o.callback.apply(this,arguments)}el.dequeue()}})})}})(jQuery);(function($,undefined){$.effects.transfer=function(o){return this.queue(function(){var elem=$(this),target=$(o.options.to),endPosition=target.offset(),animation={top:endPosition.top,left:endPosition.left,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(o.options.className).css({top:startPosition.top,left:startPosition.left,height:elem.innerHeight(),width:elem.innerWidth(),position:"absolute"}).animate(animation,o.duration,o.options.easing,function(){transfer.remove();(o.callback&&o.callback.apply(elem[0],arguments));elem.dequeue()})})}})(jQuery);(function($,undefined){$.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var self=this,options=self.options;self.running=0;self.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");self.headers=self.element.find(options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){if(options.disabled){return}$(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){if(options.disabled){return}$(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){if(options.disabled){return}$(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){if(options.disabled){return}$(this).removeClass("ui-state-focus")});self.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(options.navigation){var current=self.element.find("a").filter(options.navigationFilter).eq(0);if(current.length){var header=current.closest(".ui-accordion-header");if(header.length){self.active=header}else{self.active=current.closest(".ui-accordion-content").prev()}}}self.active=self._findActive(self.active||options.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");self.active.next().addClass("ui-accordion-content-active");self._createIcons();self.resize();self.element.attr("role","tablist");self.headers.attr("role","tab").bind("keydown.accordion",function(event){return self._keydown(event)}).next().attr("role","tabpanel");self.headers.not(self.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();if(!self.active.length){self.headers.eq(0).attr("tabIndex",0)}else{self.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0})}if(!$.browser.safari){self.headers.find("a").attr("tabIndex",-1)}if(options.event){self.headers.bind(options.event.split(" ").join(".accordion ")+".accordion",function(event){self._clickHandler.call(self,event,this);event.preventDefault()})}},_createIcons:function(){var options=this.options;if(options.icons){$("<span></span>").addClass("ui-icon "+options.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(options.icons.header).toggleClass(options.icons.headerSelected);this.element.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var options=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var contents=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(options.autoHeight||options.fillHeight){contents.css("height","")}return $.Widget.prototype.destroy.call(this)},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key=="active"){this.activate(value)}if(key=="icons"){this._destroyIcons();if(value){this._createIcons()}}if(key=="disabled"){this.headers.add(this.headers.next())[value?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")}},_keydown:function(event){if(this.options.disabled||event.altKey||event.ctrlKey){return}var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._clickHandler({target:event.target},event.target);event.preventDefault()}if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);toFocus.focus();return false}return true},resize:function(){var options=this.options,maxHeight;if(options.fillSpace){if($.browser.msie){var defOverflow=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}maxHeight=this.element.parent().height();if($.browser.msie){this.element.parent().css("overflow",defOverflow)}this.headers.each(function(){maxHeight-=$(this).outerHeight(true)});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-$(this).innerHeight()+$(this).height()))}).css("overflow","auto")}else{if(options.autoHeight){maxHeight=0;this.headers.next().each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height())}).height(maxHeight)}}return this},activate:function(index){this.options.active=index;var active=this._findActive(index)[0];this._clickHandler({target:active},active);return this},_findActive:function(selector){return selector?typeof selector==="number"?this.headers.filter(":eq("+selector+")"):this.headers.not(this.headers.not(selector)):selector===false?$([]):this.headers.filter(":eq(0)")},_clickHandler:function(event,target){var options=this.options;if(options.disabled){return}if(!event.target){if(!options.collapsible){return}this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(options.icons.headerSelected).addClass(options.icons.header);this.active.next().addClass("ui-accordion-content-active");var toHide=this.active.next(),data={options:options,newHeader:$([]),oldHeader:options.active,newContent:$([]),oldContent:toHide},toShow=(this.active=$([]));this._toggle(toShow,toHide,data);return}var clicked=$(event.currentTarget||target),clickedIsActive=clicked[0]===this.active[0];options.active=options.collapsible&&clickedIsActive?false:this.headers.index(clicked);if(this.running||(!options.collapsible&&clickedIsActive)){return}var active=this.active,toShow=clicked.next(),toHide=this.active.next(),data={options:options,newHeader:clickedIsActive&&options.collapsible?$([]):clicked,oldHeader:this.active,newContent:clickedIsActive&&options.collapsible?$([]):toShow,oldContent:toHide},down=this.headers.index(this.active[0])>this.headers.index(clicked[0]);this.active=clickedIsActive?$([]):clicked;this._toggle(toShow,toHide,data,clickedIsActive,down);active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(options.icons.headerSelected).addClass(options.icons.header);if(!clickedIsActive){clicked.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(options.icons.header).addClass(options.icons.headerSelected);clicked.next().addClass("ui-accordion-content-active")}return},_toggle:function(toShow,toHide,data,clickedIsActive,down){var self=this,options=self.options;self.toShow=toShow;self.toHide=toHide;self.data=data;var complete=function(){if(!self){return}return self._completed.apply(self,arguments)};self._trigger("changestart",null,self.data);self.running=toHide.size()===0?toShow.size():toHide.size();if(options.animated){var animOptions={};if(options.collapsible&&clickedIsActive){animOptions={toShow:$([]),toHide:toHide,complete:complete,down:down,autoHeight:options.autoHeight||options.fillSpace}}else{animOptions={toShow:toShow,toHide:toHide,complete:complete,down:down,autoHeight:options.autoHeight||options.fillSpace}}if(!options.proxied){options.proxied=options.animated}if(!options.proxiedDuration){options.proxiedDuration=options.duration}options.animated=$.isFunction(options.proxied)?options.proxied(animOptions):options.proxied;options.duration=$.isFunction(options.proxiedDuration)?options.proxiedDuration(animOptions):options.proxiedDuration;var animations=$.ui.accordion.animations,duration=options.duration,easing=options.animated;if(easing&&!animations[easing]&&!$.easing[easing]){easing="slide"}if(!animations[easing]){animations[easing]=function(options){this.slide(options,{easing:easing,duration:duration||700})}}animations[easing](animOptions)}else{if(options.collapsible&&clickedIsActive){toShow.toggle()}else{toHide.hide();toShow.show()}complete(true)}toHide.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur();toShow.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(cancel){this.running=cancel?0:--this.running;if(this.running){return}if(this.options.clearStyle){this.toShow.add(this.toHide).css({height:"",overflow:""})}this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length){this.toHide.parent()[0].className=this.toHide.parent()[0].className}this._trigger("change",null,this.data)}});$.extend($.ui.accordion,{version:"1.8.16",animations:{slide:function(options,additions){options=$.extend({easing:"swing",duration:300},options,additions);if(!options.toHide.size()){options.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},options);return}if(!options.toShow.size()){options.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},options);return}var overflow=options.toShow.css("overflow"),percentDone=0,showProps={},hideProps={},fxAttrs=["height","paddingTop","paddingBottom"],originalWidth;var s=options.toShow;originalWidth=s[0].style.width;s.width(parseInt(s.parent().width(),10)-parseInt(s.css("paddingLeft"),10)-parseInt(s.css("paddingRight"),10)-(parseInt(s.css("borderLeftWidth"),10)||0)-(parseInt(s.css("borderRightWidth"),10)||0));$.each(fxAttrs,function(i,prop){hideProps[prop]="hide";var parts=(""+$.css(options.toShow[0],prop)).match(/^([\d+-.]+)(.*)$/);showProps[prop]={value:parts[1],unit:parts[2]||"px"}});options.toShow.css({height:0,overflow:"hidden"}).show();options.toHide.filter(":hidden").each(options.complete).end().filter(":visible").animate(hideProps,{step:function(now,settings){if(settings.prop=="height"){percentDone=(settings.end-settings.start===0)?0:(settings.now-settings.start)/(settings.end-settings.start)}options.toShow[0].style[settings.prop]=(percentDone*showProps[settings.prop].value)+showProps[settings.prop].unit},duration:options.duration,easing:options.easing,complete:function(){if(!options.autoHeight){options.toShow.css("height","")}options.toShow.css({width:originalWidth,overflow:overflow});options.complete()}})},bounceslide:function(options){this.slide(options,{easing:options.down?"easeOutBounce":"swing",duration:options.down?1000:200})}}})})(jQuery);(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var self=this,doc=this.element[0].ownerDocument,suppressKeyPress;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(event){if(self.options.disabled||self.element.propAttr("readOnly")){return}suppressKeyPress=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:self._move("previousPage",event);break;case keyCode.PAGE_DOWN:self._move("nextPage",event);break;case keyCode.UP:self._move("previous",event);event.preventDefault();break;case keyCode.DOWN:self._move("next",event);event.preventDefault();break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(self.menu.active){suppressKeyPress=true;event.preventDefault()}case keyCode.TAB:if(!self.menu.active){return}self.menu.select(event);break;case keyCode.ESCAPE:self.element.val(self.term);self.close(event);break;default:clearTimeout(self.searching);self.searching=setTimeout(function(){if(self.term!=self.element.val()){self.selectedItem=null;self.search(null,event)}},self.options.delay);break}}).bind("keypress.autocomplete",function(event){if(suppressKeyPress){suppressKeyPress=false;event.preventDefault()}}).bind("focus.autocomplete",function(){if(self.options.disabled){return}self.selectedItem=null;self.previous=self.element.val()}).bind("blur.autocomplete",function(event){if(self.options.disabled){return}clearTimeout(self.searching);self.closing=setTimeout(function(){self.close(event);self._change(event)},150)});this._initSource();this.response=function(){return self._response.apply(self,arguments)};this.menu=$("<ul></ul>").addClass("ui-autocomplete").appendTo($(this.options.appendTo||"body",doc)[0]).mousedown(function(event){var menuElement=self.menu.element[0];if(!$(event.target).closest(".ui-menu-item").length){setTimeout(function(){$(document).one("mousedown",function(event){if(event.target!==self.element[0]&&event.target!==menuElement&&!$.ui.contains(menuElement,event.target)){self.close()}})},1)}setTimeout(function(){clearTimeout(self.closing)},13)}).menu({focus:function(event,ui){var item=ui.item.data("item.autocomplete");if(false!==self._trigger("focus",event,{item:item})){if(/^key/.test(event.originalEvent.type)){self.element.val(item.value)}}},selected:function(event,ui){var item=ui.item.data("item.autocomplete"),previous=self.previous;if(self.element[0]!==doc.activeElement){self.element.focus();self.previous=previous;setTimeout(function(){self.previous=previous;self.selectedItem=item},1)}if(false!==self._trigger("select",event,{item:item})){self.element.val(item.value)}self.term=self.element.val();self.close(event);self.selectedItem=item},blur:function(event,ui){if(self.menu.element.is(":visible")&&(self.element.val()!==self.term)){self.element.val(self.term)}}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");if($.fn.bgiframe){this.menu.element.bgiframe()}},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();$.Widget.prototype.destroy.call(this)},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key==="source"){this._initSource()}if(key==="appendTo"){this.menu.element.appendTo($(value||"body",this.element[0].ownerDocument)[0])}if(key==="disabled"&&value&&this.xhr){this.xhr.abort()}},_initSource:function(){var self=this,array,url;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term))}}else{if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(self.xhr){self.xhr.abort()}self.xhr=$.ajax({url:url,data:request,dataType:"json",autocompleteRequest:++requestIndex,success:function(data,status){if(this.autocompleteRequest===requestIndex){response(data)}},error:function(){if(this.autocompleteRequest===requestIndex){response([])}}})}}else{this.source=this.options.source}}},search:function(value,event){value=value!=null?value:this.element.val();this.term=this.element.val();if(value.length<this.options.minLength){return this.close(event)}clearTimeout(this.closing);if(this._trigger("search",event)===false){return}return this._search(value)},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:value},this.response)},_response:function(content){if(!this.options.disabled&&content&&content.length){content=this._normalize(content);this._suggest(content);this._trigger("open")}else{this.close()}this.pending--;if(!this.pending){this.element.removeClass("ui-autocomplete-loading")}},close:function(event){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",event)}},_change:function(event){if(this.previous!==this.element.val()){this._trigger("change",event,{item:this.selectedItem})}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items}return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item}}return $.extend({label:item.label||item.value,value:item.value||item.label},item)})},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.deactivate();this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next(new $.Event("mouseover"))}},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(ul,items){var self=this;$.each(items,function(index,item){self._renderItem(ul,item)})},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>").text(item.label)).appendTo(ul)},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return}if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this.element.val(this.term);this.menu.deactivate();return}this.menu[direction](event)},widget:function(){return this.menu.element}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value)})}})}(jQuery));(function($){$.widget("ui.menu",{_create:function(){var self=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(event){if(!$(event.target).closest(".ui-menu-item a").length){return}event.preventDefault();self.select(event)});this.refresh()},refresh:function(){var self=this;var items=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");items.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this).parent())}).mouseleave(function(){self.deactivate()})},activate:function(event,item){this.deactivate();if(this.hasScroll()){var offset=item.offset().top-this.element.offset().top,scroll=this.element.scrollTop(),elementHeight=this.element.height();if(offset<0){this.element.scrollTop(scroll+offset)}else{if(offset>=elementHeight){this.element.scrollTop(scroll+offset-elementHeight+item.height())}}}this.active=item.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",event,{item:item})},deactivate:function(){if(!this.active){return}this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null},next:function(event){this.move("next",".ui-menu-item:first",event)},previous:function(event){this.move("prev",".ui-menu-item:last",event)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(direction,edge,event){if(!this.active){this.activate(event,this.element.children(edge));return}var next=this.active[direction+"All"](".ui-menu-item").eq(0);if(next.length){this.activate(event,next)}else{this.activate(event,this.element.children(edge))}},nextPage:function(event){if(this.hasScroll()){if(!this.active||this.last()){this.activate(event,this.element.children(".ui-menu-item:first"));return}var base=this.active.offset().top,height=this.element.height(),result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base-height+$(this).height();return close<10&&close>-10});if(!result.length){result=this.element.children(".ui-menu-item:last")}this.activate(event,result)}else{this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))}},previousPage:function(event){if(this.hasScroll()){if(!this.active||this.first()){this.activate(event,this.element.children(".ui-menu-item:last"));return}var base=this.active.offset().top,height=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base+height-$(this).height();return close<10&&close>-10});if(!result.length){result=this.element.children(".ui-menu-item:first")}this.activate(event,result)}else{this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))}},hasScroll:function(){return this.element.height()<this.element[$.fn.prop?"prop":"attr"]("scrollHeight")},select:function(event){this._trigger("selected",event,{item:this.active})}})}(jQuery));(function($,undefined){var lastActive,startXPos,startYPos,clickDragged,baseClasses="ui-button ui-widget ui-state-default ui-corner-all",stateClasses="ui-state-hover ui-state-active ",typeClasses="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",formResetHandler=function(){var buttons=$(this).find(":ui-button");setTimeout(function(){buttons.button("refresh")},1)},radioGroup=function(radio){var name=radio.name,form=radio.form,radios=$([]);if(name){if(form){radios=$(form).find("[name='"+name+"']")}else{radios=$("[name='"+name+"']",radio.ownerDocument).filter(function(){return !this.form})}}return radios};$.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",formResetHandler);if(typeof this.options.disabled!=="boolean"){this.options.disabled=this.element.propAttr("disabled")}this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var self=this,options=this.options,toggleButton=this.type==="checkbox"||this.type==="radio",hoverClass="ui-state-hover"+(!toggleButton?" ui-state-active":""),focusClass="ui-state-focus";if(options.label===null){options.label=this.buttonElement.html()}if(this.element.is(":disabled")){options.disabled=true}this.buttonElement.addClass(baseClasses).attr("role","button").bind("mouseenter.button",function(){if(options.disabled){return}$(this).addClass("ui-state-hover");if(this===lastActive){$(this).addClass("ui-state-active")}}).bind("mouseleave.button",function(){if(options.disabled){return}$(this).removeClass(hoverClass)}).bind("click.button",function(event){if(options.disabled){event.preventDefault();event.stopImmediatePropagation()}});this.element.bind("focus.button",function(){self.buttonElement.addClass(focusClass)}).bind("blur.button",function(){self.buttonElement.removeClass(focusClass)});if(toggleButton){this.element.bind("change.button",function(){if(clickDragged){return}self.refresh()});this.buttonElement.bind("mousedown.button",function(event){if(options.disabled){return}clickDragged=false;startXPos=event.pageX;startYPos=event.pageY}).bind("mouseup.button",function(event){if(options.disabled){return}if(startXPos!==event.pageX||startYPos!==event.pageY){clickDragged=true}})}if(this.type==="checkbox"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false}$(this).toggleClass("ui-state-active");self.buttonElement.attr("aria-pressed",self.element[0].checked)})}else{if(this.type==="radio"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false}$(this).addClass("ui-state-active");self.buttonElement.attr("aria-pressed","true");var radio=self.element[0];radioGroup(radio).not(radio).map(function(){return $(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")})}else{this.buttonElement.bind("mousedown.button",function(){if(options.disabled){return false}$(this).addClass("ui-state-active");lastActive=this;$(document).one("mouseup",function(){lastActive=null})}).bind("mouseup.button",function(){if(options.disabled){return false}$(this).removeClass("ui-state-active")}).bind("keydown.button",function(event){if(options.disabled){return false}if(event.keyCode==$.ui.keyCode.SPACE||event.keyCode==$.ui.keyCode.ENTER){$(this).addClass("ui-state-active")}}).bind("keyup.button",function(){$(this).removeClass("ui-state-active")});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(event){if(event.keyCode===$.ui.keyCode.SPACE){$(this).click()}})}}}this._setOption("disabled",options.disabled);this._resetButton()},_determineButtonType:function(){if(this.element.is(":checkbox")){this.type="checkbox"}else{if(this.element.is(":radio")){this.type="radio"}else{if(this.element.is("input")){this.type="input"}else{this.type="button"}}}if(this.type==="checkbox"||this.type==="radio"){var ancestor=this.element.parents().filter(":last"),labelSelector="label[for='"+this.element.attr("id")+"']";this.buttonElement=ancestor.find(labelSelector);if(!this.buttonElement.length){ancestor=ancestor.length?ancestor.siblings():this.element.siblings();this.buttonElement=ancestor.filter(labelSelector);if(!this.buttonElement.length){this.buttonElement=ancestor.find(labelSelector)}}this.element.addClass("ui-helper-hidden-accessible");var checked=this.element.is(":checked");if(checked){this.buttonElement.addClass("ui-state-active")}this.buttonElement.attr("aria-pressed",checked)}else{this.buttonElement=this.element}},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(baseClasses+" "+stateClasses+" "+typeClasses).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title")}$.Widget.prototype.destroy.call(this)},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key==="disabled"){if(value){this.element.propAttr("disabled",true)}else{this.element.propAttr("disabled",false)}return}this._resetButton()},refresh:function(){var isDisabled=this.element.is(":disabled");if(isDisabled!==this.options.disabled){this._setOption("disabled",isDisabled)}if(this.type==="radio"){radioGroup(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true")}else{$(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}})}else{if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true")}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false")}}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label)}return}var buttonElement=this.buttonElement.removeClass(typeClasses),buttonText=$("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(buttonElement.empty()).text(),icons=this.options.icons,multipleIcons=icons.primary&&icons.secondary,buttonClasses=[];if(icons.primary||icons.secondary){if(this.options.text){buttonClasses.push("ui-button-text-icon"+(multipleIcons?"s":(icons.primary?"-primary":"-secondary")))}if(icons.primary){buttonElement.prepend("<span class='ui-button-icon-primary ui-icon "+icons.primary+"'></span>")}if(icons.secondary){buttonElement.append("<span class='ui-button-icon-secondary ui-icon "+icons.secondary+"'></span>")}if(!this.options.text){buttonClasses.push(multipleIcons?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){buttonElement.attr("title",buttonText)}}}else{buttonClasses.push("ui-button-text-only")}buttonElement.addClass(buttonClasses.join(" "))}});$.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(key,value){if(key==="disabled"){this.buttons.button("option",key,value)}$.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var ltr=this.element.css("direction")==="ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return $(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(ltr?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(ltr?"ui-corner-right":"ui-corner-left").end().end()},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return $(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");$.Widget.prototype.destroy.call(this)}})}(jQuery));(function($,undefined){$.extend($.ui,{datepicker:{version:"1.8.16"}});var PROP_NAME="datepicker";var dpuuid=new Date().getTime();var instActive;function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional[""]);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){if(this.debug){console.log.apply("",arguments)}},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=="div"||nodeName=="span");if(!target.id){this.uuid+=1;target.id="dp"+this.uuid}var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=="input"){this._connectDatepicker(target,inst)}else{if(inline){this._inlineDatepicker(target,inst)}}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')))}},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return}this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value}).bind("getData.datepicker",function(event,key){return this._get(inst,key)});this._autoSize(inst);$.data(target,PROP_NAME,inst);if(inst.settings.disabled){this._disableDatepicker(target)}},_attachments:function(input,inst){var appendText=this._get(inst,"appendText");var isRTL=this._get(inst,"isRTL");if(inst.append){inst.append.remove()}if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+"</span>");input[isRTL?"before":"after"](inst.append)}input.unbind("focus",this._showDatepicker);if(inst.trigger){inst.trigger.remove()}var showOn=this._get(inst,"showOn");if(showOn=="focus"||showOn=="both"){input.focus(this._showDatepicker)}if(showOn=="button"||showOn=="both"){var buttonText=this._get(inst,"buttonText");var buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==""?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0]){$.datepicker._hideDatepicker()}else{$.datepicker._showDatepicker(input[0])}return false})}},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,"dateFormat");if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i}}return maxI};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?"monthNames":"monthNamesShort"))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?"dayNames":"dayNamesShort")))+20-date.getDay())}inst.input.attr("size",this._formatDate(inst,date).length)}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return}divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value}).bind("getData.datepicker",function(event,key){return this._get(inst,key)});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target)}inst.dpDiv.css("display","block")},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst)}extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY]}this._dialogInput.css("left",(this._pos[0]+20)+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv)}$.data(this._dialogInput[0],PROP_NAME,inst);return this},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else{if(nodeName=="div"||nodeName=="span"){$target.removeClass(this.markerClassName).empty()}}},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false}).end().filter("img").css({opacity:"1.0",cursor:""})}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value)})},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return}var nodeName=target.nodeName.toLowerCase();if(nodeName=="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else{if(nodeName=="div"||nodeName=="span"){var inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}}this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value)});this._disabledInputs[this._disabledInputs.length]=target},_isDisabledDatepicker:function(target){if(!target){return false}for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target){return true}}return false},_getInst:function(target){try{return $.data(target,PROP_NAME)}catch(err){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=="string"){return(name=="defaults"?$.extend({},$.datepicker._defaults):(inst?(name=="all"?$.extend({},inst.settings):this._get(inst,name)):null))}var settings=name||{};if(typeof name=="string"){settings={};settings[name]=value}if(inst){if(this._curInst==inst){this._hideDatepicker()}var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");extendRemove(inst.settings,settings);if(minDate!==null&&settings.dateFormat!==undefined&&settings.minDate===undefined){inst.settings.minDate=this._formatDate(inst,minDate)}if(maxDate!==null&&settings.dateFormat!==undefined&&settings.maxDate===undefined){inst.settings.maxDate=this._formatDate(inst,maxDate)}this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst)}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value)},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst)}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst)}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst,noDefault)}return(inst?this._getDate(inst):null)},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0])}var onSelect=$.datepicker._get(inst,"onSelect");if(onSelect){var dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst])}else{$.datepicker._hideDatepicker()}return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target)}handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target)}handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M")}break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D")}handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),"D")}handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M")}break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D")}handled=event.ctrlKey||event.metaKey;break;default:handled=false}}else{if(event.keyCode==36&&event.ctrlKey){$.datepicker._showDatepicker(this)}else{handled=false}}if(handled){event.preventDefault();event.stopPropagation()}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){var chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<" "||!chars||chars.indexOf(chr)>-1)}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst)}}catch(event){$.datepicker.log(event)}}return true},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!="input"){input=$("input",input.parentNode)[0]}if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input){return}var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){if($.datepicker._datepickerShowing){$.datepicker._triggerOnClose($.datepicker._curInst)}$.datepicker._curInst.dpDiv.stop(true,true)}var beforeShow=$.datepicker._get(inst,"beforeShow");var beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return}extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value=""}if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight}var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")=="fixed";return !isFixed});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop}var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?"static":(isFixed?"fixed":"absolute")),display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){var showAnim=$.datepicker._get(inst,"showAnim");var duration=$.datepicker._get(inst,"duration");var postProcess=function(){var cover=inst.dpDiv.find("iframe.ui-datepicker-cover");if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}};inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[showAnim||"show"]((showAnim?duration:null),postProcess)}if(!showAnim||!duration){postProcess()}if(inst.input.is(":visible")&&!inst.input.is(":disabled")){inst.input.focus()}$.datepicker._curInst=inst}},_updateDatepicker:function(inst){var self=this;self.maxRows=4;var borders=$.datepicker._getBorders(inst.dpDiv);instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));var cover=inst.dpDiv.find("iframe.ui-datepicker-cover");if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}inst.dpDiv.find("."+this._dayOverClass+" a").mouseover();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",(width*cols)+"em")}inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&inst.input[0]!=document.activeElement){inst.input.focus()}if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml)}origyearshtml=inst.yearshtml=null},0)}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value};return[parseFloat(convert(elem.css("border-left-width"))),parseFloat(convert(elem.css("border-top-width")))]},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+$(document).scrollLeft();var viewHeight=document.documentElement.clientHeight+$(document).scrollTop();offset.left-=(this._get(inst,"isRTL")?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,"isRTL");while(obj&&(obj.type=="hidden"||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?"previousSibling":"nextSibling"]}var position=$(obj).offset();return[position.left,position.top]},_triggerOnClose:function(inst){var onClose=this._get(inst,"onClose");if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():""),inst])}},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME))){return}if(this._datepickerShowing){var showAnim=this._get(inst,"showAnim");var duration=this._get(inst,"duration");var postProcess=function(){$.datepicker._tidyDialog(inst);this._curInst=null};if($.effects&&$.effects[showAnim]){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess)}else{inst.dpDiv[(showAnim=="slideDown"?"slideUp":(showAnim=="fadeIn"?"fadeOut":"hide"))]((showAnim?duration:null),postProcess)}if(!showAnim){postProcess()}$.datepicker._triggerOnClose(inst);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv)}}this._inDialog=false}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(event){if(!$.datepicker._curInst){return}var $target=$(event.target);if($target[0].id!=$.datepicker._mainDivId&&$target.parents("#"+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)){$.datepicker._hideDatepicker()}},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return}this._adjustInstDate(inst,offset+(period=="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst)},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear}else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear()}this._notifyChange(inst);this._adjustDate(target)},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst["selected"+(period=="M"?"Month":"Year")]=inst["draw"+(period=="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target)},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return}var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear))},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,"")},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr)}this._updateAlternate(inst);var onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst])}else{if(inst.input){inst.input.trigger("change")}}if(inst.inline){this._updateDatepicker(inst)}else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!="object"){inst.input.focus()}this._lastInput=null}},_updateAlternate:function(inst){var altField=this._get(inst,"altField");if(altField){var altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr)})}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),""]},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments"}value=(typeof value=="object"?value.toString():value+"");if(value==""){return null}var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=="@"?14:(match=="!"?20:(match=="y"&&isDoubled?4:(match=="o"?3:2))));var digits=new RegExp("^\\d{1,"+size+"}");var num=value.substring(iValue).match(digits);if(!num){throw"Missing number at position "+iValue}iValue+=num[0].length;return parseInt(num[0],10)};var getName=function(match,shortNames,longNames){var names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]]}).sort(function(a,b){return -(a[1].length-b[1].length)});var index=-1;$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()==name.toLowerCase()){index=pair[0];iValue+=name.length;return false}});if(index!=-1){return index+1}else{throw"Unknown name at position "+iValue}};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat)){throw"Unexpected literal at position "+iValue}iValue++};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{checkLiteral()}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":var date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"!":var date=new Date((getNumber("!")-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral()}else{literal=true}break;default:checkLiteral()}}}if(iValue<value.length){throw"Extra/unparsed characters found in date: "+value.substring(iValue)}if(year==-1){year=new Date().getFullYear()}else{if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+(year<=shortYearCutoff?0:-100)}}if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim){break}month++;day-=dim}while(true)}var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day){throw"Invalid date"}return date},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date){return""}var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};var formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num}}return num};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value])};var output="";var literal=false;if(date){for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{output+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=(lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100);break;case"@":output+=date.getTime();break;case"!":output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'")){output+="'"}else{literal=true}break;default:output+=format.charAt(iFormat)}}}}return output},_possibleChars:function(format){var chars="";var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches){iFormat++}return matches};for(var iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)=="'"&&!lookAhead("'")){literal=false}else{chars+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'"}else{literal=true}break;default:chars+=format.charAt(iFormat)}}}return chars},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name]},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return}var dateFormat=this._get(inst,"dateFormat");var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate}catch(event){this.log(event);dates=(noDefault?"":dates)}inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst)},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date()))},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst))}catch(e){}var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break}matches=pattern.exec(offset)}return new Date(year,month,day)};var newDate=(date==null||date===""?defaultDate:(typeof date=="string"?offsetString(date):(typeof date=="number"?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=="Invalid Date"?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0)}return this._daylightSavingAdjust(newDate)},_daylightSavingAdjust:function(date){if(!date){return null}date.setHours(date.getHours()>12?date.getHours()+2:0);return date},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange){this._notifyChange(inst)}this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst))}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=="")?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,"isRTL");var showButtonPanel=this._get(inst,"showButtonPanel");var hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext");var navigationAsDateFormat=this._get(inst,"navigationAsDateFormat");var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,"showCurrentAtPos");var stepMonths=this._get(inst,"stepMonths");var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--}if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--}}}inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,"prevText");prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+inst.id+"', -"+stepMonths+", 'M');\" title=\""+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"e":"w")+'">'+prevText+"</span></a>"));var nextText=this._get(inst,"nextText");nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+inst.id+"', +"+stepMonths+", 'M');\" title=\""+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>":(hideIfNoPrevNext?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?"w":"e")+'">'+nextText+"</span></a>"));var currentText=this._get(inst,"currentText");var gotoDate=(this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(inst,"closeText")+"</button>":"");var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+inst.id+"');\">"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";var firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,"showWeek");var dayNames=this._get(inst,"dayNames");var dayNamesShort=this._get(inst,"dayNamesShort");var dayNamesMin=this._get(inst,"dayNamesMin");var monthNames=this._get(inst,"monthNames");var monthNamesShort=this._get(inst,"monthNamesShort");var beforeShowDay=this._get(inst,"beforeShowDay");var showOtherMonths=this._get(inst,"showOtherMonths");var selectOtherMonths=this._get(inst,"selectOtherMonths");var calculateWeek=this._get(inst,"calculateWeek")||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html="";for(var row=0;row<numMonths[0];row++){var group="";this.maxRows=4;for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=" ui-corner-all";var calender="";if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1){switch(col){case 0:calender+=" ui-datepicker-group-first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle";cornerClass="";break}}calender+='">'}calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):"")+(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,"weekHeader")+"</th>":"");for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+dayNames[day]+'">'+dayNamesMin[day]+"</span></th>"}calender+=thead+"</tr></thead><tbody>";var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth)}var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var curRows=Math.ceil((leadDays+daysInMonth)/7);var numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+="<tr>";var tbody=(!showWeek?"":'<td class="ui-datepicker-week-col">'+this._get(inst,"calculateWeek")(printDate)+"</td>");for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,""]);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()==currentDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()==today.getTime()?" ui-datepicker-today":""))+'"'+((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':"")+(unselectable?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+inst.id+"',"+printDate.getMonth()+","+printDate.getFullYear()+', this);return false;"')+">"+(otherMonth&&!showOtherMonths?"&#xa0;":(unselectable?'<span class="ui-state-default">'+printDate.getDate()+"</span>":'<a class="ui-state-default'+(printDate.getTime()==today.getTime()?" ui-state-highlight":"")+(printDate.getTime()==currentDate.getTime()?" ui-state-active":"")+(otherMonth?" ui-priority-secondary":"")+'" href="#">'+printDate.getDate()+"</a>"))+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate)}calender+=tbody+"</tr>"}drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++}calender+="</tbody></table>"+(isMultiMonth?"</div>"+((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':""):"");group+=calender}html+=group}html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':"");inst._keyEvent=false;return html},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,"changeMonth");var changeYear=this._get(inst,"changeYear");var showMonthAfterYear=this._get(inst,"showMonthAfterYear");var html='<div class="ui-datepicker-title">';var monthHtml="";if(secondary||!changeMonth){monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+"</span>"}else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+inst.id+"', this, 'M');\" >";for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+='<option value="'+month+'"'+(month==drawMonth?' selected="selected"':"")+">"+monthNamesShort[month]+"</option>"}}monthHtml+="</select>"}if(!showMonthAfterYear){html+=monthHtml+(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")}if(!inst.yearshtml){inst.yearshtml="";if(secondary||!changeYear){html+='<span class="ui-datepicker-year">'+drawYear+"</span>"}else{var years=this._get(inst,"yearRange").split(":");var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year)};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||""));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+inst.id+"', this, 'Y');\" >";for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+(year==drawYear?' selected="selected"':"")+">"+year+"</option>"}inst.yearshtml+="</select>";html+=inst.yearshtml;inst.yearshtml=null}}html+=this._get(inst,"yearSuffix");if(showMonthAfterYear){html+=(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")+monthHtml}html+="</div>";return html},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=="Y"?offset:0);var month=inst.drawMonth+(period=="M"?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period=="D"?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=="M"||period=="Y"){this._notifyChange(inst)}},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst])}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return(numMonths==null?[1,1]:(typeof numMonths=="number"?[1,numMonths]:numMonths))},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null)},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate()},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay()},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()))}return this._isInRange(inst,date)},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,"min");var maxDate=this._getMinMaxDate(inst,"max");return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()))},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=(typeof shortYearCutoff!="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")}},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear}var date=(day?(typeof day=="object"?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst))}});function bindHover(dpDiv){var selector="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.bind("mouseout",function(event){var elem=$(event.target).closest(selector);if(!elem.length){return}elem.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(event){var elem=$(event.target).closest(selector);if($.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])||!elem.length){return}elem.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");elem.addClass("ui-state-hover");if(elem.hasClass("ui-datepicker-prev")){elem.addClass("ui-datepicker-prev-hover")}if(elem.hasClass("ui-datepicker-next")){elem.addClass("ui-datepicker-next-hover")}})}function extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null||props[name]==undefined){target[name]=props[name]}}return target}function isArray(a){return(a&&(($.browser.safari&&typeof a=="object"&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))))}$.fn.datepicker=function(options){if(!this.length){return this}if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv);$.datepicker.initialized=true}var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=="string"&&(options=="isDisabled"||options=="getDate"||options=="widget")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}if(options=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))}return this.each(function(){typeof options=="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options)})};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.8.16";window["DP_jQuery_"+dpuuid]=$})(jQuery);(function($,undefined){var uiDialogClasses="ui-dialog ui-widget ui-widget-content ui-corner-all ",sizeRelatedOptions={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},attrFn=$.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};$.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",collision:"fit",using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css("top",pos.top-topOffset)}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle=""}this.options.title=this.options.title||this.originalTitle;var self=this,options=self.options,title=options.title||"&#160;",titleId=$.ui.dialog.getTitleId(self.element),uiDialog=(self.uiDialog=$("<div></div>")).appendTo(document.body).hide().addClass(uiDialogClasses+options.dialogClass).css({zIndex:options.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(event){if(options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){self.close(event);event.preventDefault()}}).attr({role:"dialog","aria-labelledby":titleId}).mousedown(function(event){self.moveToTop(false,event)}),uiDialogContent=self.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(uiDialog),uiDialogTitlebar=(self.uiDialogTitlebar=$("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(uiDialog),uiDialogTitlebarClose=$('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){uiDialogTitlebarClose.addClass("ui-state-hover")},function(){uiDialogTitlebarClose.removeClass("ui-state-hover")}).focus(function(){uiDialogTitlebarClose.addClass("ui-state-focus")}).blur(function(){uiDialogTitlebarClose.removeClass("ui-state-focus")}).click(function(event){self.close(event);return false}).appendTo(uiDialogTitlebar),uiDialogTitlebarCloseText=(self.uiDialogTitlebarCloseText=$("<span></span>")).addClass("ui-icon ui-icon-closethick").text(options.closeText).appendTo(uiDialogTitlebarClose),uiDialogTitle=$("<span></span>").addClass("ui-dialog-title").attr("id",titleId).html(title).prependTo(uiDialogTitlebar);if($.isFunction(options.beforeclose)&&!$.isFunction(options.beforeClose)){options.beforeClose=options.beforeclose}uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();if(options.draggable&&$.fn.draggable){self._makeDraggable()}if(options.resizable&&$.fn.resizable){self._makeResizable()}self._createButtons(options.buttons);self._isOpen=false;if($.fn.bgiframe){uiDialog.bgiframe()}},_init:function(){if(this.options.autoOpen){this.open()}},destroy:function(){var self=this;if(self.overlay){self.overlay.destroy()}self.uiDialog.hide();self.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");self.uiDialog.remove();if(self.originalTitle){self.element.attr("title",self.originalTitle)}return self},widget:function(){return this.uiDialog},close:function(event){var self=this,maxZ,thisZ;if(false===self._trigger("beforeClose",event)){return}if(self.overlay){self.overlay.destroy()}self.uiDialog.unbind("keypress.ui-dialog");self._isOpen=false;if(self.options.hide){self.uiDialog.hide(self.options.hide,function(){self._trigger("close",event)})}else{self.uiDialog.hide();self._trigger("close",event)}$.ui.dialog.overlay.resize();if(self.options.modal){maxZ=0;$(".ui-dialog").each(function(){if(this!==self.uiDialog[0]){thisZ=$(this).css("z-index");if(!isNaN(thisZ)){maxZ=Math.max(maxZ,thisZ)}}});$.ui.dialog.maxZ=maxZ}return self},isOpen:function(){return this._isOpen},moveToTop:function(force,event){var self=this,options=self.options,saveScroll;if((options.modal&&!force)||(!options.stack&&!options.modal)){return self._trigger("focus",event)}if(options.zIndex>$.ui.dialog.maxZ){$.ui.dialog.maxZ=options.zIndex}if(self.overlay){$.ui.dialog.maxZ+=1;self.overlay.$el.css("z-index",$.ui.dialog.overlay.maxZ=$.ui.dialog.maxZ)}saveScroll={scrollTop:self.element.scrollTop(),scrollLeft:self.element.scrollLeft()};$.ui.dialog.maxZ+=1;self.uiDialog.css("z-index",$.ui.dialog.maxZ);self.element.attr(saveScroll);self._trigger("focus",event);return self},open:function(){if(this._isOpen){return}var self=this,options=self.options,uiDialog=self.uiDialog;self.overlay=options.modal?new $.ui.dialog.overlay(self):null;self._size();self._position(options.position);uiDialog.show(options.show);self.moveToTop(true);if(options.modal){uiDialog.bind("keypress.ui-dialog",function(event){if(event.keyCode!==$.ui.keyCode.TAB){return}var tabbables=$(":tabbable",this),first=tabbables.filter(":first"),last=tabbables.filter(":last");if(event.target===last[0]&&!event.shiftKey){first.focus(1);return false}else{if(event.target===first[0]&&event.shiftKey){last.focus(1);return false}}})}$(self.element.find(":tabbable").get().concat(uiDialog.find(".ui-dialog-buttonpane :tabbable").get().concat(uiDialog.get()))).eq(0).focus();self._isOpen=true;self._trigger("open");return self},_createButtons:function(buttons){var self=this,hasButtons=false,uiDialogButtonPane=$("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),uiButtonSet=$("<div></div>").addClass("ui-dialog-buttonset").appendTo(uiDialogButtonPane);self.uiDialog.find(".ui-dialog-buttonpane").remove();if(typeof buttons==="object"&&buttons!==null){$.each(buttons,function(){return !(hasButtons=true)})}if(hasButtons){$.each(buttons,function(name,props){props=$.isFunction(props)?{click:props,text:name}:props;var button=$('<button type="button"></button>').click(function(){props.click.apply(self.element[0],arguments)}).appendTo(uiButtonSet);$.each(props,function(key,value){if(key==="click"){return}if(key in attrFn){button[key](value)}else{button.attr(key,value)}});if($.fn.button){button.button()}});uiDialogButtonPane.appendTo(self.uiDialog)}},_makeDraggable:function(){var self=this,options=self.options,doc=$(document),heightBeforeDrag;function filteredUi(ui){return{position:ui.position,offset:ui.offset}}self.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(event,ui){heightBeforeDrag=options.height==="auto"?"auto":$(this).height();$(this).height($(this).height()).addClass("ui-dialog-dragging");self._trigger("dragStart",event,filteredUi(ui))},drag:function(event,ui){self._trigger("drag",event,filteredUi(ui))},stop:function(event,ui){options.position=[ui.position.left-doc.scrollLeft(),ui.position.top-doc.scrollTop()];$(this).removeClass("ui-dialog-dragging").height(heightBeforeDrag);self._trigger("dragStop",event,filteredUi(ui));$.ui.dialog.overlay.resize()}})},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var self=this,options=self.options,position=self.uiDialog.css("position"),resizeHandles=(typeof handles==="string"?handles:"n,e,s,w,se,sw,ne,nw");function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size}}self.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:self.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:self._minHeight(),handles:resizeHandles,start:function(event,ui){$(this).addClass("ui-dialog-resizing");self._trigger("resizeStart",event,filteredUi(ui))},resize:function(event,ui){self._trigger("resize",event,filteredUi(ui))},stop:function(event,ui){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();self._trigger("resizeStop",event,filteredUi(ui));$.ui.dialog.overlay.resize()}}).css("position",position).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var options=this.options;if(options.height==="auto"){return options.minHeight}else{return Math.min(options.minHeight,options.height)}},_position:function(position){var myAt=[],offset=[0,0],isVisible;if(position){if(typeof position==="string"||(typeof position==="object"&&"0" in position)){myAt=position.split?position.split(" "):[position[0],position[1]];if(myAt.length===1){myAt[1]=myAt[0]}$.each(["left","top"],function(i,offsetPosition){if(+myAt[i]===myAt[i]){offset[i]=myAt[i];myAt[i]=offsetPosition}});position={my:myAt.join(" "),at:myAt.join(" "),offset:offset.join(" ")}}position=$.extend({},$.ui.dialog.prototype.options.position,position)}else{position=$.ui.dialog.prototype.options.position}isVisible=this.uiDialog.is(":visible");if(!isVisible){this.uiDialog.show()}this.uiDialog.css({top:0,left:0}).position($.extend({of:window},position));if(!isVisible){this.uiDialog.hide()}},_setOptions:function(options){var self=this,resizableOptions={},resize=false;$.each(options,function(key,value){self._setOption(key,value);if(key in sizeRelatedOptions){resize=true}if(key in resizableRelatedOptions){resizableOptions[key]=value}});if(resize){this._size()}if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",resizableOptions)}},_setOption:function(key,value){var self=this,uiDialog=self.uiDialog;switch(key){case"beforeclose":key="beforeClose";break;case"buttons":self._createButtons(value);break;case"closeText":self.uiDialogTitlebarCloseText.text(""+value);break;case"dialogClass":uiDialog.removeClass(self.options.dialogClass).addClass(uiDialogClasses+value);break;case"disabled":if(value){uiDialog.addClass("ui-dialog-disabled")}else{uiDialog.removeClass("ui-dialog-disabled")}break;case"draggable":var isDraggable=uiDialog.is(":data(draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy")}if(!isDraggable&&value){self._makeDraggable()}break;case"position":self._position(value);break;case"resizable":var isResizable=uiDialog.is(":data(resizable)");if(isResizable&&!value){uiDialog.resizable("destroy")}if(isResizable&&typeof value==="string"){uiDialog.resizable("option","handles",value)}if(!isResizable&&value!==false){self._makeResizable(value)}break;case"title":$(".ui-dialog-title",self.uiDialogTitlebar).html(""+(value||"&#160;"));break}$.Widget.prototype._setOption.apply(self,arguments)},_size:function(){var options=this.options,nonContentHeight,minContentHeight,isVisible=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(options.minWidth>options.width){options.width=options.minWidth}nonContentHeight=this.uiDialog.css({height:"auto",width:options.width}).height();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);if(options.height==="auto"){if($.support.minHeight){this.element.css({minHeight:minContentHeight,height:"auto"})}else{this.uiDialog.show();var autoHeight=this.element.css("height","auto").height();if(!isVisible){this.uiDialog.hide()}this.element.height(Math.max(autoHeight,minContentHeight))}}else{this.element.height(Math.max(options.height-nonContentHeight,0))}if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight())}}});$.extend($.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function($el){var id=$el.attr("id");if(!id){this.uuid+=1;id=this.uuid}return"ui-dialog-title-"+id},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog)}});$.extend($.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:$.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(event){return event+".dialog-overlay"}).join(" "),create:function(dialog){if(this.instances.length===0){setTimeout(function(){if($.ui.dialog.overlay.instances.length){$(document).bind($.ui.dialog.overlay.events,function(event){if($(event.target).zIndex()<$.ui.dialog.overlay.maxZ){return false}})}},1);$(document).bind("keydown.dialog-overlay",function(event){if(dialog.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){dialog.close(event);event.preventDefault()}});$(window).bind("resize.dialog-overlay",$.ui.dialog.overlay.resize)}var $el=(this.oldInstances.pop()||$("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});if($.fn.bgiframe){$el.bgiframe()}this.instances.push($el);return $el},destroy:function($el){var indexOf=$.inArray($el,this.instances);if(indexOf!=-1){this.oldInstances.push(this.instances.splice(indexOf,1)[0])}if(this.instances.length===0){$([document,window]).unbind(".dialog-overlay")}$el.remove();var maxZ=0;$.each(this.instances,function(){maxZ=Math.max(maxZ,this.css("z-index"))});this.maxZ=maxZ},height:function(){var scrollHeight,offsetHeight;if($.browser.msie&&$.browser.version<7){scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height()+"px"}else{return scrollHeight+"px"}}else{return $(document).height()+"px"}},width:function(){var scrollWidth,offsetWidth;if($.browser.msie){scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width()+"px"}else{return scrollWidth+"px"}}else{return $(document).width()+"px"}},resize:function(){var $overlays=$([]);$.each($.ui.dialog.overlay.instances,function(){$overlays=$overlays.add(this)});$overlays.css({width:0,height:0}).css({width:$.ui.dialog.overlay.width(),height:$.ui.dialog.overlay.height()})}});$.extend($.ui.dialog.overlay.prototype,{destroy:function(){$.ui.dialog.overlay.destroy(this.$el)}})}(jQuery));(function($,undefined){$.ui=$.ui||{};var horizontalPositions=/left|center|right/,verticalPositions=/top|center|bottom/,center="center",_position=$.fn.position,_offset=$.fn.offset;$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments)}options=$.extend({},options);var target=$(options.of),targetElem=target[0],collision=(options.collision||"flip").split(" "),offset=options.offset?options.offset.split(" "):[0,0],targetWidth,targetHeight,basePosition;if(targetElem.nodeType===9){targetWidth=target.width();targetHeight=target.height();basePosition={top:0,left:0}}else{if(targetElem.setTimeout){targetWidth=target.width();targetHeight=target.height();basePosition={top:target.scrollTop(),left:target.scrollLeft()}}else{if(targetElem.preventDefault){options.at="left top";targetWidth=targetHeight=0;basePosition={top:options.of.pageY,left:options.of.pageX}}else{targetWidth=target.outerWidth();targetHeight=target.outerHeight();basePosition=target.offset()}}}$.each(["my","at"],function(){var pos=(options[this]||"").split(" ");if(pos.length===1){pos=horizontalPositions.test(pos[0])?pos.concat([center]):verticalPositions.test(pos[0])?[center].concat(pos):[center,center]}pos[0]=horizontalPositions.test(pos[0])?pos[0]:center;pos[1]=verticalPositions.test(pos[1])?pos[1]:center;options[this]=pos});if(collision.length===1){collision[1]=collision[0]}offset[0]=parseInt(offset[0],10)||0;if(offset.length===1){offset[1]=offset[0]}offset[1]=parseInt(offset[1],10)||0;if(options.at[0]==="right"){basePosition.left+=targetWidth}else{if(options.at[0]===center){basePosition.left+=targetWidth/2}}if(options.at[1]==="bottom"){basePosition.top+=targetHeight}else{if(options.at[1]===center){basePosition.top+=targetHeight/2}}basePosition.left+=offset[0];basePosition.top+=offset[1];return this.each(function(){var elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseInt($.curCSS(this,"marginLeft",true))||0,marginTop=parseInt($.curCSS(this,"marginTop",true))||0,collisionWidth=elemWidth+marginLeft+(parseInt($.curCSS(this,"marginRight",true))||0),collisionHeight=elemHeight+marginTop+(parseInt($.curCSS(this,"marginBottom",true))||0),position=$.extend({},basePosition),collisionPosition;if(options.my[0]==="right"){position.left-=elemWidth}else{if(options.my[0]===center){position.left-=elemWidth/2}}if(options.my[1]==="bottom"){position.top-=elemHeight}else{if(options.my[1]===center){position.top-=elemHeight/2}}position.left=Math.round(position.left);position.top=Math.round(position.top);collisionPosition={left:position.left-marginLeft,top:position.top-marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:offset,my:options.my,at:options.at})}});if($.fn.bgiframe){elem.bgiframe()}elem.offset($.extend(position,{using:options.using}))})};$.ui.position={fit:{left:function(position,data){var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft();position.left=over>0?position.left-over:Math.max(position.left-data.collisionPosition.left,position.left)},top:function(position,data){var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop();position.top=over>0?position.top-over:Math.max(position.top-data.collisionPosition.top,position.top)}},flip:{left:function(position,data){if(data.at[0]===center){return}var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft(),myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:-data.targetWidth,offset=-2*data.offset[0];position.left+=data.collisionPosition.left<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0},top:function(position,data){if(data.at[1]===center){return}var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop(),myOffset=data.my[1]==="top"?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:-data.targetHeight,offset=-2*data.offset[1];position.top+=data.collisionPosition.top<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0}}};if(!$.offset.setOffset){$.offset.setOffset=function(elem,options){if(/static/.test($.curCSS(elem,"position"))){elem.style.position="relative"}var curElem=$(elem),curOffset=curElem.offset(),curTop=parseInt($.curCSS(elem,"top",true),10)||0,curLeft=parseInt($.curCSS(elem,"left",true),10)||0,props={top:(options.top-curOffset.top)+curTop,left:(options.left-curOffset.left)+curLeft};if("using" in options){options.using.call(elem,props)}else{curElem.css(props)}};$.fn.offset=function(options){var elem=this[0];if(!elem||!elem.ownerDocument){return null}if(options){return this.each(function(){$.offset.setOffset(this,options)})}return _offset.call(this)}}}(jQuery));(function($,undefined){$.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();$.Widget.prototype.destroy.apply(this,arguments)},value:function(newValue){if(newValue===undefined){return this._value()}this._setOption("value",newValue);return this},_setOption:function(key,value){if(key==="value"){this.options.value=value;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete")}}$.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var val=this.options.value;if(typeof val!=="number"){val=0}return Math.min(this.options.max,Math.max(this.min,val))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var value=this.value();var percentage=this._percentage();if(this.oldValue!==value){this.oldValue=value;this._trigger("change")}this.valueDiv.toggle(value>this.min).toggleClass("ui-corner-right",value===this.options.max).width(percentage.toFixed(0)+"%");this.element.attr("aria-valuenow",value)}});$.extend($.ui.progressbar,{version:"1.8.16"})})(jQuery);(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var self=this,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handleCount=(o.values&&o.values.length)||1,handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()]}if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]]}}this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+((o.range==="min"||o.range==="max")?" ui-slider-range-"+o.range:""))}for(var i=existingHandles.length;i<handleCount;i+=1){handles.push(handle)}this.handles=existingHandles.add($(handles.join("")).appendTo(self.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault()}).hover(function(){if(!o.disabled){$(this).addClass("ui-state-hover")}},function(){$(this).removeClass("ui-state-hover")}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus")}else{$(this).blur()}}).blur(function(){$(this).removeClass("ui-state-focus")});this.handles.each(function(i){$(this).data("index.ui-slider-handle",i)});this.handles.keydown(function(event){var ret=true,index=$(this).data("index.ui-slider-handle"),allowed,curVal,newVal,step;if(self.options.disabled){return}switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ret=false;if(!self._keySliding){self._keySliding=true;$(this).addClass("ui-state-active");allowed=self._start(event,index);if(allowed===false){return}}break}step=self.options.step;if(self.options.values&&self.options.values.length){curVal=newVal=self.values(index)}else{curVal=newVal=self.value()}switch(event.keyCode){case $.ui.keyCode.HOME:newVal=self._valueMin();break;case $.ui.keyCode.END:newVal=self._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=self._trimAlignValue(curVal+((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=self._trimAlignValue(curVal-((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===self._valueMax()){return}newVal=self._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===self._valueMin()){return}newVal=self._trimAlignValue(curVal-step);break}self._slide(event,index,newVal);return ret}).keyup(function(event){var index=$(this).data("index.ui-slider-handle");if(self._keySliding){self._keySliding=false;self._stop(event,index);self._change(event,index);$(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this},_mouseCapture:function(event){var o=this.options,position,normValue,distance,closestHandle,self,index,allowed,offset,mouseOverHandle;if(o.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;self=this;this.handles.each(function(i){var thisDistance=Math.abs(normValue-self.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index])}allowed=this._start(event,index);if(allowed===false){return false}this._mouseSliding=true;self._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-(closestHandle.height()/2)-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue)}this._animateOff=true;return true},_mouseStart:function(event){return true},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal"},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1}if(percentMouse<0){percentMouse=0}if(this.orientation==="vertical"){percentMouse=1-percentMouse}valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse)},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}return this._trigger("start",event,uiHash)},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal}if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true)}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal)}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}this._trigger("stop",event,uiHash)},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}this._trigger("change",event,uiHash)}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return}return this._value()},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return}if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i)}this._refreshValue()}else{if(this.options.values&&this.options.values.length){return this._values(index)}else{return this.value()}}}else{return this._values()}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length}$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i)}this._animateOff=false;break}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i])}return vals}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin()}if(val>=this._valueMax()){return this._valueMax()}var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step)}return parseFloat(alignValue.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var oRange=this.options.range,o=this.options,self=this,animate=(!this._animateOff)?o.animate:false,valPercent,_set={},lastValPercent,value,valueMin,valueMax;if(this.options.values&&this.options.values.length){this.handles.each(function(i,j){valPercent=(self.values(i)-self._valueMin())/(self._valueMax()-self._valueMin())*100;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(self.options.range===true){if(self.orientation==="horizontal"){if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate)}if(i===1){self.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate})}}else{if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate)}if(i===1){self.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate})}}}lastValPercent=valPercent})}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate)}if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate})}if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate)}if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate})}}}});$.extend($.ui.slider,{version:"1.8.16"})}(jQuery));(function($,undefined){var tabId=0,listId=0;function getNextTabId(){return ++tabId}function getNextListId(){return ++listId}$.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true)},_setOption:function(key,value){if(key=="selected"){if(this.options.collapsible&&value==this.options.selected){return}this.select(value)}else{this.options[key]=value;this._tabify()}},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+getNextTabId()},_sanitizeSelector:function(hash){return hash.replace(/:/g,"\\:")},_cookie:function(){var cookie=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+getNextListId());return $.cookie.apply(null,[cookie].concat($.makeArray(arguments)))},_ui:function(tab,panel){return{tab:tab,panel:panel,index:this.anchors.index(tab)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var el=$(this);el.html(el.data("label.tabs")).removeData("label.tabs")})},_tabify:function(init){var self=this,o=this.options,fragmentId=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=$(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return $("a",this)[0]});this.panels=$([]);this.anchors.each(function(i,a){var href=$(a).attr("href");var hrefBase=href.split("#")[0],baseEl;if(hrefBase&&(hrefBase===location.toString().split("#")[0]||(baseEl=$("base")[0])&&hrefBase===baseEl.href)){href=a.hash;a.href=href}if(fragmentId.test(href)){self.panels=self.panels.add(self.element.find(self._sanitizeSelector(href)))}else{if(href&&href!=="#"){$.data(a,"href.tabs",href);$.data(a,"load.tabs",href.replace(/#.*$/,""));var id=self._tabId(a);a.href="#"+id;var $panel=self.element.find("#"+id);if(!$panel.length){$panel=$(o.panelTemplate).attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(self.panels[i-1]||self.list);$panel.data("destroy.tabs",true)}self.panels=self.panels.add($panel)}else{o.disabled.push(i)}}});if(init){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(o.selected===undefined){if(location.hash){this.anchors.each(function(i,a){if(a.hash==location.hash){o.selected=i;return false}})}if(typeof o.selected!=="number"&&o.cookie){o.selected=parseInt(self._cookie(),10)}if(typeof o.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length){o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))}o.selected=o.selected||(this.lis.length?0:-1)}else{if(o.selected===null){o.selected=-1}}o.selected=((o.selected>=0&&this.anchors[o.selected])||o.selected<0)?o.selected:0;o.disabled=$.unique(o.disabled.concat($.map(this.lis.filter(".ui-state-disabled"),function(n,i){return self.lis.index(n)}))).sort();if($.inArray(o.selected,o.disabled)!=-1){o.disabled.splice($.inArray(o.selected,o.disabled),1)}this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");if(o.selected>=0&&this.anchors.length){self.element.find(self._sanitizeSelector(self.anchors[o.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(o.selected).addClass("ui-tabs-selected ui-state-active");self.element.queue("tabs",function(){self._trigger("show",null,self._ui(self.anchors[o.selected],self.element.find(self._sanitizeSelector(self.anchors[o.selected].hash))[0]))});this.load(o.selected)}$(window).bind("unload",function(){self.lis.add(self.anchors).unbind(".tabs");self.lis=self.anchors=self.panels=null})}else{o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))}this.element[o.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");if(o.cookie){this._cookie(o.selected,o.cookie)}for(var i=0,li;(li=this.lis[i]);i++){$(li)[$.inArray(i,o.disabled)!=-1&&!$(li).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled")}if(o.cache===false){this.anchors.removeData("cache.tabs")}this.lis.add(this.anchors).unbind(".tabs");if(o.event!=="mouseover"){var addState=function(state,el){if(el.is(":not(.ui-state-disabled)")){el.addClass("ui-state-"+state)}};var removeState=function(state,el){el.removeClass("ui-state-"+state)};this.lis.bind("mouseover.tabs",function(){addState("hover",$(this))});this.lis.bind("mouseout.tabs",function(){removeState("hover",$(this))});this.anchors.bind("focus.tabs",function(){addState("focus",$(this).closest("li"))});this.anchors.bind("blur.tabs",function(){removeState("focus",$(this).closest("li"))})}var hideFx,showFx;if(o.fx){if($.isArray(o.fx)){hideFx=o.fx[0];showFx=o.fx[1]}else{hideFx=showFx=o.fx}}function resetStyle($el,fx){$el.css("display","");if(!$.support.opacity&&fx.opacity){$el[0].style.removeAttribute("filter")}}var showTab=showFx?function(clicked,$show){$(clicked).closest("li").addClass("ui-tabs-selected ui-state-active");$show.hide().removeClass("ui-tabs-hide").animate(showFx,showFx.duration||"normal",function(){resetStyle($show,showFx);self._trigger("show",null,self._ui(clicked,$show[0]))})}:function(clicked,$show){$(clicked).closest("li").addClass("ui-tabs-selected ui-state-active");$show.removeClass("ui-tabs-hide");self._trigger("show",null,self._ui(clicked,$show[0]))};var hideTab=hideFx?function(clicked,$hide){$hide.animate(hideFx,hideFx.duration||"normal",function(){self.lis.removeClass("ui-tabs-selected ui-state-active");$hide.addClass("ui-tabs-hide");resetStyle($hide,hideFx);self.element.dequeue("tabs")})}:function(clicked,$hide,$show){self.lis.removeClass("ui-tabs-selected ui-state-active");$hide.addClass("ui-tabs-hide");self.element.dequeue("tabs")};this.anchors.bind(o.event+".tabs",function(){var el=this,$li=$(el).closest("li"),$hide=self.panels.filter(":not(.ui-tabs-hide)"),$show=self.element.find(self._sanitizeSelector(el.hash));if(($li.hasClass("ui-tabs-selected")&&!o.collapsible)||$li.hasClass("ui-state-disabled")||$li.hasClass("ui-state-processing")||self.panels.filter(":animated").length||self._trigger("select",null,self._ui(this,$show[0]))===false){this.blur();return false}o.selected=self.anchors.index(this);self.abort();if(o.collapsible){if($li.hasClass("ui-tabs-selected")){o.selected=-1;if(o.cookie){self._cookie(o.selected,o.cookie)}self.element.queue("tabs",function(){hideTab(el,$hide)}).dequeue("tabs");this.blur();return false}else{if(!$hide.length){if(o.cookie){self._cookie(o.selected,o.cookie)}self.element.queue("tabs",function(){showTab(el,$show)});self.load(self.anchors.index(this));this.blur();return false}}}if(o.cookie){self._cookie(o.selected,o.cookie)}if($show.length){if($hide.length){self.element.queue("tabs",function(){hideTab(el,$hide)})}self.element.queue("tabs",function(){showTab(el,$show)});self.load(self.anchors.index(this))}else{throw"jQuery UI Tabs: Mismatching fragment identifier."}if($.browser.msie){this.blur()}});this.anchors.bind("click.tabs",function(){return false})},_getIndex:function(index){if(typeof index=="string"){index=this.anchors.index(this.anchors.filter("[href$="+index+"]"))}return index},destroy:function(){var o=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var href=$.data(this,"href.tabs");if(href){this.href=href}var $this=$(this).unbind(".tabs");$.each(["href","load","cache"],function(i,prefix){$this.removeData(prefix+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){if($.data(this,"destroy.tabs")){$(this).remove()}else{$(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-selected","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom","ui-tabs-hide"].join(" "))}});if(o.cookie){this._cookie(null,o.cookie)}return this},add:function(url,label,index){if(index===undefined){index=this.anchors.length}var self=this,o=this.options,$li=$(o.tabTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label)),id=!url.indexOf("#")?url.replace("#",""):this._tabId($("a",$li)[0]);$li.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var $panel=self.element.find("#"+id);if(!$panel.length){$panel=$(o.panelTemplate).attr("id",id).data("destroy.tabs",true)}$panel.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(index>=this.lis.length){$li.appendTo(this.list);$panel.appendTo(this.list[0].parentNode)}else{$li.insertBefore(this.lis[index]);$panel.insertBefore(this.panels[index])}o.disabled=$.map(o.disabled,function(n,i){return n>=index?++n:n});this._tabify();if(this.anchors.length==1){o.selected=0;$li.addClass("ui-tabs-selected ui-state-active");$panel.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){self._trigger("show",null,self._ui(self.anchors[0],self.panels[0]))});this.load(0)}this._trigger("add",null,this._ui(this.anchors[index],this.panels[index]));return this},remove:function(index){index=this._getIndex(index);var o=this.options,$li=this.lis.eq(index).remove(),$panel=this.panels.eq(index).remove();if($li.hasClass("ui-tabs-selected")&&this.anchors.length>1){this.select(index+(index+1<this.anchors.length?1:-1))}o.disabled=$.map($.grep(o.disabled,function(n,i){return n!=index}),function(n,i){return n>=index?--n:n});this._tabify();this._trigger("remove",null,this._ui($li.find("a")[0],$panel[0]));return this},enable:function(index){index=this._getIndex(index);var o=this.options;if($.inArray(index,o.disabled)==-1){return}this.lis.eq(index).removeClass("ui-state-disabled");o.disabled=$.grep(o.disabled,function(n,i){return n!=index});this._trigger("enable",null,this._ui(this.anchors[index],this.panels[index]));return this},disable:function(index){index=this._getIndex(index);var self=this,o=this.options;if(index!=o.selected){this.lis.eq(index).addClass("ui-state-disabled");o.disabled.push(index);o.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[index],this.panels[index]))}return this},select:function(index){index=this._getIndex(index);if(index==-1){if(this.options.collapsible&&this.options.selected!=-1){index=this.options.selected}else{return this}}this.anchors.eq(index).trigger(this.options.event+".tabs");return this},load:function(index){index=this._getIndex(index);var self=this,o=this.options,a=this.anchors.eq(index)[0],url=$.data(a,"load.tabs");this.abort();if(!url||this.element.queue("tabs").length!==0&&$.data(a,"cache.tabs")){this.element.dequeue("tabs");return}this.lis.eq(index).addClass("ui-state-processing");if(o.spinner){var span=$("span",a);span.data("label.tabs",span.html()).html(o.spinner)}this.xhr=$.ajax($.extend({},o.ajaxOptions,{url:url,success:function(r,s){self.element.find(self._sanitizeSelector(a.hash)).html(r);self._cleanup();if(o.cache){$.data(a,"cache.tabs",true)}self._trigger("load",null,self._ui(self.anchors[index],self.panels[index]));try{o.ajaxOptions.success(r,s)}catch(e){}},error:function(xhr,s,e){self._cleanup();self._trigger("load",null,self._ui(self.anchors[index],self.panels[index]));try{o.ajaxOptions.error(xhr,s,index,a)}catch(e){}}}));self.element.dequeue("tabs");return this},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr}this._cleanup();return this},url:function(index,url){this.anchors.eq(index).removeData("cache.tabs").data("load.tabs",url);return this},length:function(){return this.anchors.length}});$.extend($.ui.tabs,{version:"1.8.16"});$.extend($.ui.tabs.prototype,{rotation:null,rotate:function(ms,continuing){var self=this,o=this.options;var rotate=self._rotate||(self._rotate=function(e){clearTimeout(self.rotation);self.rotation=setTimeout(function(){var t=o.selected;self.select(++t<self.anchors.length?t:0)},ms);if(e){e.stopPropagation()}});var stop=self._unrotate||(self._unrotate=!continuing?function(e){if(e.clientX){self.rotate(null)}}:function(e){t=o.selected;rotate()});if(ms){this.element.bind("tabsshow",rotate);this.anchors.bind(o.event+".tabs",stop);rotate()}else{clearTimeout(self.rotation);this.element.unbind("tabsshow",rotate);this.anchors.unbind(o.event+".tabs",stop);delete this._rotate;delete this._unrotate}return this}})})(jQuery);
(function($){var inviewObjects={},viewportSize,viewportOffset,d=document,w=window,documentElement=d.documentElement,expando=$.expando;$.event.special.inview={add:function(data){inviewObjects[data.guid+"-"+this[expando]]={data:data,$element:$(this)}},remove:function(data){try{delete inviewObjects[data.guid+"-"+this[expando]]}catch(e){}}};function getViewportSize(){var mode,domObject,size={height:w.innerHeight,width:w.innerWidth};if(!size.height){mode=d.compatMode;if(mode||!$.support.boxModel){domObject=mode==="CSS1Compat"?documentElement:d.body;size={height:domObject.clientHeight,width:domObject.clientWidth}}}return size}function getViewportOffset(){return{top:w.pageYOffset||documentElement.scrollTop||d.body.scrollTop,left:w.pageXOffset||documentElement.scrollLeft||d.body.scrollLeft}}function checkInView(){var $elements=$(),elementsLength,i=0;$.each(inviewObjects,function(i,inviewObject){var selector=inviewObject.data.selector,$element=inviewObject.$element;$elements=$elements.add(selector?$element.find(selector):$element)});elementsLength=$elements.length;if(elementsLength){viewportSize=viewportSize||getViewportSize();viewportOffset=viewportOffset||getViewportOffset();for(;i<elementsLength;i++){if(!$.contains(documentElement,$elements[i])){continue}var $element=$($elements[i]),elementSize={height:$element.height(),width:$element.width()},elementOffset=$element.offset(),inView=$element.data("inview"),visiblePartX,visiblePartY,visiblePartsMerged;if(!viewportOffset||!viewportSize){return}if(elementOffset.top+elementSize.height>viewportOffset.top&&elementOffset.top<viewportOffset.top+viewportSize.height&&elementOffset.left+elementSize.width>viewportOffset.left&&elementOffset.left<viewportOffset.left+viewportSize.width){visiblePartX=(viewportOffset.left>elementOffset.left?"right":(viewportOffset.left+viewportSize.width)<(elementOffset.left+elementSize.width)?"left":"both");visiblePartY=(viewportOffset.top>elementOffset.top?"bottom":(viewportOffset.top+viewportSize.height)<(elementOffset.top+elementSize.height)?"top":"both");visiblePartsMerged=visiblePartX+"-"+visiblePartY;if(!inView||inView!==visiblePartsMerged){$element.data("inview",visiblePartsMerged).trigger("inview",[true,visiblePartX,visiblePartY])}}else{if(inView){$element.data("inview",false).trigger("inview",[false])}}}}}$(w).bind("scroll resize",function(){viewportSize=viewportOffset=null});setInterval(checkInView,250)})(jQuery);
(function($,e,b){var c="hashchange",h=document,f,g=$.event.special,i=h.documentMode,d="on"+c in e&&(i===b||i>7);function a(j){j=j||location.href;return"#"+j.replace(/^[^#]*#?(.*)$/,"$1")}$.fn[c]=function(j){return j?this.bind(c,j):this.trigger(c)};$.fn[c].delay=50;g[c]=$.extend(g[c],{setup:function(){if(d){return false}$(f.start)},teardown:function(){if(d){return false}$(f.stop)}});f=(function(){var j={},p,m=a(),k=function(q){return q},l=k,o=k;j.start=function(){p||n()};j.stop=function(){p&&clearTimeout(p);p=b};function n(){var r=a(),q=o(m);if(r!==m){l(m=r,q);$(e).trigger(c)}else{if(q!==m){location.href=location.href.replace(/#.*/,"")+q}}p=setTimeout(n,$.fn[c].delay)}$.browser.msie&&!d&&(function(){var q,r;j.start=function(){if(!q){r=$.fn[c].src;r=r&&r+a();q=$('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){r||l(a());n()}).attr("src",r||"javascript:0").insertAfter("body")[0].contentWindow;h.onpropertychange=function(){try{if(event.propertyName==="title"){q.document.title=h.title}}catch(s){}}}};j.stop=k;o=function(){return a(q.location.href)};l=function(v,s){var u=q.document,t=$.fn[c].domain;if(v!==s){u.title=h.title;u.open();t&&u.write('<script>document.domain="'+t+'"<\/script>');u.close();q.location.hash=v}}})();return j})()})(jQuery,this);
(function($) {

	/**
	 * Spoofs placeholders in browsers that don't support them (eg Firefox 3)
	 * 
	 * Copyright 2011 Dan Bentley
	 * Licensed under the Apache License 2.0
	 *
	 * Author: Dan Bentley [github.com/danbentley]
	 */

	// Return if native support is available.
	if ("placeholder" in document.createElement("input")) return;

	$(document).ready(function(){
		$(':input[placeholder]').not(':password').each(function() {
			setupPlaceholder($(this));
		});

		$(':password[placeholder]').each(function() {
			setupPasswords($(this));
		});
	   
		$('form').submit(function(e) {
			clearPlaceholdersBeforeSubmit($(this));
		});
	});

	function setupPlaceholder(input) {

		var placeholderText = input.attr('placeholder');

		setPlaceholderOrFlagChanged(input, placeholderText);
		input.focus(function(e) {
			if (input.data('changed') === true) return;
			if (input.val() === placeholderText) input.val('');
		}).blur(function(e) {
			if (input.val() === '') input.val(placeholderText); 
		}).change(function(e) {
			input.data('changed', input.val() !== '');
		});
	}

	function setPlaceholderOrFlagChanged(input, text) {
		(input.val() === '') ? input.val(text) : input.data('changed', true);
	}

	function setupPasswords(input) {
		var passwordPlaceholder = createPasswordPlaceholder(input);
		input.after(passwordPlaceholder);

		(input.val() === '') ? input.hide() : passwordPlaceholder.hide();

		$(input).blur(function(e) {
			if (input.val() !== '') return;
			input.hide();
			passwordPlaceholder.show();
		});
			
		$(passwordPlaceholder).focus(function(e) {
			input.show().focus();
			passwordPlaceholder.hide();
		});
	}

	function createPasswordPlaceholder(input) {
		return $('<input>').attr({
			placeholder: input.attr('placeholder'),
			value: input.attr('placeholder'),
			id: input.attr('id'),
			readonly: true
		}).addClass(input.attr('class'));
	}

	function clearPlaceholdersBeforeSubmit(form) {
		form.find(':input[placeholder]').each(function() {
			if ($(this).data('changed') === true) return;
			if ($(this).val() === $(this).attr('placeholder')) $(this).val('');
		});
	}
})(jQuery);

/*!

 Copyright (c) 2011 Peter van der Spek

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 */


(function($) {

    /**
     * Hash containing mapping of selectors to settings hashes for target selectors that should be live updated.
     *
     * @type {Object.<string, Object>}
     * @private
     */
    var liveUpdatingTargetSelectors = {};

    /**
     * Interval ID for live updater. Contains interval ID when the live updater interval is active, or is undefined
     * otherwise.
     *
     * @type {number}
     * @private
     */
    var liveUpdaterIntervalId;

    /**
     * Boolean indicating whether the live updater is running.
     *
     * @type {boolean}
     * @private
     */
    var liveUpdaterRunning = false;

    /**
     * Set of default settings.
     *
     * @type {Object.<string, string>}
     * @private
     */
    var defaultSettings = {
        ellipsis: '...',
        setTitle: 'never',
        live: false
    };

    /**
     * Perform ellipsis on selected elements.
     *
     * @param {string} selector the inner selector of elements that ellipsis may work on. Inner elements not referred to by this
     *      selector are left untouched.
     * @param {Object.<string, string>=} options optional options to override default settings.
     * @return {jQuery} the current jQuery object for chaining purposes.
     * @this {jQuery} the current jQuery object.
     */
    $.fn.ellipsis = function(selector, options) {
        var subjectElements, settings;

        subjectElements = $(this);

        // Check for options argument only.
        if (typeof selector !== 'string') {
            options = selector;
            selector = undefined;
        }

        // Create the settings from the given options and the default settings.
        settings = $.extend({}, defaultSettings, options);

        // If selector is not set, work on immediate children (default behaviour).
        settings.selector = selector;

        // Do ellipsis on each subject element.
        subjectElements.each(function() {
            var elem = $(this);

            // Do ellipsis on subject element.
            ellipsisOnElement(elem, settings);
        });

        // If live option is enabled, add subject elements to live updater. Otherwise remove from live updater.
        if (settings.live) {
            addToLiveUpdater(subjectElements.selector, settings);

        } else {
            removeFromLiveUpdater(subjectElements.selector);
        }

        // Return jQuery object for chaining.
        return this;
    };


    /**
     * Perform ellipsis on the given container.
     *
     * @param {jQuery} containerElement jQuery object containing one DOM element to perform ellipsis on.
     * @param {Object.<string, string>} settings the settings for this ellipsis operation.
     * @private
     */
    function ellipsisOnElement(containerElement, settings) {
        var containerData = containerElement.data('jqae');
        if (!containerData) containerData = {};

        // Check if wrapper div was already created and bound to the container element.
        var wrapperElement = containerData.wrapperElement;

        // If not, create wrapper element.
        if (!wrapperElement) {
            wrapperElement = containerElement.wrapInner('<div/>').find('>div');

            // Wrapper div should not add extra size.
            wrapperElement.css({
                margin: 0,
                padding: 0,
                border: 0
            });
        }

        // Check if the original wrapper element content was already bound to the wrapper element.
        var wrapperElementData = wrapperElement.data('jqae');
        if (!wrapperElementData) wrapperElementData = {};

        var wrapperOriginalContent = wrapperElementData.originalContent;

        // If so, clone the original content, re-bind the original wrapper content to the clone, and replace the
        // wrapper with the clone.
        if (wrapperOriginalContent) {
            wrapperElement = wrapperElementData.originalContent.clone(true)
                .data('jqae', {originalContent: wrapperOriginalContent}).replaceAll(wrapperElement);

        } else {
            // Otherwise, clone the current wrapper element and bind it as original content to the wrapper element.

            wrapperElement.data('jqae', {originalContent: wrapperElement.clone(true)});
        }

        // Bind the wrapper element and current container width and height to the container element. Current container
        // width and height are stored to detect changes to the container size.
        containerElement.data('jqae', {
            wrapperElement: wrapperElement,
            containerWidth: containerElement.width(),
            containerHeight: containerElement.height()
        });

        // Calculate with current container element height.
        var containerElementHeight = containerElement.height();

        // Calculate wrapper offset.
        var wrapperOffset = (parseInt(containerElement.css('padding-top'), 10) || 0) + (parseInt(containerElement.css('border-top-width'), 10) || 0) - (wrapperElement.offset().top - containerElement.offset().top);

        // Normally the ellipsis characters are applied to the last non-empty text-node in the selected element. If the
        // selected element becomes empty during ellipsis iteration, the ellipsis characters cannot be applied to that
        // selected element, and must be deferred to the previous selected element. This parameter keeps track of that.
        var deferAppendEllipsis = false;

        // Loop through all selected elements in reverse order.
        var selectedElements = wrapperElement;
        if (settings.selector) selectedElements = $(wrapperElement.find(settings.selector).get().reverse());

        selectedElements.each(function() {
            var selectedElement = $(this),
                originalText = selectedElement.text(),
                ellipsisApplied = false;

            // Check if we can safely remove the selected element. This saves a lot of unnecessary iterations.
            if (wrapperElement.innerHeight() - selectedElement.innerHeight() > containerElementHeight + wrapperOffset) {
                selectedElement.remove();

            } else {
                // Reverse recursively remove empty elements, until the element that contains a non-empty text-node.
                removeLastEmptyElements(selectedElement);

                // If the selected element has not become empty, start ellipsis iterations on the selected element.
                if (selectedElement.contents().length) {

                    // If a deffered ellipsis is still pending, apply it now to the last text-node.
                    if (deferAppendEllipsis) {
                        getLastTextNode(selectedElement).get(0).nodeValue += settings.ellipsis;
                        deferAppendEllipsis = false;
                    }

                    // Iterate until wrapper element height is less than or equal to the original container element
                    // height plus possible wrapperOffset.
                    while (wrapperElement.innerHeight() > containerElementHeight + wrapperOffset) {
                        // Apply ellipsis on last text node, by removing one word.
                        ellipsisApplied = ellipsisOnLastTextNode(selectedElement);

                        // If ellipsis was succesfully applied, remove any remaining empty last elements and append the
                        // ellipsis characters.
                        if (ellipsisApplied) {
                            removeLastEmptyElements(selectedElement);

                            // If the selected element is not empty, append the ellipsis characters.
                            if (selectedElement.contents().length) {
                                getLastTextNode(selectedElement).get(0).nodeValue += settings.ellipsis;

                            } else {
                                // If the selected element has become empty, defer the appending of the ellipsis characters
                                // to the previous selected element.
                                deferAppendEllipsis = true;
                                selectedElement.remove();
                                break;
                            }

                        } else {
                            // If ellipsis could not be applied, defer the appending of the ellipsis characters to the
                            // previous selected element.
                            deferAppendEllipsis = true;
                            selectedElement.remove();
                            break;
                        }
                    }

                    // If the "setTitle" property is set to "onEllipsis" and the ellipsis has been applied, or if the
                    // property is set to "always", the add the "title" attribute with the original text. Else remove the
                    // "title" attribute. When the "setTitle" property is set to "never" we do not touch the "title"
                    // attribute.
                    if (((settings.setTitle == 'onEllipsis') && ellipsisApplied) || (settings.setTitle == 'always')) {
                        selectedElement.attr('title', originalText);

                    } else if (settings.setTitle != 'never') {
                        selectedElement.removeAttr('title');
                    }
                }
            }
        });
    }

    /**
     * Performs ellipsis on the last text node of the given element. Ellipsis is done by removing a full word.
     *
     * @param {jQuery} element jQuery object containing a single DOM element.
     * @return {boolean} true when ellipsis has been done, false otherwise.
     * @private
     */
    function ellipsisOnLastTextNode(element) {
        var lastTextNode = getLastTextNode(element);

        // If the last text node is found, do ellipsis on that node.
        if (lastTextNode.length) {
            var text = lastTextNode.get(0).nodeValue;

            // Find last space character, and remove text from there. If no space is found the full remaining text is
            // removed.
            var pos = text.lastIndexOf(' ');
            if (pos > -1) {
                text = $.trim(text.substring(0, pos));
                lastTextNode.get(0).nodeValue = text;

            } else {
                lastTextNode.get(0).nodeValue = '';
            }

            return true;
        }

        return false;
    }

    /**
     * Get last text node of the given element.
     *
     * @param {jQuery} element jQuery object containing a single element.
     * @return {jQuery} jQuery object containing a single text node.
     * @private
     */
    function getLastTextNode(element) {
        if (element.contents().length) {

            // Get last child node.
            var contents = element.contents();
            var lastNode = contents.eq(contents.length - 1);

            // If last node is a text node, return it.
            if (lastNode.filter(textNodeFilter).length) {
                return lastNode;

            } else {
                // Else it is an element node, and we recurse into it.

                return getLastTextNode(lastNode);
            }

        } else {
            // If there is no last child node, we append an empty text node and return that. Normally this should not
            // happen, as we test for emptiness before calling getLastTextNode.

            element.append('');
            var contents = element.contents();
            return contents.eq(contents.length - 1);
        }
    }

    /**
     * Remove last empty elements. This is done recursively until the last element contains a non-empty text node.
     *
     * @param {jQuery} element jQuery object containing a single element.
     * @return {boolean} true when elements have been removed, false otherwise.
     * @private
     */
    function removeLastEmptyElements(element) {
        if (element.contents().length) {

            // Get last child node.
            var contents = element.contents();
            var lastNode = contents.eq(contents.length - 1);

            // If last child node is a text node, check for emptiness.
            if (lastNode.filter(textNodeFilter).length) {
                var text = lastNode.get(0).nodeValue;
                text = $.trim(text);

                if (text == '') {
                    // If empty, remove the text node.
                    lastNode.remove();

                    return true;

                } else {
                    return false;
                }

            } else {
                // If the last child node is an element node, remove the last empty child nodes on that node.
                while (removeLastEmptyElements(lastNode)) {
                }

                // If the last child node contains no more child nodes, remove the last child node.
                if (lastNode.contents().length) {
                    return false;

                } else {
                    lastNode.remove();

                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Filter for testing on text nodes.
     *
     * @return {boolean} true when this node is a text node, false otherwise.
     * @this {Node}
     * @private
     */
    function textNodeFilter() {
        return this.nodeType === 3;
    }

    /**
     * Add target selector to hash of target selectors. If this is the first target selector added, start the live
     * updater.
     *
     * @param {string} targetSelector the target selector to run the live updater for.
     * @param {Object.<string, string>} settings the settings to apply on this target selector.
     * @private
     */
    function addToLiveUpdater(targetSelector, settings) {
        // Store target selector with its settings.
        liveUpdatingTargetSelectors[targetSelector] = settings;

        // If the live updater has not yet been started, start it now.
        if (!liveUpdaterIntervalId) {
            liveUpdaterIntervalId = window.setInterval(function() {
                doLiveUpdater();
            }, 200);
        }
    }

    /**
     * Remove the target selector from the hash of target selectors. It this is the last remaining target selector
     * being removed, stop the live updater.
     *
     * @param {string} targetSelector the target selector to stop running the live updater for.
     * @private
     */
    function removeFromLiveUpdater(targetSelector) {
        // If the hash contains the target selector, remove it.
        if (liveUpdatingTargetSelectors[targetSelector]) {
            delete liveUpdatingTargetSelectors[targetSelector];

            // If no more target selectors are in the hash, stop the live updater.
            if (!liveUpdatingTargetSelectors.length) {
                if (liveUpdaterIntervalId) {
                    window.clearInterval(liveUpdaterIntervalId);
                    liveUpdaterIntervalId = undefined;
                }
            }
        }
    };

    /**
     * Run the live updater. The live updater is periodically run to check if its monitored target selectors require
     * re-applying of the ellipsis.
     *
     * @private
     */
    function doLiveUpdater() {
        // If the live updater is already running, skip this time. We only want one instance running at a time.
        if (!liveUpdaterRunning) {
            liveUpdaterRunning = true;

            // Loop through target selectors.
            for (var targetSelector in liveUpdatingTargetSelectors) {
                $(targetSelector).each(function() {
                    var containerElement, containerData;

                    containerElement = $(this);
                    containerData = containerElement.data('jqae');

                    // If container element dimensions have changed, or the container element is new, run ellipsis on
                    // that container element.
                    if ((containerData.containerWidth != containerElement.width()) ||
                        (containerData.containerHeight != containerElement.height())) {
                        ellipsisOnElement(containerElement, liveUpdatingTargetSelectors[targetSelector]);
                    }
                });
            }

            liveUpdaterRunning = false;
        }
    };

})(jQuery);
/* ========================================================================
 * Bootstrap: tooltip.js v3.2.0
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
    'use strict';

    // TOOLTIP PUBLIC CLASS DEFINITION
    // ===============================

    var Tooltip = function (element, options) {
        this.type       =
            this.options    =
                this.enabled    =
                    this.timeout    =
                        this.hoverState =
                            this.$element   = null

        this.init('tooltip', element, options)
    }

    Tooltip.VERSION  = '3.2.0'

    Tooltip.TRANSITION_DURATION = 150

    Tooltip.DEFAULTS = {
        animation: true,
        placement: 'top',
        selector: false,
        template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
        trigger: 'hover focus',
        title: '',
        delay: 0,
        html: false,
        container: false,
        viewport: {
            selector: 'body',
            padding: 0
        }
    }

    Tooltip.prototype.init = function (type, element, options) {
        this.enabled   = true
        this.type      = type
        this.$element  = $(element)
        this.options   = this.getOptions(options)
        this.$viewport = this.options.viewport && $(this.options.viewport.selector || this.options.viewport)

        var triggers = this.options.trigger.split(' ')

        for (var i = triggers.length; i--;) {
            var trigger = triggers[i]

            if (trigger == 'click') {
                this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
            } else if (trigger != 'manual') {
                var eventIn  = trigger == 'hover' ? 'mouseenter' : 'focusin'
                var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'

                this.$element.on(eventIn  + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
                this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
            }
        }

        this.options.selector ?
            (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :
            this.fixTitle()
    }

    Tooltip.prototype.getDefaults = function () {
        return Tooltip.DEFAULTS
    }

    Tooltip.prototype.getOptions = function (options) {
        options = $.extend({}, this.getDefaults(), this.$element.data(), options)

        if (options.delay && typeof options.delay == 'number') {
            options.delay = {
                show: options.delay,
                hide: options.delay
            }
        }

        return options
    }

    Tooltip.prototype.getDelegateOptions = function () {
        var options  = {}
        var defaults = this.getDefaults()

        this._options && $.each(this._options, function (key, value) {
            if (defaults[key] != value) options[key] = value
        })

        return options
    }

    Tooltip.prototype.enter = function (obj) {
        var self = obj instanceof this.constructor ?
            obj : $(obj.currentTarget).data('bs.' + this.type)

        if (self && self.$tip && self.$tip.is(':visible')) {
            self.hoverState = 'in'
            return
        }

        if (!self) {
            self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
            $(obj.currentTarget).data('bs.' + this.type, self)
        }

        clearTimeout(self.timeout)

        self.hoverState = 'in'

        if (!self.options.delay || !self.options.delay.show) return self.show()

        self.timeout = setTimeout(function () {
            if (self.hoverState == 'in') self.show()
        }, self.options.delay.show)
    }

    Tooltip.prototype.leave = function (obj) {
        var self = obj instanceof this.constructor ?
            obj : $(obj.currentTarget).data('bs.' + this.type)

        if (!self) {
            self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
            $(obj.currentTarget).data('bs.' + this.type, self)
        }

        clearTimeout(self.timeout)

        self.hoverState = 'out'

        if (!self.options.delay || !self.options.delay.hide) return self.hide()

        self.timeout = setTimeout(function () {
            if (self.hoverState == 'out') self.hide()
        }, self.options.delay.hide)
    }

    Tooltip.prototype.show = function () {
        var e = $.Event('show.bs.' + this.type)

        if (this.hasContent() && this.enabled) {
            this.$element.trigger(e)

            var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0])
            if (e.isDefaultPrevented() || !inDom) return
            var that = this

            var $tip = this.tip()

            var tipId = this.getUID(this.type)

            this.setContent()
            $tip.attr('id', tipId)
            this.$element.attr('aria-describedby', tipId)

            if (this.options.animation) $tip.addClass('fade')

            var placement = typeof this.options.placement == 'function' ?
                this.options.placement.call(this, $tip[0], this.$element[0]) :
                this.options.placement

            var autoToken = /\s?auto?\s?/i
            var autoPlace = autoToken.test(placement)
            if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

            $tip
                .detach()
                .css({ top: 0, left: 0, display: 'block' })
                .addClass(placement)
                .data('bs.' + this.type, this)

            this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

            var pos          = this.getPosition()
            var actualWidth  = $tip[0].offsetWidth
            var actualHeight = $tip[0].offsetHeight

            if (autoPlace) {
                var orgPlacement = placement
                var $container   = this.options.container ? $(this.options.container) : this.$element.parent()
                var containerDim = this.getPosition($container)

                placement = placement == 'bottom' && pos.top   + pos.height          + actualHeight - containerDim.scroll > containerDim.height ? 'top'    :
                        placement == 'top'    && pos.top   - containerDim.scroll - actualHeight < containerDim.top                          ? 'bottom' :
                        placement == 'right'  && pos.right + actualWidth         > containerDim.width                                       ? 'left'   :
                        placement == 'left'   && pos.left  - actualWidth         < containerDim.left                                        ? 'right'  :
                    placement

                $tip
                    .removeClass(orgPlacement)
                    .addClass(placement)
            }

            var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

            this.applyPlacement(calculatedOffset, placement)

            var complete = function () {
                that.$element.trigger('shown.bs.' + that.type)
                that.hoverState = null
            }

            $.support.transition && this.$tip.hasClass('fade') ?
                $tip
                    .one('bsTransitionEnd', complete)
                    .emulateTransitionEnd(Tooltip.TRANSITION_DURATION) :
                complete()
        }
    }

    Tooltip.prototype.applyPlacement = function (offset, placement) {
        var $tip   = this.tip()
        var width  = $tip[0].offsetWidth
        var height = $tip[0].offsetHeight

        // manually read margins because getBoundingClientRect includes difference
        var marginTop = parseInt($tip.css('margin-top'), 10)
        var marginLeft = parseInt($tip.css('margin-left'), 10)

        // we must check for NaN for ie 8/9
        if (isNaN(marginTop))  marginTop  = 0
        if (isNaN(marginLeft)) marginLeft = 0

        offset.top  = offset.top  + marginTop
        offset.left = offset.left + marginLeft

        // $.fn.offset doesn't round pixel values
        // so we use setOffset directly with our own function B-0
        $.offset.setOffset($tip[0], $.extend({
            using: function (props) {
                $tip.css({
                    top: Math.round(props.top),
                    left: Math.round(props.left)
                })
            }
        }, offset), 0)

        $tip.addClass('in')

        // check to see if placing tip in new offset caused the tip to resize itself
        var actualWidth  = $tip[0].offsetWidth
        var actualHeight = $tip[0].offsetHeight

        if (placement == 'top' && actualHeight != height) {
            offset.top = offset.top + height - actualHeight
        }

        var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)

        if (delta.left) offset.left += delta.left
        else offset.top += delta.top

        var isVertical          = /top|bottom/.test(placement)
        var arrowDelta          = isVertical ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight
        var arrowOffsetPosition = isVertical ? 'offsetWidth' : 'offsetHeight'

        $tip.offset(offset)
        this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], isVertical)
    }

    Tooltip.prototype.replaceArrow = function (delta, dimension, isHorizontal) {
        this.arrow()
            .css(isHorizontal ? 'left' : 'top', 50 * (1 - delta / dimension) + '%')
            .css(isHorizontal ? 'top' : 'left', '')
    }

    Tooltip.prototype.setContent = function () {
        var $tip  = this.tip()
        var title = this.getTitle()

        $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
        $tip.removeClass('fade in top bottom left right')
    }

    Tooltip.prototype.hide = function (callback) {
        var that = this
        var $tip = this.tip()
        var e    = $.Event('hide.bs.' + this.type)

        function complete() {
            if (that.hoverState != 'in') $tip.detach()
            that.$element
                .removeAttr('aria-describedby')
                .trigger('hidden.bs.' + that.type)
            callback && callback()
        }

        this.$element.trigger(e)

        if (e.isDefaultPrevented()) return

        $tip.removeClass('in')

        $.support.transition && this.$tip.hasClass('fade') ?
            $tip
                .one('bsTransitionEnd', complete)
                .emulateTransitionEnd(Tooltip.TRANSITION_DURATION) :
            complete()

        this.hoverState = null

        return this
    }

    Tooltip.prototype.fixTitle = function () {
        var $e = this.$element
        if ($e.attr('title') || typeof ($e.attr('data-original-title')) != 'string') {
            $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
        }
    }

    Tooltip.prototype.hasContent = function () {
        return this.getTitle()
    }

    Tooltip.prototype.getPosition = function ($element) {
        $element   = $element || this.$element

        var el     = $element[0]
        var isBody = el.tagName == 'BODY'

        var elRect    = el.getBoundingClientRect()
        if (elRect.width == null) {
            // width and height are missing in IE8, so compute them manually; see https://github.com/twbs/bootstrap/issues/14093
            elRect = $.extend({}, elRect, { width: elRect.right - elRect.left, height: elRect.bottom - elRect.top })
        }
        var elOffset  = isBody ? { top: 0, left: 0 } : $element.offset()
        var scroll    = { scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop() }
        var outerDims = isBody ? { width: $(window).width(), height: $(window).height() } : null

        return $.extend({}, elRect, scroll, outerDims, elOffset)
    }

    Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
        return placement == 'bottom' ? { top: pos.top + pos.height,   left: pos.left + pos.width / 2 - actualWidth / 2  } :
                placement == 'top'    ? { top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2  } :
                placement == 'left'   ? { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth } :
            /* placement == 'right' */ { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width   }

    }

    Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {
        var delta = { top: 0, left: 0 }
        if (!this.$viewport) return delta

        var viewportPadding = this.options.viewport && this.options.viewport.padding || 0
        var viewportDimensions = this.getPosition(this.$viewport)

        if (/right|left/.test(placement)) {
            var topEdgeOffset    = pos.top - viewportPadding - viewportDimensions.scroll
            var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight
            if (topEdgeOffset < viewportDimensions.top) { // top overflow
                delta.top = viewportDimensions.top - topEdgeOffset
            } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow
                delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset
            }
        } else {
            var leftEdgeOffset  = pos.left - viewportPadding
            var rightEdgeOffset = pos.left + viewportPadding + actualWidth
            if (leftEdgeOffset < viewportDimensions.left) { // left overflow
                delta.left = viewportDimensions.left - leftEdgeOffset
            } else if (rightEdgeOffset > viewportDimensions.width) { // right overflow
                delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset
            }
        }

        return delta
    }

    Tooltip.prototype.getTitle = function () {
        var title
        var $e = this.$element
        var o  = this.options

        title = $e.attr('data-original-title')
            || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)

        return title
    }

    Tooltip.prototype.getUID = function (prefix) {
        do prefix += ~~(Math.random() * 1000000)
        while (document.getElementById(prefix))
        return prefix
    }

    Tooltip.prototype.tip = function () {
        return (this.$tip = this.$tip || $(this.options.template))
    }

    Tooltip.prototype.arrow = function () {
        return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))
    }

    Tooltip.prototype.enable = function () {
        this.enabled = true
    }

    Tooltip.prototype.disable = function () {
        this.enabled = false
    }

    Tooltip.prototype.toggleEnabled = function () {
        this.enabled = !this.enabled
    }

    Tooltip.prototype.toggle = function (e) {
        var self = this
        if (e) {
            self = $(e.currentTarget).data('bs.' + this.type)
            if (!self) {
                self = new this.constructor(e.currentTarget, this.getDelegateOptions())
                $(e.currentTarget).data('bs.' + this.type, self)
            }
        }

        self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
    }

    Tooltip.prototype.destroy = function () {
        var that = this
        clearTimeout(this.timeout)
        this.hide(function () {
            that.$element.off('.' + that.type).removeData('bs.' + that.type)
        })
    }


    // TOOLTIP PLUGIN DEFINITION
    // =========================

    function Plugin(option) {
        return this.each(function () {
            var $this   = $(this)
            var data    = $this.data('bs.tooltip')
            var options = typeof option == 'object' && option

            if (!data && option == 'destroy') return
            if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
            if (typeof option == 'string') data[option]()
        })
    }

    var old = $.fn.tooltip

    $.fn.tooltip             = Plugin
    $.fn.tooltip.Constructor = Tooltip


    // TOOLTIP NO CONFLICT
    // ===================

    $.fn.tooltip.noConflict = function () {
        $.fn.tooltip = old
        return this
    }

}(jQuery);

/* ========================================================================
 * Bootstrap: popover.js v3.2.0
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
    'use strict';

    // POPOVER PUBLIC CLASS DEFINITION
    // ===============================

    var Popover = function (element, options) {
        this.init('popover', element, options)
    }

    if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js')

    Popover.VERSION  = '3.2.0'

    Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {
        placement: 'right',
        trigger: 'click',
        content: '',
        template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
    })


    // NOTE: POPOVER EXTENDS tooltip.js
    // ================================

    Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype)

    Popover.prototype.constructor = Popover

    Popover.prototype.getDefaults = function () {
        return Popover.DEFAULTS
    }

    Popover.prototype.setContent = function () {
        var $tip    = this.tip()
        var title   = this.getTitle()
        var content = this.getContent()

        $tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title)
        $tip.find('.popover-content').children().detach().end()[ // we use append for html objects to maintain js events
            this.options.html ? (typeof content == 'string' ? 'html' : 'append') : 'text'
            ](content)

        $tip.removeClass('fade top bottom left right in')

        // IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do
        // this manually by checking the contents.
        if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide()
    }

    Popover.prototype.hasContent = function () {
        return this.getTitle() || this.getContent()
    }

    Popover.prototype.getContent = function () {
        var $e = this.$element
        var o  = this.options

        return $e.attr('data-content')
            || (typeof o.content == 'function' ?
                o.content.call($e[0]) :
                o.content)
    }

    Popover.prototype.arrow = function () {
        return (this.$arrow = this.$arrow || this.tip().find('.arrow'))
    }

    Popover.prototype.tip = function () {
        if (!this.$tip) this.$tip = $(this.options.template)
        return this.$tip
    }


    // POPOVER PLUGIN DEFINITION
    // =========================

    function Plugin(option) {
        return this.each(function () {
            var $this   = $(this)
            var data    = $this.data('bs.popover')
            var options = typeof option == 'object' && option

            if (!data && option == 'destroy') return
            if (!data) $this.data('bs.popover', (data = new Popover(this, options)))
            if (typeof option == 'string') data[option]()
        })
    }

    var old = $.fn.popover

    $.fn.popover             = Plugin
    $.fn.popover.Constructor = Popover


    // POPOVER NO CONFLICT
    // ===================

    $.fn.popover.noConflict = function () {
        $.fn.popover = old
        return this
    }

}(jQuery);
/**
 * jquery.timer.js
 *
 * Copyright (c) 2011 Jason Chavannes <jason.chavannes@gmail.com>
 *
 * http://jchavannes.com/jquery-timer
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

;(function($) {
	$.timer = function(func, time, autostart) {	
	 	this.set = function(func, time, autostart) {
	 		this.init = true;
	 	 	if(typeof func == 'object') {
		 	 	var paramList = ['autostart', 'time'];
	 	 	 	for(var arg in paramList) {if(func[paramList[arg]] != undefined) {eval(paramList[arg] + " = func[paramList[arg]]");}};
 	 			func = func.action;
	 	 	}
	 	 	if(typeof func == 'function') {this.action = func;}
		 	if(!isNaN(time)) {this.intervalTime = time;}
		 	if(autostart && !this.isActive) {
			 	this.isActive = true;
			 	this.setTimer();
		 	}
		 	return this;
	 	};
	 	this.once = function(time) {
			var timer = this;
	 	 	if(isNaN(time)) {time = 0;}
			window.setTimeout(function() {timer.action();}, time);
	 		return this;
	 	};
		this.play = function(reset) {
			if(!this.isActive) {
				if(reset) {this.setTimer();}
				else {this.setTimer(this.remaining);}
				this.isActive = true;
			}
			return this;
		};
		this.pause = function() {
			if(this.isActive) {
				this.isActive = false;
				this.remaining -= new Date() - this.last;
				this.clearTimer();
			}
			return this;
		};
		this.stop = function() {
			this.isActive = false;
			this.remaining = this.intervalTime;
			this.clearTimer();
			return this;
		};
		this.toggle = function(reset) {
			if(this.isActive) {this.pause();}
			else if(reset) {this.play(true);}
			else {this.play();}
			return this;
		};
		this.reset = function() {
			this.isActive = false;
			this.play(true);
			return this;
		};
		this.clearTimer = function() {
			window.clearTimeout(this.timeoutObject);
		};
	 	this.setTimer = function(time) {
			var timer = this;
	 	 	if(typeof this.action != 'function') {return;}
	 	 	if(isNaN(time)) {time = this.intervalTime;}
		 	this.remaining = time;
	 	 	this.last = new Date();
			this.clearTimer();
			this.timeoutObject = window.setTimeout(function() {timer.go();}, time);
		};
	 	this.go = function() {
	 		if(this.isActive) {
	 			this.action();
	 			this.setTimer();
	 		}
	 	};
	 	
	 	if(this.init) {
	 		return new $.timer(func, time, autostart);
	 	} else {
			this.set(func, time, autostart);
	 		return this;
	 	}
	};
})(jQuery);
(function($){$.fn.loader=function(settings){function updateSize(loader){var height=loader.options.location==="outer"?loader.target.outerHeight():loader.target.innerHeight(),width=loader.options.location==="outer"?loader.target.outerWidth():loader.target.innerWidth();if(height<loader.options.minheight){height=loader.options.minheight}if(width<loader.options.minwidth){width=loader.options.minwidth}loader.$.css({height:height+"px",width:width+"px"})}function buildLoaderElement(loader){var ldr=$(loader.options.element[loader.options.step]).addClass("loading-wrapper").css({background:"#1e1e1e",filter:"alpha(opacity=80)","z-index":"8990"});if($("html").hasClass("rgba")){ldr.css("background","rgba(30,30,30,.8)")}if(loader.options.elementClass){ldr.addClass(loader.options.elementClass)}return ldr}function setPosition(itm){var oldposition=itm.css("position");itm.data("oldposition",oldposition);if(oldposition==="static"||oldposition===""){itm.css("position","relative")}}function restorePosition(itm){var oldposition=itm.data("oldposition");itm.css("position",oldposition)}var defaults={element:{append:"<div/>",overlay:"<div/>",insert:"<div/>"},target:null,img:{src:"/etc/designs/orion/upc/nl/img/ui/ajax-loader.gif",top:null,left:null},location:"outer",flow:[],height:null,width:null,minheight:16,minwidth:11,onloading:function(loader){var $this=$(loader),$target,oldposition,position={position:"relative",left:0,top:0},cssObj={};loader.target=$target=loader.options.target?$this.find(loader.options.target):$this;loader.$=buildLoaderElement(loader);if(loader.options.step==="append"){setPosition($(loader));updateSize(loader);loader.$.css($.extend({},position));$(loader).append(loader.$.html(loader.$img))}else{if(loader.options.step==="overlay"){setPosition($(loader));updateSize(loader);isTvodDialog=$(loader).find(".tvod-checkout").length>0;if(((navigator.appVersion.indexOf("MSIE 8")>-1)||(navigator.appVersion.indexOf("MSIE 9")>-1))&&!isTvodDialog){cssObj={position:"relative",top:"-"+loader.$.height()+"px","margin-bottom":"-"+loader.$.height()+"px"}}else{cssObj={position:"absolute",top:parseInt(loader.target.position().top,10)+"px",left:parseInt(loader.target.position().left,10)+"px"}}loader.$.css(cssObj);$(loader).append(loader.$.html(loader.$img))}else{if(loader.options.step=="insert"){setPosition(loader.target);loader.$.css({height:loader.options.minheight+"px",width:loader.options.minwidth+"px"});loader.target.append(loader.$.html(loader.$img))}}}},onloaded:function(loader){var updateProgress;loader.$.remove();loader.target.css("position",loader.target.data("oldposition"));updateProgress=!!(loader.options.progress<loader.options.flow.length-1);if(updateProgress){loader.options.progress=loader.options.progress+1;loader.options.step=loader.options.flow[loader.options.progress]}},oncancelled:function(loader){loader.$.remove();loader.target.css("position",loader.target.data("oldposition"))}};return this.each(function(){var loader=this;var $this=$(loader);var $target,$img,oldposition,$loader;loader.options={step:null,progress:0};if(settings){$.extend(true,loader.options,defaults,settings);loader.options.step=loader.options.flow[loader.options.progress]}loader.target=$target=loader.options.target?$this.find(loader.options.target):$this;loader.$img=$img=$("<img/>",{src:loader.options.img.src}).css({position:"absolute",left:loader.options.img.left||"50%",top:loader.options.img.top||"50%"}).load(function(){var $i=$(this),offsetTop=$i.height()/2,offsetLeft=$i.width()/2;$i.css({"margin-top":-offsetTop+"px","margin-left":-offsetLeft+"px"})});loader.$=$loader=buildLoaderElement(loader);if($this.data("events")&&$this.data("events").loading){return}$this.bind("loading",function(e){e.stopPropagation();loader.options.onloading.call(e,loader)}).bind("loaded",function(e){e.stopPropagation();loader.options.onloaded.call(e,loader)}).bind("loadcancelled",function(e){e.stopPropagation();loader.options.oncancelled.call(e,loader)})})}})(jQuery);
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
var Mustache;(function(exports){if(typeof module!=="undefined"){module.exports=exports}else{if(typeof define==="function"){define(exports)}else{Mustache=exports}}}(function(){var exports={};exports.name="mustache.js";exports.version="0.5.1-dev";exports.tags=["{{","}}"];exports.parse=parse;exports.clearCache=clearCache;exports.compile=compile;exports.compilePartial=compilePartial;exports.render=render;exports.Scanner=Scanner;exports.Context=Context;exports.Renderer=Renderer;exports.to_html=function(template,view,partials,send){var result=render(template,view,partials);if(typeof send==="function"){send(result)}else{return result}};var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string)}function isWhitespace(string){return !testRe(nonSpaceRe,string)}var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};var jsCharsRe=/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF\u2028\u2029]/gm;function quote(text){var escaped=text.replace(jsCharsRe,function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)});return'"'+escaped+'"'}function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}exports.isWhitespace=isWhitespace;exports.isArray=isArray;exports.quote=quote;exports.escapeRe=escapeRe;exports.escapeHtml=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function(){return this.tail===""};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0]}return null};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case -1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match=null;break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos}return match};function Context(view,parent){this.view=view;this.parent=parent;this.clearCache()}Context.make=function(view){return(view instanceof Context)?view:new Context(view)};Context.prototype.clearCache=function(){this._cache={}};Context.prototype.push=function(view){return new Context(view,this)};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name==="."){value=this.view}else{var context=this;while(context){if(name.indexOf(".")>0){var names=name.split("."),i=0;value=context.view;while(value&&i<names.length){value=value[names[i++]]}}else{value=context.view[name]}if(value!=null){break}context=context.parent}}this._cache[name]=value}if(typeof value==="function"){value=value.call(this.view)}return value};function Renderer(){this.clearCache()}Renderer.prototype.clearCache=function(){this._cache={};this._partialCache={}};Renderer.prototype.compile=function(tokens,tags){if(typeof tokens==="string"){tokens=parse(tokens,tags)}var fn=compileTokens(tokens),self=this;return function(view){return fn(Context.make(view),self)}};Renderer.prototype.compilePartial=function(name,tokens,tags){this._partialCache[name]=this.compile(tokens,tags);return this._partialCache[name]};Renderer.prototype.render=function(template,view){var fn=this._cache[template];if(!fn){fn=this.compile(template);this._cache[template]=fn}return fn(view)};Renderer.prototype._section=function(name,context,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){var buffer="";for(var i=0,len=value.length;i<len;++i){buffer+=callback(context.push(value[i]),this)}return buffer}return value?callback(context.push(value),this):"";case"function":var sectionText=callback(context,this),self=this;var scopedRender=function(template){return self.render(template,context)};return value.call(context.view,sectionText,scopedRender)||"";default:if(value){return callback(context,this)}}return""};Renderer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);if(value==null||value===false||(isArray(value)&&value.length===0)){return callback(context,this)}return""};Renderer.prototype._partial=function(name,context){var fn=this._partialCache[name];if(fn){return fn(context,this)}return""};Renderer.prototype._name=function(name,context,escape){var value=context.lookup(name);if(typeof value==="function"){value=value.call(context.view)}var string=(value==null)?"":String(value);if(escape){return escapeHtml(string)}return string};function compileTokens(tokens,returnBody){var body=['""'];var token,method,escape;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token.type){case"#":case"^":method=(token.type==="#")?"_section":"_inverted";body.push("r."+method+"("+quote(token.value)+", c, function (c, r) {\n  "+compileTokens(token.tokens,true)+"\n})");break;case"{":case"&":case"name":escape=token.type==="name"?"true":"false";body.push("r._name("+quote(token.value)+", c, "+escape+")");break;case">":body.push("r._partial("+quote(token.value)+", c)");break;case"text":body.push(quote(token.value));break}}body="return "+body.join(" + ")+";";if(returnBody){return body}return new Function("c, r",body)}function escapeTags(tags){if(tags.length===2){return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))]}throw new Error("Invalid tags: "+tags.join(" "))}function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token,section;for(var i=0;i<tokens.length;++i){token=tokens[i];switch(token.type){case"#":case"^":token.tokens=[];sections.push(token);collector.push(token);collector=token.tokens;break;case"/":if(sections.length===0){throw new Error("Unopened section: "+token.value)}section=sections.pop();if(section.value!==token.value){throw new Error("Unclosed section: "+section.value)}if(sections.length>0){collector=sections[sections.length-1].tokens}else{collector=tree}break;default:collector.push(token)}}section=sections.pop();if(section){throw new Error("Unclosed section: "+section.value)}return tree}function squashTokens(tokens){var lastToken;for(var i=0;i<tokens.length;++i){var token=tokens[i];if(lastToken&&lastToken.type==="text"&&token.type==="text"){lastToken.value+=token.value;tokens.splice(i--,1)}else{lastToken=token}}}function parse(template,tags){tags=tags||exports.tags;var tagRes=escapeTags(tags);var scanner=new Scanner(template);var tokens=[],spaces=[],hasTag=false,nonSpace=false;var stripSpace=function(){if(hasTag&&!nonSpace){while(spaces.length){tokens.splice(spaces.pop(),1)}}else{spaces=[]}hasTag=false;nonSpace=false};var type,value,chr;while(!scanner.eos()){value=scanner.scanUntil(tagRes[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length)}else{nonSpace=true}tokens.push({type:"text",value:chr});if(chr==="\n"){stripSpace()}}}if(!scanner.scan(tagRes[0])){break}hasTag=true;type=scanner.scan(tagRe)||"name";scanner.scan(whiteRe);if(type==="="){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1])}else{if(type==="{"){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe);scanner.scan(curlyRe);scanner.scanUntil(tagRes[1])}else{value=scanner.scanUntil(tagRes[1])}}if(!scanner.scan(tagRes[1])){throw new Error("Unclosed tag at "+scanner.pos)}tokens.push({type:type,value:value});if(type==="name"||type==="{"||type==="&"){nonSpace=true}if(type==="="){tags=value.split(spaceRe);tagRes=escapeTags(tags)}}squashTokens(tokens);return nestTokens(tokens)}var _renderer=new Renderer();function clearCache(){_renderer.clearCache()}function compile(tokens,tags){return _renderer.compile(tokens,tags)}function compilePartial(name,tokens,tags){return _renderer.compilePartial(name,tokens,tags)}function render(template,view,partials){if(partials){for(var name in partials){compilePartial(name,partials[name])}}return _renderer.render(template,view)}return exports}()));
var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/*!	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1",playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof win.ActiveXObject!=UNDEF){try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}}catch(e){}}}return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac}}(),onDomLoad=function(){if(!ua.w3){return}if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))){callDomLoadFunctions()}if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false)}if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee);callDomLoadFunctions()}});if(win==top){(function(){if(isDomLoaded){return}try{doc.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}callDomLoadFunctions()})()}}if(ua.wk){(function(){if(isDomLoaded){return}if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,0);return}callDomLoadFunctions()})()}addLoadEvent(callDomLoadFunctions)}}();function callDomLoadFunctions(){if(isDomLoaded){return}try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t)}catch(e){return}isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++){domLoadFnArr[i]()}}function addDomLoadEvent(fn){if(isDomLoaded){fn()}else{domLoadFnArr[domLoadFnArr.length]=fn}}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false)}else{if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false)}else{if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn)}else{if(typeof win.onload=="function"){var fnOld=win.onload;win.onload=function(){fnOld();fn()}}else{win.onload=fn}}}}}function main(){if(plugin){testPlayerVersion()}else{matchVersions()}}function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}}else{if(counter<10){counter++;setTimeout(arguments.callee,10);return}}b.removeChild(o);t=null;matchVersions()})()}else{matchVersions()}}function matchVersions(){var rl=regObjArr.length;if(rl>0){for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj){if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj)}}else{if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class")){att.styleclass=obj.getAttribute("class")}if(obj.getAttribute("align")){att.align=obj.getAttribute("align")}var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++){if(p[j].getAttribute("name").toLowerCase()!="movie"){par[p[j].getAttribute("name")]=p[j].getAttribute("value")}}showExpressInstall(att,par,id,cb)}else{displayAltContent(obj);if(cb){cb(cbObj)}}}}}else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o}cb(cbObj)}}}}}function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=UNDEF){r=o}else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n}}}return r}function canExpressInstall(){return !isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312)}function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null}else{storedAltContent=obj;storedAltContentId=replaceElemIdStr}att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||(!/%$/.test(att.width)&&parseInt(att.width,10)<310)){att.width="310"}if(typeof att.height==UNDEF||(!/%$/.test(att.height)&&parseInt(att.height,10)<137)){att.height="137"}doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+fv}else{par.flashvars=fv}if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj)}else{setTimeout(arguments.callee,10)}})()}createSWF(att,par,replaceElemIdStr)}}function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj)}else{setTimeout(arguments.callee,10)}})()}else{obj.parentNode.replaceChild(abstractAltContent(obj),obj)}}function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML}else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true))}}}}}return ac}function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312){return r}if(el){if(typeof attObj.id==UNDEF){attObj.id=id}if(ua.ie&&ua.win){var att="";for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i]}else{if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"'}else{if(i.toLowerCase()!="classid"){att+=" "+i+'="'+attObj[i]+'"'}}}}}var par="";for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />'}}el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>";objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id)}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m])}else{if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m])}}}}for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n])}}el.parentNode.replaceChild(o,el);r=o}}return r}function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p)}function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){removeObjectInIE(id)}else{setTimeout(arguments.callee,10)}})()}else{obj.parentNode.removeChild(obj)}}}function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null}}obj.parentNode.removeChild(obj)}}function getElementById(id){var el=null;try{el=doc.getElementById(id)}catch(e){}return el}function createElement(el){return doc.createElement(el)}function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn]}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false}function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac){return}var h=doc.getElementsByTagName("head")[0];if(!h){return}var m=(media&&typeof media=="string")?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null}if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1]}dynamicStylesheetMedia=m}if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT){dynamicStylesheet.addRule(sel,decl)}}else{if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF){dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"))}}}function setVisibility(id,isVisible){if(!autoHideShow){return}var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v}else{createCSS("#"+id,"visibility:"+v)}}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s}var cleanup=function(){if(ua.ie&&ua.win){window.attachEvent("onunload",function(){var ll=listenersArr.length;for(var i=0;i<ll;i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2])}var il=objIdArr.length;for(var j=0;j<il;j++){removeSWF(objIdArr[j])}for(var k in ua){ua[k]=null}ua=null;for(var l in swfobject){swfobject[l]=null}swfobject=null})}}();return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false)}else{if(callbackFn){callbackFn({success:false,id:objectIdStr})}}},getObjectById:function(objectIdStr){if(ua.w3){return getObjectById(objectIdStr)}},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT){for(var i in attObj){att[i]=attObj[i]}}att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT){for(var j in parObj){par[j]=parObj[j]}}if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k]}else{par.flashvars=k+"="+flashvarsObj[k]}}}if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true)}callbackObj.success=true;callbackObj.ref=obj}else{if(xiSwfUrlStr&&canExpressInstall()){att.data=xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return}else{setVisibility(replaceElemIdStr,true)}}if(callbackFn){callbackFn(callbackObj)}})}else{if(callbackFn){callbackFn(callbackObj)}}},switchOffAutoHideShow:function(){autoHideShow=false},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3){return createSWF(attObj,parObj,replaceElemIdStr)}else{return undefined}},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall()){showExpressInstall(att,par,replaceElemIdStr,callbackFn)}},removeSWF:function(objElemIdStr){if(ua.w3){removeSWF(objElemIdStr)}},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3){createCSS(selStr,declStr,mediaStr,newStyleBoolean)}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)){q=q.split("?")[1]}if(param==null){return urlEncodeIfNecessary(q)}var pairs=q.split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&ua.win){storedAltContent.style.display="block"}}if(storedCallbackFn){storedCallbackFn(storedCallbackObj)}}isExpressInstallActive=false}}}}();
(function(window,undefined){var EMPTY="",UNKNOWN="?",FUNC_TYPE="function",UNDEF_TYPE="undefined",OBJ_TYPE="object",MAJOR="major",MODEL="model",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",ARCHITECTURE="architecture",CONSOLE="console",MOBILE="mobile",TABLET="tablet",SMARTTV="smarttv";var util={has:function(str1,str2){if(typeof str1==="string"){return str2.toLowerCase().indexOf(str1.toLowerCase())!==-1}},lowerize:function(str){return str.toLowerCase()}};var mapper={rgx:function(){for(var result,i=0,j,k,p,q,matches,match,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(typeof(result)===UNDEF_TYPE){result={};for(p in props){q=props[p];if(typeof(q)===OBJ_TYPE){result[q[0]]=undefined}else{result[q]=undefined}}}for(j=k=0;j<regex.length;j++){matches=regex[j].exec(this.getUA());if(!!matches){for(p=0;p<props.length;p++){match=matches[++k];q=props[p];if(typeof(q)===OBJ_TYPE&&q.length>0){if(q.length==2){if(typeof(q[1])==FUNC_TYPE){result[q[0]]=q[1].call(this,match)}else{result[q[0]]=q[1]}}else{if(q.length==3){if(typeof(q[1])===FUNC_TYPE&&!(q[1].exec&&q[1].test)){result[q[0]]=match?q[1].call(this,match,q[2]):undefined}else{result[q[0]]=match?match.replace(q[1],q[2]):undefined}}else{if(q.length==4){result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined}}}}else{result[q]=match?match:undefined}}break}}if(!!matches){break}}return result},str:function(str,map){for(var i in map){if(typeof(map[i])===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(util.has(map[i][j],str)){return(i===UNKNOWN)?undefined:i}}}else{if(util.has(map[i],str)){return(i===UNKNOWN)?undefined:i}}}return str}};var maps={browser:{oldsafari:{major:{"1":["/8","/1","/3"],"2":"/4","?":"/"},version:{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0","2000":"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0","7":"NT 6.1","8":"NT 6.2","8.1":"NT 6.3",RT:"ARM"}}}};var regexes={browser:[[/APP-([\w\s-\d]+)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[NAME,"Opera"],VERSION,MAJOR],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[NAME,"IE"],VERSION,MAJOR],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[NAME,"Yandex"],VERSION,MAJOR],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[NAME,/_/g," "],VERSION,MAJOR],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[NAME,"Dolphin"],VERSION,MAJOR],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[NAME,"Chrome"],VERSION,MAJOR],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,MAJOR,[NAME,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,MAJOR,NAME],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[NAME,[MAJOR,mapper.str,maps.browser.oldsafari.major],[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[NAME,"Netscape"],VERSION,MAJOR],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(apple(?:coremedia|))\/((\d+)[\w\._]+)/i,/(coremedia) v((\d+)[\w\._]+)/i],[NAME,VERSION,MAJOR],[/(aqualung|lyssna|bsplayer)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION],[/(ares|ossproxy)\s((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(audacious|audimusicstream|amarok|bass|core|dalvik|gnomemplayer|music on console|nsplayer|psp-internetradioplayer|videos)\/((\d+)[\w\.-]+)/i,/(clementine|music player daemon)\s((\d+)[\w\.-]+)/i,/(lg player|nexplayer)\s((\d+)[\d\.]+)/i,/player\/(nexplayer|lg player)\s((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(nexplayer)\s((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(flrp)\/((\d+)[\w\.-]+)/i],[[NAME,"Flip Player"],VERSION,MAJOR],[/(fstream|nativehost|queryseekspider|ia-archiver|facebookexternalhit)/i],[NAME],[/(gstreamer) souphttpsrc (?:\([^\)]+\)){0,1} libsoup\/((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(htc streaming player)\s[\w_]+\s\/\s((\d+)[\d\.]+)/i,/(java|python-urllib|python-requests|wget|libcurl)\/((\d+)[\w\.-_]+)/i,/(lavf)((\d+)[\d\.]+)/i],[NAME,VERSION,MAJOR],[/(htc_one_s)\/((\d+)[\d\.]+)/i,],[[NAME,/_/g," "],VERSION,MAJOR],[/(mplayer)(?:\s|\/)(?:(?:sherpya-){0,1}svn)(?:-|\s)(r\d+(?:-\d+[\w\.-]+){0,1})/i,],[NAME,VERSION],[/(mplayer)(?:\s|\/|[unkow-]+)((\d+)[\w\.-]+)/i,],[NAME,VERSION,MAJOR],[/(mplayer)/i,/(yourmuze)/i,/(media player classic|nero showtime)/i],[NAME],[/(nero (?:home|scout))\/((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(nokia\d+)\/((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/\s(songbird)\/((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(winamp)3 version ((\d+)[\w\.-]+)/i,/(winamp)\s((\d+)[\w\.-]+)/i,/(winamp)mpeg\/((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(ocms-bot|tapinradio|tunein radio|unknown|winamp|inlight radio)/i],[NAME],[/(quicktime|rma|radioapp|radioclientapplication|soundtap|totem|stagefright|streamium)\/((\d+)[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(smp)((\d+)[\d\.]+)/i],[NAME,VERSION,MAJOR],[/(vlc) media player - version ((\d+)[\w\.]+)/i,/(vlc)\/((\d+)[\w\.-]+)/i,/(xbmc|gvfs|xine|xmms|irapp)\/((\d+)[\w\.-]+)/i,/(foobar2000)\/((\d+)[\d\.]+)/i,/(itunes)\/((\d+)[\d\.]+)/i],[NAME,VERSION,MAJOR],[/(wmplayer)\/((\d+)[\w\.-]+)/i,/(windows-media-player)\/((\d+)[\w\.-]+)/i],[[NAME,/-/g," "],VERSION,MAJOR],[/windows\/((\d+)[\w\.-]+) upnp\/[\d\.]+ dlnadoc\/[\d\.]+ (home media server)/i,],[VERSION,MAJOR,[NAME,"Windows"]],[/(com\.riseupradioalarm)\/((\d+)[\d\.]*)/i],[NAME,VERSION,MAJOR],[/(rad.io)\s((\d+)[\d\.]+)/i,/(radio.(?:de|at|fr))\s((\d+)[\d\.]+)/i],[[NAME,"rad.io"],VERSION,MAJOR]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[ARCHITECTURE,"amd64"]],[/(ia32(?=;))/i],[[ARCHITECTURE,util.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[ARCHITECTURE,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[ARCHITECTURE,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[ARCHITECTURE,/ower/,"",util.lowerize]],[/(sun4\w)[;\)]/i],[[ARCHITECTURE,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[ARCHITECTURE,util.lowerize]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/applecoremedia\/[\w\.]+ \((ipad)/],[MODEL,[VENDOR,"Apple"],[TYPE,TABLET]],[/(apple\s{0,1}tv)/i],[[MODEL,"Apple TV"],[VENDOR,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i,],[MODEL,[VENDOR,"Amazon"],[TYPE,TABLET]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[MODEL,VENDOR,[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);/i],[MODEL,[VENDOR,"Apple"],[TYPE,MOBILE]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/\((bb10);\s(\w+)/i],[[VENDOR,"BlackBerry"],MODEL,[TYPE,MOBILE]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7))/i],[[VENDOR,"Asus"],MODEL,[TYPE,TABLET]],[/(sony)\s(tablet\s[ps])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(nintendo)\s([wids3u]+)/i],[VENDOR,MODEL,[TYPE,CONSOLE]],[/((playstation)\s[3portablevi]+)/i],[[VENDOR,"Sony"],MODEL,[TYPE,CONSOLE]],[/(sprint\s(\w+))/i],[[VENDOR,mapper.str,maps.device.sprint.vendor],[MODEL,mapper.str,maps.device.sprint.model],[TYPE,MOBILE]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[VENDOR,"Motorola"],MODEL,[TYPE,MOBILE]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[VENDOR,"Motorola"],MODEL,[TYPE,TABLET]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,TABLET]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,MOBILE]],[/(sie)-(\w+)*/i],[[VENDOR,"Siemens"],MODEL,[TYPE,MOBILE]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[VENDOR,"Nokia"],MODEL,[TYPE,MOBILE]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[VENDOR,"Acer"],MODEL,[TYPE,TABLET]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[VENDOR,"LG"],MODEL,[TYPE,TABLET]],[/(lg) netcast\.tv/i],[VENDOR,[TYPE,SMARTTV]],[/((nexus\s[45]))/i,/(lg)[e;\s-\/]+(\w+)*/i],[[VENDOR,"LG"],MODEL,[TYPE,MOBILE]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[VENDOR,"Lenovo"],MODEL,[TYPE,TABLET]],[/(mobile|tablet);.+rv\:.+gecko\//i],[TYPE,VENDOR,MODEL]],engine:[[/APP-([\w\s-\d]+)\/((\d+)?[\w\.]+)/i],[[NAME,"Mobile-App"],VERSION],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/microsoft\s(windows)\s(vista|xp)/i,],[NAME,VERSION],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[NAME,[VERSION,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]};var UAParser=function(uastring){var ua=uastring||((window&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:EMPTY);if(!(this instanceof UAParser)){return new UAParser(uastring).getResult()}this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser)};this.getCPU=function(){return mapper.rgx.apply(this,regexes.cpu)};this.getDevice=function(){return mapper.rgx.apply(this,regexes.device)};this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine)};this.getOS=function(){return mapper.rgx.apply(this,regexes.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return ua};this.setUA=function(uastring){ua=uastring;return this};this.setUA(ua)};if(typeof(exports)!==UNDEF_TYPE){if(typeof(module)!==UNDEF_TYPE&&module.exports){exports=module.exports=UAParser}exports.UAParser=UAParser}else{window.UAParser=UAParser;if(typeof(define)===FUNC_TYPE&&define.amd){define(function(){return UAParser})}if(typeof(window.jQuery)!==UNDEF_TYPE){var $=window.jQuery;var parser=new UAParser();$.ua=parser.getResult();$.ua.get=function(){return parser.getUA()};$.ua.set=function(uastring){parser.setUA(uastring);var result=parser.getResult();for(var prop in result){$.ua[prop]=result[prop]}}}}})(this);
//v2.0.30511.0
if(!window.Silverlight)window.Silverlight={};Silverlight._silverlightCount=0;Silverlight.__onSilverlightInstalledCalled=false;Silverlight.fwlinkRoot="http://go2.microsoft.com/fwlink/?LinkID=";Silverlight.__installationEventFired=false;Silverlight.onGetSilverlight=null;Silverlight.onSilverlightInstalled=function(){window.location.reload(false)};Silverlight.isInstalled=function(b){if(b==undefined)b=null;var a=false,m=null;try{var i=null,j=false;if(window.ActiveXObject)try{i=new ActiveXObject("AgControl.AgControl");if(b===null)a=true;else if(i.IsVersionSupported(b))a=true;i=null}catch(l){j=true}else j=true;if(j){var k=navigator.plugins["Silverlight Plug-In"];if(k)if(b===null)a=true;else{var h=k.description;if(h==="1.0.30226.2")h="2.0.30226.2";var c=h.split(".");while(c.length>3)c.pop();while(c.length<4)c.push(0);var e=b.split(".");while(e.length>4)e.pop();var d,g,f=0;do{d=parseInt(e[f]);g=parseInt(c[f]);f++}while(f<e.length&&d===g);if(d<=g&&!isNaN(d))a=true}}}catch(l){a=false}return a};Silverlight.WaitForInstallCompletion=function(){if(!Silverlight.isBrowserRestartRequired&&Silverlight.onSilverlightInstalled){try{navigator.plugins.refresh()}catch(a){}if(Silverlight.isInstalled(null)&&!Silverlight.__onSilverlightInstalledCalled){Silverlight.onSilverlightInstalled();Silverlight.__onSilverlightInstalledCalled=true}else setTimeout(Silverlight.WaitForInstallCompletion,3e3)}};Silverlight.__startup=function(){navigator.plugins.refresh();Silverlight.isBrowserRestartRequired=Silverlight.isInstalled(null);if(!Silverlight.isBrowserRestartRequired){Silverlight.WaitForInstallCompletion();if(!Silverlight.__installationEventFired){Silverlight.onInstallRequired();Silverlight.__installationEventFired=true}}else if(window.navigator.mimeTypes){var b=navigator.mimeTypes["application/x-silverlight-2"],c=navigator.mimeTypes["application/x-silverlight-2-b2"],d=navigator.mimeTypes["application/x-silverlight-2-b1"],a=d;if(c)a=c;if(!b&&(d||c)){if(!Silverlight.__installationEventFired){Silverlight.onUpgradeRequired();Silverlight.__installationEventFired=true}}else if(b&&a)if(b.enabledPlugin&&a.enabledPlugin)if(b.enabledPlugin.description!=a.enabledPlugin.description)if(!Silverlight.__installationEventFired){Silverlight.onRestartRequired();Silverlight.__installationEventFired=true}}if(!Silverlight.disableAutoStartup)if(window.removeEventListener)window.removeEventListener("load",Silverlight.__startup,false);else window.detachEvent("onload",Silverlight.__startup)};if(!Silverlight.disableAutoStartup)if(window.addEventListener)window.addEventListener("load",Silverlight.__startup,false);else window.attachEvent("onload",Silverlight.__startup);Silverlight.createObject=function(m,f,e,k,l,h,j){var d={},a=k,c=l;d.version=a.version;a.source=m;d.alt=a.alt;if(h)a.initParams=h;if(a.isWindowless&&!a.windowless)a.windowless=a.isWindowless;if(a.framerate&&!a.maxFramerate)a.maxFramerate=a.framerate;if(e&&!a.id)a.id=e;delete a.ignoreBrowserVer;delete a.inplaceInstallPrompt;delete a.version;delete a.isWindowless;delete a.framerate;delete a.data;delete a.src;delete a.alt;if(Silverlight.isInstalled(d.version)){for(var b in c)if(c[b]){if(b=="onLoad"&&typeof c[b]=="function"&&c[b].length!=1){var i=c[b];c[b]=function(a){return i(document.getElementById(e),j,a)}}var g=Silverlight.__getHandlerName(c[b]);if(g!=null){a[b]=g;c[b]=null}else throw"typeof events."+b+" must be 'function' or 'string'";}slPluginHTML=Silverlight.buildHTML(a)}else slPluginHTML=Silverlight.buildPromptHTML(d);if(f)f.innerHTML=slPluginHTML;else return slPluginHTML};Silverlight.buildHTML=function(a){var b=[];b.push('<object type="application/x-silverlight" data="data:application/x-silverlight,"');if(a.id!=null)b.push(' id="'+Silverlight.HtmlAttributeEncode(a.id)+'"');if(a.width!=null)b.push(' width="'+a.width+'"');if(a.height!=null)b.push(' height="'+a.height+'"');b.push(" >");delete a.id;delete a.width;delete a.height;for(var c in a)if(a[c])b.push('<param name="'+Silverlight.HtmlAttributeEncode(c)+'" value="'+Silverlight.HtmlAttributeEncode(a[c])+'" />');b.push("</object>");return b.join("")};Silverlight.createObjectEx=function(b){var a=b,c=Silverlight.createObject(a.source,a.parentElement,a.id,a.properties,a.events,a.initParams,a.context);if(a.parentElement==null)return c};Silverlight.buildPromptHTML=function(b){var a="",d=Silverlight.fwlinkRoot,c=b.version;if(b.alt)a=b.alt;else{if(!c)c="";a="<a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a>";a=a.replace("{1}",c);a=a.replace("{2}",d+"108181")}return a};Silverlight.getSilverlight=function(e){if(Silverlight.onGetSilverlight)Silverlight.onGetSilverlight();var b="",a=String(e).split(".");if(a.length>1){var c=parseInt(a[0]);if(isNaN(c)||c<2)b="1.0";else b=a[0]+"."+a[1]}var d="";if(b.match(/^\d+\056\d+$/))d="&v="+b;Silverlight.followFWLink("149156"+d)};Silverlight.followFWLink=function(a){top.location=Silverlight.fwlinkRoot+String(a)};Silverlight.HtmlAttributeEncode=function(c){var a,b="";if(c==null)return null;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);if(a>96&&a<123||a>64&&a<91||a>43&&a<58&&a!=47||a==95)b=b+String.fromCharCode(a);else b=b+"&#"+a+";"}return b};Silverlight.default_error_handler=function(e,b){var d,c=b.ErrorType;d=b.ErrorCode;var a="\nSilverlight error message     \n";a+="ErrorCode: "+d+"\n";a+="ErrorType: "+c+"       \n";a+="Message: "+b.ErrorMessage+"     \n";if(c=="ParserError"){a+="XamlFile: "+b.xamlFile+"     \n";a+="Line: "+b.lineNumber+"     \n";a+="Position: "+b.charPosition+"     \n"}else if(c=="RuntimeError"){if(b.lineNumber!=0){a+="Line: "+b.lineNumber+"     \n";a+="Position: "+b.charPosition+"     \n"}a+="MethodName: "+b.methodName+"     \n"}alert(a)};Silverlight.__cleanup=function(){for(var a=Silverlight._silverlightCount-1;a>=0;a--)window["__slEvent"+a]=null;Silverlight._silverlightCount=0;if(window.removeEventListener)window.removeEventListener("unload",Silverlight.__cleanup,false);else window.detachEvent("onunload",Silverlight.__cleanup)};Silverlight.__getHandlerName=function(b){var a="";if(typeof b=="string")a=b;else if(typeof b=="function"){if(Silverlight._silverlightCount==0)if(window.addEventListener)window.addEventListener("onunload",Silverlight.__cleanup,false);else window.attachEvent("onunload",Silverlight.__cleanup);var c=Silverlight._silverlightCount++;a="__slEvent"+c;window[a]=b}else a=null;return a};Silverlight.onRequiredVersionAvailable=function(){};Silverlight.onRestartRequired=function(){};Silverlight.onUpgradeRequired=function(){};Silverlight.onInstallRequired=function(){};Silverlight.IsVersionAvailableOnError=function(d,a){var b=false;try{if(a.ErrorCode==8001&&!Silverlight.__installationEventFired){Silverlight.onUpgradeRequired();Silverlight.__installationEventFired=true}else if(a.ErrorCode==8002&&!Silverlight.__installationEventFired){Silverlight.onRestartRequired();Silverlight.__installationEventFired=true}else if(a.ErrorCode==5014||a.ErrorCode==2106){if(Silverlight.__verifySilverlight2UpgradeSuccess(a.getHost()))b=true}else b=true}catch(c){}return b};Silverlight.IsVersionAvailableOnLoad=function(b){var a=false;try{if(Silverlight.__verifySilverlight2UpgradeSuccess(b.getHost()))a=true}catch(c){}return a};Silverlight.__verifySilverlight2UpgradeSuccess=function(d){var c=false,b="2.0.31005",a=null;try{if(d.IsVersionSupported(b+".99")){a=Silverlight.onRequiredVersionAvailable;c=true}else if(d.IsVersionSupported(b+".0"))a=Silverlight.onRestartRequired;else a=Silverlight.onUpgradeRequired;if(a&&!Silverlight.__installationEventFired){a();Silverlight.__installationEventFired=true}}catch(e){}return c}
	var plugin_version;
	function checkInstall(){
            	if (pluginInstalled()){
                        //setTimeout("setupPlayer(null);", 2000);
       		}
 	}

	function pluginInstalled(){
          	var plugin;
                plugin = document.getElementById('WidevinePlugin');

              	if(plugin){
                	try{
                        	plugin_version = plugin.GetVersion();
                             	return true;
                    	}catch(e){
                            	return false;
                  	}
           	}else{
                    	return false;
             	}

  	}

	function checkFlash(){
		flash_version = widevine.flashVersion();
                if (flash_version != ""){
                        major_ver = 0;

                        if(flash_version.indexOf(",") != -1){
                                major_ver = parseInt(flash_version.split(",")[0]);
                        }else if(flash_version.indexOf(".") != -1){
                                major_ver = parseInt(flash_version.split(".")[0]);
                        }

                        if (major_ver < 10){
                                getFlashText();
                        }else{
                                checkInstall();
                        }
                }else{
                        // display place holder flash movie to player
                        // dumby();
                }
	}

	function checkFFInstall(){
		// do nothing
	}

	window.onunload = checkFFInstall;

// Flash Player Version Detection - Rev 1.6
// Detect Client Browser type
// Copyright(c) 2005-2006 Adobe Macromedia Software, LLC. All rights reserved.
var isIE  = (navigator.appVersion.indexOf("MSIE") != -1) ? true : false;
var isWin = (navigator.appVersion.toLowerCase().indexOf("win") != -1) ? true : false;
var isOpera = (navigator.userAgent.indexOf("Opera") != -1) ? true : false;

function ControlVersion()
{
	var version;
	var axo;
	var e;

	// NOTE : new ActiveXObject(strFoo) throws an exception if strFoo isn't in the registry

	try {
		// version will be set for 7.X or greater players
		axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
		version = axo.GetVariable("$version");
	} catch (e) {
	}

	if (!version)
	{
		try {
			// version will be set for 6.X players only
			axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
			
			// installed player is some revision of 6.0
			// GetVariable("$version") crashes for versions 6.0.22 through 6.0.29,
			// so we have to be careful. 
			
			// default to the first public version
			version = "WIN 6,0,21,0";

			// throws if AllowScripAccess does not exist (introduced in 6.0r47)		
			axo.AllowScriptAccess = "always";

			// safe to call for 6.0r47 or greater
			version = axo.GetVariable("$version");

		} catch (e) {
		}
	}

	if (!version)
	{
		try {
			// version will be set for 4.X or 5.X player
			axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
			version = axo.GetVariable("$version");
		} catch (e) {
		}
	}

	if (!version)
	{
		try {
			// version will be set for 3.X player
			axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");
			version = "WIN 3,0,18,0";
		} catch (e) {
		}
	}

	if (!version)
	{
		try {
			// version will be set for 2.X player
			axo = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
			version = "WIN 2,0,0,11";
		} catch (e) {
			version = -1;
		}
	}
	
	return version;
}

// JavaScript helper required to detect Flash Player PlugIn version information
function GetSwfVer(){
	// NS/Opera version >= 3 check for Flash plugin in plugin array
	var flashVer = -1;
	
	if (navigator.plugins != null && navigator.plugins.length > 0) {
		if (navigator.plugins["Shockwave Flash 2.0"] || navigator.plugins["Shockwave Flash"]) {
			var swVer2 = navigator.plugins["Shockwave Flash 2.0"] ? " 2.0" : "";
			var flashDescription = navigator.plugins["Shockwave Flash" + swVer2].description;
			var descArray = flashDescription.split(" ");
			var tempArrayMajor = descArray[2].split(".");			
			var versionMajor = tempArrayMajor[0];
			var versionMinor = tempArrayMajor[1];
			var versionRevision = descArray[3];
			if (versionRevision == "") {
				versionRevision = descArray[4];
			}
			if (versionRevision[0] == "d") {
				versionRevision = versionRevision.substring(1);
			} else if (versionRevision[0] == "r") {
				versionRevision = versionRevision.substring(1);
				if (versionRevision.indexOf("d") > 0) {
					versionRevision = versionRevision.substring(0, versionRevision.indexOf("d"));
				}
			}
			var flashVer = versionMajor + "." + versionMinor + "." + versionRevision;
		}
	}
	// MSN/WebTV 2.6 supports Flash 4
	else if (navigator.userAgent.toLowerCase().indexOf("webtv/2.6") != -1) flashVer = 4;
	// WebTV 2.5 supports Flash 3
	else if (navigator.userAgent.toLowerCase().indexOf("webtv/2.5") != -1) flashVer = 3;
	// older WebTV supports Flash 2
	else if (navigator.userAgent.toLowerCase().indexOf("webtv") != -1) flashVer = 2;
	else if ( isIE && isWin && !isOpera ) {
		flashVer = ControlVersion();
	}	
	return flashVer;
}

// When called with reqMajorVer, reqMinorVer, reqRevision returns true if that version or greater is available
function DetectFlashVer(reqMajorVer, reqMinorVer, reqRevision)
{
	versionStr = GetSwfVer();
	if (versionStr == -1 ) {
		return false;
	} else if (versionStr != 0) {
		if(isIE && isWin && !isOpera) {
			// Given "WIN 2,0,0,11"
			tempArray         = versionStr.split(" "); 	// ["WIN", "2,0,0,11"]
			tempString        = tempArray[1];			// "2,0,0,11"
			versionArray      = tempString.split(",");	// ['2', '0', '0', '11']
		} else {
			versionArray      = versionStr.split(".");
		}
		var versionMajor      = versionArray[0];
		var versionMinor      = versionArray[1];
		var versionRevision   = versionArray[2];

        	// is the major.revision >= requested major.revision AND the minor version >= requested minor
		if (versionMajor > parseFloat(reqMajorVer)) {
			return true;
		} else if (versionMajor == parseFloat(reqMajorVer)) {
			if (versionMinor > parseFloat(reqMinorVer))
				return true;
			else if (versionMinor == parseFloat(reqMinorVer)) {
				if (versionRevision >= parseFloat(reqRevision))
					return true;
			}
		}
		return false;
	}
}

function AC_AddExtension(src, ext)
{
  if (src.indexOf('?') != -1)
    return src.replace(/\?/, ext+'?'); 
  else
    return src + ext;
}

function AC_Generateobj(objAttrs, params, embedAttrs) 
{ 
    var str = '';
    if (isIE && isWin && !isOpera)
    {
  		str += '<object ';
  		for (var i in objAttrs)
  			str += i + '="' + objAttrs[i] + '" ';
  		for (var i in params)
  			str += '><param name="' + i + '" value="' + params[i] + '" /> ';
  		str += '></object>';
    } else {
  		str += '<embed ';
  		for (var i in embedAttrs)
  			str += i + '="' + embedAttrs[i] + '" ';
  		str += '> </embed>';
    }

    document.write(str);
}

function AC_FL_RunContent(){
  var ret = 
    AC_GetArgs
    (  arguments, ".swf", "movie", "clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"
     , "application/x-shockwave-flash"
    );
  AC_Generateobj(ret.objAttrs, ret.params, ret.embedAttrs);
}

function AC_GetArgs(args, ext, srcParamName, classid, mimeType){
  var ret = new Object();
  ret.embedAttrs = new Object();
  ret.params = new Object();
  ret.objAttrs = new Object();
  for (var i=0; i < args.length; i=i+2){
    var currArg = args[i].toLowerCase();    

    switch (currArg){	
      case "classid":
        break;
      case "pluginspage":
        ret.embedAttrs[args[i]] = args[i+1];
        break;
      case "src":
      case "movie":	
        args[i+1] = AC_AddExtension(args[i+1], ext);
        ret.embedAttrs["src"] = args[i+1];
        ret.params[srcParamName] = args[i+1];
        break;
      case "onafterupdate":
      case "onbeforeupdate":
      case "onblur":
      case "oncellchange":
      case "onclick":
      case "ondblClick":
      case "ondrag":
      case "ondragend":
      case "ondragenter":
      case "ondragleave":
      case "ondragover":
      case "ondrop":
      case "onfinish":
      case "onfocus":
      case "onhelp":
      case "onmousedown":
      case "onmouseup":
      case "onmouseover":
      case "onmousemove":
      case "onmouseout":
      case "onkeypress":
      case "onkeydown":
      case "onkeyup":
      case "onload":
      case "onlosecapture":
      case "onpropertychange":
      case "onreadystatechange":
      case "onrowsdelete":
      case "onrowenter":
      case "onrowexit":
      case "onrowsinserted":
      case "onstart":
      case "onscroll":
      case "onbeforeeditfocus":
      case "onactivate":
      case "onbeforedeactivate":
      case "ondeactivate":
      case "type":
      case "codebase":
        ret.objAttrs[args[i]] = args[i+1];
        break;
      case "id":
      case "width":
      case "height":
      case "align":
      case "vspace": 
      case "hspace":
      case "class":
      case "title":
      case "accesskey":
      case "name":
      case "tabindex":
        ret.embedAttrs[args[i]] = ret.objAttrs[args[i]] = args[i+1];
        break;
      default:
        ret.embedAttrs[args[i]] = ret.params[args[i]] = args[i+1];
    }
  }
  ret.objAttrs["classid"] = classid;
  if (mimeType) ret.embedAttrs["type"] = mimeType;
  return ret;
}



var WidevinePlugin;
var widevine = (function() {

	var debug = false;
	var debug_flags = "forceip=www.shibboleth.tv";

	// Version of plugin pointed by the installer
	var version ="5.0.0.000";
	var ie_version ="5,0,0,000";

	// Set the head end server 
	var signon_url = WVConfig.WV_SIGN_ON_URL;
	var log_url = WVConfig.WV_LOG_URL;
	var emm_url = WVConfig.WV_EMM_URL;

	// Set the portal
	var portal = WVConfig.WV_PORTAL;

	function doDetect( type, value  ) {
		//return eval( 'navigator.' + type + '.toLowerCase().indexOf("' + value + '") != -1' );
		return navigator[type].toLowerCase().indexOf(value) !== -1;
	}


	function detectMac()     { return doDetect( "platform", "mac" );}
	function detectWin32()   { return doDetect( "platform", "win32" );}
	function detectIE()      { return doDetect( "userAgent", "trident" ); }
	function detectFirefox() { return doDetect( "userAgent", "firefox" ); }
	function detectSafari()  { return doDetect( "userAgent", "safari" ); }
	function detectChrome()  { return doDetect( "userAgent", "chrome" ); }

	function detectVistaOrWindows7() {
		return doDetect( "userAgent", "windows nt 6" );
	}

	function getCookie(c_name) {
		if (document.cookie.length > 0) {
			var c_start = document.cookie.indexOf(c_name + "=");
			if (c_start!=-1) {
				c_start = c_start + c_name.length + 1;
				c_end = document.cookie.indexOf(";", c_start);
				if (c_end === -1) {
					c_end = document.cookie.length;
				}
				return unescape(document.cookie.substring(c_start,c_end))
			}
		}
		return ""
	}

	function setCookie(c_name,value,expireseconds) {
		var exdate = new Date();
		exdate.setSeconds(exdate.getSeconds() + expireseconds);
		document.cookie = c_name + "=" + escape(value) +
			((expireseconds == null) ? "" : ";expires="+exdate.toGMTString())
	}


	////////////////////////////////////////////////////////////////////////////
	// Start debug output section
	// Used to write debug information to the screen if debug variable is set
	// to true.
	// Only used by test page
	////////////////////////////////////////////////////////////////////////////

	function writeDebugCell( name, bold ) {
		if ( bold ) {
			return "<td><b>" + name + "</b></td>";
		} else {
			return "<td><s>" + name + "</s></td>";
		}
	}

	function writeDebugMimeArray( values ) {
		var value;
		var result = "";
		for ( value in values ) {
			if ( values[value] ) {
				result += "<td><table><tr><td>" +
					values[value].description +
					"</td></tr><tr><td>" +
					values[value].type +
					"</td></tr><tr><td>" +
					values[value].enabledPlugin +
					"</td></tr></table></td>";
			}
		}
		return result;
	}

	function DebugInfo() {
		var result = "";
		result += "<table border=1>";

		result += "<tr><td>Platform</td>";
		result += writeDebugCell( "Macintosh", detectMac() );
		result += writeDebugCell( "Windows", detectWin32() );
		if ( detectWin32() ) {
			result += writeDebugCell( "Vista/Windows7", detectVistaOrWindows7() );
		}
		result += "</tr>";

		result += "<tr><td>Browser</td>";
		result += writeDebugCell( "IE", detectIE() );
		result += writeDebugCell( "Firefox", detectFirefox() );
		result += writeDebugCell( "Safari", detectSafari() );
		result += writeDebugCell( "Chrome", detectChrome() );
		result += "</tr>";

		if ( !detectIE() ) {
			result += "<tr><td>MIME types</td>";
			result += writeDebugMimeArray( navigator.mimeTypes );
			result += "</tr>";
		}

		result += "<tr><td>Installed</td><td>";
		if ( navigator.mimeTypes['application/x-widevinemediaoptimizer'] ) {
			var aWidevinePlugin = document.getElementById('WidevinePlugin');
			if ( aWidevinePlugin ) {
				result += aWidevinePlugin.GetVersion();
			} else {
				result += "MIME type exists but could not load plugin";
			}
		} else {
			result += "MIME Type Not Found";
		}
		result += "</td></tr>";

		result += "</table>";
		return result;
	}

	////////////////////////////////////////////////////////////////////////////
	// End debug output section
	// Used to write debug information to the screen if debug variable is set
	// to true.
	// Only used by test page
	////////////////////////////////////////////////////////////////////////////


	////////////////////////////////////////////
	// AddDiv
	//
	// Adds a div to the html page
	// html: html to place in the div
	////////////////////////////////////////////
	function AddDiv( html ) {
		var div = document.createElement( "div" );
		document.body.appendChild( div );
		div.innerHTML = html;
		return div;
	}

	////////////////////////////////////////////
	// EmbedText
	//
	// Returns embed or object tag for the initializing WidevineMediaOptimizer
	// plugin
	////////////////////////////////////////////
	function EmbedText() {
		if ( detectIE() ) {
			if ( pluginInstalledIE() ) {	 
				return '<object id="WidevinePlugin" classid=CLSID:defa762b-ebc6-4ce2-a48c-32b232aac64d ' +
					'hidden=true style="display:none" height="0" width="0">' +
					'<param name="default_url" value="' + signon_url + '">' +
					'<param name="emm_url" value="' + emm_url + '">' +
					'<param name="log_url" value="' + log_url + '">' +
					'<param name="portal" value="' + portal + '">' +
					'<param name="user_agent" value="' + navigator.userAgent + '">' +
					'</object>';
			}
		} else if ( navigator.mimeTypes['application/x-widevinemediaoptimizer'] ) {
				setCookie("FirefoxDisabledCheck", "");
				return '<embed id="WidevinePlugin" type="application/x-widevinemediaoptimizer"' +
					' default_url="' + signon_url +
					'" emm_url="' + emm_url +
					'" log_url="' + log_url +
					'" portal="' + portal +
					'" height="0" width="0' +
					'" user_agent="' + navigator.userAgent +
					'">';
		} else {
			//return showDownloadPageText();
			return false;
		}
	}

	////////////////////////////////////////////
	// showDownloadPageText
	//
	// Returns button to download page
	////////////////////////////////////////////
	function showDownloadPageText(){
		return "<div style='margin: -1em; position: absolute; z-index: 10; width: 1500px; height: 1200px; color: white; background-color: black'>" +
			"<div align='center'>" +
				"<h2>Widevine Video Optimizer is not installed</h2>" +
					"<input type='button' value='Get Video Optimizer' OnClick='javascript: window.open(\"http://tools.google.com/dlpage/widevine\");'>" +
						"</div>" +
							"</div>"
	}

	////////////////////////////////////////////
	// pluginInstalledIE
	//
	// Returns true if the WideVine plugin is installed
	////////////////////////////////////////////
	function pluginInstalledIE(){
		try{
			var o = new ActiveXObject("npwidevinemediaoptimizer.WidevineMediaTransformerPlugin");
			o = null;
			return true;

		}catch(e){
			return false;
		}
	}

	////////////////////////////////////////////
	// flashInstalled
	//
	// Returns true if the Flash plugin is installed
	////////////////////////////////////////////
	function isFlashInstalled(){
		try{
			var major_ver = 0;
			var version = GetSwfVer();
			if(version.indexOf(" ") != -1){
				version = version.split(" ")[1];
			}else if (version.indexOf("=") != -1){
				version = version.split(" ")[1];
			}
			current_ver = version;

			if(version.indexOf(",") != -1){
				major_ver = parseInt(version.split(",")[0]);
			}else if(version.indexOf(".") != -1){
				major_ver = parseInt(version.split(".")[0]);
			}
			if (major_ver < 10){
				alert("Please upgrade to Flash 10+ to continue. Current version: " + current_ver);
				return false;
			} else {
				return true;
			}
		}catch(e){
			current_ver = "";
			alert("Flash not detected. Please install Flash to continue.");
			return false;
		}
	}


	return {
		pluginInstalledIE: function(){
			return pluginInstalledIE();
		}
		,
		flashVersion:function(){
			isFlashInstalled();
			return current_ver;
		}
		,
		pluginInstalled:function() {
			// try {

				var embedText = EmbedText();

				if (embedText) {

					AddDiv(embedText);

				} else {

					var attempts = 0;

					function showDialog() {
						if (
							window.orion &&
							window.orion.app &&
							window.orion.app.dialogManager
						) {
							var dialog = orion.app.dialogManager.getDialog('widevine');
							dialog.setHtmlContent(
								'<div class="widevine">' +
                                '<h2>Widevine Video Optimizer is not installed</h2>' +
                                '<span class="button">' +
								'<button onclick="window.open(\'http://tools.google.com/dlpage/widevine\');">Get Video Optimizer</button>' +
                                '</span>' +
                                '</div>'
							);
							dialog.centerOn(window);
							dialog.show();
						} else {
							attempts++;
							if (attempts < 100) {
								window.setTimeout(showDialog, 100);
							}
						}
					}

					window.setTimeout(showDialog, 1000);

				}

				if ( debug ) {
					AddDiv( DebugInfo() );
				}

			// }
			// catch(e) {
				// alert("widevine.init exception: " + e.message);
			// }
		}
	};
}());

function WVGetURL( arg ) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		transformedUrl = aWidevinePlugin.Translate( arg );
	}
	catch (err) {
		return "Error calling Translate: " + err.description;
	}
	return transformedUrl;
}

function WVGetCommURL () {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.GetCommandChannelBaseUrl();
	} catch (err) {
		//alert("Error calling GetCommandChannelBaseUrl: " + err.description);
	}
	return "http://localhost:20001/cgi-bin/";
}

function WVSetPlayScale( arg ) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.SetPlayScale( arg );
	}
	catch (err) {
		alert ("Error calling SetPlayScale: " + err.description);
	}
	return 0;
}

function WVGetMediaTime( arg ) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.GetMediaTime( arg );
	} catch (err) {
		alert("Error calling GetMediaTime: " + err.description);
	}
	return 0;
}

function WVGetClientId() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getClientId();
	}
	catch (err) {
		alert ("Error calling GetClientId: " + err.description);
	}
	return 0;
}


function WVSetDeviceId(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setDeviceId(arg);
	}
	catch (err) {
		alert ("Error calling SetDeviceId: " + err.description);
	}
	return 0;
}

function WVSetStreamId(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setStreamId(arg);
	}
	catch (err) {
		alert ("Error calling SetStreamId: " + err.description);
	}
	return 0;
}

function WVSetClientIp(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setClientIp(arg);
	}
	catch (err) {
		alert ("Error calling SetClientIp: " + err.description);
	}
	return 0;
}

function WVSetEmmURL(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setEmmUrl(arg);
	}
	catch (err) {
		alert ("Error calling SetEmmURL: " + err.description);
	}
	return 0;
}


function WVSetEmmAckURL(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setEmmAckUrl(arg);
	}
	catch (err) {
		alert ("Error calling SetEmmAckUrl: " + err.description);
	}
	return 0;
}

function WVSetHeartbeatUrl(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setHeartbeatUrl(arg);
	}
	catch (err) {
		alert ("Error calling SetHeartbeatUrl: " + err.description);
	}
	return 0;
}


function WVSetHeartbeatPeriod(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setHeartbeatPeriod(arg);
	}
	catch (err) {
		alert ("Error calling SetHeartbeatPeriod: " + err.description);
	}
	return 0;
}



function WVSetOptData(arg) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.setOptData(arg);
	}
	catch (err) {
		alert ("Error calling SetOptData: " + err.description);
	}
	return 0;
}

function WVGetDeviceId() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getDeviceId();
	}
	catch (err) {
		alert ("Error calling GetDeviceId: " + err.description);
	}
	return 0;
}

function WVGetStreamId() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getStreamId();
	}
	catch (err) {
		alert ("Error calling GetStreamId: " + err.description);
	}
	return 0;
}

function WVGetClientIp() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getClientIp();
	}
	catch (err) {
		alert ("Error calling GetClientIp: " + err.description);
	}
	return 0;
}


function WVGetEmmURL() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getEmmUrl();
	}
	catch (err) {
		alert ("Error calling GetEmmURL: " + err.description);
	}
	return "";
}


function WVGetEmmAckURL() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getEmmAckUrl();
	}
	catch (err) {
		alert ("Error calling GetEmmAckUrl: " + err.description);
	}
	return "";
}

function WVGetHeartbeatUrl() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getHeartbeatUrl();
	}
	catch (err) {
		alert ("Error calling GetHeartbeatUrl: " + err.description);
	}
	return "";
}



function WVGetHeartbeatPeriod() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getHeartbeatPeriod();
	}
	catch (err) {
		alert ("Error calling GetHeartbeatPeriod: " + err.description);
	}
	return "";
}


function WVGetOptData() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.getOptData();
	}
	catch (err) {
		alert ("Error calling GetOptData: " + err.description);
	}
	return "";
}


function WVAlert( arg ) {
	alert(arg);
	return 0;
}


function WVPDLNew(mediaPath, pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		pdl_new =  aWidevinePlugin.PDL_New(mediaPath, pdlPath);
		return pdl_new;
	}
	catch (err) {
		//alert ("Error calling PDL_New: " + err.description);
	}
	return "";
}

function WVPDLStart(pdlPath, trackNumber, trickPlay) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_Start(pdlPath, trackNumber, trickPlay);
	}
	catch (err) {
		//alert ("Error calling PDL_Start: " + err.description);
	}
	return "";
}

function WVPDLResume(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_Resume(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_Resume: " + err.description);
	}
	return "";
}


function WVPDLStop(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_Stop(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_Stop: " + err.description);
	}
	return "";
}

function WVPDLCancel(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_Cancel(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_Stop: " + err.description);
	}
	return "";
}

function WVPDLGetProgress(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_GetProgress(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_GetProgress: " + err.description);
	}
	return "";
}


function WVPDLGetTotalSize(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_GetTotalSize(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_GetTotalSize: " + err.description);
	}
	return "";
}

function WVPDLFinalize(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_Finalize(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_Finalize: " + err.description);
	}
	return "";
}

function WVPDLCheckHasTrickPlay(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_CheckHasTrickPlay(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_CheckHasTrickPlay: " + err.description);
	}
	return "";
}

function WVPDLGetTrackBitrate(pdlPath, trackNumber) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_GetTrackBitrate(pdlPath, trackNumber);
	}
	catch (err) {
		//alert ("Error calling PDL_GetTrackBitrate: " + err.description);
	}
	return "";
}

function WVPDLGetTrackCount(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_GetTrackCount(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_GetTrackCount: " + err.description);
	}
	return "";
}

function WVPDLGetDownloadMap(pdlPath) {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.PDL_GetDownloadMap(pdlPath);
	}
	catch (err) {
		//alert ("Error calling PDL_GetDownloadMap: " + err.description);
	}
	return "";
}

function WVGetLastError() {
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.GetLastError();
	}
	catch (err) {
		//alert ("Error calling GetLastError: " + err.description);
	}
	return "";
}

function WVRegisterAsset(assetPath, requestLicense){
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.RegisterAsset(assetPath, requestLicense);
	}
	catch (err) {
		//alert ("Error calling RegisterAsset: " + err.description);
	}
	return "";

}


function WVQueryAsset(assetPath){
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.QueryAsset(assetPath);
	}
	catch (err) {
		//alert ("Error calling QueryAsset: " + err.description);
	}
	return "";

}

function WVQueryAllAssets(){
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.QueryAllAssets();
	}
	catch (err) {
		//alert ("Error calling QueryAllAssets: " + err.description);
	}
	return "";

}



function WVUnregisterAsset(assetPath){
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.UnregisterAsset(assetPath);
	}
	catch (err) {
		//alert ("Error calling UnregisterAsset: " + err.description);
	}
	return "";

}

function WVUpdateLicense(assetPath){
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		return aWidevinePlugin.UpdateLicense(assetPath);
	}
	catch (err) {
		//alert ("Error calling UpdateAssetLicense: " + err.description);
	}
	return "";

}

function WVGetQueryLicenseValue(assetPath, key){
	var licenseInfo = eval('(' + WVQueryAsset(assetPath) + ')');
	licenseInfo = eval("licenseInfo." + key);
	return licenseInfo;
}


function WVCancelAllDownloads(){
	var aWidevinePlugin = document.getElementById('WidevinePlugin');
	try {
		if (aWidevinePlugin){
			var downloading_list = eval(aWidevinePlugin.PDL_QueryDownloadNames());
			for(var i = 0; i < downloading_list.length; i++){
				WVPDLCancel(downloading_list[i]);
			}
		}
	}
	catch (err) {
		//alert ("Error calling QueryAllAssets: " + err.description);
	}
	return "";
}

// name: sammy
// version: 0.7.5

// Sammy.js / http://sammyjs.org

(function(factory){
  // Support module loading scenarios
  if (typeof define === 'function' && define.amd){
    // AMD Anonymous Module
    define(['jquery'], factory);
  } else {
    // No module loader (plain <script> tag) - put directly in global namespace
    jQuery.sammy = window.Sammy = factory(jQuery);
  }
})(function($){

  var Sammy,
      PATH_REPLACER = "([^\/]+)",
      PATH_NAME_MATCHER = /:([\w\d]+)/g,
      QUERY_STRING_MATCHER = /\?([^#]*)?$/,
      // mainly for making `arguments` an Array
      _makeArray = function(nonarray) { return Array.prototype.slice.call(nonarray); },
      // borrowed from jQuery
      _isFunction = function( obj ) { return Object.prototype.toString.call(obj) === "[object Function]"; },
      _isArray = function( obj ) { return Object.prototype.toString.call(obj) === "[object Array]"; },
      _isRegExp = function( obj ) { return Object.prototype.toString.call(obj) === "[object RegExp]"; },
      _decode = function( str ) { return decodeURIComponent((str || '').replace(/\+/g, ' ')); },
      _encode = encodeURIComponent,
      _escapeHTML = function(s) {
        return String(s).replace(/&(?!\w+;)/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
      },
      _routeWrapper = function(verb) {
        return function() {
          return this.route.apply(this, [verb].concat(Array.prototype.slice.call(arguments)));
        };
      },
      _template_cache = {},
      _has_history = !!(window.history && history.pushState),
      loggers = [];


  // `Sammy` (also aliased as $.sammy) is not only the namespace for a
  // number of prototypes, its also a top level method that allows for easy
  // creation/management of `Sammy.Application` instances. There are a
  // number of different forms for `Sammy()` but each returns an instance
  // of `Sammy.Application`. When a new instance is created using
  // `Sammy` it is added to an Object called `Sammy.apps`. This
  // provides for an easy way to get at existing Sammy applications. Only one
  // instance is allowed per `element_selector` so when calling
  // `Sammy('selector')` multiple times, the first time will create
  // the application and the following times will extend the application
  // already added to that selector.
  //
  // ### Example
  //
  //      // returns the app at #main or a new app
  //      Sammy('#main')
  //
  //      // equivalent to "new Sammy.Application", except appends to apps
  //      Sammy();
  //      Sammy(function() { ... });
  //
  //      // extends the app at '#main' with function.
  //      Sammy('#main', function() { ... });
  //
  Sammy = function() {
    var args = _makeArray(arguments),
        app, selector;
    Sammy.apps = Sammy.apps || {};
    if (args.length === 0 || args[0] && _isFunction(args[0])) { // Sammy()
      return Sammy.apply(Sammy, ['body'].concat(args));
    } else if (typeof (selector = args.shift()) == 'string') { // Sammy('#main')
      app = Sammy.apps[selector] || new Sammy.Application();
      app.element_selector = selector;
      if (args.length > 0) {
        $.each(args, function(i, plugin) {
          app.use(plugin);
        });
      }
      // if the selector changes make sure the reference in Sammy.apps changes
      if (app.element_selector != selector) {
        delete Sammy.apps[selector];
      }
      Sammy.apps[app.element_selector] = app;
      return app;
    }
  };

  Sammy.VERSION = '0.7.5';

  // Add to the global logger pool. Takes a function that accepts an
  // unknown number of arguments and should print them or send them somewhere
  // The first argument is always a timestamp.
  Sammy.addLogger = function(logger) {
    loggers.push(logger);
  };

  // Sends a log message to each logger listed in the global
  // loggers pool. Can take any number of arguments.
  // Also prefixes the arguments with a timestamp.
  Sammy.log = function()  {
    var args = _makeArray(arguments);
    args.unshift("[" + Date() + "]");
    $.each(loggers, function(i, logger) {
      logger.apply(Sammy, args);
    });
  };

  if (typeof window.console != 'undefined') {
    if (typeof window.console.log === 'function' && _isFunction(window.console.log.apply)) {
      Sammy.addLogger(function() {
        window.console.log.apply(window.console, arguments);
      });
    } else {
      Sammy.addLogger(function() {
        window.console.log(arguments);
      });
    }
  } else if (typeof console != 'undefined') {
    Sammy.addLogger(function() {
      console.log.apply(console, arguments);
    });
  }

  $.extend(Sammy, {
    makeArray: _makeArray,
    isFunction: _isFunction,
    isArray: _isArray
  });

  // Sammy.Object is the base for all other Sammy classes. It provides some useful
  // functionality, including cloning, iterating, etc.
  Sammy.Object = function(obj) { // constructor
    return $.extend(this, obj || {});
  };

  $.extend(Sammy.Object.prototype, {

    // Escape HTML in string, use in templates to prevent script injection.
    // Also aliased as `h()`
    escapeHTML: _escapeHTML,
    h: _escapeHTML,

    // Returns a copy of the object with Functions removed.
    toHash: function() {
      var json = {};
      $.each(this, function(k,v) {
        if (!_isFunction(v)) {
          json[k] = v;
        }
      });
      return json;
    },

    // Renders a simple HTML version of this Objects attributes.
    // Does not render functions.
    // For example. Given this Sammy.Object:
    //
    //     var s = new Sammy.Object({first_name: 'Sammy', last_name: 'Davis Jr.'});
    //     s.toHTML()
    //     //=> '<strong>first_name</strong> Sammy<br /><strong>last_name</strong> Davis Jr.<br />'
    //
    toHTML: function() {
      var display = "";
      $.each(this, function(k, v) {
        if (!_isFunction(v)) {
          display += "<strong>" + k + "</strong> " + v + "<br />";
        }
      });
      return display;
    },

    // Returns an array of keys for this object. If `attributes_only`
    // is true will not return keys that map to a `function()`
    keys: function(attributes_only) {
      var keys = [];
      for (var property in this) {
        if (!_isFunction(this[property]) || !attributes_only) {
          keys.push(property);
        }
      }
      return keys;
    },

    // Checks if the object has a value at `key` and that the value is not empty
    has: function(key) {
      return this[key] && $.trim(this[key].toString()) !== '';
    },

    // convenience method to join as many arguments as you want
    // by the first argument - useful for making paths
    join: function() {
      var args = _makeArray(arguments);
      var delimiter = args.shift();
      return args.join(delimiter);
    },

    // Shortcut to Sammy.log
    log: function() {
      Sammy.log.apply(Sammy, arguments);
    },

    // Returns a string representation of this object.
    // if `include_functions` is true, it will also toString() the
    // methods of this object. By default only prints the attributes.
    toString: function(include_functions) {
      var s = [];
      $.each(this, function(k, v) {
        if (!_isFunction(v) || include_functions) {
          s.push('"' + k + '": ' + v.toString());
        }
      });
      return "Sammy.Object: {" + s.join(',') + "}";
    }
  });


  // Return whether the event targets this window.
  Sammy.targetIsThisWindow = function targetIsThisWindow(event, tagName) {
    var targetElement = $(event.target).closest(tagName);
    if (targetElement.length === 0) { return true; }

    var targetWindow = targetElement.attr('target');
    if (!targetWindow || targetWindow === window.name || targetWindow === '_self') { return true; }
    if (targetWindow === '_blank') { return false; }
    if (targetWindow === 'top' && window === window.top) { return true; }
    return false;
  };


  // The DefaultLocationProxy is the default location proxy for all Sammy applications.
  // A location proxy is a prototype that conforms to a simple interface. The purpose
  // of a location proxy is to notify the Sammy.Application its bound to when the location
  // or 'external state' changes.
  //
  // The `DefaultLocationProxy` watches for changes to the path of the current window and
  // is also able to set the path based on changes in the application. It does this by
  // using different methods depending on what is available in the current browser. In
  // the latest and greatest browsers it used the HTML5 History API and the `pushState`
  // `popState` events/methods. This allows you to use Sammy to serve a site behind normal
  // URI paths as opposed to the older default of hash (#) based routing. Because the server
  // can interpret the changed path on a refresh or re-entry, though, it requires additional
  // support on the server side. If you'd like to force disable HTML5 history support, please
  // use the `disable_push_state` setting on `Sammy.Application`. If pushState support
  // is enabled, `DefaultLocationProxy` also binds to all links on the page. If a link is clicked
  // that matches the current set of routes, the URL is changed using pushState instead of
  // fully setting the location and the app is notified of the change.
  //
  // If the browser does not have support for HTML5 History, `DefaultLocationProxy` automatically
  // falls back to the older hash based routing. The newest browsers (IE, Safari > 4, FF >= 3.6)
  // support a 'onhashchange' DOM event, thats fired whenever the location.hash changes.
  // In this situation the DefaultLocationProxy just binds to this event and delegates it to
  // the application. In the case of older browsers a poller is set up to track changes to the
  // hash.
  Sammy.DefaultLocationProxy = function(app, run_interval_every) {
    this.app = app;
    // set is native to false and start the poller immediately
    this.is_native = false;
    this.has_history = _has_history;
    this._startPolling(run_interval_every);
  };

  Sammy.DefaultLocationProxy.fullPath = function(location_obj) {
   // Bypass the `window.location.hash` attribute.  If a question mark
    // appears in the hash IE6 will strip it and all of the following
    // characters from `window.location.hash`.
    var matches = location_obj.toString().match(/^[^#]*(#.+)$/);
    var hash = matches ? matches[1] : '';
    return [location_obj.pathname, location_obj.search, hash].join('');
  };
$.extend(Sammy.DefaultLocationProxy.prototype , {
    // bind the proxy events to the current app.
    bind: function() {
      var proxy = this, app = this.app, lp = Sammy.DefaultLocationProxy;
      $(window).bind('hashchange.' + this.app.eventNamespace(), function(e, non_native) {
        // if we receive a native hash change event, set the proxy accordingly
        // and stop polling
        if (proxy.is_native === false && !non_native) {
          proxy.is_native = true;
          window.clearInterval(lp._interval);
          lp._interval = null;
        }
        app.trigger('location-changed');
      });
      if (_has_history && !app.disable_push_state) {
        // bind to popstate
        $(window).bind('popstate.' + this.app.eventNamespace(), function(e) {
          app.trigger('location-changed');
        });
        // bind to link clicks that have routes
        $(document).delegate('a', 'click.history-' + this.app.eventNamespace(), function (e) {
          if (e.isDefaultPrevented() || e.metaKey || e.ctrlKey) {
            return;
          }
          var full_path = lp.fullPath(this),
            // Get anchor's host name in a cross browser compatible way.
            // IE looses hostname property when setting href in JS
            // with a relative URL, e.g. a.setAttribute('href',"/whatever").
            // Circumvent this problem by creating a new link with given URL and
            // querying that for a hostname.
            hostname = this.hostname ? this.hostname : function (a) {
              var l = document.createElement("a");
              l.href = a.href;
              return l.hostname;
            }(this);

          if (hostname == window.location.hostname &&
              app.lookupRoute('get', full_path) &&
              Sammy.targetIsThisWindow(e, 'a')) {
            e.preventDefault();
            proxy.setLocation(full_path);
            return false;
          }
        });
      }
      if (!lp._bindings) {
        lp._bindings = 0;
      }
      lp._bindings++;
    },

    // unbind the proxy events from the current app
    unbind: function() {
      $(window).unbind('hashchange.' + this.app.eventNamespace());
      $(window).unbind('popstate.' + this.app.eventNamespace());
      $(document).undelegate('a', 'click.history-' + this.app.eventNamespace());
      Sammy.DefaultLocationProxy._bindings--;
      if (Sammy.DefaultLocationProxy._bindings <= 0) {
        window.clearInterval(Sammy.DefaultLocationProxy._interval);
        Sammy.DefaultLocationProxy._interval = null;
      }
    },

    // get the current location from the hash.
    getLocation: function() {
      return Sammy.DefaultLocationProxy.fullPath(window.location);
    },

    // set the current location to `new_location`
    setLocation: function(new_location) {
      if (/^([^#\/]|$)/.test(new_location)) { // non-prefixed url
        if (_has_history && !this.app.disable_push_state) {
          new_location = '/' + new_location;
        } else {
          new_location = '#!/' + new_location;
        }
      }
      if (new_location != this.getLocation()) {
        // HTML5 History exists and new_location is a full path
        if (_has_history && !this.app.disable_push_state && /^\//.test(new_location)) {
          history.pushState({ path: new_location }, window.title, new_location);
          this.app.trigger('location-changed');
        } else {
          return (window.location = new_location);
        }
      }
    },

    _startPolling: function(every) {
      // set up interval
      var proxy = this;
      if (!Sammy.DefaultLocationProxy._interval) {
        if (!every) { every = 10; }
        var hashCheck = function() {
          var current_location = proxy.getLocation();
          if (typeof Sammy.DefaultLocationProxy._last_location == 'undefined' ||
            current_location != Sammy.DefaultLocationProxy._last_location) {
            window.setTimeout(function() {
              $(window).trigger('hashchange', [true]);
            }, 0);
          }
          Sammy.DefaultLocationProxy._last_location = current_location;
        };
        hashCheck();
        Sammy.DefaultLocationProxy._interval = window.setInterval(hashCheck, every);
      }
    }
  });


  // Sammy.Application is the Base prototype for defining 'applications'.
  // An 'application' is a collection of 'routes' and bound events that is
  // attached to an element when `run()` is called.
  // The only argument an 'app_function' is evaluated within the context of the application.
  Sammy.Application = function(app_function) {
    var app = this;
    this.routes            = {};
    this.listeners         = new Sammy.Object({});
    this.arounds           = [];
    this.befores           = [];
    // generate a unique namespace
    this.namespace         = (new Date()).getTime() + '-' + parseInt(Math.random() * 1000, 10);
    this.context_prototype = function() { Sammy.EventContext.apply(this, arguments); };
    this.context_prototype.prototype = new Sammy.EventContext();

    if (_isFunction(app_function)) {
      app_function.apply(this, [this]);
    }
    // set the location proxy if not defined to the default (DefaultLocationProxy)
    if (!this._location_proxy) {
      this.setLocationProxy(new Sammy.DefaultLocationProxy(this, this.run_interval_every));
    }
    if (this.debug) {
      this.bindToAllEvents(function(e, data) {
        app.log(app.toString(), e.cleaned_type, data || {});
      });
    }
  };

  Sammy.Application.prototype = $.extend({}, Sammy.Object.prototype, {

    // the four route verbs
    ROUTE_VERBS: ['get','post','put','delete'],

    // An array of the default events triggered by the
    // application during its lifecycle
    APP_EVENTS: ['run', 'unload', 'lookup-route', 'run-route', 'route-found', 'event-context-before', 'event-context-after', 'changed', 'error', 'check-form-submission', 'redirect', 'location-changed'],

    _last_route: null,
    _location_proxy: null,
    _running: false,

    // Defines what element the application is bound to. Provide a selector
    // (parseable by `jQuery()`) and this will be used by `$element()`
    element_selector: 'body',

    // When set to true, logs all of the default events using `log()`
    debug: false,

    // When set to true, and the error() handler is not overridden, will actually
    // raise JS errors in routes (500) and when routes can't be found (404)
    raise_errors: false,

    // The time in milliseconds that the URL is queried for changes
    run_interval_every: 50,

    // if using the `DefaultLocationProxy` setting this to true will force the app to use
    // traditional hash based routing as opposed to the new HTML5 PushState support
    disable_push_state: false,

    // The default template engine to use when using `partial()` in an
    // `EventContext`. `template_engine` can either be a string that
    // corresponds to the name of a method/helper on EventContext or it can be a function
    // that takes two arguments, the content of the unrendered partial and an optional
    // JS object that contains interpolation data. Template engine is only called/referred
    // to if the extension of the partial is null or unknown. See `partial()`
    // for more information
    template_engine: null,

    // //=> Sammy.Application: body
    toString: function() {
      return 'Sammy.Application:' + this.element_selector;
    },

    // returns a jQuery object of the Applications bound element.
    $element: function(selector) {
      return selector ? $(this.element_selector).find(selector) : $(this.element_selector);
    },

    // `use()` is the entry point for including Sammy plugins.
    // The first argument to use should be a function() that is evaluated
    // in the context of the current application, just like the `app_function`
    // argument to the `Sammy.Application` constructor.
    //
    // Any additional arguments are passed to the app function sequentially.
    //
    // For much more detail about plugins, check out:
    // [http://sammyjs.org/docs/plugins](http://sammyjs.org/docs/plugins)
    //
    // ### Example
    //
    //      var MyPlugin = function(app, prepend) {
    //
    //        this.helpers({
    //          myhelper: function(text) {
    //            alert(prepend + " " + text);
    //          }
    //        });
    //
    //      };
    //
    //      var app = $.sammy(function() {
    //
    //        this.use(MyPlugin, 'This is my plugin');
    //
    //        this.get('#/', function() {
    //          this.myhelper('and dont you forget it!');
    //          //=> Alerts: This is my plugin and dont you forget it!
    //        });
    //
    //      });
    //
    // If plugin is passed as a string it assumes your are trying to load
    // Sammy."Plugin". This is the preferred way of loading core Sammy plugins
    // as it allows for better error-messaging.
    //
    // ### Example
    //
    //      $.sammy(function() {
    //        this.use('Mustache'); //=> Sammy.Mustache
    //        this.use('Storage'); //=> Sammy.Storage
    //      });
    //
    use: function() {
      // flatten the arguments
      var args = _makeArray(arguments),
          plugin = args.shift(),
          plugin_name = plugin || '';
      try {
        args.unshift(this);
        if (typeof plugin == 'string') {
          plugin_name = 'Sammy.' + plugin;
          plugin = Sammy[plugin];
        }
        plugin.apply(this, args);
      } catch(e) {
        if (typeof plugin === 'undefined') {
          this.error("Plugin Error: called use() but plugin (" + plugin_name.toString() + ") is not defined", e);
        } else if (!_isFunction(plugin)) {
          this.error("Plugin Error: called use() but '" + plugin_name.toString() + "' is not a function", e);
        } else {
          this.error("Plugin Error", e);
        }
      }
      return this;
    },

    // Sets the location proxy for the current app. By default this is set to
    // a new `Sammy.DefaultLocationProxy` on initialization. However, you can set
    // the location_proxy inside you're app function to give your app a custom
    // location mechanism. See `Sammy.DefaultLocationProxy` and `Sammy.DataLocationProxy`
    // for examples.
    //
    // `setLocationProxy()` takes an initialized location proxy.
    //
    // ### Example
    //
    //        // to bind to data instead of the default hash;
    //        var app = $.sammy(function() {
    //          this.setLocationProxy(new Sammy.DataLocationProxy(this));
    //        });
    //
    setLocationProxy: function(new_proxy) {
      var original_proxy = this._location_proxy;
      this._location_proxy = new_proxy;
      if (this.isRunning()) {
        if (original_proxy) {
          // if there is already a location proxy, unbind it.
          original_proxy.unbind();
        }
        this._location_proxy.bind();
      }
    },

    // provide log() override for inside an app that includes the relevant application element_selector
    log: function() {
      Sammy.log.apply(Sammy, Array.prototype.concat.apply([this.element_selector],arguments));
    },


    // `route()` is the main method for defining routes within an application.
    // For great detail on routes, check out:
    // [http://sammyjs.org/docs/routes](http://sammyjs.org/docs/routes)
    //
    // This method also has aliases for each of the different verbs (eg. `get()`, `post()`, etc.)
    //
    // ### Arguments
    //
    // * `verb` A String in the set of ROUTE_VERBS or 'any'. 'any' will add routes for each
    //    of the ROUTE_VERBS. If only two arguments are passed,
    //    the first argument is the path, the second is the callback and the verb
    //    is assumed to be 'any'.
    // * `path` A Regexp or a String representing the path to match to invoke this verb.
    // * `callback` A Function that is called/evaluated when the route is run see: `runRoute()`.
    //    It is also possible to pass a string as the callback, which is looked up as the name
    //    of a method on the application.
    //
    route: function(verb, path) {
      var app = this, param_names = [], add_route, path_match, callback = Array.prototype.slice.call(arguments,2);

      // if the method signature is just (path, callback)
      // assume the verb is 'any'
      if (callback.length === 0 && _isFunction(path)) {
        callback = [path];
        path = verb;
        verb = 'any';
      }

      verb = verb.toLowerCase(); // ensure verb is lower case

      // if path is a string turn it into a regex
      if (path.constructor == String) {

        // Needs to be explicitly set because IE will maintain the index unless NULL is returned,
        // which means that with two consecutive routes that contain params, the second set of params will not be found and end up in splat instead of params
        // https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/RegExp/lastIndex
        PATH_NAME_MATCHER.lastIndex = 0;

        // find the names
        while ((path_match = PATH_NAME_MATCHER.exec(path)) !== null) {
          param_names.push(path_match[1]);
        }
        // replace with the path replacement
        path = new RegExp(path.replace(PATH_NAME_MATCHER, PATH_REPLACER) + "$");
      }
      // lookup callbacks
      $.each(callback,function(i,cb){
        if (typeof(cb) === 'string') {
          callback[i] = app[cb];
        }
      });

      add_route = function(with_verb) {
        var r = {verb: with_verb, path: path, callback: callback, param_names: param_names};
        // add route to routes array
        app.routes[with_verb] = app.routes[with_verb] || [];
        // place routes in order of definition
        app.routes[with_verb].push(r);
      };

      if (verb === 'any') {
        $.each(this.ROUTE_VERBS, function(i, v) { add_route(v); });
      } else {
        add_route(verb);
      }

      // return the app
      return this;
    },

    // Alias for route('get', ...)
    get: _routeWrapper('get'),

    // Alias for route('post', ...)
    post: _routeWrapper('post'),

    // Alias for route('put', ...)
    put: _routeWrapper('put'),

    // Alias for route('delete', ...)
    del: _routeWrapper('delete'),

    // Alias for route('any', ...)
    any: _routeWrapper('any'),

    // `mapRoutes` takes an array of arrays, each array being passed to route()
    // as arguments, this allows for mass definition of routes. Another benefit is
    // this makes it possible/easier to load routes via remote JSON.
    //
    // ### Example
    //
    //      var app = $.sammy(function() {
    //
    //        this.mapRoutes([
    //            ['get', '#/', function() { this.log('index'); }],
    //            // strings in callbacks are looked up as methods on the app
    //            ['post', '#/create', 'addUser'],
    //            // No verb assumes 'any' as the verb
    //            [/dowhatever/, function() { this.log(this.verb, this.path)}];
    //          ]);
    //      });
    //
    mapRoutes: function(route_array) {
      var app = this;
      $.each(route_array, function(i, route_args) {
        app.route.apply(app, route_args);
      });
      return this;
    },

    // A unique event namespace defined per application.
    // All events bound with `bind()` are automatically bound within this space.
    eventNamespace: function() {
      return ['sammy-app', this.namespace].join('-');
    },

    // Works just like `jQuery.fn.bind()` with a couple notable differences.
    //
    // * It binds all events to the application element
    // * All events are bound within the `eventNamespace()`
    // * Events are not actually bound until the application is started with `run()`
    // * callbacks are evaluated within the context of a Sammy.EventContext
    //
    bind: function(name, data, callback) {
      var app = this;
      // build the callback
      // if the arity is 2, callback is the second argument
      if (typeof callback == 'undefined') { callback = data; }
      var listener_callback =  function() {
        // pull off the context from the arguments to the callback
        var e, context, data;
        e       = arguments[0];
        data    = arguments[1];
        if (data && data.context) {
          context = data.context;
          delete data.context;
        } else {
          context = new app.context_prototype(app, 'bind', e.type, data, e.target);
        }
        e.cleaned_type = e.type.replace(app.eventNamespace(), '');
        callback.apply(context, [e, data]);
      };

      // it could be that the app element doesnt exist yet
      // so attach to the listeners array and then run()
      // will actually bind the event.
      if (!this.listeners[name]) { this.listeners[name] = []; }
      this.listeners[name].push(listener_callback);
      if (this.isRunning()) {
        // if the app is running
        // *actually* bind the event to the app element
        this._listen(name, listener_callback);
      }
      return this;
    },

    // Triggers custom events defined with `bind()`
    //
    // ### Arguments
    //
    // * `name` The name of the event. Automatically prefixed with the `eventNamespace()`
    // * `data` An optional Object that can be passed to the bound callback.
    // * `context` An optional context/Object in which to execute the bound callback.
    //   If no context is supplied a the context is a new `Sammy.EventContext`
    //
    trigger: function(name, data) {
      this.$element().trigger([name, this.eventNamespace()].join('.'), [data]);
      return this;
    },

    // Reruns the current route
    refresh: function() {
      this.last_location = null;
      this.trigger('location-changed');
      return this;
    },

    // Takes a single callback that is pushed on to a stack.
    // Before any route is run, the callbacks are evaluated in order within
    // the current `Sammy.EventContext`
    //
    // If any of the callbacks explicitly return false, execution of any
    // further callbacks and the route itself is halted.
    //
    // You can also provide a set of options that will define when to run this
    // before based on the route it proceeds.
    //
    // ### Example
    //
    //      var app = $.sammy(function() {
    //
    //        // will run at #/route but not at #/
    //        this.before('#/route', function() {
    //          //...
    //        });
    //
    //        // will run at #/ but not at #/route
    //        this.before({except: {path: '#/route'}}, function() {
    //          this.log('not before #/route');
    //        });
    //
    //        this.get('#/', function() {});
    //
    //        this.get('#/route', function() {});
    //
    //      });
    //
    // See `contextMatchesOptions()` for a full list of supported options
    //
    before: function(options, callback) {
      if (_isFunction(options)) {
        callback = options;
        options = {};
      }
      this.befores.push([options, callback]);
      return this;
    },

    // A shortcut for binding a callback to be run after a route is executed.
    // After callbacks have no guarunteed order.
    after: function(callback) {
      return this.bind('event-context-after', callback);
    },


    // Adds an around filter to the application. around filters are functions
    // that take a single argument `callback` which is the entire route
    // execution path wrapped up in a closure. This means you can decide whether
    // or not to proceed with execution by not invoking `callback` or,
    // more usefully wrapping callback inside the result of an asynchronous execution.
    //
    // ### Example
    //
    // The most common use case for around() is calling a _possibly_ async function
    // and executing the route within the functions callback:
    //
    //      var app = $.sammy(function() {
    //
    //        var current_user = false;
    //
    //        function checkLoggedIn(callback) {
    //          // /session returns a JSON representation of the logged in user
    //          // or an empty object
    //          if (!current_user) {
    //            $.getJSON('/session', function(json) {
    //              if (json.login) {
    //                // show the user as logged in
    //                current_user = json;
    //                // execute the route path
    //                callback();
    //              } else {
    //                // show the user as not logged in
    //                current_user = false;
    //                // the context of aroundFilters is an EventContext
    //                this.redirect('#/login');
    //              }
    //            });
    //          } else {
    //            // execute the route path
    //            callback();
    //          }
    //        };
    //
    //        this.around(checkLoggedIn);
    //
    //      });
    //
    around: function(callback) {
      this.arounds.push(callback);
      return this;
    },

    // Adds a onComplete function to the application. onComplete functions are executed
    // at the end of a chain of route callbacks, if they call next(). Unlike after,
    // which is called as soon as the route is complete, onComplete is like a final next()
    // for all routes, and is thus run asynchronously
    //
    // ### Example
    //
    //      app.get('/chain',function(context,next) {
    //          console.log('chain1');
    //          next();
    //      },function(context,next) {
    //          console.log('chain2');
    //          next();
    //      });
    //
    //      app.get('/link',function(context,next) {
    //          console.log('link1');
    //          next();
    //      },function(context,next) {
    //          console.log('link2');
    //          next();
    //      });
    //
    //      app.onComplete(function() {
    //          console.log("Running finally");
    //      });
    //
    // If you go to '/chain', you will get the following messages:
    //
    //      chain1
    //      chain2
    //      Running onComplete
    //
    //
    // If you go to /link, you will get the following messages:
    //
    //      link1
    //      link2
    //      Running onComplete
    //
    //
    // It really comes to play when doing asynchronous:
    //
    //      app.get('/chain',function(context,next) {
    //        $.get('/my/url',function() {
    //          console.log('chain1');
    //          next();
    //        });
    //      },function(context,next) {
    //        console.log('chain2');
    //        next();
    //      });
    //
    onComplete: function(callback) {
      this._onComplete = callback;
      return this;
    },

    // Returns `true` if the current application is running.
    isRunning: function() {
      return this._running;
    },

    // Helpers extends the EventContext prototype specific to this app.
    // This allows you to define app specific helper functions that can be used
    // whenever you're inside of an event context (templates, routes, bind).
    //
    // ### Example
    //
    //     var app = $.sammy(function() {
    //
    //       helpers({
    //         upcase: function(text) {
    //          return text.toString().toUpperCase();
    //         }
    //       });
    //
    //       get('#/', function() { with(this) {
    //         // inside of this context I can use the helpers
    //         $('#main').html(upcase($('#main').text());
    //       }});
    //
    //     });
    //
    //
    // ### Arguments
    //
    // * `extensions` An object collection of functions to extend the context.
    //
    helpers: function(extensions) {
      $.extend(this.context_prototype.prototype, extensions);
      return this;
    },

    // Helper extends the event context just like `helpers()` but does it
    // a single method at a time. This is especially useful for dynamically named
    // helpers
    //
    // ### Example
    //
    //     // Trivial example that adds 3 helper methods to the context dynamically
    //     var app = $.sammy(function(app) {
    //
    //       $.each([1,2,3], function(i, num) {
    //         app.helper('helper' + num, function() {
    //           this.log("I'm helper number " + num);
    //         });
    //       });
    //
    //       this.get('#/', function() {
    //         this.helper2(); //=> I'm helper number 2
    //       });
    //     });
    //
    // ### Arguments
    //
    // * `name` The name of the method
    // * `method` The function to be added to the prototype at `name`
    //
    helper: function(name, method) {
      this.context_prototype.prototype[name] = method;
      return this;
    },

    // Actually starts the application's lifecycle. `run()` should be invoked
    // within a document.ready block to ensure the DOM exists before binding events, etc.
    //
    // ### Example
    //
    //     var app = $.sammy(function() { ... }); // your application
    //     $(function() { // document.ready
    //        app.run();
    //     });
    //
    // ### Arguments
    //
    // * `start_url` Optionally, a String can be passed which the App will redirect to
    //   after the events/routes have been bound.
    run: function(start_url) {
      if (this.isRunning()) { return false; }
      var app = this;

      // actually bind all the listeners
      $.each(this.listeners.toHash(), function(name, callbacks) {
        $.each(callbacks, function(i, listener_callback) {
          app._listen(name, listener_callback);
        });
      });

      this.trigger('run', {start_url: start_url});
      this._running = true;
      // set last location
      this.last_location = null;
      if (!(/\#(.+)/.test(this.getLocation())) && typeof start_url != 'undefined') {
        this.setLocation(start_url);
      }
      // check url
      this._checkLocation();
      this._location_proxy.bind();
      this.bind('location-changed', function() {
        app._checkLocation();
      });

      // bind to submit to capture post/put/delete routes
      this.bind('submit', function(e) {
        if ( !Sammy.targetIsThisWindow(e, 'form') ) { return true; }
        var returned = app._checkFormSubmission($(e.target).closest('form'));
        return (returned === false) ? e.preventDefault() : false;
      });

      // bind unload to body unload
      $(window).bind('unload', function() {
        app.unload();
      });

      // trigger html changed
      return this.trigger('changed');
    },

    // The opposite of `run()`, un-binds all event listeners and intervals
    // `run()` Automatically binds a `onunload` event to run this when
    // the document is closed.
    unload: function() {
      if (!this.isRunning()) { return false; }
      var app = this;
      this.trigger('unload');
      // clear interval
      this._location_proxy.unbind();
      // unbind form submits
      this.$element().unbind('submit').removeClass(app.eventNamespace());
      // unbind all events
      $.each(this.listeners.toHash() , function(name, listeners) {
        $.each(listeners, function(i, listener_callback) {
          app._unlisten(name, listener_callback);
        });
      });
      this._running = false;
      return this;
    },

    // Not only runs `unbind` but also destroys the app reference.
    destroy: function() {
      this.unload();
      delete Sammy.apps[this.element_selector];
      return this;
    },

    // Will bind a single callback function to every event that is already
    // being listened to in the app. This includes all the `APP_EVENTS`
    // as well as any custom events defined with `bind()`.
    //
    // Used internally for debug logging.
    bindToAllEvents: function(callback) {
      var app = this;
      // bind to the APP_EVENTS first
      $.each(this.APP_EVENTS, function(i, e) {
        app.bind(e, callback);
      });
      // next, bind to listener names (only if they dont exist in APP_EVENTS)
      $.each(this.listeners.keys(true), function(i, name) {
        if ($.inArray(name, app.APP_EVENTS) == -1) {
          app.bind(name, callback);
        }
      });
      return this;
    },

    // Returns a copy of the given path with any query string after the hash
    // removed.
    routablePath: function(path) {
      return path.replace(QUERY_STRING_MATCHER, '');
    },

    // Given a verb and a String path, will return either a route object or false
    // if a matching route can be found within the current defined set.
    lookupRoute: function(verb, path) {
      var app = this, routed = false, i = 0, l, route;
      if (typeof this.routes[verb] != 'undefined') {
        l = this.routes[verb].length;
        for (; i < l; i++) {
          route = this.routes[verb][i];
          if (app.routablePath(path).match(route.path)) {
            routed = route;
            break;
          }
        }
      }
      return routed;
    },

    // First, invokes `lookupRoute()` and if a route is found, parses the
    // possible URL params and then invokes the route's callback within a new
    // `Sammy.EventContext`. If the route can not be found, it calls
    // `notFound()`. If `raise_errors` is set to `true` and
    // the `error()` has not been overridden, it will throw an actual JS
    // error.
    //
    // You probably will never have to call this directly.
    //
    // ### Arguments
    //
    // * `verb` A String for the verb.
    // * `path` A String path to lookup.
    // * `params` An Object of Params pulled from the URI or passed directly.
    //
    // ### Returns
    //
    // Either returns the value returned by the route callback or raises a 404 Not Found error.
    //
    runRoute: function(verb, path, params, target) {
      var app = this,
          route = this.lookupRoute(verb, path),
          context,
          wrapped_route,
          arounds,
          around,
          befores,
          before,
          callback_args,
          path_params,
          final_returned;

      if (this.debug) {
        this.log('runRoute', [verb, path].join(' '));
      }

      this.trigger('run-route', {verb: verb, path: path, params: params});
      if (typeof params == 'undefined') { params = {}; }

      $.extend(params, this._parseQueryString(path));

      if (route) {
        this.trigger('route-found', {route: route});
        // pull out the params from the path
        if ((path_params = route.path.exec(this.routablePath(path))) !== null) {
          // first match is the full path
          path_params.shift();
          // for each of the matches
          $.each(path_params, function(i, param) {
            // if theres a matching param name
            if (route.param_names[i]) {
              // set the name to the match
              params[route.param_names[i]] = _decode(param);
            } else {
              // initialize 'splat'
              if (!params.splat) { params.splat = []; }
              params.splat.push(_decode(param));
            }
          });
        }

        // set event context
        context  = new this.context_prototype(this, verb, path, params, target);
        // ensure arrays
        arounds = this.arounds.slice(0);
        befores = this.befores.slice(0);
        // set the callback args to the context + contents of the splat
        callback_args = [context];
        if (params.splat) {
          callback_args = callback_args.concat(params.splat);
        }
        // wrap the route up with the before filters
        wrapped_route = function() {
          var returned, i, nextRoute;
          while (befores.length > 0) {
            before = befores.shift();
            // check the options
            if (app.contextMatchesOptions(context, before[0])) {
              returned = before[1].apply(context, [context]);
              if (returned === false) { return false; }
            }
          }
          app.last_route = route;
          context.trigger('event-context-before', {context: context});
          // run multiple callbacks
          if (typeof(route.callback) === "function") {
            route.callback = [route.callback];
          }
          if (route.callback && route.callback.length) {
            i = -1;
            nextRoute = function() {
              i++;
              if (route.callback[i]) {
                returned = route.callback[i].apply(context,callback_args);
              } else if (app._onComplete && typeof(app._onComplete === "function")) {
                app._onComplete(context);
              }
            };
            callback_args.push(nextRoute);
            nextRoute();
          }
          context.trigger('event-context-after', {context: context});
          return returned;
        };
        $.each(arounds.reverse(), function(i, around) {
          var last_wrapped_route = wrapped_route;
          wrapped_route = function() { return around.apply(context, [last_wrapped_route]); };
        });
        try {
          final_returned = wrapped_route();
        } catch(e) {
          this.error(['500 Error', verb, path].join(' '), e);
        }
        return final_returned;
      } else {
        return this.notFound(verb, path);
      }
    },

    // Matches an object of options against an `EventContext` like object that
    // contains `path` and `verb` attributes. Internally Sammy uses this
    // for matching `before()` filters against specific options. You can set the
    // object to _only_ match certain paths or verbs, or match all paths or verbs _except_
    // those that match the options.
    //
    // ### Example
    //
    //     var app = $.sammy(),
    //         context = {verb: 'get', path: '#/mypath'};
    //
    //     // match against a path string
    //     app.contextMatchesOptions(context, '#/mypath'); //=> true
    //     app.contextMatchesOptions(context, '#/otherpath'); //=> false
    //     // equivalent to
    //     app.contextMatchesOptions(context, {only: {path:'#/mypath'}}); //=> true
    //     app.contextMatchesOptions(context, {only: {path:'#/otherpath'}}); //=> false
    //     // match against a path regexp
    //     app.contextMatchesOptions(context, /path/); //=> true
    //     app.contextMatchesOptions(context, /^path/); //=> false
    //     // match only a verb
    //     app.contextMatchesOptions(context, {only: {verb:'get'}}); //=> true
    //     app.contextMatchesOptions(context, {only: {verb:'post'}}); //=> false
    //     // match all except a verb
    //     app.contextMatchesOptions(context, {except: {verb:'post'}}); //=> true
    //     app.contextMatchesOptions(context, {except: {verb:'get'}}); //=> false
    //     // match all except a path
    //     app.contextMatchesOptions(context, {except: {path:'#/otherpath'}}); //=> true
    //     app.contextMatchesOptions(context, {except: {path:'#/mypath'}}); //=> false
    //     // match all except a verb and a path
    //     app.contextMatchesOptions(context, {except: {path:'#/otherpath', verb:'post'}}); //=> true
    //     app.contextMatchesOptions(context, {except: {path:'#/mypath', verb:'post'}}); //=> true
    //     app.contextMatchesOptions(context, {except: {path:'#/mypath', verb:'get'}}); //=> false
    //     // match multiple paths
    //     app.contextMatchesOptions(context, {path: ['#/mypath', '#/otherpath']}); //=> true
    //     app.contextMatchesOptions(context, {path: ['#/otherpath', '#/thirdpath']}); //=> false
    //     // equivalent to
    //     app.contextMatchesOptions(context, {only: {path: ['#/mypath', '#/otherpath']}}); //=> true
    //     app.contextMatchesOptions(context, {only: {path: ['#/otherpath', '#/thirdpath']}}); //=> false
    //     // match all except multiple paths
    //     app.contextMatchesOptions(context, {except: {path: ['#/mypath', '#/otherpath']}}); //=> false
    //     app.contextMatchesOptions(context, {except: {path: ['#/otherpath', '#/thirdpath']}}); //=> true
    //     // match all except multiple paths and verbs
    //     app.contextMatchesOptions(context, {except: {path: ['#/mypath', '#/otherpath'], verb: ['get', 'post']}}); //=> false
    //     app.contextMatchesOptions(context, {except: {path: ['#/otherpath', '#/thirdpath'], verb: ['get', 'post']}}); //=> true
    //
    contextMatchesOptions: function(context, match_options, positive) {
      var options = match_options;
      // normalize options
      if (typeof options === 'string' || _isRegExp(options)) {
        options = {path: options};
      }
      if (typeof positive === 'undefined') {
        positive = true;
      }
      // empty options always match
      if ($.isEmptyObject(options)) {
        return true;
      }
      // Do we have to match against multiple paths?
      if (_isArray(options.path)){
        var results, numopt, opts, len;
        results = [];
        for (numopt = 0, len = options.path.length; numopt < len; numopt += 1) {
          opts = $.extend({}, options, {path: options.path[numopt]});
          results.push(this.contextMatchesOptions(context, opts));
        }
        var matched = $.inArray(true, results) > -1 ? true : false;
        return positive ? matched : !matched;
      }
      if (options.only) {
        return this.contextMatchesOptions(context, options.only, true);
      } else if (options.except) {
        return this.contextMatchesOptions(context, options.except, false);
      }
      var path_matched = true, verb_matched = true;
      if (options.path) {
        if (!_isRegExp(options.path)) {
          options.path = new RegExp(options.path.toString() + '$');
        }
        path_matched = options.path.test(context.path);
      }
      if (options.verb) {
        if(typeof options.verb === 'string') {
          verb_matched = options.verb === context.verb;
        } else {
          verb_matched = options.verb.indexOf(context.verb) > -1;
        }
      }
      return positive ? (verb_matched && path_matched) : !(verb_matched && path_matched);
    },


    // Delegates to the `location_proxy` to get the current location.
    // See `Sammy.DefaultLocationProxy` for more info on location proxies.
    getLocation: function() {
      return this._location_proxy.getLocation();
    },

    // Delegates to the `location_proxy` to set the current location.
    // See `Sammy.DefaultLocationProxy` for more info on location proxies.
    //
    // ### Arguments
    //
    // * `new_location` A new location string (e.g. '#/')
    //
    setLocation: function(new_location) {
      return this._location_proxy.setLocation(new_location);
    },

    // Swaps the content of `$element()` with `content`
    // You can override this method to provide an alternate swap behavior
    // for `EventContext.partial()`.
    //
    // ### Example
    //
    //      var app = $.sammy(function() {
    //
    //        // implements a 'fade out'/'fade in'
    //        this.swap = function(content, callback) {
    //          var context = this;
    //          context.$element().fadeOut('slow', function() {
    //            context.$element().html(content);
    //            context.$element().fadeIn('slow', function() {
    //              if (callback) {
    //                callback.apply();
    //              }
    //            });
    //          });
    //        };
    //
    //      });
    //
    swap: function(content, callback) {
      var $el = this.$element().html(content);
      if (_isFunction(callback)) { callback(content); }
      return $el;
    },

    // a simple global cache for templates. Uses the same semantics as
    // `Sammy.Cache` and `Sammy.Storage` so can easily be replaced with
    // a persistent storage that lasts beyond the current request.
    templateCache: function(key, value) {
      if (typeof value != 'undefined') {
        return _template_cache[key] = value;
      } else {
        return _template_cache[key];
      }
    },

    // clear the templateCache
    clearTemplateCache: function() {
      return (_template_cache = {});
    },

    // This throws a '404 Not Found' error by invoking `error()`.
    // Override this method or `error()` to provide custom
    // 404 behavior (i.e redirecting to / or showing a warning)
    notFound: function(verb, path) {
      var ret = this.error(['404 Not Found', verb, path].join(' '));
      return (verb === 'get') ? ret : true;
    },

    // The base error handler takes a string `message` and an `Error`
    // object. If `raise_errors` is set to `true` on the app level,
    // this will re-throw the error to the browser. Otherwise it will send the error
    // to `log()`. Override this method to provide custom error handling
    // e.g logging to a server side component or displaying some feedback to the
    // user.
    error: function(message, original_error) {
      if (!original_error) { original_error = new Error(); }
      original_error.message = [message, original_error.message].join(' ');
      this.trigger('error', {message: original_error.message, error: original_error});
      if (this.raise_errors) {
        throw(original_error);
      } else {
        this.log(original_error.message, original_error);
      }
    },

    _checkLocation: function() {
      var location, returned;
      // get current location
      location = this.getLocation();
      // compare to see if hash has changed
      if (!this.last_location || this.last_location[0] != 'get' || this.last_location[1] != location) {
        // reset last location
        this.last_location = ['get', location];
        // lookup route for current hash
        returned = this.runRoute('get', location);
      }
      return returned;
    },

    _getFormVerb: function(form) {
      var $form = $(form), verb, $_method;
      $_method = $form.find('input[name="_method"]');
      if ($_method.length > 0) { verb = $_method.val(); }
      if (!verb) { verb = $form[0].getAttribute('method'); }
      if (!verb || verb === '') { verb = 'get'; }
      return $.trim(verb.toString().toLowerCase());
    },

    _checkFormSubmission: function(form) {
      var $form, path, verb, params, returned;
      this.trigger('check-form-submission', {form: form});
      $form = $(form);
      path  = $form.attr('action') || '';
      verb  = this._getFormVerb($form);

      if (this.debug) {
        this.log('_checkFormSubmission', $form, path, verb);
      }

      if (verb === 'get') {
        params = this._serializeFormParams($form);
        if (params !== '') { path += '?' + params; }
        this.setLocation(path);
        returned = false;
      } else {
        params = $.extend({}, this._parseFormParams($form));
        returned = this.runRoute(verb, path, params, form.get(0));
      }
      return (typeof returned == 'undefined') ? false : returned;
    },

    _serializeFormParams: function($form) {
       var queryString = "",
         fields = $form.serializeArray(),
         i;
       if (fields.length > 0) {
         queryString = this._encodeFormPair(fields[0].name, fields[0].value);
         for (i = 1; i < fields.length; i++) {
           queryString = queryString + "&" + this._encodeFormPair(fields[i].name, fields[i].value);
         }
       }
       return queryString;
    },

    _encodeFormPair: function(name, value){
      return _encode(name) + "=" + _encode(value);
    },

    _parseFormParams: function($form) {
      var params = {},
          form_fields = $form.serializeArray(),
          i;
      for (i = 0; i < form_fields.length; i++) {
        params = this._parseParamPair(params, form_fields[i].name, form_fields[i].value);
      }
      return params;
    },

    _parseQueryString: function(path) {
      var params = {}, parts, pairs, pair, i;

      parts = path.match(QUERY_STRING_MATCHER);
      if (parts && parts[1]) {
        pairs = parts[1].split('&');
        for (i = 0; i < pairs.length; i++) {
          pair = pairs[i].split('=');
          params = this._parseParamPair(params, _decode(pair[0]), _decode(pair[1] || ""));
        }
      }
      return params;
    },

    _parseParamPair: function(params, key, value) {
      if (typeof params[key] !== 'undefined') {
        if (_isArray(params[key])) {
          params[key].push(value);
        } else {
          params[key] = [params[key], value];
        }
      } else {
        params[key] = value;
      }
      return params;
    },

    _listen: function(name, callback) {
      return this.$element().bind([name, this.eventNamespace()].join('.'), callback);
    },

    _unlisten: function(name, callback) {
      return this.$element().unbind([name, this.eventNamespace()].join('.'), callback);
    }

  });

  // `Sammy.RenderContext` is an object that makes sequential template loading,
  // rendering and interpolation seamless even when dealing with asynchronous
  // operations.
  //
  // `RenderContext` objects are not usually created directly, rather they are
  // instantiated from an `Sammy.EventContext` by using `render()`, `load()` or
  // `partial()` which all return `RenderContext` objects.
  //
  // `RenderContext` methods always returns a modified `RenderContext`
  // for chaining (like jQuery itself).
  //
  // The core magic is in the `then()` method which puts the callback passed as
  // an argument into a queue to be executed once the previous callback is complete.
  // All the methods of `RenderContext` are wrapped in `then()` which allows you
  // to queue up methods by chaining, but maintaining a guaranteed execution order
  // even with remote calls to fetch templates.
  //
  Sammy.RenderContext = function(event_context) {
    this.event_context    = event_context;
    this.callbacks        = [];
    this.previous_content = null;
    this.content          = null;
    this.next_engine      = false;
    this.waiting          = false;
  };

  Sammy.RenderContext.prototype = $.extend({}, Sammy.Object.prototype, {

    // The "core" of the `RenderContext` object, adds the `callback` to the
    // queue. If the context is `waiting` (meaning an async operation is happening)
    // then the callback will be executed in order, once the other operations are
    // complete. If there is no currently executing operation, the `callback`
    // is executed immediately.
    //
    // The value returned from the callback is stored in `content` for the
    // subsequent operation. If you return `false`, the queue will pause, and
    // the next callback in the queue will not be executed until `next()` is
    // called. This allows for the guaranteed order of execution while working
    // with async operations.
    //
    // If then() is passed a string instead of a function, the string is looked
    // up as a helper method on the event context.
    //
    // ### Example
    //
    //      this.get('#/', function() {
    //        // initialize the RenderContext
    //        // Even though `load()` executes async, the next `then()`
    //        // wont execute until the load finishes
    //        this.load('myfile.txt')
    //            .then(function(content) {
    //              // the first argument to then is the content of the
    //              // prev operation
    //              $('#main').html(content);
    //            });
    //      });
    //
    then: function(callback) {
      if (!_isFunction(callback)) {
        // if a string is passed to then, assume we want to call
        // a helper on the event context in its context
        if (typeof callback === 'string' && callback in this.event_context) {
          var helper = this.event_context[callback];
          callback = function(content) {
            return helper.apply(this.event_context, [content]);
          };
        } else {
          return this;
        }
      }
      var context = this;
      if (this.waiting) {
        this.callbacks.push(callback);
      } else {
        this.wait();
        window.setTimeout(function() {
          var returned = callback.apply(context, [context.content, context.previous_content]);
          if (returned !== false) {
            context.next(returned);
          }
        }, 0);
      }
      return this;
    },

    // Pause the `RenderContext` queue. Combined with `next()` allows for async
    // operations.
    //
    // ### Example
    //
    //        this.get('#/', function() {
    //          this.load('mytext.json')
    //              .then(function(content) {
    //                var context = this,
    //                    data    = JSON.parse(content);
    //                // pause execution
    //                context.wait();
    //                // post to a url
    //                $.post(data.url, {}, function(response) {
    //                  context.next(JSON.parse(response));
    //                });
    //              })
    //              .then(function(data) {
    //                // data is json from the previous post
    //                $('#message').text(data.status);
    //              });
    //        });
    wait: function() {
      this.waiting = true;
    },

    // Resume the queue, setting `content` to be used in the next operation.
    // See `wait()` for an example.
    next: function(content) {
      this.waiting = false;
      if (typeof content !== 'undefined') {
        this.previous_content = this.content;
        this.content = content;
      }
      if (this.callbacks.length > 0) {
        this.then(this.callbacks.shift());
      }
    },

    // Load a template into the context.
    // The `location` can either be a string specifying the remote path to the
    // file, a jQuery object, or a DOM element.
    //
    // No interpolation happens by default, the content is stored in
    // `content`.
    //
    // In the case of a path, unless the option `{cache: false}` is passed the
    // data is stored in the app's `templateCache()`.
    //
    // If a jQuery or DOM object is passed the `innerHTML` of the node is pulled in.
    // This is useful for nesting templates as part of the initial page load wrapped
    // in invisible elements or `<script>` tags. With template paths, the template
    // engine is looked up by the extension. For DOM/jQuery embedded templates,
    // this isnt possible, so there are a couple of options:
    //
    //  * pass an `{engine:}` option.
    //  * define the engine in the `data-engine` attribute of the passed node.
    //  * just store the raw template data and use `interpolate()` manually
    //
    // If a `callback` is passed it is executed after the template load.
    load: function(location, options, callback) {
      var context = this;
      return this.then(function() {
        var should_cache, cached, is_json, location_array;
        if (_isFunction(options)) {
          callback = options;
          options = {};
        } else {
          options = $.extend({}, options);
        }
        if (callback) { this.then(callback); }
        if (typeof location === 'string') {
          // it's a path
          is_json      = (location.match(/\.json(\?|$)/) || options.json);
          should_cache = is_json ? options.cache === true : options.cache !== false;
          context.next_engine = context.event_context.engineFor(location);
          delete options.cache;
          delete options.json;
          if (options.engine) {
            context.next_engine = options.engine;
            delete options.engine;
          }
          if (should_cache && (cached = this.event_context.app.templateCache(location))) {
            return cached;
          }
          this.wait();
          $.ajax($.extend({
            url: location,
            data: {},
            dataType: is_json ? 'json' : 'text',
            type: 'get',
            success: function(data) {
              if (should_cache) {
                context.event_context.app.templateCache(location, data);
              }
              context.next(data);
            }
          }, options));
          return false;
        } else {
          // it's a dom/jQuery
          if (location.nodeType) {
            return location.innerHTML;
          }
          if (location.selector) {
            // it's a jQuery
            context.next_engine = location.attr('data-engine');
            if (options.clone === false) {
              return location.remove()[0].innerHTML.toString();
            } else {
              return location[0].innerHTML.toString();
            }
          }
        }
      });
    },

    // Load partials
    //
    // ### Example
    //
    //      this.loadPartials({mypartial: '/path/to/partial'});
    //
    loadPartials: function(partials) {
      var name;
      if(partials) {
        this.partials = this.partials || {};
        for(name in partials) {
          (function(context, name) {
            context.load(partials[name])
                   .then(function(template) {
                     this.partials[name] = template;
                   });
          })(this, name);
        }
      }
      return this;
    },

    // `load()` a template and then `interpolate()` it with data.
    //
    // can be called with multiple different signatures:
    //
    //      this.render(callback);
    //      this.render('/location');
    //      this.render('/location', {some: data});
    //      this.render('/location', callback);
    //      this.render('/location', {some: data}, callback);
    //      this.render('/location', {some: data}, {my: partials});
    //      this.render('/location', callback, {my: partials});
    //      this.render('/location', {some: data}, callback, {my: partials});
    //
    // ### Example
    //
    //      this.get('#/', function() {
    //        this.render('mytemplate.template', {name: 'test'});
    //      });
    //
    render: function(location, data, callback, partials) {
      if (_isFunction(location) && !data) {
        // invoked as render(callback)
        return this.then(location);
      } else {
        if(_isFunction(data)) {
          // invoked as render(location, callback, [partials])
          partials = callback;
          callback = data;
          data = null;
        } else if(callback && !_isFunction(callback)) {
          // invoked as render(location, data, partials)
          partials = callback;
          callback = null;
        }

        return this.loadPartials(partials)
                   .load(location)
                   .interpolate(data, location)
                   .then(callback);
      }
    },

    // `render()` the `location` with `data` and then `swap()` the
    // app's `$element` with the rendered content.
    partial: function(location, data, callback, partials) {
      if (_isFunction(callback)) {
        // invoked as partial(location, data, callback, [partials])
        return this.render(location, data, partials).swap(callback);
      } else if (_isFunction(data)) {
        // invoked as partial(location, callback, [partials])
        return this.render(location, {}, callback).swap(data);
      } else {
        // invoked as partial(location, data, [partials])
        return this.render(location, data, callback).swap();
      }
    },

    // defers the call of function to occur in order of the render queue.
    // The function can accept any number of arguments as long as the last
    // argument is a callback function. This is useful for putting arbitrary
    // asynchronous functions into the queue. The content passed to the
    // callback is passed as `content` to the next item in the queue.
    //
    // ### Example
    //
    //     this.send($.getJSON, '/app.json')
    //         .then(function(json) {
    //           $('#message).text(json['message']);
    //          });
    //
    //
    send: function() {
      var context = this,
          args = _makeArray(arguments),
          fun  = args.shift();

      if (_isArray(args[0])) { args = args[0]; }

      return this.then(function(content) {
        args.push(function(response) { context.next(response); });
        context.wait();
        fun.apply(fun, args);
        return false;
      });
    },

    // iterates over an array, applying the callback for each item item. the
    // callback takes the same style of arguments as `jQuery.each()` (index, item).
    // The return value of each callback is collected as a single string and stored
    // as `content` to be used in the next iteration of the `RenderContext`.
    collect: function(array, callback, now) {
      var context = this;
      var coll = function() {
        if (_isFunction(array)) {
          callback = array;
          array = this.content;
        }
        var contents = [], doms = false;
        $.each(array, function(i, item) {
          var returned = callback.apply(context, [i, item]);
          if (returned.jquery && returned.length == 1) {
            returned = returned[0];
            doms = true;
          }
          contents.push(returned);
          return returned;
        });
        return doms ? contents : contents.join('');
      };
      return now ? coll() : this.then(coll);
    },

    // loads a template, and then interpolates it for each item in the `data`
    // array. If a callback is passed, it will call the callback with each
    // item in the array _after_ interpolation
    renderEach: function(location, name, data, callback) {
      if (_isArray(name)) {
        callback = data;
        data = name;
        name = null;
      }
      return this.load(location).then(function(content) {
          var rctx = this;
          if (!data) {
            data = _isArray(this.previous_content) ? this.previous_content : [];
          }
          if (callback) {
            $.each(data, function(i, value) {
              var idata = {}, engine = this.next_engine || location;
              if (name) {
                idata[name] = value;
              } else {
                idata = value;
              }
              callback(value, rctx.event_context.interpolate(content, idata, engine));
            });
          } else {
            return this.collect(data, function(i, value) {
              var idata = {}, engine = this.next_engine || location;
              if (name) {
                idata[name] = value;
              } else {
                idata = value;
              }
              return this.event_context.interpolate(content, idata, engine);
            }, true);
          }
      });
    },

    // uses the previous loaded `content` and the `data` object to interpolate
    // a template. `engine` defines the templating/interpolation method/engine
    // that should be used. If `engine` is not passed, the `next_engine` is
    // used. If `retain` is `true`, the final interpolated data is appended to
    // the `previous_content` instead of just replacing it.
    interpolate: function(data, engine, retain) {
      var context = this;
      return this.then(function(content, prev) {
        if (!data && prev) { data = prev; }
        if (this.next_engine) {
          engine = this.next_engine;
          this.next_engine = false;
        }
        var rendered = context.event_context.interpolate(content, data, engine, this.partials);
        return retain ? prev + rendered : rendered;
      });
    },

    // Swap the return contents ensuring order. See `Application#swap`
    swap: function(callback) {
      return this.then(function(content) {
        this.event_context.swap(content, callback);
        return content;
      }).trigger('changed', {});
    },

    // Same usage as `jQuery.fn.appendTo()` but uses `then()` to ensure order
    appendTo: function(selector) {
      return this.then(function(content) {
        $(selector).append(content);
      }).trigger('changed', {});
    },

    // Same usage as `jQuery.fn.prependTo()` but uses `then()` to ensure order
    prependTo: function(selector) {
      return this.then(function(content) {
        $(selector).prepend(content);
      }).trigger('changed', {});
    },

    // Replaces the `$(selector)` using `html()` with the previously loaded
    // `content`
    replace: function(selector) {
      return this.then(function(content) {
        $(selector).html(content);
      }).trigger('changed', {});
    },

    // trigger the event in the order of the event context. Same semantics
    // as `Sammy.EventContext#trigger()`. If data is omitted, `content`
    // is sent as `{content: content}`
    trigger: function(name, data) {
      return this.then(function(content) {
        if (typeof data == 'undefined') { data = {content: content}; }
        this.event_context.trigger(name, data);
        return content;
      });
    }

  });

  // `Sammy.EventContext` objects are created every time a route is run or a
  // bound event is triggered. The callbacks for these events are evaluated within a `Sammy.EventContext`
  // This within these callbacks the special methods of `EventContext` are available.
  //
  // ### Example
  //
  //       $.sammy(function() {
  //         // The context here is this Sammy.Application
  //         this.get('#/:name', function() {
  //           // The context here is a new Sammy.EventContext
  //           if (this.params['name'] == 'sammy') {
  //             this.partial('name.html.erb', {name: 'Sammy'});
  //           } else {
  //             this.redirect('#/somewhere-else')
  //           }
  //         });
  //       });
  //
  // Initialize a new EventContext
  //
  // ### Arguments
  //
  // * `app` The `Sammy.Application` this event is called within.
  // * `verb` The verb invoked to run this context/route.
  // * `path` The string path invoked to run this context/route.
  // * `params` An Object of optional params to pass to the context. Is converted
  //   to a `Sammy.Object`.
  // * `target` a DOM element that the event that holds this context originates
  //   from. For post, put and del routes, this is the form element that triggered
  //   the route.
  //
  Sammy.EventContext = function(app, verb, path, params, target) {
    this.app    = app;
    this.verb   = verb;
    this.path   = path;
    this.params = new Sammy.Object(params);
    this.target = target;
  };

  Sammy.EventContext.prototype = $.extend({}, Sammy.Object.prototype, {

    // A shortcut to the app's `$element()`
    $element: function() {
      return this.app.$element(_makeArray(arguments).shift());
    },

    // Look up a templating engine within the current app and context.
    // `engine` can be one of the following:
    //
    // * a function: should conform to `function(content, data) { return interpolated; }`
    // * a template path: 'template.ejs', looks up the extension to match to
    //   the `ejs()` helper
    // * a string referring to the helper: "mustache" => `mustache()`
    //
    // If no engine is found, use the app's default `template_engine`
    //
    engineFor: function(engine) {
      var context = this, engine_match;
      // if path is actually an engine function just return it
      if (_isFunction(engine)) { return engine; }
      // lookup engine name by path extension
      engine = (engine || context.app.template_engine).toString();
      if ((engine_match = engine.match(/\.([^\.\?\#]+)(\?|$)/))) {
        engine = engine_match[1];
      }
      // set the engine to the default template engine if no match is found
      if (engine && _isFunction(context[engine])) {
        return context[engine];
      }

      if (context.app.template_engine) {
        return this.engineFor(context.app.template_engine);
      }
      return function(content, data) { return content; };
    },

    // using the template `engine` found with `engineFor()`, interpolate the
    // `data` into `content`
    interpolate: function(content, data, engine, partials) {
      return this.engineFor(engine).apply(this, [content, data, partials]);
    },

    // Create and return a `Sammy.RenderContext` calling `render()` on it.
    // Loads the template and interpolate the data, however does not actual
    // place it in the DOM.
    //
    // ### Example
    //
    //      // mytemplate.mustache <div class="name">{{name}}</div>
    //      render('mytemplate.mustache', {name: 'quirkey'});
    //      // sets the `content` to <div class="name">quirkey</div>
    //      render('mytemplate.mustache', {name: 'quirkey'})
    //        .appendTo('ul');
    //      // appends the rendered content to $('ul')
    //
    render: function(location, data, callback, partials) {
      return new Sammy.RenderContext(this).render(location, data, callback, partials);
    },

    // Create and return a `Sammy.RenderContext` calling `renderEach()` on it.
    // Loads the template and interpolates the data for each item,
    // however does not actual place it in the DOM.
    //
    // ### Example
    //
    //      // mytemplate.mustache <div class="name">{{name}}</div>
    //      renderEach('mytemplate.mustache', [{name: 'quirkey'}, {name: 'endor'}])
    //      // sets the `content` to <div class="name">quirkey</div><div class="name">endor</div>
    //      renderEach('mytemplate.mustache', [{name: 'quirkey'}, {name: 'endor'}]).appendTo('ul');
    //      // appends the rendered content to $('ul')
    //
    renderEach: function(location, name, data, callback) {
      return new Sammy.RenderContext(this).renderEach(location, name, data, callback);
    },

    // create a new `Sammy.RenderContext` calling `load()` with `location` and
    // `options`. Called without interpolation or placement, this allows for
    // preloading/caching the templates.
    load: function(location, options, callback) {
      return new Sammy.RenderContext(this).load(location, options, callback);
    },

    // create a new `Sammy.RenderContext` calling `loadPartials()` with `partials`.
    loadPartials: function(partials) {
      return new Sammy.RenderContext(this).loadPartials(partials);
    },

    // `render()` the `location` with `data` and then `swap()` the
    // app's `$element` with the rendered content.
    partial: function(location, data, callback, partials) {
      return new Sammy.RenderContext(this).partial(location, data, callback, partials);
    },

    // create a new `Sammy.RenderContext` calling `send()` with an arbitrary
    // function
    send: function() {
      var rctx = new Sammy.RenderContext(this);
      return rctx.send.apply(rctx, arguments);
    },

    // Changes the location of the current window. If `to` begins with
    // '#' it only changes the document's hash. If passed more than 1 argument
    // redirect will join them together with forward slashes.
    //
    // ### Example
    //
    //      redirect('#/other/route');
    //      // equivalent to
    //      redirect('#', 'other', 'route');
    //
    redirect: function() {
      var to, args = _makeArray(arguments),
          current_location = this.app.getLocation(),
          l = args.length;
      if (l > 1) {
        var i = 0, paths = [], pairs = [], params = {}, has_params = false;
        for (; i < l; i++) {
          if (typeof args[i] == 'string') {
            paths.push(args[i]);
          } else {
            $.extend(params, args[i]);
            has_params = true;
          }
        }
        to = paths.join('/');
        if (has_params) {
          for (var k in params) {
            pairs.push(this.app._encodeFormPair(k, params[k]));
          }
          to += '?' + pairs.join('&');
        }
      } else {
        to = args[0];
      }
      this.trigger('redirect', {to: to});
      this.app.last_location = [this.verb, this.path];
      this.app.setLocation(to);
      if (new RegExp(to).test(current_location)) {
        this.app.trigger('location-changed');
      }
    },

    // Triggers events on `app` within the current context.
    trigger: function(name, data) {
      if (typeof data == 'undefined') { data = {}; }
      if (!data.context) { data.context = this; }
      return this.app.trigger(name, data);
    },

    // A shortcut to app's `eventNamespace()`
    eventNamespace: function() {
      return this.app.eventNamespace();
    },

    // A shortcut to app's `swap()`
    swap: function(contents, callback) {
      return this.app.swap(contents, callback);
    },

    // Raises a possible `notFound()` error for the current path.
    notFound: function() {
      return this.app.notFound(this.verb, this.path);
    },

    // Default JSON parsing uses jQuery's `parseJSON()`. Include `Sammy.JSON`
    // plugin for the more conformant "crockford special".
    json: function(string) {
      return $.parseJSON(string);
    },

    // //=> Sammy.EventContext: get #/ {}
    toString: function() {
      return "Sammy.EventContext: " + [this.verb, this.path, this.params].join(' ');
    }

  });

  return Sammy;
});

var Path = {
    'version': "0.8.4",
    'map': function (path) {
        if (Path.routes.defined.hasOwnProperty(path)) {
            return Path.routes.defined[path];
        } else {
            return new Path.core.route(path);
        }
    },
    'root': function (path) {
        Path.routes.root = path;
    },
    'rescue': function (fn) {
        Path.routes.rescue = fn;
    },
    'history': {
        'initial':{}, // Empty container for "Initial Popstate" checking variables.
        'pushState': function(state, title, path){
            if(Path.history.supported){
                if(Path.dispatch(path)){
                    history.pushState(state, title, path);
                }
            } else {
                if(Path.history.fallback){
                    window.location.hash = "#" + path;
                }
            }
        },
        'popState': function(event){
            var initialPop = !Path.history.initial.popped && location.href == Path.history.initial.URL;
            Path.history.initial.popped = true;
            if(initialPop) return;
            Path.dispatch(document.location.pathname + document.location.hash);
        },
        'listen': function(fallback){
            Path.history.supported = !!(window.history && window.history.pushState);
            Path.history.fallback  = fallback;

            if(Path.history.supported){
                Path.history.initial.popped = ('state' in window.history), Path.history.initial.URL = location.href;
                window.onpopstate = Path.history.popState;
            } else {
                if(Path.history.fallback){
                    for(route in Path.routes.defined){
                        if(route.charAt(0) != "#"){
                            Path.routes.defined["#"+route] = Path.routes.defined[route];
                            Path.routes.defined["#"+route].path = "#"+route;
                        }
                    }
                    Path.listen();
                }
            }
        }
    },
    'match': function (path, parameterize) {
        var params = {}, route = null, possible_routes, slice, i, j, compare;
        for (route in Path.routes.defined) {
            if (route !== null && route !== undefined) {
                route = Path.routes.defined[route];
                possible_routes = route.partition();
                for (j = 0; j < possible_routes.length; j++) {
                    slice = possible_routes[j];
                    compare = path;
                    if (slice.search(/:/) > 0) {
                        for (i = 0; i < slice.split("/").length; i++) {
                            if ((i < compare.split("/").length) && (slice.split("/")[i].charAt(0) === ":")) {
                                params[slice.split('/')[i].replace(/:/, '')] = compare.split("/")[i];
                                compare = compare.replace(compare.split("/")[i], slice.split("/")[i]);
                            }
                        }
                    }
                    if (slice === compare) {
                        if (parameterize) {
                            route.params = params;
                        }
                        return route;
                    }
                }
            }
        }
        return null;
    },
    'dispatch': function (passed_route) {
        var previous_route, matched_route;
        if (Path.routes.current !== passed_route) {
            Path.routes.previous = Path.routes.current;
            Path.routes.current = passed_route;
            matched_route = Path.match(passed_route, true);

            if (Path.routes.previous) {
                previous_route = Path.match(Path.routes.previous);
                if (previous_route !== null && previous_route.do_exit !== null) {
                    previous_route.do_exit();
                }
            }

            if (matched_route !== null) {
                matched_route.run();
                return true;
            } else {
                if (Path.routes.rescue !== null) {
                    Path.routes.rescue();
                }
            }
        }
    },
    'listen': function () {
        var fn = function(){ Path.dispatch(location.hash); }

        if (location.hash === "") {
            if (Path.routes.root !== null) {
                location.hash = Path.routes.root;
            }
        }

        // The 'document.documentMode' checks below ensure that PathJS fires the right events
        // even in IE "Quirks Mode".
        if ("onhashchange" in window && (!document.documentMode || document.documentMode >= 8)) {
            window.onhashchange = fn;
        } else {
            setInterval(fn, 50);
        }

        if(location.hash !== "") {
            Path.dispatch(location.hash);
        }
    },
    'core': {
        'route': function (path) {
            this.path = path;
            this.action = null;
            this.do_enter = [];
            this.do_exit = null;
            this.params = {};
            Path.routes.defined[path] = this;
        }
    },
    'routes': {
        'current': null,
        'root': null,
        'rescue': null,
        'previous': null,
        'defined': {}
    }
};
Path.core.route.prototype = {
    'to': function (fn) {
        this.action = fn;
        return this;
    },
    'enter': function (fns) {
        if (fns instanceof Array) {
            this.do_enter = this.do_enter.concat(fns);
        } else {
            this.do_enter.push(fns);
        }
        return this;
    },
    'exit': function (fn) {
        this.do_exit = fn;
        return this;
    },
    'partition': function () {
        var parts = [], options = [], re = /\(([^}]+?)\)/g, text, i;
        while (text = re.exec(this.path)) {
            parts.push(text[1]);
        }
        options.push(this.path.split("(")[0]);
        for (i = 0; i < parts.length; i++) {
            options.push(options[options.length - 1] + parts[i]);
        }
        return options;
    },
    'run': function () {
        var halt_execution = false, i, result, previous;

        if (Path.routes.defined[this.path].hasOwnProperty("do_enter")) {
            if (Path.routes.defined[this.path].do_enter.length > 0) {
                for (i = 0; i < Path.routes.defined[this.path].do_enter.length; i++) {
                    result = Path.routes.defined[this.path].do_enter[i].apply(this, null);
                    if (result === false) {
                        halt_execution = true;
                        break;
                    }
                }
            }
        }
        if (!halt_execution) {
            Path.routes.defined[this.path].action();
        }
    }
};
/*!
Chosen, a Select Box Enhancer for jQuery and Prototype
by Patrick Filler for Harvest, http://getharvest.com

Version 1.1.0
Full source at https://github.com/harvesthq/chosen
Copyright (c) 2011 Harvest http://getharvest.com

MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
This file is generated by `grunt build`, do not edit it by hand.
*/
(function(){var $,AbstractChosen,Chosen,SelectParser,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child};SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[]}SelectParser.prototype.add_node=function(child){if(child.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(child)}else{return this.add_option(child)}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:this.escapeExpression(group.label),children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled))}return _results};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName.toUpperCase()==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};SelectParser.prototype.escapeExpression=function(text){var map,unsafe_chars;if((text==null)||text===false){return""}if(!/[\&\<\>\"\'\`]/.test(text)){return text}map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};unsafe_chars=/&(?!\w+;)|[\<\>\"\'\`]/g;return text.replace(unsafe_chars,function(chr){return map[chr]||"&amp;"})};return SelectParser})();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser();_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child)}return parser.parsed};AbstractChosen=(function(){function AbstractChosen(form_field,options){this.form_field=form_field;this.options=options!=null?options:{};if(!AbstractChosen.browser_is_supported()){return}this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers()}AbstractChosen.prototype.set_default_values=function(){var _this=this;this.click_test_action=function(evt){return _this.test_active_click(evt)};this.activate_action=function(evt){return _this.activate_field(evt)};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;this.inherit_select_classes=this.options.inherit_select_classes||false;this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:true;return this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:true};AbstractChosen.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder")}else{if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||AbstractChosen.default_multiple_text}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||AbstractChosen.default_single_text}}return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||AbstractChosen.default_no_result_text};AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=true};AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=false};AbstractChosen.prototype.input_focus=function(evt){var _this=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return _this.container_mousedown()}),50)}}else{if(!this.active_field){return this.activate_field()}}};AbstractChosen.prototype.input_blur=function(evt){var _this=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return _this.blur_test()}),100)}};AbstractChosen.prototype.results_option_build=function(options){var content,data,_i,_len,_ref;content="";_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){content+=this.result_add_group(data)}else{content+=this.result_add_option(data)}if(options!=null?options.first:void 0){if(data.selected&&this.is_multiple){this.choice_build(data)}else{if(data.selected&&!this.is_multiple){this.single_set_selected_text(data.text)}}}}return content};AbstractChosen.prototype.result_add_option=function(option){var classes,option_el;if(!option.search_match){return""}if(!this.include_option_in_results(option)){return""}classes=[];if(!option.disabled&&!(option.selected&&this.is_multiple)){classes.push("active-result")}if(option.disabled&&!(option.selected&&this.is_multiple)){classes.push("disabled-result")}if(option.selected){classes.push("result-selected")}if(option.group_array_index!=null){classes.push("group-option")}if(option.classes!==""){classes.push(option.classes)}option_el=document.createElement("li");option_el.className=classes.join(" ");option_el.style.cssText=option.style;option_el.setAttribute("data-option-array-index",option.array_index);option_el.innerHTML=option.search_text;return this.outerHTML(option_el)};AbstractChosen.prototype.result_add_group=function(group){var group_el;if(!(group.search_match||group.group_match)){return""}if(!(group.active_options>0)){return""}group_el=document.createElement("li");group_el.className="group-result";group_el.innerHTML=group.search_text;return this.outerHTML(group_el)};AbstractChosen.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup()}this.result_clear_highlight();this.results_build();if(this.results_showing){return this.winnow_results()}};AbstractChosen.prototype.reset_single_select_options=function(){var result,_i,_len,_ref,_results;_ref=this.results_data;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){result=_ref[_i];if(result.selected){_results.push(result.selected=false)}else{_results.push(void 0)}}return _results};AbstractChosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};AbstractChosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};AbstractChosen.prototype.winnow_results=function(){var escapedSearchText,option,regex,regexAnchor,results,results_group,searchText,startpos,text,zregex,_i,_len,_ref;this.no_results_clear();results=0;searchText=this.get_search_text();escapedSearchText=searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");regexAnchor=this.search_contains?"":"^";regex=new RegExp(regexAnchor+escapedSearchText,"i");zregex=new RegExp(escapedSearchText,"i");_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];option.search_match=false;results_group=null;if(this.include_option_in_results(option)){if(option.group){option.group_match=false;option.active_options=0}if((option.group_array_index!=null)&&this.results_data[option.group_array_index]){results_group=this.results_data[option.group_array_index];if(results_group.active_options===0&&results_group.search_match){results+=1}results_group.active_options+=1}if(!(option.group&&!this.group_search)){option.search_text=option.group?option.label:option.html;option.search_match=this.search_string_match(option.search_text,regex);if(option.search_match&&!option.group){results+=1}if(option.search_match){if(searchText.length){startpos=option.search_text.search(zregex);text=option.search_text.substr(0,startpos+searchText.length)+"</em>"+option.search_text.substr(startpos+searchText.length);option.search_text=text.substr(0,startpos)+"<em>"+text.substr(startpos)}if(results_group!=null){results_group.group_match=true}}else{if((option.group_array_index!=null)&&this.results_data[option.group_array_index].search_match){option.search_match=true}}}}}this.result_clear_highlight();if(results<1&&searchText.length){this.update_results_content("");return this.no_results(searchText)}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight()}};AbstractChosen.prototype.search_string_match=function(search_string,regex){var part,parts,_i,_len;if(regex.test(search_string)){return true}else{if(this.enable_split_word_search&&(search_string.indexOf(" ")>=0||search_string.indexOf("[")===0)){parts=search_string.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];if(regex.test(part)){return true}}}}}};AbstractChosen.prototype.choices_count=function(){var option,_i,_len,_ref;if(this.selected_option_count!=null){return this.selected_option_count}this.selected_option_count=0;_ref=this.form_field.options;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(option.selected){this.selected_option_count+=1}}return this.selected_option_count};AbstractChosen.prototype.choices_click=function(evt){evt.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show()}};AbstractChosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke()}else{if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}}break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt)}break;case 27:if(this.results_showing){this.results_hide()}return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};AbstractChosen.prototype.clipboard_event_checker=function(evt){var _this=this;return setTimeout((function(){return _this.results_search()}),50)};AbstractChosen.prototype.container_width=function(){if(this.options.width!=null){return this.options.width}else{return""+this.form_field.offsetWidth+"px"}};AbstractChosen.prototype.include_option_in_results=function(option){if(this.is_multiple&&(!this.display_selected_options&&option.selected)){return false}if(!this.display_disabled_options&&option.disabled){return false}if(option.empty){return false}return true};AbstractChosen.prototype.search_results_touchstart=function(evt){this.touch_started=true;return this.search_results_mouseover(evt)};AbstractChosen.prototype.search_results_touchmove=function(evt){this.touch_started=false;return this.search_results_mouseout(evt)};AbstractChosen.prototype.search_results_touchend=function(evt){if(this.touch_started){return this.search_results_mouseup(evt)}};AbstractChosen.prototype.outerHTML=function(element){var tmp;if(element.outerHTML){return element.outerHTML}tmp=document.createElement("div");tmp.appendChild(element);return tmp.innerHTML};AbstractChosen.browser_is_supported=function(){if(window.navigator.appName==="Microsoft Internet Explorer"){return document.documentMode>=8}if(/iP(od|hone)/i.test(window.navigator.userAgent)){return false}if(/Android/i.test(window.navigator.userAgent)){if(/Mobile/i.test(window.navigator.userAgent)){return false}}return true};AbstractChosen.default_multiple_text="Select Some Options";AbstractChosen.default_single_text="Select an Option";AbstractChosen.default_no_result_text="No results match";return AbstractChosen})();$=jQuery;$.fn.extend({chosen:function(options){if(!AbstractChosen.browser_is_supported()){return this}return this.each(function(input_field){var $this,chosen;$this=$(this);chosen=$this.data("chosen");if(options==="destroy"&&chosen){chosen.destroy()}else{if(!chosen){$this.data("chosen",new Chosen(this,options))}}})}});Chosen=(function(_super){__extends(Chosen,_super);function Chosen(){_ref=Chosen.__super__.constructor.apply(this,arguments);return _ref}Chosen.prototype.setup=function(){this.form_field_jq=$(this.form_field);this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")};Chosen.prototype.set_up_html=function(){var container_classes,container_props;container_classes=["chosen-container"];container_classes.push("chosen-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){container_classes.push(this.form_field.className)}if(this.is_rtl){container_classes.push("chosen-rtl")}container_props={"class":container_classes.join(" "),style:"width: "+(this.container_width())+";",title:this.form_field.title};if(this.form_field.id.length){container_props.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"}this.container=$("<div />",container_props);if(this.is_multiple){this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>')}else{this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>')}this.form_field_jq.hide().after(this.container);this.dropdown=this.container.find("div.chosen-drop").first();this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chosen-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chosen-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chosen-search").first();this.selected_item=this.container.find(".chosen-single").first()}this.results_build();this.set_tab_index();this.set_label_behavior();return this.form_field_jq.trigger("chosen:ready",{chosen:this})};Chosen.prototype.register_observers=function(){var _this=this;this.container.bind("mousedown.chosen",function(evt){_this.container_mousedown(evt)});this.container.bind("mouseup.chosen",function(evt){_this.container_mouseup(evt)});this.container.bind("mouseenter.chosen",function(evt){_this.mouse_enter(evt)});this.container.bind("mouseleave.chosen",function(evt){_this.mouse_leave(evt)});this.search_results.bind("mouseup.chosen",function(evt){_this.search_results_mouseup(evt)});this.search_results.bind("mouseover.chosen",function(evt){_this.search_results_mouseover(evt)});this.search_results.bind("mouseout.chosen",function(evt){_this.search_results_mouseout(evt)});this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(evt){_this.search_results_mousewheel(evt)});this.search_results.bind("touchstart.chosen",function(evt){_this.search_results_touchstart(evt)});this.search_results.bind("touchmove.chosen",function(evt){_this.search_results_touchmove(evt)});this.search_results.bind("touchend.chosen",function(evt){_this.search_results_touchend(evt)});this.form_field_jq.bind("chosen:updated.chosen",function(evt){_this.results_update_field(evt)});this.form_field_jq.bind("chosen:activate.chosen",function(evt){_this.activate_field(evt)});this.form_field_jq.bind("chosen:open.chosen",function(evt){_this.container_mousedown(evt)});this.form_field_jq.bind("chosen:close.chosen",function(evt){_this.input_blur(evt)});this.search_field.bind("blur.chosen",function(evt){_this.input_blur(evt)});this.search_field.bind("keyup.chosen",function(evt){_this.keyup_checker(evt)});this.search_field.bind("keydown.chosen",function(evt){_this.keydown_checker(evt)});this.search_field.bind("focus.chosen",function(evt){_this.input_focus(evt)});this.search_field.bind("cut.chosen",function(evt){_this.clipboard_event_checker(evt)});this.search_field.bind("paste.chosen",function(evt){_this.clipboard_event_checker(evt)});if(this.is_multiple){return this.search_choices.bind("click.chosen",function(evt){_this.choices_click(evt)})}else{return this.container.bind("click.chosen",function(evt){evt.preventDefault()})}};Chosen.prototype.destroy=function(){$(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);if(this.search_field[0].tabIndex){this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex}this.container.remove();this.form_field_jq.removeData("chosen");return this.form_field_jq.show()};Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass("chosen-disabled");this.search_field[0].disabled=true;if(!this.is_multiple){this.selected_item.unbind("focus.chosen",this.activate_action)}return this.close_field()}else{this.container.removeClass("chosen-disabled");this.search_field[0].disabled=false;if(!this.is_multiple){return this.selected_item.bind("focus.chosen",this.activate_action)}}};Chosen.prototype.container_mousedown=function(evt){if(!this.is_disabled){if(evt&&evt.type==="mousedown"&&!this.results_showing){evt.preventDefault()}if(!((evt!=null)&&($(evt.target)).hasClass("search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.val("")}$(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action);this.results_show()}else{if(!this.is_multiple&&evt&&(($(evt.target)[0]===this.selected_item[0])||$(evt.target).parents("a.chosen-single").length)){evt.preventDefault();this.results_toggle()}}return this.activate_field()}}};Chosen.prototype.container_mouseup=function(evt){if(evt.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(evt)}};Chosen.prototype.search_results_mousewheel=function(evt){var delta;if(evt.originalEvent){delta=-evt.originalEvent.wheelDelta||evt.originalEvent.detail}if(delta!=null){evt.preventDefault();if(evt.type==="DOMMouseScroll"){delta=delta*40}return this.search_results.scrollTop(delta+this.search_results.scrollTop())}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chosen-container-active")){return this.close_field()}};Chosen.prototype.close_field=function(){$(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action);this.active_field=false;this.results_hide();this.container.removeClass("chosen-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};Chosen.prototype.activate_field=function(){this.container.addClass("chosen-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};Chosen.prototype.test_active_click=function(evt){var active_container;active_container=$(evt.target).closest(".chosen-container");if(active_container.length&&this.container[0]===active_container[0]){return this.active_field=true}else{return this.close_field()}};Chosen.prototype.results_build=function(){this.parsing=true;this.selected_option_count=null;this.results_data=SelectParser.select_to_array(this.form_field);if(this.is_multiple){this.search_choices.find("li.search-choice").remove()}else{if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field[0].readOnly=true;this.container.addClass("chosen-container-single-nosearch")}else{this.search_field[0].readOnly=false;this.container.removeClass("chosen-container-single-nosearch")}}}this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop((high_bottom-maxHeight)>0?high_bottom-maxHeight:0)}else{if(high_top<visible_top){return this.search_results.scrollTop(high_top)}}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};Chosen.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}this.container.addClass("chosen-with-drop");this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());this.winnow_results();return this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this})};Chosen.prototype.update_results_content=function(content){return this.search_results.html(content)};Chosen.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();this.container.removeClass("chosen-with-drop");this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})}return this.results_showing=false};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field.tabIndex){ti=this.form_field.tabIndex;this.form_field.tabIndex=-1;return this.search_field[0].tabIndex=ti}};Chosen.prototype.set_label_behavior=function(){var _this=this;this.form_field_label=this.form_field_jq.parents("label");if(!this.form_field_label.length&&this.form_field.id.length){this.form_field_label=$("label[for='"+this.form_field.id+"']")}if(this.form_field_label.length>0){return this.form_field_label.bind("click.chosen",function(evt){if(_this.is_multiple){return _this.container_mousedown(evt)}else{return _this.activate_field()}})}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;this.result_select(evt);return this.search_field.focus()}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target)}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents(".active-result").first())){return this.result_clear_highlight()}};Chosen.prototype.choice_build=function(item){var choice,close_link,_this=this;choice=$("<li />",{"class":"search-choice"}).html("<span>"+item.html+"</span>");if(item.disabled){choice.addClass("search-choice-disabled")}else{close_link=$("<a />",{"class":"search-choice-close","data-option-array-index":item.array_index});close_link.bind("click.chosen",function(evt){return _this.choice_destroy_link_click(evt)});choice.append(close_link)}return this.search_container.before(choice)};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();evt.stopPropagation();if(!this.is_disabled){return this.choice_destroy($(evt.target))}};Chosen.prototype.choice_destroy=function(link){if(this.result_deselect(link[0].getAttribute("data-option-array-index"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1){this.results_hide()}link.parents("li").first().remove();return this.search_field_scale()}};Chosen.prototype.results_reset=function(){this.reset_single_select_options();this.form_field.options[0].selected=true;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field){return this.results_hide()}};Chosen.prototype.results_reset_cleanup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.selected_item.find("abbr").remove()};Chosen.prototype.result_select=function(evt){var high,item;if(this.result_highlight){high=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){this.form_field_jq.trigger("chosen:maxselected",{chosen:this});return false}if(this.is_multiple){high.removeClass("active-result")}else{this.reset_single_select_options()}item=this.results_data[high[0].getAttribute("data-option-array-index")];item.selected=true;this.form_field.options[item.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(item)}else{this.single_set_selected_text(item.text)}if(!((evt.metaKey||evt.ctrlKey)&&this.is_multiple)){this.results_hide()}this.search_field.val("");if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){this.form_field_jq.trigger("change",{selected:this.form_field.options[item.options_index].value})}this.current_selectedIndex=this.form_field.selectedIndex;return this.search_field_scale()}};Chosen.prototype.single_set_selected_text=function(text){if(text==null){text=this.default_text}if(text===this.default_text){this.selected_item.addClass("chosen-default")}else{this.single_deselect_control_build();this.selected_item.removeClass("chosen-default")}return this.selected_item.find("span").text(text)};Chosen.prototype.result_deselect=function(pos){var result_data;result_data=this.results_data[pos];if(!this.form_field.options[result_data.options_index].disabled){result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results()}this.form_field_jq.trigger("change",{deselected:this.form_field.options[result_data.options_index].value});this.search_field_scale();return true}else{return false}};Chosen.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect){return}if(!this.selected_item.find("abbr").length){this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}return this.selected_item.addClass("chosen-single-with-deselect")};Chosen.prototype.get_search_text=function(){if(this.search_field.val()===this.default_text){return""}else{return $("<div/>").text($.trim(this.search_field.val())).html()}};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;selected_results=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high)}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');no_results_html.find("span").first().html(terms);this.search_results.append(no_results_html);return this.form_field_jq.trigger("chosen:no_results",{chosen:this})};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};Chosen.prototype.keydown_arrow=function(){var next_sib;if(this.results_showing&&this.result_highlight){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){return this.result_do_highlight(next_sib)}}else{return this.results_show()}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else{if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first())}else{if(this.choices_count()>0){this.results_hide()}return this.result_clear_highlight()}}}};Chosen.prototype.keydown_backstroke=function(){var next_available_destroy;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{next_available_destroy=this.search_container.siblings("li.search-choice").last();if(next_available_destroy.length&&!next_available_destroy.hasClass("search-choice-disabled")){this.pending_backstroke=next_available_destroy;if(this.single_backstroke_delete){return this.keydown_backstroke()}else{return this.pending_backstroke.addClass("search-choice-focus")}}}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref1;stroke=(_ref1=evt.which)!=null?_ref1:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke()}switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(evt)}this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:evt.preventDefault();this.keydown_arrow();break}};Chosen.prototype.search_field_scale=function(){var div,f_width,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";"}div=$("<div />",{style:style_block});div.text(this.search_field.val());$("body").append(div);w=div.width()+25;div.remove();f_width=this.container.outerWidth();if(w>f_width-10){w=f_width-10}return this.search_field.css({width:w+"px"})}};return Chosen})(AbstractChosen)}).call(this);

var BBV=(function(WINDOW,DOCUMENT,TRUE,FALSE,NULL,UNDEFINED){var modules={},TRIMBOTH=/^\s+|\s+$/g,URLPATTERN=/^.+\//i,VERSION="1.0",scripts=DOCUMENT.getElementsByTagName("script"),firstscript=scripts[0],scriptpath=(function(){return URLPATTERN.exec(scripts[scripts.length-1].src)})(),datatypes={},hasOwn=Object.prototype.hasOwnProperty,slice=Array.prototype.slice,toString=Object.prototype.toString,trim=String.prototype.trim,bbv={inArray:function(item,arr){if(arr.indexOf){return arr.indexOf(item)}for(var i=0,len=arr.length;i<len;i++){if(arr[i]===item){return i}}return -1},isArray:function(obj){return bbv.type(obj)==="array"},remove:function(arr,from,to){var rest=arr.slice((to||from)+1||arr.length);arr.length=from<0?arr.length+from:from;return arr.push.apply(arr,rest)},isEmptyObj:function(obj){for(var i in obj){return false}return true},isFunction:function(obj){return bbv.type(obj)==="function"},isObj:function(obj){return(obj&&obj.length==UNDEFINED)&&bbv.type(obj)==="object"},each:function(obj,fn){var name,value,i=0,object=obj||{},length=object.length,isObj=length===UNDEFINED||bbv.isFunction(object);if(isObj){for(name in object){fn.call(object[name],name,object[name])}}else{for(value=object[0];i<length;value=object[++i]){fn.call(value,i,value)}}},unique:function(arr,comparer){if(arr.length===1){return arr}comparer=comparer||function(x,y){return x===y};var a=[],length=arr.length;for(var i=0;i<length;i++){for(var j=i+1;j<length;j++){if(comparer(arr[i],arr[j])){j=++i}}a.push(arr[i])}return a},extend:function(){var args=arguments,length=args.length,target=args[0],option,i=0,l=length,name;if(!target){target={}}for(;i<l;i++){if((option=args[i])!==NULL){for(name in option){target[name]=option[name]}}}return target},module:function(name,fn){var temp={};temp[name]=modules[name]=fn(WINDOW,DOCUMENT,TRUE,FALSE,NULL);bbv.extend(bbv,temp)},namespace:function(_ns){var ns=_ns.split("."),parnt=window;BBV.each(ns,function(idx,val){parnt[val]=parnt[val]||{};parnt=parnt[val]});return parnt},noop:function(){},require:function(modules){var script,i=0,required=(BBV.type(modules)==="string")?slice.call(arguments):modules,mods=required.length;for(;i<mods;i++){if(!BBV[required[i]]){throw new Error(required[i]+" is required but is missing.")}}},trim:trim?function(str){return String(str).trim()}:function(str){return String(str).replace(TRIMBOTH,"")},type:function(o){return o==NULL?String(o):datatypes[toString.call(o)]||"object"}};bbv.Object={create:function(obj,_props){var _properties=_props||{};function F(){}if(!BBV.isFunction(Object.create)){BBV.extend(obj,_properties);F.prototype=obj;return new F()}else{return Object.create(obj,_properties)}},extend:function(){}};bbv.each("Array Boolean Date Function Number Object RegExp String".split(" "),function(i,t){datatypes["[object "+t+"]"]=t.toLowerCase()});return bbv})(this,this.document,true,false,null),BBV_settings=(function(){var base={};function settings(options){BBV.extend(base,options);return base}return settings})();BBV.extend(BBV,{settings:BBV_settings()});BBV_settings(BBVSettingsObject);
BBV.module("error",function(WINDOW,BBV_){var history=[],type={AJAXERROR:{name:"AjaxErrorExceptions",msg:"Generic AJAX error"},DEFAULTERROR:{name:"GenericException",msg:"An error has occured"},INVALIDMETHOD:{name:"InvalidMethodException",msg:"Method cannot be called on this object"},MISSINGMODULE:{name:"MissingModuleException",msg:"{0} module is missing"}};function Err(){var err_=(this instanceof Err)?this:new Err,args=Array.prototype.slice.call(arguments),l=args.length,isobj=BBV.isObj(args[0]);return err_}BBV.extend(Err.prototype,{log:function(){var err_=this},warn:function(){},stop:function(){}},Error.prototype);Err.DEBUG=false;Err.type=type;return Err});
(function(WINDOW,DOCUMENT,TRUE,FALSE,NULL,UNDEFINED){BBV.require(["error"]);var $=WINDOW.jQuery,defaults;BBV.extend(BBV,{ajax:{defaults:defaults={async:true,crossDomain:BBV.settings.api.xhr||false,dataType:"json",type:"GET",error:function(data){BBV.error(BBV.error.type.AJAXERROR,{status:data.textStatus,msg:data.errorThrown})},success:function(data){}},getJSON:function(url,settings){var settings=settings||{},config=BBV.extend({},defaults,settings,{dataType:"json"});BBV.ajax.load(url,config)},getJSONP:function(url,settings){var settings=settings||{},config=BBV.extend({},defaults,settings,{dataType:"jsonp",jsonpCallback:callback});BBV.ajax.load(url,config)},load:function(url,settings){var settings=settings||{},config=BBV.extend({},defaults,settings);$.ajax(orion.util.url.fixedOESPURL(url),config)}},dom:{addClass:function(selector,classname){var selector=selector||document;$(selector).addClass(classname);return BBV.get(selector)},append:function(selector,element){var selector=selector||document;$(selector).append(element);return BBV.get(selector)},detach:function(selector){var selector=selector||document;return $(selector).detach()},empty:function(selector){var selector=selector||document;$(selector).empty();return BBV.get(selector)},get:function(selector,context,idx){var context=context||document,match=$(context).find(selector);return match.get(idx)},hasClass:function(selector,classname){var selector=selector||document;return $(selector).hasClass(classname)},removeClass:function(selector,classname){var selector=selector||document;$(selector).removeClass(classname);return BBV.get(selector)}},events:{bind:function(event,handler){$(document).bind(event,handler)},trigger:function(event,params){$.event.trigger(event,params)}},json:{serialize:function(obj){return JSON.stringify(obj)},parse:function(str){return JSON.parse(str)}}})})(this,this.document,true,false,null);
BBV.module("utils",function(WINDOW,DOCUMENT,TRUE,FALSE,NULL,UNDEFINED){var utils={};utils.cookie=(function(){var cookie=function(name){var c=(!(this instanceof cookie))?new cookie:this;c.data=null;c.json=null;c.name=name;c.exists=c.check(c.name);if(name){c.data=c.get(c.name)||"{}";c.json=BBV.json.parse(decodeURIComponent(c.data))}return c};cookie.prototype={check:function(key){var val=(this instanceof cookie)?this.get(key):cookie.get(key);return(!!val||val==="")},get:function(key){if(!key){return}var c=(this instanceof cookie&&this.json)?this.json:document.cookie.split(";"),length=c.length,i=0,namexp=key+("="),data;if(BBV.type(c)!=="object"){for(;i<length;i++){if(BBV.trim(c[i]).indexOf(namexp)===0){data=BBV.trim(c[i]);break}}return data?data.split("=")[1]:null}else{if(BBV.isObj(c)){return c[key]}}return c},set:function(n,v,e,d,s){var self=this,name=n,value=v,expire=(e===0)?false:e||BBV.settings.cookie.daysToExpire||null,domain=d||null,secure=s||FALSE,strbuilder=[];if(!(self instanceof cookie)){strbuilder.push(name+"="+value)}else{var data=this.json||{},inject={};inject[name]=value;BBV.extend(data,inject);strbuilder.push(this.name+"="+BBV.json.serialize(this.json))}if(expire){var date=new Date(),expires;if(typeof expire==="number"){date.setTime(date.getTime()+(expire*1000*60*60*24));expires=date}else{expires=expire}strbuilder.push("expires="+expires.toGMTString())}if(domain){strbuilder.push("domain="+domain)}if("https:"==document.location.protocol&&secure){strbuilder.push("secure")}strbuilder.push("path=/");document.cookie=strbuilder.join("; ")},remove:function(name){var key;if(!(this instanceof cookie)){utils.cookie.set(name,"",-1)}else{for(key in this.json){if(key===name){delete this.json[key]}}utils.cookie.set(this.name,BBV.json.serialize(this.json))}}};BBV.extend(cookie,cookie.prototype);return cookie})();utils.adjustToServerTime=function(t){return utils.date(t+orion.oesp.timeEndpoint.offset*60*1000)};utils.serverDate=utils.adjustToServerTime;utils.date=function(t){function DateObj(t){var self=this;self.date=t?new Date(t):new Date;return self}DateObj.prototype={getMonthName:function(abbr){var offset=abbr?12:0,s=BBV.settings.i18n.dateformat,month=this.date.getMonth(),months=s&&s.monthNames.length?s.monthNames:[];return months[month+offset]},getDayName:function(abbr){var offset=abbr?7:0,s=BBV.settings.i18n.dateformat,day=this.date.getDay(),days=s&&s.dayNames.length?s.dayNames:[];return days[day+offset]},format:function(format){if(typeof format!=="string"){return false}var self=this,pattern=/M{1,4}|D{1,4}|Y{2,4}|H{1,2}|h{1,2}|m|s|t{1,2}/g,d=self.date,M=d.getMonth(),D=d.getDate(),Y=d.getFullYear(),H=d.getHours(),m=d.getMinutes(),s=d.getSeconds(),tt=H>12?"PM":"AM",pad=function(val){return val<10?[0,val].join(""):val},mappings={MMMM:self.getMonthName(),MMM:self.getMonthName(true),MM:pad(M+1),M:M+1,DDDD:self.getDayName(),DDD:self.getDayName(true),DD:pad(D),D:D,YYYY:Y,YY:String(Y).slice(2),HH:pad(H),H:H,hh:pad(H%12),h:H%12||12,m:pad(m),s:pad(s),tt:tt,t:String(tt).slice(0,1)};return format.replace(pattern,function($0){return($0 in mappings)?mappings[$0]:$0})},toString:function(){return this.date.toString()}};return new DateObj(t)};BBV.extend(utils.date,{toMilliseconds:function(days){return(1000*60*60*24*days)}});utils.guid={expression:/^[0-9a-f]{8}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{12}$/,format:"xx-x-x-x-xxx",generate:function(pattern){var guid=null,pattern=pattern||utils.guid.format;function field(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}guid=utils.guid.format.replace(/x/ig,function(){return field()});return guid},validate:function(guid){return utils.guid.expression.test(guid)}};utils.time={format:function(time,lead){var time=Math.ceil(time),lead=lead||true,formatted=[],seconds=parseInt(time%60,10)||0,minutes=parseInt(time/60,10)||0,hours=parseInt(minutes/60,10)||0;minutes=minutes-(hours*60);function checkLeadingZero(num){return(num<10&&lead)?"0"+num:num}return checkLeadingZero(hours)+":"+checkLeadingZero(minutes)}};utils.uri={builder:function(url){var self={url:NULL,domain:NULL,port:NULL,path:NULL,hash:NULL,params:{},toString:function(){var str=[self.domain],param=[];if(self.port){str.push(":"+self.port)}if(self.path){str.push(self.path)}for(var item in self.params){param.push(item+"="+self.params[item])}if(param.length){str.push("?"+param.join("&"))}if(self.hash){str.push("#"+self.hash)}return str.join("")}},urlmatch=/^([a-z]+:\/{2,3}[a-z0-9\.\-]+)(?::(\d{2,4}))?([a-z0-9\-\.\_\/]+)?(?:\?([^#]+))?(?:#(.+))?$/i,parts=["url","domain","port","path","params","hash"],type=typeof url,match=type==="string"?urlmatch.exec(url):[],length=match?match.length:0,i=0,pairs,params;if(type==="string"&&length){for(;i<length;i++){if(i===4){self[parts[i]]=decodeURIComponent(match[i].replace("%26","%2526"))}else{self[parts[i]]=decodeURIComponent(match[i])}}params=self.params;self.params={};pairs=params.split("&");for(i=0,length=pairs.length;i<length;i++){var keyValue=pairs[i].split("=");self.params[decodeURIComponent(keyValue[0])]=decodeURIComponent(keyValue[1])}}else{if(type==="object"){BBV.extend(self,url)}}return self},resolveURL:function(path){var context=BBV.settings.context,resolved;if(context){resolved=path.replace(/^~/,context)}else{resolved=path.replace(/^~/,"")}return resolved},toObject:function(uri){var obj={},pairs=uri.split("&");BBV.each(pairs,function(idx,val){var keyValue=val.split("=");obj[keyValue[0]]=orion.util.url.fixedEncodeURIComponent(keyValue[1])});return obj},toFilterObject:function(uri){var obj={},pairs=uri.split("&");BBV.each(pairs,function(idx,val){var keyValue=val.split("=");obj[keyValue[0]]=keyValue[0]+"="+orion.util.url.fixedEncodeURIComponent(keyValue[1])});return obj}};utils.listings={currentDate:null,msToDate:function(time){return(BBV.utils.date(time).format("DDD D MMM")).toUpperCase()},msToTime:function(time){var n=new Date(time),hours=n.getHours(),minutes=n.getMinutes();return[(hours<10)?"0"+hours:+hours,":",(minutes<10)?"0"+minutes:+minutes].join("")},getGenre:function(){return orion.modules.EPG.TemplateHelperMethods.listings.getGenresTitles(this.categories)},buildMediaGenreLinks:function(){return orion.oesp.res.Media.prototype.getGenre.call(this)},buildGenreLinks:function(){if(!this.program){return""}var genres=this.program.categories;var categories=[];for(var i=0;i<genres.length;i++){categories.push('<a href="'+BBV.settings.site.urls.channels.bygenre+"#/"+genres[i].id+'">'+genres[i].title+"</a>"||"")}return categories.join(", ")},checkIfLiveStream:function(){var now=+new Date(),isStationLive=false,isShowLive=(this.startTime<now&&this.endTime>now);return(isStationLive&&isShowLive)},getFormattedServerTime:function(){return this.msToTime(this.startTime+orion.oesp.timeEndpoint.offset*60*1000)+"-"+msToTime(this.endTime+orion.oesp.timeEndpoint.offset*60*1000)},getFormattedTime:function(){return this.msToTime(this.startTime)+"-"+msToTime(this.endTime)},getFormattedServerStartTime:function(){return this.msToTime(this.startTime+orion.oesp.timeEndpoint.offset*60*1000)},getFormattedStartTime:function(){return this.msToTime(this.startTime)},getFormattedDate:function(){this.currentDate=msToDate(this.startTime);return this.currentDate},isNewDate:function(){return this.index===0||this.currentDate!=msToDate(this.startTime)},isAvailable:function(){var notEntitled=BBV.user().isEntitlementLocked(),loggedIn=this.isLoggedIn();return(loggedIn&&!notEntitled)},isLoggedIn:function(){return BBV.user().isLoggedIn},localizeText:function(){return function(text){return this.localStrings[text]}},upcomingLink:function(){var link=[BBV.settings.site.urls.search.tvresults,"?q="],title=this.title||"";link.push(encodeURIComponent(title.replace(/\s/g,"-")));return link.join("")}};return utils});
BBV.module("api",function(WINDOW,DOCUMENT,TRUE,FALSE,NULL,UNDEFINED){BBV.require(["utils"]);var base=BBV.settings.api.urls.base,endpoint=BBV.settings.api.urls.endpoints,xhr=BBV.settings.api.xhr,cache=[],api={};function Query(url,settings){var self=!(this instanceof Query)?new Query:this,settings=BBV.isObj(settings)?settings:{};self.url=url||base;self.callback=settings&&BBV.isFunction(settings.callback)?settings.callback:null;self.success=function(){var args=Array.prototype.slice.call(arguments);self.response=args[0];self.lastrun=new Date();if(self.callback){self.callback.apply(self,args)}BBV.events.trigger("BBV#Query",args)};self.settings=BBV.extend({},settings,{success:self.success});return self}Query.prototype={constructor:Query,response:{},data:null,lastrun:null,remove:function(overrideType){var self=this;if(overrideType){BBV.extend(self.settings,{type:"DELETE"})}self.run()},run:function(){var self=this;if(!xhr){BBV.ajax.getJSON(self.url,BBV.extend(self.settings,{data:self.data}))}else{BBV.ajax.getJSONP(self.url,BBV.extend(self.settings,{data:self.data}))}},save:function(){BBV.error(BBV.error.type.INVALIDMETHOD)},update:function(settings){var self=this;BBV.extend(self.settings,settings);BBV.each(settings,function(property,value){if(!BBV.isFunction(self[property])){self[property]=value}})}};function ChannelListQuery(settings){var self=!(this instanceof ChannelListQuery)?new ChannelListQuery:this,settings=BBV.isObj(settings)?settings:{};self.url=(settings.url)?settings.url:[base,endpoint.channels].join("/");self.callback=settings&&BBV.isFunction(settings.callback)?settings.callback:null;self.settings=BBV.extend({},settings,{success:self.success});self.success=function(){var args=Array.prototype.slice.call(arguments);self.response=args[0];self.lastrun=new Date();if(self.callback){args.unshift(this);self.callback.apply(self,args)}BBV.events.trigger("BBV#ChannelListQuery",args)};self.settings=BBV.extend({},settings,{success:self.success});return self}ChannelListQuery.prototype=new Query;function FeedQuery(feedID,settings){var self=!(this instanceof FeedQuery)?new FeedQuery:this,settings=BBV.isObj(settings)?settings:{};self.feedID=feedID||null;self.url=(settings.url)?settings.url:[base,endpoint.feeds].join("/");self.callback=settings&&BBV.isFunction(settings.callback)?settings.callback:null;self.success=function(){var args=Array.prototype.slice.call(arguments);self.response=args[0];self.lastrun=new Date();if(self.callback){args.unshift(this);self.callback.apply(self,args)}BBV.events.trigger("BBV#FeedQuery",args)};self.settings=BBV.extend({},settings,{success:self.success});return self}FeedQuery.prototype=new Query;BBV.extend(FeedQuery.prototype,{});function ListingsQuery(settings){var self=!(this instanceof ListingsQuery)?new ListingsQuery:this,settings=BBV.isObj(settings)?settings:{};self.url=(settings.url)?settings.url:[base,endpoint.channels].join("/");self.callback=settings&&BBV.isFunction(settings.callback)?settings.callback:null;self.settings=BBV.extend({},settings,{success:self.success});self.success=function(){var args=Array.prototype.slice.call(arguments);self.response=args[0];self.lastrun=new Date();if(self.callback){args.unshift(this);self.callback.apply(self,args)}BBV.events.trigger("BBV#ListingsQuery",args)};self.settings=BBV.extend({},settings,{success:self.success});return self}ListingsQuery.prototype=new Query;ListingsQuery.prototype.constructor=ListingsQuery;function MediaObjectQuery(mediaID,callback,settings){var self=!(this instanceof MediaQuery)?new MediaQuery(mediaID,callback,settings):this,settings=BBV.isObj(settings)?settings:BBV.isObj(callback)?callback:{},callback=BBV.isFunction(callback)?callback:(settings&&settings.success)?settings.success:null;self.url=(settings.url)?settings.url:[base,endpoint.media].join("/");self.mediaID=mediaID||null}MediaObjectQuery.prototype=new Query;BBV.extend(MediaObjectQuery.prototype,{remove:function(){},save:function(){}});function RatingQuery(){}function ReviewQuery(){}BBV.extend(api,{Query:Query,ChannelListQuery:ChannelListQuery,FeedQuery:FeedQuery,ListingsQuery:ListingsQuery});return api});
BBV.module("user",function(WINDOW,DOCUMENT,TRUE,FALSE,NULL,UNDEFINED){BBV.require(["utils","error"]);var user,isloggedin=checkLoggedStatus();function checkLoggedStatus(){return BBV.utils.cookie.check(BBV.settings.cookie.tokenName)}checkLoggedStatus.mappings={account:BBV.settings.cookie.map.account||"account",parentalRestrict:BBV.settings.cookie.map.parental||"parental",deviceID:BBV.settings.cookie.map.deviceID||"deviceID",entitlements:BBV.settings.cookie.map.entitlements||"entitlements",fullname:BBV.settings.cookie.map.fullname||"fullname",status:BBV.settings.cookie.map.status||"status",languageCode:BBV.settings.cookie.map.languageCode||"languageCode",playlists:BBV.settings.cookie.map.playlists||"playlists",SID:BBV.settings.cookie.map.SID||"SID",UID:BBV.settings.cookie.map.UID||"UID",username:BBV.settings.cookie.map.username||"username"};function checkUserStatus(callback){var loggedStatus=checkLoggedStatus();if(loggedStatus!==isloggedin||user===UNDEFINED){user=(loggedStatus)?new Member:new User;user.init();isloggedin=checkLoggedStatus()}if(BBV.isFunction(callback)){callback.call(user)}return user}function User(){var self=this,map_=checkLoggedStatus.mappings;self.isLoggedIn=false;self.properties={account:null,deviceID:null,entitlements:[],fullname:"Guest User",languageCode:null,parentalRestrict:null,playlists:null,SID:null,UID:null,username:"guest"};self.isEntitlementLocked=function(control_){var self=this,notentitled=true,control=control_||"",entitle=self.get(checkLoggedStatus.mappings.entitlements)||[];if(entitle.length>0){var i=0,entitledTo=BBV.isArray(entitle)?entitle:entitle.split(","),entitlements=BBV.isArray(control)?control:control.split(",");BBV.each(entitledTo,function(idx,id){notentitled=(BBV.inArray(id,entitlements)!==-1)?false:notentitled})}return notentitled};self.checkInPlaylists=function(id){};self.init=function(){};self.login=function(response,sessionLength){var self=this;if(BBV.settings.cookie.generate){var token={oespToken:response.oespToken,username:response.username};BBV.utils.cookie.set(BBV.settings.cookie.tokenName,encodeURIComponent(BBV.json.serialize(token)),sessionLength,null,BBV.settings.cookie.secure)}checkUserStatus(function(){if(this.isLoggedIn){BBV.events.trigger("User#login")}});return this};self.logout=function(){BBV.utils.cookie.remove(BBV.settings.cookie.tokenName);checkUserStatus(function(){if(!this.isLoggedIn){BBV.events.trigger("User#logout")}});return this};self.get=function(property_){var self=this,subscript=property_.split("."),property=self.properties,key=property[subscript.shift()];BBV.each(subscript,function(idx,val_){if(key&&BBV.type(key[val_])!==UNDEFINED){key=key[val_]}});return key};return self}function Member(){var self=this;self.isLoggedIn=true;self.init=function(){var self=this;$.when(orion.oesp.session).done(function(session){BBV.extend(self.properties,BBV.json.parse(decodeURIComponent(BBV.utils.cookie.get(BBV.settings.cookie.tokenName))),session)})};return self}Member.prototype=new User;return checkUserStatus});
BBV.module("feed",function(WINDOW,DOCUMENT,TRUE,FALSE,NULL,UNDEFINED){var feedcache={},mediacache={},MediaObject={properties:{},initialize:function(data){BBV.extend(this,data);return this}};function Feed(context,settings,withoutCache){var self=this;self.context=context;self.settings=settings||{};self.url=self.settings.url||null;self.callback=settings.callback||BBV.noop;BBV.extend(self.settings,{callback:function(queryObj,data){self.data=data;self.callback.call(self,this)}});self.query=new BBV.api.FeedQuery(self.context,BBV.extend(self.settings,{url:self.url}));return self}Feed.prototype={constructor:Feed,data:null,update:function(url){var self=this;self.query.update(BBV.extend(self.settings,{url:url||self.url}));self.query.run()}};function Filter(){}function Pager(){}function Sorter(){}function s(){}function feed(context,settings){if(!feedcache[context]){feedcache[context]=new Feed(context,settings)}return settings.withoutCache?new Feed(context,settings):feedcache[context]}feed.s=s;feed.MediaObject=MediaObject;return feed});
BBV.module("player",function(window,_BBV){var player={};player=(function(){function Player(){var self=this;return self}Player.prototype={isSilverlight:function(mode){var playerName;if(mode&&mode.toLowerCase()==="standard"){playerName=BBV.settings.videoPlayer.vodPlayer}else{playerName=BBV.settings.videoPlayer.linearPlayer}if(playerName){return playerName.toLowerCase()==="silverlight"}return false},generateSLEventName:function(name){var PLAYER_EVENT_PREFIX="slplayerevent_";return PLAYER_EVENT_PREFIX+name}};return new Player()})();return player});

BBV.namespace("orion.util").inherits=orion.util.inherits||(function(){var inherits=function inherits(klass,superKlass,copyStaticProperties){var prop;function F(){}F.prototype=superKlass.prototype;klass.prototype=new F();klass.prototype.constructor=klass;if(copyStaticProperties){for(prop in superKlass){if(superKlass.hasOwnProperty(prop)){klass[prop]=superKlass[prop]}}}};return inherits})();
BBV.namespace("orion.util").PubSub=orion.util.PubSub||(function($){function PubSub(){}PubSub.prototype.bind=function(event,eventData,handler){var $this=$(this);$this.bind.apply($this,arguments)};PubSub.prototype.unbind=function(eventType,handler){var $this=$(this);$this.unbind.apply($this,arguments)};PubSub.prototype.trigger=function(eventType,extraParameters){var $this=$(this);try{$this.trigger.apply($this,arguments)}catch(err){try{extraParameters.length;console.log(err)}catch(e){}}};return PubSub})(jQuery);
BBV.namespace("orion.util.mvc").Model=orion.util.mvc.Model||(function($,PubSub){function Model(config){var self=this;PubSub.call(self);if(config&&$.type(config)=="object"){self.set(config,true)}}orion.util.inherits(Model,PubSub);Model.prototype.has=function(property){var self=this;return property in self&&self.hasOwnProperty(property)};Model.prototype.get=function(property){return this[property]};Model.prototype.set=function(property,value,silent){var self=this;var type=$.type(property);var customSetters=self.constructor.customSetters||{};var prop;if(type=="object"){silent=value;for(prop in property){if(property.hasOwnProperty(prop)){self.set(prop,property[prop],silent)}}}else{if(type=="string"){if(customSetters.hasOwnProperty(property)){customSetters[property].call(self,value)}else{self[property]=value}}}if(!silent){self.trigger("change");if($.type(property)=="string"){self.trigger("change."+property)}}};Model.prototype.unset=function(property){var self=this;if(self.has(property)){delete self[property]}};return Model})(jQuery,orion.util.PubSub);BBV.namespace("orion.util.mvc").View=orion.util.mvc.View||(function($,PubSub){function View(model){PubSub.call(this);this.model=model}orion.util.inherits(View,PubSub);View.prototype.render=function(){};return View})(jQuery,orion.util.PubSub);
BBV.namespace("orion.util").mediamethods=orion.util.mediamethods||(function($){function parseCategory(catID){var category=BBV.settings.i18n.genreMap[catID]||{title:null};return category.title}var mediamethods={buildCategoryUrl:function(genre){var self=this;var url=[genre];if(self.medium){var byMedium=self.medium.toLowerCase();if(self.isMyPrime()){byMedium="myprime"}else{if(self.isTVMissed()){byMedium="tvmissed"}else{byMedium="ondemand"}}url.unshift(BBV.settings.site.urls.category[byMedium])}return url.join("")},buildOtherMoviesUrl:function(){var mediaItem=this.mediaItem?this.mediaItem:this;var url=orion.oesp.routes.mediagroups+"?byCategoryIds="+mediaItem.getCategoriesIds()+"&sort=playCount30|desc&byHasCurrentVod=true&range=2-6";if(mediaItem.isTV()){url=orion.oesp.routes.mediaitems+"?byCategoryIds="+mediaItem.getCategoriesIds()+"&sort=playCount30|desc&range=2-6"}if(mediaItem.isAdult){url+="&includeAdult=true"}return url},buildMediaUrl:function(){return orion.oesp.res.Media.prototype.buildMediaUrl.call(this)},isReplayTvAvailable:function(){return this.replayTvAvailable},isTVOD:function(){return orion.oesp.res.Media.prototype.isTVOD.call(this)},isSVOD:function(){return orion.oesp.res.Media.prototype.isSVOD.call(this)},encodeTitle:function(title_){var title=title_||this.title;title=title.replace(/ /g,"-").replace(/\//g,"~");return encodeURI(title)},truncatedTitle:function(){if(this.imageType==="boxart-small"&&this.title.length>=18){return this.title.substring(0,15)+"..."}else{return this.title}},formatLength:function(){return orion.oesp.res.Media.prototype.formatLength.call(this)},formatLengthNoSeconds:function(){return this.formatLength()},getImg:function(){var images=this.images,imgType=this.imageType||"",imgStyle=imgType.split("-")[0],imgSize=imgType.split("-")[1],img="";BBV.each(images,function(idx,itm){if(itm.assetType===imgStyle+"-"+imgSize){img=itm.url;return false}});return img},getBoxArtSmall:function(){var images=this.images,img="";BBV.each(images,function(idx,itm){if(itm.assetType==="boxart-small"){img=itm.url;return false}});return img},getBoxArtMedium:function(){var images=(this.program)?this.program.images:this.images,img="";BBV.each(images,function(idx,itm){if(itm.assetType==="boxart-medium"){img=itm.url;return false}});return img},getBoxArtLarge:function(){var images=(this.program)?this.program.images:this.images,img="";BBV.each(images,function(idx,itm){if(itm.assetType==="boxart-large"){img=itm.url;return false}});return img},getStillArtMedium:function(){var images=this.images,img="";BBV.each(images,function(idx,itm){if(itm.assetType==="still-medium"){img=itm.url;return false}});return img},getChildMedias:function(){var media=this.currentChildMediaTypeCounts,display=[],itm=[];BBV.each(media,function(name,value){i18nName=value>1?name.replace(" ","")+"Plural":name.replace(" ","");mediaType=BBV.settings.i18n.mediaType[i18nName];itm.push(value+" ");itm.push(mediaType);display.push(itm.join(""));itm=[]});return display.join(", ")},getMedium:function(){i18nName=value>1?this.medium+"Plural":this.medium;return BBV.settings.i18n.medium[i18nName]},getGenre:function(){return orion.oesp.res.Media.prototype.getGenre.call(this)},getFormattedDate:function(){return orion.oesp.res.Media.prototype.getFormattedDate.call(this)},getFormattedAirDate:function(){var airDate=this.startTime;return airDate==null?"":BBV.utils.date(parseInt(airDate)).format(BBV.settings.l10n.date.shortformat)},getFormattedProductExpirationDate:function(){var expirationDate=this.productExpirationDate;return BBV.utils.date(parseInt(expirationDate)).format(BBV.settings.l10n.date.expirationformat)},getFormattedPlaylistExpirationDate:function(){var maxDays=15,oneDay=24*60*60*1000,today=new Date().getTime(),future=today+(maxDays*oneDay);return this.expirationDate&&this.expirationDate>today&&this.expirationDate<future?BBV.utils.date(parseInt(this.expirationDate)).format(BBV.settings.l10n.date.shortformat):false},getEarliestBroadcastDate:function(){var broadcastDate=this.earliestBroadcastStartTime;return broadcastDate==null?"":BBV.utils.date(parseInt(broadcastDate)).format(BBV.settings.l10n.date.shortformat)},getLatestBroadcastDate:function(){var broadcastDate=this.latestBroadcastStartTime;return broadcastDate==null?"":BBV.utils.date(parseInt(broadcastDate)).format(BBV.settings.l10n.date.shortformat)},getCategoriesIds:function(){var categories=[];for(i=0;i<this.categories.length;i++){categories.push(this.categories[i].id)}return(categories&&categories.length)?categories.join("|"):""},getCurrency:function(){return BBV.settings.currency.symbol},getDuration:function(){function addZero(digits){return digits<10?"0"+digits:digits}var endTime=parseInt(this.endTime),startTime=parseInt(this.startTime),duration=endTime-startTime,hour=60*60*1000,minute=60*1000,H=Math.floor(duration/hour),M=Math.floor((duration-(H*hour))/minute),durationFormatted=addZero(H)+":"+addZero(M);return durationFormatted},getTrailerId:function(){var id="";BBV.each(this,function(idx,itm){if(itm.mediaType==="Trailer"||itm.mediaType==="Preview"){id=itm.id}});return id},getThumb:function(){var img=this.images,art="";BBV.each(img,function(idx,itm){if(itm.assetType==="still-small"){art=itm.url}});return art},getYear:function(){return orion.oesp.res.Media.prototype.getYear.call(this)},hasCategories:function(){return(this.categories&&this.categories.length)?this.categories.length:0},hasChildMedia:function(){return(this.currentChildMediaTypeCounts&&(this.currentChildMediaTypeCounts.Clip||this.currentChildMediaTypeCounts.Episode||this.currentChildMediaTypeCounts.FeatureFilm))?1:0},hasParentalRating:function(){return(this.parentalRating||this.groupParentalRating)},highestParentalRating:function(){return this.parentalRating?this.parentalRating:this.groupParentalRating},inPlaylist:function(){if(!this.id){return false}var playlistIds=[];$("#playlist .grid-view .media-item").each(function(index,mediaItem){playlistIds.push($(mediaItem).data("media-id").toString())});return BBV.inArray(this.id.toString(),playlistIds)==-1?false:true},isEpisode:function(){return(this.mediaType==="Episode")},isMediaGroup:function(){return orion.oesp.res.Media.prototype.isMediaGroup.call(this)},isMovie:function(){return(this.medium==="Movie")},isMovieItem:function(){return(this.medium==="Movie"&&!BBV.isObj(this.currentChildMediaTypeCounts))},isPlayable:function(){var self=this;return !self.isMediaGroup()||self.medium&&self.medium.toLowerCase()==="movie"},isTV:function(){return(this.medium==="TV")},isTVMissed:function(){return orion.oesp.res.Media.prototype.isTVMissed.call(this)},isMyPrime:function(){return orion.oesp.res.Media.prototype.isMyPrime.call(this)},isExpandable:function(){return this.index>=3},isFirstItem:function(){return this.index==0},isLastItem:function(){return this.index==this.length-1},hiddenStart:function(){return this.index==3?'<div class="hidden-items">':""},hiddenEnd:function(){var lastItem=this.length<4?4:this.length;return this.index==lastItem-1?"</div>":""},lowerCase:function(){return function(text){if(this[text]){return this[text].toLowerCase()}else{return this[text]}}},localizeText:function(){return function(text){return" "+this.localStrings[text]+" "}},hasVodType:function(vodType){return orion.oesp.res.Media.prototype.hasVodType.call(this,vodType)}};return mediamethods})(jQuery);
BBV.namespace("orion.util").MediaTemplate=orion.util.MediaTemplate||(function($){function MediaTemplate(){}MediaTemplate.prototype.formatData=function(data,options){var self=this;var items=[];var mediaType="mediaItems";if(data.mediaGroups){mediaType="mediaGroups"}else{if(data.results){mediaType="results"}}var item,media;if(!$.isArray(data[mediaType])){data[mediaType]=data}options=$.extend({imgType:"boxart-large"},options);self.templateProperties=options;if(!data[mediaType].length){return[]}orion.oesp.session.done(function(session){for(i=0;i<data[mediaType].length;i++){item=data[mediaType][i];if(mediaType==="mediaGroups"){media=new orion.oesp.res.MediaGroup(item,session)}else{if(mediaType==="results"){if(item.listing&&item.listing.program){media=new orion.oesp.res.Listing(item.listing,session);media.isListing=true}else{if(item.vod&&item.vod.mediaGroup){media=new orion.oesp.res.MediaGroup(item.vod.mediaGroup,session)}else{media=null}}}else{media=new orion.oesp.res.MediaItem(item,session)}}if(media){$.extend(media,options);items.push(media)}}});return items};MediaTemplate.prototype.getMarkup=function(media,options){var self=this;var template,data,partials;var disabledHover=options.disabledHover?options.disabledHover:false;if(options&&options.template){template=options.template}else{template="MediaGrid"}data=$.extend({items:media,type:template},options,self.templateProperties);partials=this.getPartials(template,disabledHover);return Mustache.to_html(orion.templates[template],data,partials)};MediaTemplate.prototype.getPartials=function(template,disabledHover){switch(template){case"MediaGrid":return{ProgramGridItem:orion.templates.ProgramGridItem,MediaGridMovieItem:orion.templates.MediaGridMovieItem,MediaGridSeriesItem:orion.templates.MediaGridSeriesItem,MediaGridReplayItem:orion.templates.ProgramGridItem,MediaGridMissedItem:orion.templates.MediaGridMissedItem};case"MediaList":return{MediaListItem:orion.templates.MediaListItem};case"Playlist":return{PlaylistEmpty:orion.templates.PlaylistEmpty,PlaylistFull:orion.templates.PlaylistFull,Media:orion.templates.Media,PlaylistMediaGrid:orion.templates.PlaylistMediaGrid,MediaGridItem:orion.templates.MediaGridItem,MediaGridItemHoverOff:orion.templates.MediaGridItemHoverOff,MediaGridItemHoverOn:disabledHover?"":orion.templates.MediaGridItemHoverOn,MediaList:orion.templates.MediaList,MediaListItem:orion.templates.MediaListItem};default:return{Media:orion.templates.Media,MediaGridWithHover:orion.templates.MediaGridWithHover,MediaGridItem:orion.templates.MediaGridItem,MediaGridItemHoverOff:orion.templates.MediaGridItemHoverOff,MediaGridItemHoverOn:disabledHover?"":orion.templates.MediaGridItemHoverOn,MediaList:orion.templates.MediaList,MediaListItem:orion.templates.MediaListItem}}};return MediaTemplate})(jQuery);
BBV.namespace("orion.util").modules=orion.util.modules||(function($){var modules={};modules.getHash=function(event){var elem=event.target;var $elem=$(elem).closest("a");return $elem.get(0).hash};modules.toggleView=function($container,hash){var $elem=$container.find('a[href="'+hash+'"]');var viewClass=hash.replace("#",".");var $links,$lists;$links=$container.find(".view-toggle").not(".medium-toggle");$lists=$container.find(".content-list");$lists.children("ul").hide();$lists.children(viewClass).show();$links.find(".active").removeClass("active");$elem.addClass("active")};return modules})(jQuery);
(function($,window,undefined){window.facebook=$.Deferred();window.fbAsyncInit=function(){FB.init({appId:BBV.settings.facebook.appId,channelURL:BBV.settings.currentDomain+"/etc/designs/orion/upc/js/lib/fb/channel.html",status:true,cookie:true,oauth:true,xfbml:true});FB.Event.subscribe("auth.login",function(response){});FB.Event.subscribe("auth.logout",function(response){});FB.Event.subscribe("edge.create",function(targetUrl){});FB.Event.subscribe("edge.remove",function(targetUrl){});FB.Event.subscribe("comment.create",function(commentDetail){});FB.Event.subscribe("comment.remove",function(commentDetail){});FB.Event.subscribe("message.send",function(targetUrl){});log("fbAsyncInit: facebook API is ready");window.facebook.resolve()};window.facebook.promise()})(jQuery,window);(function(d){var js,id="facebook-jssdk";if(d.getElementById(id)){return}js=d.createElement("script");js.id=id;js.async=true;js.src="//connect.facebook.net/"+BBV.settings.facebook.facebookLocale+"/all.js";d.getElementsByTagName("head")[0].appendChild(js)}(document));window.facebook.parse=function(elem){facebook.done(function(){FB.XFBML.parse(elem)})};
BBV.namespace("orion.util").url=orion.util.url||(function($){var url={};url.queryToObj=function(url){var retObj={},urlParts,query,pairs,pair,i;if(typeof url!=="string"){return retObj}urlParts=/^([^?#]*)(\?[^#]*)?(\#.*)?$/i.exec(url);if(urlParts.length>2){query=urlParts[2]}if(query){query=query.slice(1);pairs=query.split("&");for(i=0;i<pairs.length;i++){pair=pairs[i].split("=");retObj[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])||""}}return retObj};url.readUrlString=function(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}};url.parseParam=function(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj};url.getParam=function(url,key){var query=this.queryToObj(url);return query[key]||""};url.setParam=function(url,key,value){var urlParts,query,queryIndex,hashIndex,before,after,queryString,k;if(typeof url!=="string"){return""}urlParts=/^([^?#]*)(\?[^#]*)?(\#.*)?$/i.exec(url);before=urlParts[1]||"";after=urlParts[3]||"";query=this.queryToObj(url);query[key]=value;beforeUrlQuery=url.substring(0,queryIndex);afterUrlQuery=url.substring(hashIndex,url.length);queryString="?";for(k in query){if(query.hasOwnProperty(k)){if(queryString.length>1){queryString+="&"}queryString+=k+"="+query[k]}}return before+queryString+after};url.fixedEncodeURIComponent=function(str){return encodeURIComponent(str).replace(/[']/g,"%27").replace(/[#]/g,"%23")};url.fixedOESPURL=function(originURI){var fixedURL=originURI;var isOESPURL=originURI.indexOf("/web/")>-1;var isAbsolute=new RegExp("^(?:[a-z]+:)?//","i");if(isOESPURL&&!isAbsolute.test(originURI)){var apiPathPrefix="/oesp/api";var hasAPIPrefix=originURI.substring(0,apiPathPrefix.length)===apiPathPrefix;if(hasAPIPrefix){fixedURL=BBV.settings.api.urls.ajaxBase+originURI.substring(apiPathPrefix.length)}else{fixedURL=BBV.settings.api.urls.ajaxBase+originURI}}return fixedURL};return url})(jQuery);
BBV.namespace("orion.util").analytics=orion.util.analytics||(function($){analytics.set={loginStatus:function(session){if(window.analytics.vars.loginStatus!==""){return}window.analytics.vars.loginStatus=typeof(session.customer)==="object";return window.analytics.vars.loginStatus},customerId:function(session){if(window.analytics.vars.customerId!==""){return}window.analytics.vars.customerId=session.trackingId;return window.analytics.vars.customerId},username:function(session){if(window.analytics.vars.username!==""){return}window.analytics.vars.username=session.username;return window.analytics.vars.username},deviceCode:function(session){if(window.analytics.vars.deviceCode!==""){return}window.analytics.vars.deviceCode=session.deviceCode;return window.analytics.vars.deviceCode},stbType:function(session){if(window.analytics.vars.stbType!==""){return}window.analytics.vars.stbType=session.customer?session.customer.stbType:undefined;return window.analytics.vars.stbType},productString:function(productString){if(window.analytics.vars.productString!==""){return}window.analytics.vars.productString=productString;return window.analytics.vars.productString},offerId:function(offerId){if(window.analytics.vars.offerId!==""){return}window.analytics.vars.offerId=offerId;return window.analytics.vars.offerId},mediaGroupName:function(mediaGroupName){if(window.analytics.vars.mediaGroupName!==""){return}window.analytics.vars.mediaGroupName=mediaGroupName;return window.analytics.vars.mediaGroupName},mediaGroupID:function(mediaGroupID){if(window.analytics.vars.mediaGroupID!==""){return}window.analytics.vars.mediaGroupID=unescape(mediaGroupID.replace(/~~2F/g,"/"));return window.analytics.vars.mediaGroupID},mediaItemID:function(mediaItemID){if(window.analytics.vars.mediaItemID!==""){return}window.analytics.vars.mediaItemID=unescape(mediaItemID.replace(/~~2F/g,"/"));return window.analytics.vars.mediaItemID},mediaItemTitle:function(mediaItemTitle){if(window.analytics.vars.mediaItemTitle!==""){return}window.analytics.vars.mediaItemTitle=mediaItemTitle;return window.analytics.vars.mediaItemTitle},mediaProviderId:function(mediaProviderId){if(window.analytics.vars.mediaProviderId!==""){return}window.analytics.vars.mediaProviderId=mediaProviderId;return window.analytics.vars.mediaProviderId},mediaCategoriesId:function(mediaCategoriesId){if(window.analytics.vars.mediaCategoriesId!==""){return}window.analytics.vars.mediaCategoriesId=mediaCategoriesId;return window.analytics.vars.mediaCategoriesId},mediaCategoriesTitle:function(mediaCategoriesTitle){if(window.analytics.vars.mediaCategoriesTitle!==""){return}window.analytics.vars.mediaCategoriesTitle=mediaCategoriesTitle;return window.analytics.vars.mediaCategoriesTitle},mediaVodType:function(mediaVodType){if(window.analytics.vars.mediaVodType!==""){return}window.analytics.vars.mediaVodType=mediaVodType;return window.analytics.vars.mediaVodType},mediaSeasonNumber:function(mediaSeasonNumber){if(window.analytics.vars.mediaSeasonNumber!==""){return}window.analytics.vars.mediaSeasonNumber=mediaSeasonNumber;return window.analytics.vars.mediaSeasonNumber},mediaSeasonEpisodeNumber:function(mediaSeasonEpisodeNumber){if(window.analytics.vars.mediaSeasonEpisodeNumber!==""){return}window.analytics.vars.mediaSeasonEpisodeNumber=mediaSeasonEpisodeNumber;return window.analytics.vars.mediaSeasonEpisodeNumber},mediaSeriesEpisodeNumber:function(mediaSeriesEpisodeNumber){if(window.analytics.vars.mediaSeriesEpisodeNumber!==""){return}window.analytics.vars.mediaSeriesEpisodeNumber=mediaSeriesEpisodeNumber;return window.analytics.vars.mediaSeriesEpisodeNumber},mediaGroupProviderId:function(mediaGroupProviderId){if(window.analytics.vars.mediaGroupProviderId!==""){return}window.analytics.vars.mediaGroupProviderId=mediaGroupProviderId;return window.analytics.vars.mediaGroupProviderId},mediaGroupTitle:function(mediaGroupTitle){if(window.analytics.vars.mediaGroupTitle!==""){return}window.analytics.vars.mediaGroupTitle=mediaGroupTitle;return window.analytics.vars.mediaGroupTitle},mediaGroupCategoriesId:function(mediaGroupCategoriesId){if(window.analytics.vars.mediaGroupCategoriesId!==""){return}window.analytics.vars.mediaGroupCategoriesId=mediaGroupCategoriesId;return window.analytics.vars.mediaGroupCategoriesId},mediaGroupCategoriesTitle:function(mediaGroupCategoriesTitle){if(window.analytics.vars.mediaGroupCategoriesTitle!==""){return}window.analytics.vars.mediaGroupCategoriesTitle=mediaGroupCategoriesTitle;return window.analytics.vars.mediaGroupCategoriesTitle},channelId:function(channelId){if(window.analytics.vars.channelId!==""){return}window.analytics.vars.channelId=channelId;return window.analytics.vars.channelId},channelName:function(channelName){if(window.analytics.vars.channelName!==""){return}window.analytics.vars.channelName=channelName;return window.analytics.vars.channelName}};analytics.setUserVars=function(session){var analytics=orion.util.analytics;analytics.set.loginStatus(session);analytics.set.customerId(session);analytics.set.username(session);analytics.set.deviceCode(session);analytics.set.stbType(session)};analytics.trackEvent=function(type,options){if(window.s&&type==="action"){s.record(options)}};analytics.prototype.handlers=function(e){var self=this;var $analyticsContext=$('[data-module-type="ContentDiscovery"], [data-module-type="ASpot"], [data-module-type="Playlist"], [data-module-type="Recommendations"], [data-module-type="MyRentals"], #dialog-container');$analyticsContext.delegate(".content-list a[href]","click",self.updateQueryString)};analytics.prototype.updateQueryString=function(e){var self=this;var $elem=$(e.target).closest("a");var target=$elem.attr("href");var delimeter=orion.util.url.readUrlString(target).query?"&":"?";var $container=$elem.closest(".dialog").length?$elem.closest(".dialog"):$elem.closest(".module");var id=$elem.closest(".dialog").length?$container.attr("id"):$container.data("module-type");var actionElement=$container.find("header h1").length?"&actionElement="+encodeURIComponent($container.find("header h1").text()):"";var newHref=target+delimeter+"previousAction="+id+actionElement;$elem.attr("href",newHref)};analytics.prototype.triggerQueue=function(e){if(!window.analyticsQueue){return}$.each(window.analyticsQueue,function(){(window.analyticsQueue.shift())()})};function analytics(){var self=this;if(!window.analytics){window.analytics={vars:{}}}else{if(!window.analytics.vars){window.analytics.vars={}}}window.analytics.vars={loginStatus:"",customerId:"",username:"",deviceCode:"",stbType:"",productString:"",offerId:"",mediaGroupName:"",mediaGroupID:"",mediaItemID:"",mediaItemTitle:"",mediaProviderId:"",mediaCategoriesId:"",mediaCategoriesTitle:"",mediaVodType:"",mediaSeasonNumber:"",mediaSeasonEpisodeNumber:"",mediaSeriesEpisodeNumber:"",mediaGroupProviderId:"",mediaGroupTitle:"",mediaGroupCategoriesId:"",mediaGroupCategoriesTitle:"",channelId:"",channelName:""};self.handlers();self.triggerQueue();return self}return analytics})(jQuery);
BBV.namespace("orion.util").AdultAdapter=orion.util.AdultAdapter||(function($){var PIN_DIALOG="pin-verification";var PIN_VERIFIED="pinVerified";var LOGIN_DIALOG="login";var BOXART_MEDIUM="boxart-medium";AdultAdapter.showAdultDialogs=function(onVerified,onCanceled){orion.oesp.session.done(function(session){var loginDialog;var pinDialog;var pinType;var canceledHandler=onCanceled||BBV.noop;if(session.isAuthenticated()){if(session.hasAdultCredential||session.hasAdultCredential===undefined){pinType="adultPin"}else{pinType="adultPinNotRegistered"}pinDialog=orion.app.dialogManager.getDialog("pin-verification");pinDialog.showDialog(pinType);pinDialog.onVerified(function(){pinDialog.close();onVerified()});pinDialog.onCanceled(function(){canceledHandler()})}else{loginDialog=orion.app.dialogManager.getDialog("login");loginDialog.centerOn(window);loginDialog.show();loginDialog.onCanceled(function(){canceledHandler()});orion.app.once("loggedIn",function(){AdultAdapter.showAdultDialogs(onVerified,canceledHandler)})}})};var $sections;var sectionDataHistory;AdultAdapter.prototype.renderTitle=function(elem,item){elem.prepend(item.title)};AdultAdapter.prototype.renderSeasonEpisodeNumber=function(elem,item){elem.text(item.seasonEpisodeNumber)};AdultAdapter.prototype.renderSeasonNumber=function(elem,item){elem.text(item.seasonNumber)};AdultAdapter.prototype.renderSecondaryTitle=function(elem,item){elem.text("&ldquo;"+item.secondaryTitle+"&rdquo;")};AdultAdapter.prototype.renderStillMedium=function(elem,item){var $img=$("<img />");var $placeholder=elem.find(".placeholder");$.each(item.images,function(index,image){if(image.assetType==BOXART_MEDIUM){$img.attr({src:image.url,width:image.width,height:image.height,alt:item.title});elem.prepend($img);$placeholder.hide();return}})};AdultAdapter.prototype.renderPreviewLink=function(elem,item){log("AdultAdapter.renderPreviewLink -> stub")};AdultAdapter.prototype.renderFacebookLike=function(elem,item){elem.attr({"data-asset-name":item.title})};AdultAdapter.prototype.renderDescription=function(elem,item){elem.text(item.description)};function unique(arr){var a=arr.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j,1)}}}return a}function AdultAdapter(){this.initialize()}AdultAdapter.prototype.initialize=function(){var self=this;$sections=$(document).find("[data-adult-section]");sectionDataHistory={};$.each($sections,function(index,section){var sectionType=$(section).data("adult-section");var sectionId;var sectionToRequest;if(sectionType=="media-item-id"){sectionId=$(section).data("media-id");self.requestSectionData(sectionId,section,orion.oesp.mediaItemEndpoint.requestMediaItem)}else{sectionId=$(section).data("group-id");self.requestSectionData(sectionId,section,orion.oesp.mediaGroupEndpoint.requestFormattedMediaGroup)}})};AdultAdapter.prototype.requestSectionData=function(id,section,method){var self=this;if(sectionDataHistory[id]!=undefined){$.when(orion.oesp.session).done(function(session){if(self.hasPermission(session)){self.render(session,sectionDataHistory[id],section)}})}else{$.when(orion.oesp.session,method(id)).done(function(session,data){if(self.hasPermission(session)){sectionDataHistory[id]=data;self.render(session,data,section)}})}};AdultAdapter.prototype.hasPermission=function(session){var loginDialog;var pinType,pinDialog;if(session.isAuthenticated()){if(!session.isAdultPinVerified(true)){return false}}else{loginDialog=orion.app.dialogManager.getDialog(LOGIN_DIALOG);loginDialog.centerOn(window);loginDialog.show();return false}return true};AdultAdapter.prototype.render=function(session,item,section){var self=this;var elements=$(section).find("[data-adult]");$.each(elements,function(index,element){var $element=$(element);var type=$element.data("adult");type=type[0].toUpperCase()+type.slice(1);var method="render"+type.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()});if(self[method]&&typeof self[method]=="function"){self[method]($element,item)}else{log("AdultAdapter.render -> method: "+method);log("AdultAdapter.render -> does not exist")}})};return AdultAdapter})(jQuery);
BBV.namespace("orion.util").time=orion.util.time||(function($){var time={};time.timeFrameInMilliseconds=function(amount,type){var multiplier=0;switch(type){case"seconds":multiplier=1000;break;case"minutes":multiplier=60000;break;case"hours":multiplier=3600000;break;case"days":multiplier=86400000;break;case"weeks":multiplier=604800000;break;default:multiplier=1;break}return amount*multiplier};time.roundTo30Minutes=function(date){date=date||new Date();date.setMinutes(Math.floor(date.getMinutes()/30)*30);date.setSeconds(0);date.setMilliseconds(0);return date};time.addTime=function(date,amount,type){return new Date(date.getTime()+time.timeFrameInMilliseconds(amount,type))};time.roundDate=function(dateTime,type,minutes){var coeff=1000*60*minutes;var types={round:true,floor:true,ceil:true};var roundType=types[type]&&type||"round";return new Date(Math[roundType](dateTime.getTime()/coeff)*coeff).getTime()};return time}(jQuery));

BBV.namespace("orion.templates").CardListings=orion.templates.CardListings||(function(){var t=[];t.push("<ul>");t.push("{{#listings}}");t.push("{{#isNewDate}}");t.push('<li class="date">{{getFormattedDate}}</li>');t.push("{{/isNewDate}}");t.push('<li class="listing" data-id="{{listingId}}" >');t.push('<span class="asset-details">');t.push('<span class="time">{{getFormattedStartTime}}</span>');t.push("<div>");t.push('<span class="title">{{title}}</span>');t.push('{{#rating}}<span class="rating">{{{ratedLabel}}} <span class="age-rating"><span class="rating-wrap">{{rating}}</span></span>{{/rating}}</span>');t.push("</div>");t.push("</span>");t.push('<div class="program-details-wrap" >');t.push('<div class="program-details">');t.push("{{#getBoxArtMedium}}");t.push('<div class="media" class="boxart-medium">');t.push('<img src="{{getBoxArtMedium}}" alt="{{title}}" />');t.push("</div>");t.push("{{/getBoxArtMedium}}");t.push('<div class="details">');t.push('<div class="description">');t.push("{{#secondaryTitle}}");t.push('<h4>"{{secondaryTitle}}"</h4>');t.push("{{/secondaryTitle}}");t.push('<p class="season">{{#seasonNumber}}{{#localizeText}}season{{/localizeText}} {{seasonNumber}}{{/seasonNumber}}{{#seasonEpisodeNumber}} : {{#localizeText}}episode{{/localizeText}} {{seasonEpisodeNumber}}{{/seasonEpisodeNumber}}</p>');t.push('<p class="channel-details">{{stationTitle}}, {{getFormattedTime}}</p>');t.push('<p class="info">{{description}}</p>');t.push("</div>");t.push('<div class="cta-link"><a href="{{upcomingLink}}#tv">{{#localizeText}}upcoming{{/localizeText}}</a></div>');t.push('<div class="cta-link"><a href="{{upcomingLink}}#tv">{{#localizeText}}viewAll{{/localizeText}}</a></div>');t.push("</div>");t.push("{{#checkIfLiveStream}}");t.push('<div class="watch-live">');t.push('<span class="button margin-fix">');t.push('<a href="#">Watch Live</a>');t.push("</span>");t.push("</div>");t.push("{{/checkIfLiveStream}}");t.push("</div>");t.push("</div>");t.push("</li>");t.push("{{/listings}}");t.push("{{^listings}}");t.push('<li class="listing tba">');t.push('<span class="asset-details">');t.push('<span class="title">TBA</span>');t.push("</span>");t.push("</li>");t.push("{{/listings}}");t.push("</ul>");return t.join("")})();
BBV.namespace("orion.templates").DatePicker=orion.templates.DatePicker||(function(){var DatePicker='<ol>{{#dates}}<li><a class="calendday" href="#" data-value="{{value}}">{{display}}</a></li>{{/dates}}</ol>';return DatePicker})();
BBV.namespace("orion.templates").Dialog=orion.templates.Dialog||(function(){var t=[];t.push('<div class="dialog {{dialogTypeClass}}">');t.push('<div class="dialog-inner">');t.push('<div class="dialog-content"></div>');t.push('<a href="#" class="close-dialog"></a>');t.push("</div>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").ActionBar=orion.templates.ActionBar||(function(){return['<div class="action-bar">',"<ul>","{{#buttons}}",'<li class="action-bar-item">','<a href="{{#id}}{{id}}{{/id}}{{^id}}#{{/id}}"','class="btn {{title}}-btn {{#active}}active{{/active}}{{#status}} {{name}}-{{status}}{{/status}}"','data-name="{{name}}" data-role="button"','{{#hidden}}style="display: none;"{{/hidden}}','{{#disabled}}disabled="disabled"{{/disabled}}',">",'<span class="icon {{title}}-icon"></span>',"{{#text}}",'<span class="btn-inner-text">',"{{#active}}{{textActive}}{{/active}}","{{^active}}{{text}}{{/active}}</span>","{{/text}}","</a>","</li>","{{/buttons}}","</ul>","</div>"].join("")})();
BBV.namespace("orion.templates").EPGListSummary=orion.templates.EPGListSummary||(function(){var t=[];t.push('<dl class="channel-listing{{#isLive}} live{{/isLive}}{{#station.isHd}} hd{{/station.isHd}}{{#isOOH}} ooh{{/isOOH}}" id="station-{{station.id}}" data-channel-id="{{id}}" data-station-id="{{station.id}}" data-sort="{{channelNumber}}" data-channel-name="{{station.title}}">');t.push('<dt class="network">');t.push('<span class="channel-number">{{channelNumber}}</span>');t.push("{{#images.inactive}}");t.push('<a class="logo-inactive" href="{{URL}}"><img src="{{images.inactive}}" alt="{{station.title}}" /></a>');t.push('<a class="logo-active" href="{{URL}}"><img src="{{images.active}}" alt="{{station.title}}" /></a>');t.push("{{/images.inactive}}");t.push("{{^images.inactive}}");t.push('<a class="logo-inactive" href="{{URL}}">{{station.title}}</a>');t.push('<a class="logo-active" href="{{URL}}">{{station.title}}</a>');t.push("{{/images.inactive}}");t.push('<div class="labels">');t.push('<span class="live-indicator"></span>');t.push('<span class="ooh-indicator"></span>');t.push("</div>");t.push("</dt>");t.push('<dd class="listings">');t.push("<ol>");t.push("{{#listings}}");t.push("{{#width}}");t.push('<li class="listing" style="width: {{width}}px;" data-station-id="{{stationId}}" data-listing-id="{{id}}" data-categories="{{categoryId}}">');t.push('<span class="asset-details{{#short}} short{{/short}}">');t.push('<span class="title">{{title}}</span>');t.push('<div class="notifications">');t.push('{{#replayTv}}<span class="icon replay">{{{i18n.replayButtonText}}}</span>{{/replayTv}}');t.push("{{#rbIsEntitled}}");t.push('<span data-name="recordings" class="watch btn-record record"><a href="#">');t.push('<span class="b-icon record-icon"></span>');t.push("</a></span>");t.push("{{/rbIsEntitled}}");t.push("</div>");t.push("</span>");t.push("</li>");t.push("{{/width}}");t.push("{{/listings}}");t.push("</ol>");t.push("</dd>");t.push("</dl>");return t.join("")})();
BBV.namespace("orion.templates").EPGListDetails=orion.templates.EPGListDetails||(function(){var t=[];t.push('<div class="program-details-wrap{{#isStarted}} started{{/isStarted}}{{#isEnded}} ended{{/isEnded}}" data-imi="{{imi}}" data-channel-name="{{channelTitle}}" data-channel-id="{{channelId}}" data-listing-id="{{program.id}}-{{imi}}">');t.push('<span class="close-details"></span>');t.push('<div class="program-details{{#isLocked}} locked{{/isLocked}}">');t.push("{{#boxArtMedium}}");t.push('<div class="media" class="boxart-medium has-img">');t.push('<a href="{{getListingUrl}}"><img src="{{boxArtMedium}}" alt="{{program.title}}" /></a>');t.push("</div>");t.push("{{/boxArtMedium}}");t.push('<div class="details">');t.push('<div class="description">');t.push("{{#channelOrRbIsEntitled}}");t.push('<div class="user-functionality btn-group-vertical">');t.push("{{#channelIsEntitled}}{{#isLiveStream}}");t.push('<span class="button play watch-now"><a href="{{URL}}">');t.push('<span class="b-icon play-icon"></span>{{{i18n.watchNow}}}');t.push("</a></span>");t.push("{{/isLiveStream}}{{/channelIsEntitled}}");t.push('{{#replayTV}}<span class="button replayTv"><a href="{{URL}}/{{startTime}}">{{{i18n.replayButtonText}}}</a></span>{{/replayTV}}');t.push("{{#rbIsEntitled}}");t.push('<span data-name="recordings" class="button watch btn-record record"><a href="#">');t.push('<span class="b-icon record-icon"></span>');t.push('<span class="record-text">{{{i18n.recordButton}}}</span>');t.push('<span class="record-recording-text">{{{i18n.recordSet}}}</span>');t.push('<span class="record-failed-text">{{{i18n.recordFailed}}}</span>');t.push('<span class="record-pending-text">{{{i18n.recordPending}}}</span>');t.push("</a></span>");t.push("{{/rbIsEntitled}}");t.push("</div>");t.push("{{/channelOrRbIsEntitled}}");t.push('<h3><a href="{{getListingUrl}}">{{program.title}}</a></h3>');t.push("{{#program.secondaryTitle}}<h4>{{program.secondaryTitle}}</h4>{{/program.secondaryTitle}}");t.push('{{#program.seasonNumber}}<p class="season">{{{i18n.season}}} {{program.seasonNumber}}{{#program.seasonEpisodeNumber}} : {{{i18n.episode}}} {{program.seasonEpisodeNumber}}{{/program.seasonEpisodeNumber}}</p>{{/program.seasonNumber}}');t.push('<p class="channel-details">{{channelTitle}}, {{time}}</p>');t.push("<p>{{program.longDescription}}</p>");t.push("</div>");t.push('<div class="cta-link"><a href="{{upcomingLink}}#tv">{{{i18n.upcoming}}}</a></div>');t.push("</div>");t.push("</div>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").Media=orion.templates.Media||(function(){return['<div class="content-list">',"{{>MediaGridWithHover}}","{{>MediaList}}","</div>"].join("")})();
BBV.namespace("orion.templates").MediaGrid=orion.templates.MediaGrid||(function(){return["{{^isItem}}",'<ul class="grid-view{{#isThumb}} thumbnails{{/isThumb}}" data-type="{{type}}">',"{{/isItem}}","{{#items}}","{{#isListing}}","{{>ProgramGridItem}}","{{/isListing}}","{{#isMovie}}","{{>MediaGridMovieItem}}","{{/isMovie}}","{{#isTV}}","{{^isTVMissed}}","{{>MediaGridSeriesItem}}","{{/isTVMissed}}","{{/isTV}}","{{#isReplayTV}}","{{>ProgramGridItem}}","{{/isReplayTV}}","{{#isTVMissed}}","{{>MediaGridMissedItem}}","{{/isTVMissed}}","{{/items}}","{{^isItem}}","</ul>","{{/isItem}}"].join("")})();
BBV.namespace("orion.templates").MediaGridWithHover=orion.templates.MediaGridWithHover||(function(){return["{{^isItem}}",'<ul class="grid-view{{#isThumb}} thumbnails{{/isThumb}}" data-type="{{type}}">',"{{/isItem}}","{{#items}}","{{>MediaGridItem}}","{{/items}}","{{^isItem}}","</ul>","{{/isItem}}"].join("")})();
BBV.namespace("orion.templates").PlaylistMediaGrid=orion.templates.PlaylistMediaGrid||(function(){return["{{^isItem}}",'<ul class="grid-view{{#isThumb}} thumbnails{{/isThumb}}" data-type="{{type}}">',"{{/isItem}}","{{#items}}","{{>MediaGridItem}}","{{/items}}","{{^isItem}}","</ul>","{{/isItem}}"].join("")})();
BBV.namespace("orion.templates").MediaGridItem=orion.templates.MediaGridItem||(function(){return['<li class="grid-item media-item{{#isMediaGroup}} media-group{{/isMediaGroup}}{{#inPlaylist}} in-playlist{{/inPlaylist}}{{#isPlayable}} playable{{/isPlayable}} {{#lowerCase}}medium{{/lowerCase}}" {{#isPlaylist}}id="playlist-grid-item-{{id}}"{{/isPlaylist}} data-media-id="{{id}}"','data-media-id="{{id}}">','<div class="hover-toggle">',"{{>MediaGridItemHoverOff}}","{{>MediaGridItemHoverOn}}","</div>","</li>"].join("")})();
BBV.namespace("orion.templates").MediaGridMovieItem=orion.templates.MediaGridMovieItem||(function(){return['<li class="grid-item media-item{{#isMediaGroup}} media-group{{/isMediaGroup}}{{#inPlaylist}} in-playlist{{/inPlaylist}}{{#isPlayable}} playable{{/isPlayable}} {{#lowerCase}}medium{{/lowerCase}}" {{#isPlaylist}}id="playlist-grid-item-{{id}}"{{/isPlaylist}} data-media-id="{{id}}"','data-media-id="{{id}}">','<div class="hover-toggle">','<div class="no-hover">','<div class="boxart-wrap">','<a class="{{imgType}}{{#getImg}} has-img{{/getImg}}" href="{{buildMediaUrl}}">',"{{#getImg}}",'<img src="{{getImg}}" alt="{{title}}" />',"{{/getImg}}","</a>","</div>","{{#title}}",'<h3 class="title">','<a title="{{{truncatedTitle}}}" href="{{buildMediaUrl}}">{{{truncatedTitle}}}</a>',"</h3>","{{/title}}","{{#hasCategories}}",'<div class="additional-media-info">',"{{{getMajorGenre}}}","{{#year}}","{{#getMajorGenre}}, {{/getMajorGenre}}({{year}})","{{/year}}","</div>","{{/hasCategories}}","</div>","</div>","</li>"].join("")})();
BBV.namespace("orion.templates").MediaGridSeriesItem=orion.templates.MediaGridSeriesItem||(function(){return['<li class="grid-item media-item{{#isMediaGroup}} media-group{{/isMediaGroup}}{{#inPlaylist}} in-playlist{{/inPlaylist}}{{#isPlayable}} playable{{/isPlayable}} {{#lowerCase}}medium{{/lowerCase}}" {{#isPlaylist}}id="playlist-grid-item-{{id}}"{{/isPlaylist}} data-media-id="{{id}}"','data-media-id="{{id}}">','<div class="hover-toggle">','<div class="no-hover">','<div class="boxart-wrap">','<a class="{{imgType}}{{#getImg}} has-img{{/getImg}}" href="{{buildMediaUrl}}">',"{{#getImg}}",'<img src="{{getImg}}" alt="{{title}}" />',"{{/getImg}}","</a>","</div>","{{#title}}",'<h3 class="title">','<a title="{{{truncatedTitle}}}" href="{{buildMediaUrl}}">{{{truncatedTitle}}}</a>',"</h3>","{{/title}}","{{#hasChildMedia}}",'<div class="additional-media-info">{{getEpisodesMedias}}</div>',"{{/hasChildMedia}}","</div>","</div>","</li>"].join("")})();
BBV.namespace("orion.templates").MediaGridMissedItem=orion.templates.MediaGridMissedItem||(function(){return['<li class="grid-item media-item{{#isMediaGroup}} media-group{{/isMediaGroup}}{{#inPlaylist}} in-playlist{{/inPlaylist}}{{#isPlayable}} playable{{/isPlayable}} {{#lowerCase}}medium{{/lowerCase}}" {{#isPlaylist}}id="playlist-grid-item-{{id}}"{{/isPlaylist}} data-media-id="{{id}}"','data-media-id="{{id}}">','<div class="hover-toggle">','<div class="no-hover">','<div class="boxart-wrap">','<a class="{{imgType}}{{#getImg}} has-img{{/getImg}}" href="{{buildMediaUrl}}">',"{{#getImg}}",'<img src="{{getImg}}" alt="{{title}}" />',"{{/getImg}}","</a>","</div>","{{#title}}",'<h3 class="title">','<a title="{{{truncatedTitle}}}" href="{{buildMediaUrl}}">{{{truncatedTitle}}}</a>',"</h3>","{{/title}}",'{{#getBroadcaster}}  <div class="additional-media-info">{{getBroadcaster}}</div>{{/getBroadcaster}}','{{#getLatestBroadcastTime}}<div class="additional-media-info">{{getLatestBroadcastTime}}</div>{{/getLatestBroadcastTime}}',"</div>","</div>","</li>"].join("")})();
BBV.namespace("orion.templates").ProgramGridItem=orion.templates.ProgramGridItem||(function(){return['<li class="grid-item media-item program data-media-id="{{id}}"','data-media-id="{{id}}">','<div class="no-hover postergrid programgrid">','<div class="boxart-wrap">','<a class="{{imgType}}{{#getBoxArtMedium}} has-img{{/getBoxArtMedium}}" href="{{buildMediaUrl}}">',"{{#getBoxArtMedium}}",'<img src="{{getBoxArtMedium}}" alt="{{title}}" />',"{{/getBoxArtMedium}}","</a>","</div>",'<h3 class="title">','<a title="{{{program.title}}}" href="{{buildMediaUrl}}">{{{truncatedTitle}}}</a>',"</h3>",'{{#getBroadcaster}}<div class="additional-media-info">{{getBroadcaster}}</div>{{/getBroadcaster}}','<div class="additional-media-info">{{getFormattedDateTime}}</div>',"</div>","</li>"].join("")})();
BBV.namespace("orion.templates").MediaGridItemHoverOff=orion.templates.MediaGridItemHoverOff||(function(){return['<div class="no-hover">','<div class="boxart-wrap">','<a class="{{imgType}}{{#getImg}} has-img{{/getImg}}" href="{{buildMediaUrl}}">',"{{#getImg}}",'<img src="{{getImg}}" alt="{{title}}" />',"{{/getImg}}","{{#isPlaylist}}",'<span class="order">{{order}}</span>',"{{/isPlaylist}}","</a>","</div>","{{#title}}",'<h3 class="title">','<a title="{{truncatedTitle}}" href="{{buildMediaUrl}}">{{truncatedTitle}}</a>',"</h3>",'{{#getLatestBroadcastTime}}<span class="broadcast-date">{{getLatestBroadcastTime}}</span>{{/getLatestBroadcastTime}}',"{{/title}}","{{#isMediaGroup}}","{{#hasChildMedia}}",'<span class="episode-info">',"{{getChildMedias}}","</span>","{{/hasChildMedia}}","{{#getFormattedDate}}",'<span class="release-date">',"{{getFormattedDate}}","</span>","{{/getFormattedDate}}","{{/isMediaGroup}}","{{^isBrowse}}",'{{#secondaryTitle}}<span class="secondary-title">"{{secondaryTitle}}"</span>{{/secondaryTitle}}',"{{#isMovie}}",'{{#year}}<span class="release-date">{{getYear}}</span>{{/year}}',"{{/isMovie}}","{{#isTVItem}}",'{{#hasEpisodeInfo}}<span class="episode-info">{{getFormattedEpisodeInfo}}</span>{{/hasEpisodeInfo}}',"{{/isTVItem}}","{{/isBrowse}}","{{#isMyRentals}}",'{{#isProductExpiring}}<span class="notification">{{{i18n.expiration}}}</span>{{/isProductExpiring}}',"<span>{{{i18n.availableUntil}}} {{getFormattedProductExpirationDate}}</span>","{{/isMyRentals}}","{{#isRecentlyViewed}}",'{{#isExpiring}}<span class="notification">{{{i18n.expiration}}}</span>{{/isExpiring}}',"{{/isRecentlyViewed}}","{{#isPlaylist}}",'{{#getFormattedPlaylistExpirationDate}}<span class="notification">{{{i18n.expiration}}} {{getFormattedPlaylistExpirationDate}}</span>{{/getFormattedPlaylistExpirationDate}}','<div class="highlight"></div>',"{{/isPlaylist}}","</div>"].join("")})();
BBV.namespace("orion.templates").MediaGridItemHoverOn=orion.templates.MediaGridItemHoverOn||(function(){return['<div class="hover-box">','<div class="overlay-toggle">','<div class="boxart-wrap">','<a class="{{imgType}}{{#getImg}} has-img{{/getImg}}" href="{{buildMediaUrl}}">',"{{#getImg}}",'<img src="{{getImg}}" alt="{{title}}" />',"{{/getImg}}",'<div class="play"></div>',"</a>",'<div class="functionality">',"{{#isMyOrionBar}}","{{^isRecommendations}}",'{{#formatLength}}<span class="run-time">{{formatLength}}</span>{{/formatLength}}',"{{/isRecommendations}}","{{/isMyOrionBar}}","{{^isRecentlyViewed}}","{{^isPlaylist}}",'<span class="add"><a href="#">+</a></span>',"{{/isPlaylist}}",'<span class="remove"><a href="#">&ndash;</a></span>',"{{^isMyRentals}}",'<span class="thumbs-down"><a href="#">thumbs down</a></span>','<span class="thumbs-up"><a href="#">thumbs up</a></span>',"{{/isMyRentals}}","{{/isRecentlyViewed}}","</div>","</div>","{{#title}}",'<h3 class="title">','<a href="{{buildMediaUrl}}">{{truncatedTitle}}</a>','{{#getLatestBroadcastTime}}<div class="broadcast-date">{{getLatestBroadcastTime}}</div>{{/getLatestBroadcastTime}}',"</h3>","{{/title}}","{{#secondaryTitle}}",'<span class="secondary-title">"{{secondaryTitle}}"</span>',"{{/secondaryTitle}}","{{#isMediaGroup}}","{{#hasChildMedia}}",'<span class="episode-info">',"{{getChildMedias}}","</span>","{{/hasChildMedia}}","{{#getFormattedDate}}",'<span class="release-date">',"{{getFormattedDate}}","</span>","{{/getFormattedDate}}","{{/isMediaGroup}}","{{#isTVItem}}",'{{#hasEpisodeInfo}}<span class="episode-info">{{getFormattedEpisodeInfo}}</span>{{/hasEpisodeInfo}}',"{{#isRecommendations}}",'{{#formatLength}}<span class="run-time">({{formatLength}})</span>{{/formatLength}}','{{#year}}<span class="release-date">{{getYear}}</span>{{/year}}',"{{/isRecommendations}}","{{^isMyOrionBar}}",'{{#formatLength}}<span class="run-time">({{formatLength}})</span>{{/formatLength}}','{{#year}}<span class="release-date">{{getYear}}</span>{{/year}}',"{{/isMyOrionBar}}","{{/isTVItem}}","{{#isMovieItem}}",'{{#year}}<span class="release-date">{{getYear}}</span>{{/year}}',"{{/isMovieItem}}","{{^isMyOrionBar}}",'{{#hasCategories}}<span class="genre">{{{getGenre}}}</span>{{/hasCategories}}',"{{/isMyOrionBar}}","{{#isRecommendations}}",'{{#hasCategories}}<span class="genre">{{{getGenre}}}</span>{{/hasCategories}}',"{{/isRecommendations}}","{{#isMyRentals}}",'{{#isProductExpiring}}<span class="notification">{{{i18n.expiration}}}</span>{{/isProductExpiring}}',"<span>{{{i18n.availableUntil}}} {{getFormattedProductExpirationDate}}</span>","{{/isMyRentals}}","{{#isRecentlyViewed}}",'{{#isExpiring}}<span class="notification">{{{i18n.expiration}}}</span>{{/isExpiring}}',"{{/isRecentlyViewed}}","{{#isPlaylist}}",'{{#getFormattedPlaylistExpirationDate}}<span class="notification">{{{i18n.expiration}}} {{getFormattedPlaylistExpirationDate}}</span>{{/getFormattedPlaylistExpirationDate}}','<div class="highlight"></div>',"{{/isPlaylist}}","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").RemoteBookingTooltip=orion.templates.RemoteBookingTooltip||(function(){return['<div class="remotebooking-tooltip">','{{#icon}}<span class="b-icon tooltip-icon {{icon}}"></span>{{/icon}}','<div class="tooltip-clear">',"{{text}}","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").DeviceGrid=orion.templates.DeviceGrid||(function(){return["{{>DeviceGridDialog}}",'<ul class="devicegrid" data-type="DeviceGrid">',"{{#devices}}","{{>DeviceGridItem}}","{{/devices}}","</ul>"].join("")})();
BBV.namespace("orion.templates").DeviceGridDialog=orion.templates.DeviceGridDialog||(function(){return['<div class="device-dialog-templates">','<div data-role="edit-device" class="edit-device" style="display: none;">','<div><input type="text" value="" class="device-input" /></div>',"<ul>","<li>",'<a href="#" data-action="rename" class="btn-success active">{{i18n.mydevicesrenameconfirmyestext}}</a>',"</li>","<li>",'<a href="#" data-action="rename-cancel" class="btn-cancel link">{{i18n.mydevicesrenameconfirmnotext}}</a>',"</li>","</ul>","</div>",'<div data-role="replace-device" class="device-dialog" style="display: none;">','<h3 class="dialog-title">{{i18n.mydevicesreplaceconfirmbodytext}}</h3>','<ul class="">',"<li>",'<a href="#" data-action="replace-ok" class="btn-success active">',"{{i18n.mydevicesreplaceconfirmyestex}}","</a>","</li>","<li>",'<a href="#" data-action="replace-cancel" class="btn-cancel link">',"{{i18n.mydevicesreplaceconfirmnotext}}","</a>","</li>","</ul>","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").DeviceGridItem=orion.templates.DeviceGridItem||(function(){return["{{#deviceId}}",'<li data-device-id="{{deviceId}}" data-device-name="{{deviceName}}" data-device-class="{{deviceClass}}" class="device-placeholder">','<div class="clearfix">','<div class="media">','<span class="device-img {{deviceClass}}"></span>',"</div>",'<div class="device-info clear">','<div class="device-nav">','<div class="placeholder-nav-wrap">',"{{#isReplaceWorkflow}}",'<a href="#" data-action="replace" class="btn btn-gray btn-replace">',"{{i18n.mydevicesreplacebuttontext}}","</a>","{{/isReplaceWorkflow}}","{{^isReplaceWorkflow}}",'<ul class="placeholder-nav">',"<li>",'<a href="#" data-action="edit" class="icon icon-edit"></a>',"</li>","</ul>","{{/isReplaceWorkflow}}","</div>","</div>",'<div class="device-body clear">','<h2 class="device-title">{{customerDefinedName}}</h2>','<ul class="statuses">','<li class="clearfix">','<span class="key">{{i18n.mydevicesregistrationdatetext}}</span>','<span class="clear value">{{getFormattedDeviceRegistered}}</span>',"</li>","</ul>","</div>","</div>",'<span class="hidden" data-status="{{deviceStatus}}"></span>',"</div>","</li>","{{/deviceId}}","{{#fakedDevice}}",'<li class="device-placeholder no-device">','<div class="no-device-text"><p>{{i18n.mydevicesstartstreamtext}}</p></div>',"</li>","{{/fakedDevice}}"].join("")})();
BBV.namespace("orion.templates").FiltersGrid=orion.templates.FiltersGrid||(function(){return['<div class="filtersgrid" data-type="FiltersGrid">',"{{#filters}}","{{>FilterItem}}","{{/filters}}","</div>"].join("")})();
BBV.namespace("orion.templates").FilterItem=orion.templates.FilterItem||(function(){return['<select data-role="filter" name="{{name}}" data-feed-param="{{feedParam}}" class="faceted-filter custom-select {{^allFeed}}{{#checked}}faceted-filter-selected{{/checked}}{{/allFeed}}" {{#disabled}}disabled{{/disabled}}>',"{{^primary}}",'<option value="0" {{#active}} selected {{/active}}>',"{{placeholder}}","</option>","{{/primary}}","{{#data}}",'<option value="{{id}}" {{#active}} selected {{/active}}>',"{{title}}","</option>","{{/data}}","</select>",].join("")})();
BBV.namespace("orion.templates").MediaList=orion.templates.MediaList||(function(){return["{{^isItem}}",'<ul class="list-view" data-type="{{type}}">','<li class="header">','<span class="order"></span>','<span class="title">{{{i18n.titleheading}}}</span>','<span class="rating">{{{i18n.ratedheading}}}</span>','<span class="genre">{{{i18n.genreheading}}}</span>',"{{#isPlaylist}}",'<span class="air-date">{{{i18n.airDate}}}</span>',"{{/isPlaylist}}","{{#isRecommendations}}",'<span class="air-date">{{{i18n.airDate}}}</span>',"{{/isRecommendations}}","{{#isMyRentals}}",'<span class="air-date">{{{i18n.expirationDate}}}</span>',"{{/isMyRentals}}","{{^isMyOrionBar}}",'<span class="release-date">{{{i18n.releaseheading}}}</span>',"{{/isMyOrionBar}}",'<span class="add"></span>',"</li>","{{/isItem}}","{{#items}}","{{>MediaListItem}}","{{/items}}","{{^isItem}}","</ul>","{{/isItem}}"].join("")})();
BBV.namespace("orion.templates").MediaListItem=orion.templates.MediaListItem||(function(){return['<li class="media-item{{#isMediaGroup}} media-group{{/isMediaGroup}}{{#inPlaylist}} in-playlist{{/inPlaylist}} {{#lowerCase}}medium{{/lowerCase}}" {{#isPlaylist}}id="playlist-list-item-{{id}}"{{/isPlaylist}} data-media-id="{{id}}">',"{{#isPlaylist}}",'<span class="order">{{order}}</span>',"{{/isPlaylist}}","{{#title}}",'<span class="title">',"{{#isMyOrionBar}}",'<a href="{{buildMediaUrl}}">{{title}}{{#isTV}}{{#secondaryTitle}}: <span class="episode">("{{secondaryTitle}}")</span>{{/secondaryTitle}}{{/isTV}}</a>',"{{/isMyOrionBar}}","{{^isMyOrionBar}}",'<a href="{{buildMediaUrl}}">{{title}}</a>',"{{/isMyOrionBar}}","{{#isTVItem}}",'{{#hasEpisodeInfo}}<span class="episode-info">{{getFormattedEpisodeInfo}}</span>{{/hasEpisodeInfo}}',"{{/isTVItem}}",'{{#formatLength}}<span class="run-time">({{formatLength}})</span>{{/formatLength}}',"</span>","{{/title}}","{{#hasParentalRating}}",'<span class="rating">',"{{highestParentalRating}}","</span>","{{/hasParentalRating}}",'<span class="genre">{{{getGenre}}}</span>',"{{#isPlaylist}}",'<span class="air-date">{{getFormattedAirDate}}</span>','<span class="thumbs-down"><a href="#">thumbs down</a></span>','<span class="thumbs-up"><a href="#">thumbs up</a></span>',"{{/isPlaylist}}","{{#isRecommendations}}",'<span class="air-date">{{getFormattedAirDate}}</span>','<span class="thumbs-down"><a href="#">thumbs down</a></span>','<span class="thumbs-up"><a href="#">thumbs up</a></span>',"{{/isRecommendations}}","{{#isMyRentals}}",'<span class="air-date">{{getFormattedProductExpirationDate}}</span>',"{{/isMyRentals}}","{{^isMyOrionBar}}",'<span class="release-date">{{getFormattedDate}}</span>',"{{/isMyOrionBar}}","{{^isMyOrionBar}}","{{^isFeed}}",'<span class="thumbs-up"><a href="#">thumbs up</a></span>','<span class="thumbs-down"><a href="#">thumbs down</a></span>',"{{/isFeed}}","{{/isMyOrionBar}}","{{^isPlaylist}}",'<span class="add"><a href="#">+</a></span>',"{{/isPlaylist}}",'<span class="remove"><a href="#">&ndash;</a></span>',"{{#isPlaylist}}",'<div class="highlight"></div>',"{{/isPlaylist}}","</li>"].join("")})();
BBV.namespace("orion.templates").Offers=orion.templates.Offers||(function(){var t=[];t.push('<ul class="offers-list">');t.push("{{#products}}");t.push('<li class="offer">');t.push('<div class="offer-text">');t.push('<h1 class="offer-title">{{name}}</h1>');t.push('<p class="offer-description"><span class="cost">{{{currency}}} {{^price}} 0{{/price}}{{#price}} {{price}}{{/price}}</span> {{{i18n_for}}} {{rentalDuration}}</p>');t.push("</div>");t.push('<span class="button offer-buy-button"><a href="#" class="offer-button-link" data-product-id="{{productId}}" data-offer-id="{{offerId}}">{{{i18n_buy}}}</a></span>');t.push("</li>");t.push("{{/products}}");t.push("</ul>");t.push("{{#show_login_button}}");t.push('<p><span class="button offer-buy-button{{#not_entitled}} disabled{{/not_entitled}}"><a href="#" class="offer-button-login">{{{i18n_buy}}}</a></span></p>');t.push("{{/show_login_button}}");t.push('<div class="about">');t.push("    <h1>{{{i18n_offers_head}}}</h1>");t.push("    <p>{{{i18n_offers_text}}}</p>");t.push('    {{#i18n_offers_link}}<p><a class="{{#show_login_button}}offer-button-login{{/show_login_button}}{{^show_login_button}}learn-more{{/show_login_button}}" href="{{offers_link}}">{{{i18n_offers_link}}}</a></p>{{/i18n_offers_link}}');t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").MyOrionBarDialogWrapper=orion.templates.MyOrionBarDialogWrapper||(function(){var t=[];t.push('<div class="dialog down myorionbar-dialog" id="myorionbar-dialog">');t.push('<div class="dialog-inner">');t.push('<a href="#" class="close-dialog">x</a>');t.push('<div id="dialog-arrow"></div>');t.push("</div>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").MyRentals=orion.templates.MyRentals||(function(){return['<div class="dialog-content" id="my-rentals">','<div class="user-functionality myorionbar-functionality">',"<h2>{{count}} {{{i18n.activeRentals}}}</h2>",'<span class="button button-sm">','<a href="{{manageUrl}}">{{{i18n.manageMyRentals}}}</a>',"</span>","</div>",'<div class="user-functionality myorionbar-sub-functionality">',"{{^hideView}}",'<ul class="view-toggle">','<li class="grid"><a href="#grid-view" class="user-functionality-link active"></a></li>','<li class="list"><a href="#list-view" class="user-functionality-link"></a></li>',"</ul>","{{/hideView}}","</div>",'<div class="content-list">',"{{>MediaGridWithHover}}","{{>MediaList}}","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").Playlist=orion.templates.Playlist||(function(){return['<div class="dialog-content" id="playlist">','<div class="user-functionality myorionbar-functionality">',"{{^isEmpty}}{{^isFull}}",'<ul class="view-toggle medium-toggle">',"<li>{{{i18n.view}}}</li>",'<li><a href="#all" class="active">{{{i18n.all}}} (<span class="count-all"></span>)</a></li>','<li><a href="#tv">{{{i18n.tv}}} (<span class="count-tv"></span>)</a></li>','<li><a href="#movie">{{{i18n.movies}}} (<span class="count-movies"></span>)</a></li>',"</ul>","{{/isFull}}{{/isEmpty}}",'<span class="button button-sm">','<a href="{{manageUrl}}">{{{i18n.managePlaylist}}}</a>',"</span>","</div>",'<div class="content-list">',"{{#isFull}}","{{>PlaylistFull}}","{{/isFull}}","{{#isEmpty}}","{{>PlaylistEmpty}}","{{/isEmpty}}","{{^isEmpty}}{{^isFull}}","{{>PlaylistMediaGrid}}","{{/isFull}}{{/isEmpty}}","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").PlaylistEmpty=orion.templates.PlaylistEmpty||(function(){return['<div class="empty">',"<h2><span>+</span> {{{i18n.playlistEmpty}}}</h2>","</div>"].join("")})();
BBV.namespace("orion.templates").PlaylistFull=orion.templates.PlaylistFull||(function(){return['<div class="full">',"<h2>{{{i18n.playlistFull}}}</h2>",'<p><a href="{{manageUrl}}">{{{i18n.managePlaylist}}}</a> {{{i18n.remove}}} <a href="#" class="cancel">{{{i18n.cancel}}}</a>.</p>',"</div>"].join("")})();
BBV.namespace("orion.templates").RecentlyViewed=orion.templates.RecentlyViewed||(function(){return['<div class="dialog-content" id="recently-viewed">','<div class="user-functionality myorionbar-functionality">',"<h2>{{{i18n.recentlyViewedVideos}}} ({{count}})</h2>",'<span class="button button-sm">','<a href="#" id="clear-recent">{{{i18n.clearHistory}}}</a>',"</span>","</div>",'<div class="content-list">',"{{>MediaGridWithHover}}","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").RecommendedForYou=orion.templates.RecommendedForYou||(function(){return["<header>",'<h1 class="h2">{{title}}</h1>',"</header>",'<div class="user-functionality content-view-toggler">',"{{^hideView}}",'<ul class="view-toggle">','<li class="grid"><a href="#" class="user-functionality-link active"></a></li>','<li class="list"><a href="#" class="user-functionality-link"></a></li>',"</ul>","{{/hideView}}","</div>",'<div class="content-list">',"</div>","{{#alllink}}",'<div class="show-all">','<p><a href="{{alllink}}">{{all}}<span></span></a></p>',"</div>","{{/alllink}}",].join("")})();
BBV.namespace("orion.templates").Recommendations=orion.templates.Recommendations||(function(){return['<div class="dialog-content" id="recommendations">','<div class="user-functionality myorionbar-functionality">','<h2>{{{i18n.recommendations}}} (<span class="count">{{count}}</span>)</h2>',"</div>",'<div class="user-functionality myorionbar-sub-functionality">',"{{^hideView}}",'<ul class="view-toggle">','<li class="grid"><a href="#grid-view" class="user-functionality-link active"></a></li>','<li class="list"><a href="#list-view" class="user-functionality-link"></a></li>',"</ul>","{{/hideView}}","</div>",'<div class="content-list">',"{{>MediaGridWithHover}}","{{>MediaList}}","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").RentalTime=orion.templates.RentalTime||(function(){var t=[];t.push('<div id="tvod-rental-time">');t.push("<p>{{{rental_message}}} ");t.push("{{rental_time}}</p>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").SearchResultsOnline=orion.templates.SearchResultsOnline||(function(){var t=[];t.push('<div class="results-list online-results">');t.push('<ul class="list-view">');t.push("{{#medias}}");t.push("{{#mediaGroup}}");t.push("<li>");t.push('<div class="box-art boxart-small {{#getBoxArtSmall}} has-img{{/getBoxArtSmall}}">');t.push("{{#getBoxArtSmall}}");t.push('<img src="{{getBoxArtSmall}}" alt="{{title}}" />');t.push("{{/getBoxArtSmall}}");t.push("</div>");t.push('<div class="description">');t.push('<p class="title">');t.push("<strong>{{title}}</strong>");t.push("{{#hasChildMedia}}<span>{{getChildMedias}}</span>{{/hasChildMedia}}");t.push("<span>");t.push("{{#getYear}}{{getYear}}&nbsp;|&nbsp;{{/getYear}}");t.push("{{#hasParentalRating}}{{highestParentalRating}}&nbsp;|&nbsp;{{/hasParentalRating}}");t.push("{{#hasCategories}}{{{getGenre}}}{{/hasCategories}}");t.push("</span>");t.push("</p>");t.push('<p class="cut-description">{{longDescription}}</p>');t.push("</div>");t.push("{{/mediaGroup}}");t.push('<div class="grouped-media-items">');t.push("{{#mediaItems}}");t.push("{{#isFirstItem}}<ul>{{/isFirstItem}}");t.push("{{{hiddenStart}}}");t.push('<li class="media-item">');t.push('<div class="media-title">');t.push("");t.push("<p>");t.push("<strong>{{title}}</strong>");t.push("<span> {{getLatestBroadcastDate}}{{#isTV}} {{#seasonNumber}}{{#localizeText}}season{{/localizeText}} {{seasonNumber}}{{/seasonNumber}}{{#seasonEpisodeNumber}} : {{#localizeText}}episode{{/localizeText}} {{seasonEpisodeNumber}}{{/seasonEpisodeNumber}} {{/isTV}} {{#formatLength}} ({{formatLengthNoSeconds}}) {{/formatLength}}</span>");t.push("</p>");t.push("</div>");t.push('<div class="aside btn-group-vertical">');t.push('<span class="button button-sm"><a href="{{buildMediaUrl}}" class="play">');t.push('<span class="b-icon play-icon"></span>');t.push("{{#localizeText}}watchNow{{/localizeText}}");t.push("</a></span>");t.push("</div>");t.push("</li>");t.push("{{{hiddenEnd}}}");t.push("{{#isLastItem}}");t.push("</ul>");t.push("{{#isExpandable}}");t.push('<div class="show-more">');t.push('<p><a href="#" data-text-expand="{{#localizeText}}viewAll{{/localizeText}}" data-text-collapse="{{#localizeText}}hideAll{{/localizeText}}"><span class="toggler">{{#localizeText}}viewAll{{/localizeText}}</span> {{groupTitle}} <span class="icon"></span></a></p>');t.push("</div>");t.push("{{/isExpandable}}");t.push("{{/isLastItem}}");t.push("{{/mediaItems}}");t.push("</div>");t.push("</li>");t.push("{{/medias}}");t.push("</ul>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").SearchResultsTv=orion.templates.SearchResultsTv||(function(){var t=[];t.push('<div class="results-list tv-results">');t.push('<ul class="list-view">');t.push("{{#medias}}");t.push("{{#listings}}");t.push('{{#linearGroup}}<li class="header"><header><h1>{{{linearGroup}}}</h1></header></li>{{/linearGroup}}');t.push('<li class="program-details-linear-wrap {{#linearGroup}}no-top-border{{/linearGroup}}" style="vertical-align:middle" data-imi="{{title}}" data-channel-name="{{channelNumber}}&nbsp;{{stationTitle}}" data-listing-id="{{id}}" data-station-id="{{stationId}}">');t.push('<div class="box-art-linear boxart-medium {{#getBoxArtMedium}} has-img{{/getBoxArtMedium}}">');t.push("{{#getBoxArtMedium}}");t.push('<img src="{{getBoxArtMedium}}" alt="{{#program}}{{title}}{{/program}}" />');t.push("{{/getBoxArtMedium}}");t.push("</div>");t.push('<div class="description">');t.push('<p style="float:right"><strong>{{getFormattedAirDate}}</strong></p>');t.push('<p class="title">');t.push('<strong class="program-title">{{#program}}{{title}}{{/program}}</strong>');t.push("<span>{{#program}}{{#categories}}{{title}} {{/categories}}{{/program}}</span>");t.push("</p>");t.push('<h3 class="cut-description">{{#program}}{{#program}}{{longDescription}}{{/program}}{{/program}}</h3>');t.push('<div class="additional-info">');t.push('{{#stationTitle}}<div class="channel-info">');t.push('<div class="channel-name"><strong>{{#localizeText}}channel{{/localizeText}}</strong></div>');t.push('<div class="channel-number">{{channelNumber}}&nbsp;{{stationTitle}}</div>');t.push("</div>{{/stationTitle}}");t.push('{{#getDuration}}<div class="duration-info">');t.push('<div class="duration-name"><strong>{{#localizeText}}duration{{/localizeText}}</strong></div>');t.push('<div class="duration-value">{{getDuration}}</div>');t.push("</div>{{/getDuration}}");t.push("</div>");t.push('{{#rbIsEntitled}}<div class="user-functionality btn-group-vertical">');t.push('<span data-name="recordings" class="button button-sm watch btn-record record"><a href="#">');t.push('<span class="b-icon record-icon"></span>');t.push('<span class="record-text">{{#localizeText}}recordButton{{/localizeText}}</span>');t.push('<span class="record-recording-text">{{#localizeText}}recordSet{{/localizeText}}</span>');t.push('<span class="record-failed-text">{{#localizeText}}recordFailed{{/localizeText}}</span>');t.push('<span class="record-pending-text">{{#localizeText}}recordPending{{/localizeText}}</span>');t.push("</a></span>");t.push("</div>{{/rbIsEntitled}}");t.push("</div>");t.push("</li>");t.push("{{/listings}}");t.push("{{/medias}}");t.push("</ul>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").TimeSlot=orion.templates.TimeSlot||(function(){var TimeSlot='{{#times}}<div class="time-slot"> {{display}} </div>{{/times}}';return TimeSlot})();
BBV.namespace("orion.templates").TitleCardOffers=orion.templates.TitleCardOffers||(function(){var t=[];t.push('<div class="offers">');t.push("{{#products}}");t.push('<div class="offer-text">');t.push('   <p class="offer-title">{{{name}}}</p>');t.push('           <p class="offer-description">');t.push('                <span class="cost">{{{currency}}} {{^price}} 0{{/price}}{{#price}} {{price}}{{/price}}</span> {{{i18n_for}}} {{rentalDuration}}');t.push('                <a href="#" class="offers-description-info" rel="popover"></a>');t.push("           </p>");t.push("</div>");t.push('<span class="button offer-buy-button" data-product-id="{{productId}}" data-offer-id="{{offerId}}"><a href="#">{{btn_text}}</a></span>');t.push("{{/products}}");t.push("{{#simple}}");t.push("{{#rentalTime}}");t.push('<p class="status-wrap"><span class="status">{{rental_status}}</span></p>');t.push("{{/rentalTime}}");t.push('<div class="offers-text">');t.push('<h3 class="offers-login-text">{{{i18n_text}}}</h3>');t.push("{{#i18n_btn}}");t.push('<span class="button offer-button-link">');t.push('<a href="{{#i18n_link}}{{i18n_link}}{{/i18n_link}}{{^i18n_link}}#{{/i18n_link}}" ');t.push('class="{{#i18n_login_btn}}offer-button-login{{/i18n_login_btn}}">');t.push("{{i18n_btn}}</a>");t.push("</span>");t.push("{{/i18n_btn}}");t.push("{{#rental_time}}<p><b>{{rental_time}}</b></p>{{/rental_time}}");t.push("</div>");t.push("{{/simple}}");t.push("{{^simple}}");t.push('<div class="offers-text">');t.push("{{{i18n_login_text}}}");t.push("{{#i18n_btn}}");t.push('<p><span class="button offer-button-login offer-button-link">');t.push('<a href="#">{{i18n_btn}}</a>');t.push("</span></p>");t.push("{{/i18n_btn}}");t.push("</div>");t.push("{{/simple}}");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").TitleCardOffersTooltip=orion.templates.TitleCardOffersTooltip||(function(){return['<div class="purchases-popover">','<h3 class="h4">{{{i18n_head}}}</h3>',"<p>{{{i18n_text}}}</p>","</div>"].join("")})();
BBV.namespace("orion.templates").TitleCardRentalTime=orion.templates.TitleCardRentalTime||(function(){var t=[];t.push('<div id="tvod-rental-time">');t.push("<p>{{{rental_message}}} ");t.push("{{rental_time}}</p>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").TitleCardDescription=orion.templates.TitleCardDescription||(function(){return['<article class="title-card-ng clearfix" data-media-id="{{id}}">','<div class="section">','<div class="media" class="boxart-medium {{#boxArtMedium}}has-img{{/boxArtMedium}}">',"{{#boxArtLarge}}",'<img src="{{boxArtLarge}}" class="media-img" alt="{{title}}" />',"{{/boxArtLarge}}","{{^boxArtLarge}}",'<img src="{{defaultPoster}}" class="default-img" alt="{{title}}" />',"{{/boxArtLarge}}","</div>",'<div class="description">','<div class="box-art logo boxart-small">',"{{#logo}}",'<img src="{{logo.url}}" alt="{{logo.title}}" />',"{{/logo}}","</div>",'<h2 class="title">{{title}}</h2>','{{#episodesCount}} <p class="subtitle-lead">{{episodesCount}} {{i18nActivePage.listingsText}}</p>{{/episodesCount}}','{{#secondaryTitle}}<p class="subtitle-lead">{{secondaryTitle}}</p>{{/secondaryTitle}}','{{#time}}<h3 class="subtitle">{{time}}</h3>{{/time}}','<div class="synopsis">{{description}}</div>','<div class="additional clearfix">','<div id="offers-description" class="offers-description"></div>',"{{#linear}}",'<ul class="additional-info">','{{#channelTitle}}<li><span class="key">{{i18nActivePage.channelText}}:</span> <span class="value">{{channelTitle}}</span></li>{{/channelTitle}}','{{#duration}} <li><span class="key">{{i18nTitleCardCommon.durationText}}:</span> <span class="value">{{duration}}</span></a></li>{{/duration}}','{{#genre}}    <li><span class="key">{{i18nTitleCardCommon.genreText}}:</span> <span class="value">{{{genre}}}</span></a></li>{{/genre}}','{{#broadcast}}<li><span class="key">{{i18nTitleCardCommon.broadcastStartTimeText}}:</span> <span class="value">{{broadcast}}</span></li>{{/broadcast}}','{{#year}}     <li><span class="key">{{i18nTitleCardCommon.movieReleaseYear}}:</span> <span class="value">{{year}}</span></li>{{/year}}','{{#ageRating}}<li><span class="key">{{i18nTitleCardCommon.ratingText}}:</span> <span class="value">{{ageRating}}</span></li>{{/ageRating}}','{{#language}} <li><span class="key">{{i18nTitleCardCommon.videoLanguageText}}:</span> <span class="value">{{language}}</span></li>{{/language}}','{{#actors}} <li><span class="key">{{i18nTitleCardCommon.starringText}}:</span> <span class="value">{{actors}}</span></li>{{/actors}}','{{#directors}} <li><span class="key">{{i18nTitleCardCommon.directorText}}:</span> <span class="value">{{directors}}</span></li>{{/directors}}',"</ul>","{{/linear}}","{{#media}}",'<ul class="additional-info">','{{#duration}} <li><span class="key">{{i18nTitleCardCommon.durationText}}:</span> <span class="value">{{duration}}</span></a></li>{{/duration}}','{{#year}}     <li><span class="key">{{i18nTitleCardCommon.movieReleaseYear}}:</span> <span class="value">{{year}}</span></li>{{/year}}','{{#ageRating}}<li><span class="key">{{i18nTitleCardCommon.ratingText}}:</span> <span class="value">{{ageRating}}</span></li>{{/ageRating}}','{{#language}} <li><span class="key">{{i18nTitleCardCommon.videoLanguageText}}:</span> <span class="value">{{language}}</span></li>{{/language}}','{{#genre}}    <li><span class="key">{{i18nTitleCardCommon.genreText}}:</span> <span class="value">{{{genre}}}</span></a></li>{{/genre}}','{{#channelTitle}}<li><span class="key">{{i18nActivePage.channelText}}:</span> <span class="value">{{channelTitle}}</span></li>{{/channelTitle}}','{{#broadcast}}<li><span class="key">{{i18nTitleCardCommon.broadcastStartTimeText}}:</span> <span class="value">{{broadcast}}</span></li>{{/broadcast}}','{{#actors}}   <li><span class="key">{{i18nTitleCardCommon.starringText}}:</span> <span class="value">{{actors}}</span></li>{{/actors}}','{{#directors}} <li><span class="key">{{i18nTitleCardCommon.directorText}}:</span> <span class="value">{{directors}}</span></li>{{/directors}}',"</ul>","{{/media}}","{{#reply}}",'<ul class="additional-info">','{{#broadcast}}   <li><span class="key">{{i18nTitleCardCommon.broadcastStartTimeText}}:</span> <span class="value">{{broadcast}}</span></li>{{/broadcast}}','{{#expiryDateText}}<li><span class="key">{{i18nActivePage.expireDate}}:</span> <span class="value">{{expiryDateText}}</span></li>{{/expiryDateText}}','{{#channelTitle}}<li><span class="key">{{i18nActivePage.channelText}}:</span> <span class="value">{{channelTitle}}</span></li>{{/channelTitle}}','{{#duration}}    <li><span class="key">{{i18nTitleCardCommon.durationText}}:</span> <span class="value">{{duration}}</span></a></li>{{/duration}}','{{#genre}}       <li><span class="key">{{i18nTitleCardCommon.genreText}}:</span> <span class="value">{{{genre}}}</span></a></li>{{/genre}}','{{#language}}    <li><span class="key">{{i18nTitleCardCommon.videoLanguageText}}:</span> <span class="value">{{language}}</span></li>{{/language}}','{{#ageRating}}   <li><span class="key">{{i18nTitleCardCommon.ratingText}}:</span> <span class="value">{{ageRating}}</span></li>{{/ageRating}}',"</ul>","{{/reply}}","</div>",'<div id="actionbar-container"></div>',"</div>","</div>","</article>"].join("")})();
BBV.namespace("orion.templates").TitleCardListings=orion.templates.TitleCardListings||(function(){return['<article class="listings-container">','<h2 class="listings-title">{{i18nActivePage.listingsText}} {{channelTitle}}</h2>','<div id="listings" data-listing-url="{{url}}"','data-template="TitleCardListingsItem"','data-i18n-property="i18nActivePage"','data-page-size="5"','data-channel-name="{{channelTitle}}"','data-channel-id="{{channelId}}"','data-type="{{type}}">',"</div>",'{{#tvGuidePath}}<div class=""><a href="{{tvGuidePath}}" class="link">{{{i18nActivePage.goToTvGuideText}}}</a></div>{{/tvGuidePath}}','{{#morebtn}}<div class="more"><a href="#" class="more-btn" style="display: none;"><i class="icon arr-bottom"></i> {{i18nTitleCardCommon.moreText}}</a></div>{{/morebtn}}',"</article>"].join("")})();
BBV.namespace("orion.templates").TitleCardListingsItem=orion.templates.TitleCardListingsItem||(function(){return["<table>","{{#series}}","<thead>",'<tr class="listing" data-media-id="{{listingId}}">','<td class="title">{{i18nTitleCardCommon.titleText}}</td>','<td class="genre">{{i18nTitleCardCommon.genreText}}</td>','<td class="age-rating">{{i18nTitleCardCommon.ratingText}}</td>','<td class="date">{{i18nTitleCardCommon.dateText}}</td>',"<td>&nbsp;</td>","</tr>","</thead>","<tbody>","{{#listings}}",'<tr class="listing" data-role="episode" data-media-id="{{listingId}}" data-isinplaylist="{{#inPlaylist}}true{{/inPlaylist}}{{^inPlaylist}}false{{/inPlaylist}}">','<td class="title">',"{{#secondaryTitle}}{{secondaryTitle}}{{/secondaryTitle}}","{{^secondaryTitle}}{{title}}{{/secondaryTitle}}","</td>",'<td class="genre">{{{buildMediaGenreLinks}}}</td>','<td class="age-rating">{{rating}}</td>','<td class="date">{{getYear}}</td>','<td class="status">','{{#bookmarkPaused}}<a href="#" class="link">{{bookmarkPaused}}</a>{{/bookmarkPaused}}',"{{#bookmarkWatched}}{{bookmarkWatched}}{{/bookmarkWatched}}","</td>","</tr>","{{/listings}}","</tbody>","{{/series}}","</table>"].join("")})();
BBV.namespace("orion.templates").TitleCardChannelListings=orion.templates.TitleCardChannelListings||(function(){return["<table>","<thead>",'<tr class="listing">','<td class="time">{{i18nActivePage.timeText}}</td>','<td class="title">{{i18nTitleCardCommon.titleText}}</td>','<td class="genre">{{i18nTitleCardCommon.genreText}}</td>','<td class="age-rating">{{i18nTitleCardCommon.ratingText}}</td>',"<td>&nbsp;</td>","</tr>","</thead>","<tbody>","{{#listings}}",'<tr class="listing" data-id="{{id}}" data-listing-id="{{id}}" >','<td class="time">{{getFormattedServerStartTime}}</td>','<td class="title"><a href="{{getListingUrl}}">{{program.title}}</a></td>','<td class="genre">{{{buildGenreLinks}}}</td>','<td class="age-rating">{{program.parentalRating}}</td>','<td class="nav record">','{{#nav}}<a href="#" style="display:none" class="record-btn"></a>{{/nav}}',"</td>","</tr>","{{/listings}}","</tbody>","</table>"].join("")})();
BBV.namespace("orion.templates").TitleCardReplayListings=orion.templates.TitleCardReplayListings||(function(){return['<table class="replay-listings">',"<thead>",'<tr class="listing">','<td class="channel">{{i18nActivePage.channelText}}</td>','<td class="title">{{i18nTitleCardCommon.titleText}}</td>','<td class="broadcast">{{i18nTitleCardCommon.broadcastStartTimeText}}</td>','<td class="status"></td>',"<td>&nbsp;</td>","</tr>","</thead>","<tbody>","{{#listings}}",'<tr class="listing {{#active}}active{{/active}}" data-id="{{id}}" data-listing-id="{{id}}" data-station-id="{{stationId}}">','<td class="channel">','<div class="channel-logo-wrap">{{getChannelLogo}}</div>',"</td>",'<td class="title"><a href="{{getListingUrl}}">{{title}}</a></td>','<td class="broadcast">{{broadcast}}</td>','<td class="status">','{{#bookmarkPaused}}<a href="#" class="link">{{bookmarkPaused}}</a>{{/bookmarkPaused}}',"{{#bookmarkWatched}}{{bookmarkWatched}}{{/bookmarkWatched}}","</td>",'<td class="nav">','{{#nav}}<a href="#" style="display:none" class="record-btn"></a>{{/nav}}','{{#replayTvAvailable}}<span class="b-icon replaytv-icon"></span>{{/replayTvAvailable}}',"</td>","</tr>","{{/listings}}","</tbody>","</table>"].join("")})();
BBV.namespace("orion.templates").VideoPlayerEndScreen=orion.templates.VideoPlayerEndScreen||(function(){return["{{#model}}",'<div class="just-watched">',"<h2>{{{i18nTitleCardMovie.justWatchedText}}}</h2>","<p>",'<span class="title" {{#mediaItem.isAdult}}data-adult="title"{{/mediaItem.isAdult}}>{{mediaItem.title}}</span>',"{{#mediaItem.year}}",'<span class="date" {{#mediaItem.isAdult}}data-adult="year"{{/mediaItem.isAdult}}>'," ({{mediaItem.year}})","</span>","{{/mediaItem.year}}",'<a href="#" class="replay">{{{i18nTitleCardMovie.watchAgainText}}}</a>',"</p>",'<div class="buttons">','<span class="button share"><a href="#">{{{i18nTitleCardSocial.shareLabelText}}}</a></span>',"</div>","</div>","{{#relatedItem}}",'<div class="movies related content-list">',"<h3>{{{i18nTitleCardMovie.relatedMoviesText}}}</h3>","</div>","{{/relatedItem}}",'<div class="movies top-picks content-list">',"<h3>{{{i18nTitleCardMovie.otherMoviesText}}}</h3>",'<div class="feed-container" ','data-feed-url="{{mediaItem.buildOtherMoviesUrl}}" ','data-page-size="4">',"</div>","</div>","{{/model}}"].join("")})();
BBV.namespace("orion.templates").TvodDialog=orion.templates.TvodDialog||(function(){return['<div id="tvod-checkout" class="tvod-checkout">',"<header>","<hgroup>","<h1>{{{i18n_review_order}}}</h1>","<h2>{{{i18n_bill_to_account}}}</h2>","</hgroup>","</header>",'<div class="order-summary">','<ul class="order-summary-list">',"{{#item}}",'<li class="order-summary-item">','<div class="product-details">','<p class="title">{{title}}</p>','<p class="secondary-title">{{secondary_title}}</p>',"</div>",'<div class="offer-details">','<p class="cost">{{{cost}}}</p>',"<p>{{rental_duration}}</p>","</div>","</li>","{{/item}}","</ul>","</div>","{{#item.isAdult}}",'<form method="" class="dialog-tvod-pin-form">','<h1>{{{i18n_enter_pin}}} <a href="#" class="why-required-link">{{{i18n_why_pin_required}}}</a></h1>','<fieldset class="pin-settings">','<p class="error"></p>','<p class="body"></p>','<div class="field">','<input type="password" name="pin1" maxlength="1" value="" />','<input type="password" name="pin2" maxlength="1" value="" />','<input type="password" name="pin3" maxlength="1" value="" />','<input type="password" name="pin4" maxlength="1" value="" />',"</div>",'<div class="actions">','<p><span class="button button-sm tvod-checkout-button">','<span class="b-icon checkout-icon"></span>','<input type="submit" value="{{{i18n_buy_now_button}}}" id="buynow"></span></p>',"</div>","</fieldset>","</form>","{{/item.isAdult}}","{{^item.isAdult}}",'<form method="" class="dialog-tvod-pw-form">','<h1>{{{i18n_enter_pw}}} <a href="#" class="why-required-link">{{{i18n_why_pw_required}}}</a></h1>','<fieldset class="pin-settings">','<p class="error"></p>','<p class="body"></p>','<div class="field">','<input type="password" name="pw" value="" />',"</div>",'<div class="actions">','<p><span class="button button-sm tvod-checkout-button">','<span class="b-icon checkout-icon"></span>','<input type="submit" value="{{{i18n_buy_now_button}}}" id="buynow"></span></p>',"</div>","</fieldset>","</form>","{{/item.isAdult}}",'<div class="about-rentals">',"<h1>{{{i18n_about_rentals_header}}}</h1>",'<div class="content">',"<p>{{{i18n_about_rentals}}}</p>","<p>{{{i18n_by_clicking}}}</p>","</div>","</div>","</div>"].join("")})();
BBV.namespace("orion.templates").VideoMessage=orion.templates.VideoMessage||(function(){var t=[];t.push('<div class="message{{#onLeftSide}} left-side{{/onLeftSide}}">');t.push('<a href="#" class="close">{{close}}</a>');t.push("<span></span>");t.push('<p class="message-body">{{{message}}}</p>');t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").VodPromo=orion.templates.VodPromo||(function(){var t=[];t.push('<div class="vod-promo">');t.push('<img src="{{imgSrc}}" alt="{{assetTitle}}"/>');t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").ConfirmationDialog=orion.templates.ConfirmationDialog||(function(){var t=[];t.push('<div class="inner">');t.push("<h2>{{{title}}}</h2>");t.push("<p>{{{body}}}</p>");t.push('<div class="controls">');t.push('<span class="button confirmation-dialog-button"><a class="confirm" href="#">{{i18nConfirm}}</a></span>');t.push('<span><a class="cancel" href="#">{{i18nCancel}}</a></span>');t.push("</div>");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").ProviderBanner=orion.templates.ProviderBanner||(function(){return[' <div class="banner-container" style="background: url(\'{{bannerUrl}}\');">','<div class="info">','<div class="banner-title">{{title}}</div>',' <div class="banner-description">{{description}}</div>',"</div>",'<div class="banner-social">','{{#isFacevookEnabled}}<div class="social-icon-facebook"><a class="addthis_button_facebook" target="_blank"><div class="link"></div></a></div>{{/isFacevookEnabled}}','{{#isTwitterEnabled}}<div class="social-icon-twitter"><a class="addthis_button_twitter" target="_blank"><div class="link"></div></a></div>{{/isTwitterEnabled}}','{{#isGooglePlusEnabled}}<div class="social-icon-google"><a href="#" class="google_plusone_share" title="Google Plus" target="_blank"><div class="link"></div></a></div>{{/isGooglePlusEnabled}}',"</div>","</div>"].join("")})();
BBV.namespace("orion.templates").LiveChannels=orion.templates.LiveChannels||(function(){var t=[];t.push("{{#channels}}");t.push('<li class="channel-item{{#isOOH}} ooh{{/isOOH}}" id="station-{{stationID}}" data-station-id="{{stationID}}" data-channel-id="{{channelID}}" data-channel-title="{{title}}" data-channel-number="{{channelNumber}}" data-entitlements="{{entitlements}}">');t.push('<a href="{{channelUrl}}" class="channel-link">');t.push('<span class="ooh-indicator"></span>');t.push("{{#stationImg.url}}");t.push('<img src="{{stationImg.url}}" alt="{{title}}" />');t.push("{{/stationImg.url}}");t.push("{{^stationImg.url}}");t.push('<span class="no-logo">{{title}}</span>');t.push("{{/stationImg.url}}");t.push("</a>");t.push("</li>");t.push("{{/channels}}");return t.join("")})();
BBV.namespace("orion.templates").LiveChannelsTooltip=orion.templates.LiveChannelsTooltip||(function(){var t=[];t.push('<div class="live-channel-popover">');t.push("{{#title}}");t.push('    <h4 class="h3">{{title}}</h4>');t.push("{{/title}}");t.push("{{#secondaryTitle}}");t.push('    <div class="episode">"{{secondaryTitle}}"</div>');t.push("{{/secondaryTitle}}");t.push('<div class="season">');t.push("    {{#seasonNumber}}");t.push("        {{{seasonText}}} {{seasonNumber}},");t.push("    {{/seasonNumber}}");t.push("    {{#seasonEpisodeNumber}}");t.push("        {{{episodeText}}} {{seasonEpisodeNumber}}");t.push("    {{/seasonEpisodeNumber}}");t.push("</div>");t.push('<div class="time-details h5">{{channelTitle}}, {{duration}}</div>');t.push("<p>{{description}}</p>");t.push("{{#nextTitle}}");t.push('    <h4 class="h4">{{{onnextText}}} <span class="show-title">{{nextTitle}}</span></h4>');t.push('    {{#nextDuration}}<div class="time-details h5">{{nextDuration}}</div>{{/nextDuration}}');t.push("{{/nextTitle}}");t.push("</div>");return t.join("")})();
BBV.namespace("orion.templates").LiveChannelsTooltipEmpty=orion.templates.LiveChannelsTooltipEmpty||(function(){var t=[];t.push('<h4 class="title">{{{tba_text}}}</h4>');return t.join("")})();
BBV.namespace("orion.templates").PinChangeDialog=orion.templates.PinChangeDialog||(function(){var tpl=[];tpl.push('<div class="inner pin-change-confirmation">');tpl.push("{{#title}}<h3>{{title}}</h3>{{/title}}");tpl.push("{{#message}}<p>{{message}}</p>{{/message}}");tpl.push('<div class="controls">');tpl.push('<span class="button confirmation-dialog-button"><a class="confirm" href="#">{{i18nConfirm}}</a></span>');tpl.push('<span><a class="cancel" href="#">{{i18nCancel}}</a></span>');tpl.push("</div>");tpl.push("</div>");return tpl.join("")})();
BBV.namespace("orion.templates").ChannelCard=orion.templates.ChannelCard||(function(){return["<header>",'<h1 class="channel-title">{{title}}</h1>',"</header>",'<div class="section">','<ul class="tabs">','<li id="tab-guide" class="tab active">','<a href="#guide">{{{i18nChannelCard.tvGuideTabText}}}</a>',"</li>",'<li id="tab-overview" class="tab">','<a href="#overview"{{#background}} style="background:{{background}}"{{/background}}>{{{i18nChannelCard.overviewText}}}</a>',"</li>","</ul>",'<div id="guide" class="section">','<a href="{{tvGuidePath}}" class="epg-link">{{{i18nChannelCard.epgLinkText}}}</a>','<div class="section content-list">','<div class="listing-container" ','data-page-size="10" ','data-template="CardListings" ','data-enable-paging="true" ','data-listing-url="{{routes.listings}}?byStationId={{stationId}}&sort=startTime" ','data-isLive="{{hasLiveStream}}" ','data-title="{{title}}" ','data-i18n-property="channelCardListing">',"</div>","</div>","</div>",'<div id="overview" class="section" style="display: none;">',"{{#logo}}",'<img id="station-logo" class="left" src="{{logo.url}}" width="{{logo.width}}" height="{{logo.height}}" />',"{{/logo}}",'<h2>{{{i18nChannelCard.titlePreText}}} <span class="channel-title">{{title}}</span></h2>','<div class="fb-like" data-href="{{fbLinkUrl}}" data-send="false" data-width="450" data-show-faces="false" data-asset-name="{{title}}" data-colorscheme="light" data-asset-id="{{channelId}}"></div>','<p class="channel-description">{{description}}</p>',"</div>","</div>",'<div class="section content-list most-popular{{^providerId}} hidden{{/providerId}}"','{{#providerId}} data-feed-url="{{routes.mediagroups}}?byProviderId={{providerId}}&sort=playCount|desc&range=1-5"{{/providerId}}>','<h2>{{{i18nChannelCard.popPreText}}} <span class="channel-title"></span></h2>','<div class="feed-container" ','data-feed-url="{{dataFeedUrl}}" ','data-i18n-property="channelCardFeed">',"</div>","</div>"].join("")})();
BBV.namespace("orion.templates").HorizonInspiredASpotFeedData=orion.templates.HorizonInspiredASpotFeedData||(function(){return["<section>",'<div class="basic-aspot template_basicaspot">','<div class="upc-bgcontainer-aspot">','<div class="upc-basic-aspot-container upc-basic-aspot-size-large">','<div id="template_basicaspot">','<div class="upc-aspot-wrapper">','<button class="upc-aspot-previous">',"<span>","<span>{{{i18n.prev}}}</span>","</span>","</button>","{{#mediaGroups}}","{{#.}}",'<div {{#images}}{{#.}}{{#getBg}}{{assetType}}{{url}}{{/getBg}}{{/.}}{{/images}} class="upc-aspot-item " id="lgi-aspot-vergelijken">','<div class="upc-aspot-content">','<div class="content parsys">','<div class="richtext section">','<div class="title">',"<h1>{{title}}</h1>","</div>","</div>",'<div class="richtext section description" >',"{{description}}","</div>",'<div class="button section">','<a title="" data-upc-tooltip-type="none" class="upc_button2 floatleft clearboth" target="_top" href="{{#getUrl}}{{medium}}{{/getUrl}}/{{id}}">',"<span>{{{i18n.more}}}</span>","</a>",'<div class="clear">&nbsp;</div>',"</div>",'<a target="_top" title="" href="{{#getUrl}}{{medium}}{{/getUrl}}/{{id}}"><div class="boxart" {{#images}}{{#.}}{{#getBoxart}}{{assetType}}{{url}}{{/getBoxart}}{{/.}}{{/images}} /></a>',"</div>","</div>","</div>","{{/.}}","{{/mediaGroups}}",' <button class="upc-aspot-next">',"<span>","<span>{{{i18n.next}}}</span>","</span>","</button>",'<div class="upc-aspot-nav">',"{{#mediaGroups}}",'<a class="upc-aspot-bullet">{{idx}}</a>',"{{/mediaGroups}}","</div>","</div>","</div>","</div>","</div>","</div>","</section>"].join("")})();
BBV.namespace("orion.templates").HorizonInspiredASpotCQData=orion.templates.HorizonInspiredASpotCQData||(function(){return["<section>",'<div class="basic-aspot template_basicaspot">','<div class="upc-bgcontainer-aspot">','<div class="upc-basic-aspot-container upc-basic-aspot-size-large">','<div id="template_basicaspot">','<div class="upc-aspot-wrapper">','<button class="upc-aspot-previous">',"<span>","<span>{{{i18n.prev}}}</span>","</span>","</button>","{{#mediaGroups}}","{{#.}}",'<div {{#images}}{{#.}}{{#getBg}}{{assetType}}{{url}}{{/getBg}}{{/.}}{{/images}} class="upc-aspot-item {{#config.backgroundLink}}clickable{{/config.backgroundLink}}" id="lgi-aspot-vergelijken">','<div {{#config.backgroundLink}} data-location="{{config.backgroundLink}}"{{/config.backgroundLink}} class="upc-aspot-content">','<div class="content parsys">','<div class="richtext section richeditor">',"{{{text}}}","</div>","{{#hasBoxart}}",'<a target="_top" alt="{{config.imageAltTag}}" title="{{config.imageAltTag}}" href="{{config.imageLink}}"><div class="boxart" {{#images}}{{#.}}{{#getBoxart}}{{assetType}}{{url}}{{/getBoxart}}{{/.}}{{/images}} /></a>',"{{/hasBoxart}}","</div>","</div>","</div>","{{/.}}","{{/mediaGroups}}",' <button class="upc-aspot-next">',"<span>","<span>{{{i18n.next}}}</span>","</span>","</button>",'<div class="upc-aspot-nav">',"{{#mediaGroups}}",'<a class="upc-aspot-bullet">{{idx}}</a>',"{{/mediaGroups}}","</div>","</div>","</div>","</div>","</div>","</div>","</section>"].join("")})();
BBV.namespace("orion.templates").MyDevices=orion.templates.MyDevices||(function(){return['<div class="clearfix">','<ul class="devices-global-nav">',"<li>",'<a href="#" data-action="refresh" class="icon icon-refresh"></a>',"</li>","{{#infoLink}}","<li>",'<a href="{{infoLink}}" target="_blank" class="icon icon-info"></a>',"</li>","{{/infoLink}}","</ul>","{{#isReplaceWorkflow}}",'<p class="clear lead">{{i18n.mydevicesreplacedialogbodytext}}</p>',"{{/isReplaceWorkflow}}","{{^isReplaceWorkflow}}",'<p class="clear lead">{{i18n.mydevicesregisteredbodytext}}</p>',"{{/isReplaceWorkflow}}","</div>",'<div class="clear hidden">',"<p>Is this Replace Workflow? : {{isReplaceWorkflow}}</p>","<p>Replace Device with Device Id : {{replaceDeviceId}}</p>","</div>","{{>DeviceGrid}}"].join("")})();
BBV.namespace("orion.templates").MyChannelsLineUp=orion.templates.MyChannelsLineUp||(function(){return["{{#visible}}",'<li data-id="{{serviceId}}">','<div class="images">',"{{#icon}}",'<img src="{{icon}}" />',"{{/icon}}","</div>","<span>{{title}}</span>",'<span class="icon"></span>',"</li>","{{/visible}}","{{#excluded}}",'<li data-id="{{serviceId}}">','<div class="images">',"{{#icon}}",'<img src="{{icon}}" />',"{{/icon}}","</div>","<span>{{title}}</span>",'<span class="icon"></span>',"</li>","{{/excluded}}"].join("")})();

BBV.namespace("orion.oesp").routes=orion.oesp.routes||BBV.settings.oespRoutes;
BBV.namespace("orion.oesp.res").ServerResource=orion.oesp.res.ServerResource||(function($){function ServerResource(data,session){var self=this;var protectedData={session:session};self.inflate(data);self.getProtectedData=function(){return protectedData};return self}ServerResource.prototype.inflate=function(data){var schema=this.constructor.schema;var prop;if(schema){for(prop in schema){if(schema.hasOwnProperty(prop)){if(prop in data){if(typeof schema[prop]=="function"){this[prop]=schema[prop](data[prop])}else{this[prop]=data[prop];if(typeof schema[prop]!==typeof data[prop]){log("While constructing an instance of",this.prototype.constructor,"the property",prop,"was expected to be of type",typeof schema[prop],"but was instead of type",typeof data[prop])}}}else{log("While constructing an instance of",this.prototype.constructor,"an expected property,",prop+",","was not found.","the default value of",schema[prop],"will be used");if(typeof schema[prop]=="function"){this[prop]=schema[prop]()}else{this[prop]=schema[prop]}}}}for(prop in data){if(data.hasOwnProperty(prop)){if(!(prop in schema)){log("While constructing an instance of",this.prototype.constructor,"an unexpected property,",prop+",","was not found on the data returned by the server.")}}}}else{for(prop in data){if(data.hasOwnProperty(prop)){this[prop]=data[prop]}}}};ServerResource.prototype.toString=function(){return JSON.stringify(this)};return ServerResource})(jQuery);
BBV.namespace("orion.oesp.res").Session=orion.oesp.res.Session||(function($,ServerResource){var isYouthPinVerified=false;function Session(data,authenticated){var self=this;ServerResource.call(self,data,self);self.getProtectedData().isAuthenticated=authenticated;self.publisher=orion.app;self.handlers();orion.util.analytics.setUserVars(self)}orion.util.inherits(Session,ServerResource);Session.prototype.handlers=function(){var self=this;self.publisher.subscribe("pinVerified",function(){isYouthPinVerified=true})};Session.prototype.isAuthenticated=function(){var self=this;return self.getProtectedData().isAuthenticated};Session.prototype.hasEntitlement=function(entitlementId){var self=this;var i,length;var type=$.type(entitlementId);var entitled=false;if(type=="array"){length=entitlementId.length;for(i=0;i<length&&!entitled;i++){entitled=self.hasEntitlement(entitlementId[i])}}else{length=self.entitlements.length;for(i=0;i<length&&!entitled;i++){if(self.entitlements[i]===entitlementId){entitled=true}}}return entitled};Session.prototype.hasRbEntitlement=function(entitlementId){var self=this;var i,length;var type=$.type(entitlementId);var entitled=false;if(type=="array"){length=entitlementId.length;for(i=0;i<length&&!entitled;i++){entitled=self.hasRbEntitlement(entitlementId[i])}}else{if(!self.rbEntitlements){self.rbEntitlements=self.entitlements}length=self.rbEntitlements?self.rbEntitlements.length:0;for(i=0;i<length&&!entitled;i++){if(self.rbEntitlements[i]===entitlementId){entitled=true}}}return entitled};Session.prototype.isAdult=function(asset){var self=this;if(asset.isAdult){return true}else{return false}};Session.prototype.isFree=function(asset){var self=this;if($.inArray("FREE",asset.entitlements)>=0){return true}else{return false}};Session.prototype.requiresAdultPin=function(asset){var self=this;return self.isAdult(asset)&&!self.isAdultPinVerified()};Session.prototype.requiresYouthPin=function(asset){var self=this;var isRestrictedByTime;if(isYouthPinVerified){return false}isRestrictedByTime=orion.oesp.profileEndpoint.isRestrictedByTime(asset.parentalRating);if(isRestrictedByTime&&self.isAuthenticated()){return true}else{return false}};Session.prototype.requiresParentalPin=function(asset){var self=this;var isFree=self.isFree(asset);var isAdult=self.isAdult(asset);if(isFree||isAdult||!asset.parentalRating||self.parentalPinVerified){return false}return $.inArray(asset.parentalRating,self.getValidRatingCodes())==-1};Session.prototype.getValidRatingCodes=function(){var self=this;var profileSettings=self.profileSettings;var parentalSettings;var unrestrictedContentRatingCodes;if(profileSettings){parentalSettings=profileSettings.parentalSettings}if(parentalSettings){unrestrictedContentRatingCodes=parentalSettings.unrestrictedContentRatingCodes}if($.type(unrestrictedContentRatingCodes)=="array"){return unrestrictedContentRatingCodes}else{return[]}};Session.prototype.isReplayTVEntitled=function(){return this.customer.replayTvEntitled};Session.prototype.isVip=function(){var self=this;if(self.customer&&$.isArray(self.customer.status)){return $.inArray("vip",self.customer.status)>-1}else{return false}};Session.prototype.isPinVerified=function(){var self=this;return self.parentalPinVerified};Session.prototype.isAdultPinVerified=function(ignorePromptAlways){if(ignorePromptAlways){return this.adultPinVerified}else{return(!BBV.settings.showAdultPinPromptAlways&&this.adultPinVerified)||(BBV.settings.showAdultPinPromptAlways&&this.adultPinVerified&&orion.app.hasCredential())}};Session.prototype.hasAdultPin=function(){var self=this;return self.hasAdultCredential||self.hasAdultCredential===undefined};Session.prototype.isPinDefault=function(){var self=this;var isPinDefault=false;if(self.profileSettings.pinSettings){isPinDefault=self.profileSettings.pinSettings.isDefault}return isPinDefault};Session.prototype.getPermissionToPlayMediaItem=function(mediaItem){return(!BBV.settings.slBasedPinVerificationEnabled)?this.getPermissionToPlayMediaItemClientBased(mediaItem):this.getPermissionToPlayMediaItemSLBased(mediaItem)};Session.prototype.getPermissionToPlayChannel=function(channel,isPlayerVerified){return(!BBV.settings.slBasedPinVerificationEnabled)?this.getPermissionToPlayChannelClientBased(channel,isPlayerVerified):this.getPermissionToPlayChannelSLBased(channel,isPlayerVerified)};Session.prototype.getPermissionToPlayMediaItemClientBased=function(mediaItem){var self=this;var permission=$.Deferred();var adultPinRequired=self.requiresAdultPin(mediaItem);var adultPinVerified=self.isAdultPinVerified(true);var youthPinRequired=self.requiresYouthPin(mediaItem);var parentalPinRequired=self.requiresParentalPin(mediaItem);var purchaseEndpoint=orion.oesp.purchaseEndpoint;var purchaseStatus,offersStatus;if(!self.isAuthenticated()){if(self.hasEntitlement(mediaItem.entitlements)){permission.resolve()}else{permission.reject("login")}}else{if(self.hasEntitlement(mediaItem.entitlements)||mediaItem.isReplayTvAvailable()){if(adultPinRequired){permission.reject("adultpin")}else{if(youthPinRequired){permission.reject("youthpin")}else{if(parentalPinRequired){permission.reject("parentalpin")}else{permission.resolve()}}}}else{purchaseStatus=purchaseEndpoint.requestPurchaseStatus(mediaItem);purchaseStatus.done(function(status){if(status==="isSVOD"){permission.reject("upgrade")}else{if(status==="purchaseRequired"){offersStatus=purchaseEndpoint.requestOffersStatus(mediaItem);offersStatus.done(function(status){if(status==="upgradeRequired"){permission.reject("upgrade")}else{permission.reject("purchase")}})}else{if(adultPinRequired){permission.reject("adultpin")}else{if(youthPinRequired){permission.reject("youthpin")}else{if(parentalPinRequired){permission.reject("parentalpin")}else{permission.resolve()}}}}}});purchaseStatus.fail(function(status){permission.reject(status)})}}return permission.promise()};Session.prototype.getPermissionToPlayChannelClientBased=function(channel,isPlayerVerified){var self=this;var permission=$.Deferred();var stationRequest;stationRequest=channel.requestCurrentStation();stationRequest.done(function(station){if(!self.isAuthenticated()){permission.reject("login")}else{if(!self.isVip()&&!self.hasEntitlement(station.entitlements)){permission.reject("upgrade")}}station.requestCurrentProgram().done(function(program){if(isPlayerVerified){isYouthPinVerified=false;permission.resolve()}else{var ratingCodes=self.getValidRatingCodes();var adultPinRequired=self.isAdult(program)&&!self.isAdultPinVerified();var youthPinRequired=self.requiresYouthPin(program);var parentalPinRequired=self.requiresParentalPin(program);if(!self.isAuthenticated()){permission.reject("login")}else{if(self.isVip()){if(adultPinRequired){permission.reject(self.hasAdultPin()?"adultpin":"noadultpin")}else{if(youthPinRequired){permission.reject("youthpin")}else{if(parentalPinRequired){permission.reject("parentalpin")}else{permission.resolve()}}}}else{if(!self.hasEntitlement(station.entitlements)){permission.reject("upgrade")}else{if(adultPinRequired){permission.reject("adultpin")}else{if(youthPinRequired){permission.reject("youthpin")}else{if(parentalPinRequired){permission.reject("parentalpin")}else{permission.resolve()}}}}}}}}).fail(function(reason){log("orion.widgets.VideoPlayer: unable to aquire current program from channel: ",channel);if(self.requiresYouthPin({parentalRating:18})){permission.reject(self.isAuthenticated()?"youthpin":"login")}else{if(!self.isPinVerified()){permission.reject(self.isAuthenticated()?"parentalpin":"login")}else{permission.resolve()}}})}).fail(function(){log("orion.widgets.VideoPlayer: failed to aquire station or session");permission.reject()});return permission.promise()};Session.prototype.getPermissionToPlayMediaItemSLBased=function(mediaItem){var self=this;var permission=$.Deferred();var purchaseEndpoint=orion.oesp.purchaseEndpoint;var purchaseStatus,offersStatus;if(!self.isAuthenticated()){if(self.hasEntitlement(mediaItem.entitlements)){permission.resolve()}else{permission.reject("login")}}else{if(self.hasEntitlement(mediaItem.entitlements)||mediaItem.isReplayTvAvailable()){permission.resolve()}else{purchaseStatus=purchaseEndpoint.requestPurchaseStatus(mediaItem);purchaseStatus.done(function(status){if(status==="isSVOD"){permission.reject("upgrade")}else{if(status==="purchaseRequired"){offersStatus=purchaseEndpoint.requestOffersStatus(mediaItem);offersStatus.done(function(status){if(status==="upgradeRequired"){permission.reject("upgrade")}else{permission.reject("purchase")}})}else{permission.resolve()}}});purchaseStatus.fail(function(status){permission.reject(status)})}}return permission.promise()};Session.prototype.getPermissionToPlayChannelSLBased=function(channel,isPlayerVerified){var self=this;var permission=$.Deferred();var stationRequest;stationRequest=channel.requestCurrentStation();stationRequest.done(function(station){if(!self.isAuthenticated()){permission.reject("login")}else{if(!self.isVip()&&!self.hasEntitlement(station.entitlements)){permission.reject("upgrade")}}station.requestCurrentProgram().done(function(program){if(isPlayerVerified){isYouthPinVerified=false;permission.resolve()}else{if(!self.isAuthenticated()){permission.reject("login")}else{if(self.isVip()){permission.resolve()}else{if(!self.hasEntitlement(station.entitlements)){permission.reject("upgrade")}else{permission.resolve()}}}}}).fail(function(reason){log("orion.widgets.VideoPlayer: unable to aquire current program from channel: ",channel);permission.resolve()})}).fail(function(){log("orion.widgets.VideoPlayer: failed to aquire station or session");permission.reject()});return permission.promise()};Session.prototype.setModuleState=function(module){var self=this;if(self.isAuthenticated()){orion.Playlist.setState(module);orion.app.recommendations.updateRatedItems(module)}return self};Session.prototype.setModuleStateAll=function(){var self=this;var $modules=$("[data-module-type]");$modules.each(function(){self.setModuleState($(this))})};return Session})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.res").Media=orion.oesp.res.Media||(function($,ServerResource){function Media(data,session){ServerResource.call(this,data,session)}orion.util.inherits(Media,ServerResource);Media.prototype.buildCategoryUrl=function(genre){var self=this;var url=[genre];if(self.medium){var byMedium=self.medium.toLowerCase();if(self.isMyPrime()){byMedium="myprime"}else{if(self.isTVMissed()){byMedium="tvmissed"}else{byMedium="ondemand"}}url.unshift(BBV.settings.site.urls.category[byMedium])}return url.join("")};Media.prototype.buildMediaUrl=function(){var self=this;var url;var byMedium;if(self.isMediaGroup()){url=[encodeURIComponent(self.id),self.encodeTitle()];if(self.medium){if(self.isMyPrime()){url.unshift(BBV.settings.site.urls.mediagroup.myprime[self.medium.toLowerCase()])}else{if(self.isTVMissed()){url.unshift(BBV.settings.site.urls.mediagroup.tvmissed)}else{url.unshift(BBV.settings.site.urls.mediagroup.ondemand[self.medium.toLowerCase()])}}}else{log("Broken mediagroup, missing medium on id: "+encodeURIComponent(self.id)+" title: "+self.encodeTitle())}}else{if(self.isTV()){url=[encodeURIComponent(self.mediaGroupId),self.encodeTitle(),encodeURIComponent(self.id),self.encodeTitle(self.secondaryTitle)];if(self.isMyPrime()){byMedia=BBV.settings.site.urls.media.myprime.tv}else{if(self.isTVMissed()){byMedia=BBV.settings.site.urls.media.tvmissed}else{byMedia=BBV.settings.site.urls.media.ondemand.tv}}url.unshift(byMedia)}else{if(self.isMovie()){url=[encodeURIComponent(self.mediaGroupId),self.encodeTitle(),encodeURIComponent(self.id),self.encodeTitle(self.secondaryTitle)];if(self.isMyPrime()){byMedia=BBV.settings.site.urls.media.myprime.movie}else{byMedia=BBV.settings.site.urls.media.ondemand.movie}url.unshift(byMedia)}}}return url===undefined?"#":url.join("/")+".html"};Media.prototype.encodeTitle=function(title_){var title=title_||this.title;title=title.replace(/ /g,"-").replace(/\//g,"~");return encodeURI(title)};Media.prototype.formatLength=function(){return this.duration?BBV.utils.time.format(this.duration):""};Media.prototype.getBoxArtMedium=function(){var images=this.images;var img="";BBV.each(images,function(idx,itm){if(itm.assetType==="boxart-medium"){img=itm.url;return false}});return img};Media.prototype.getBoxArtSmall=function(){var images=this.images;var img="";BBV.each(images,function(idx,itm){if(itm.assetType==="boxart-small"){img=itm.url;return false}});return img};Media.prototype.getChildMedias=function(){var media=this.currentChildMediaTypeCounts;var display=[];var itm=[];BBV.each(media,function(name,value){var i18nName=value>1?name.replace(" ","")+"Plural":name.replace(" ","");var mediaType=BBV.settings.i18n.mediaType[i18nName];itm.push(value+" ");itm.push(mediaType);display.push(itm.join(""));itm=[]});return display.join(", ")};Media.prototype.getEpisodesMedias=function(){var name="Episode";var media=this.currentChildMediaTypeCounts;var display=[];var itm=[];var value=media[name];if(!value){return}var i18nName=value>1?name.replace(" ","")+"Plural":name.replace(" ","");var mediaType=BBV.settings.i18n.mediaType[i18nName];if(value>1){itm.push(value+" ");itm.push(mediaType);display.push(itm.join(""))}return display.join(", ")};Media.prototype.getCurrency=function(){return BBV.settings.currency.symbol};Media.prototype.getDuration=function(){function addZero(digits){return digits<10?"0"+digits:digits}var endTime=parseInt(this.endTime);var startTime=parseInt(this.startTime);var duration=endTime-startTime;var hour=60*60*1000;var minute=60*1000;var H=Math.floor(duration/hour);var M=Math.floor((duration-(H*hour))/minute);var S=duration-(H*hour)-(M*minute);var durationFormatted=addZero(H)+":"+addZero(M)+":"+addZero(S);return durationFormatted};Media.prototype.getBroadcaster=function(){var providers=orion.entities.providers;var broadcaster=[];var title="";var provider;var ids=this.providerId?this.providerId.split(","):"";if(!providers||!ids){return}for(i=0;i<ids.length;i++){provider=providers[ids[i]];if(provider){title=provider.title;broadcaster.push(title)}}return broadcaster.join(", ")};Media.prototype.getEarliestBroadcastTime=function(){var broadcastTime=this.earliestBroadcastStartTime||this.groupEarliestBroadcastStartTime;var now=new Date().getTime();if(broadcastTime&&broadcastTime<now){return BBV.utils.date(parseInt(broadcastTime)).format(BBV.settings.l10n.date.shortformat)}else{return""}};Media.prototype.getLatestBroadcastTime=function(_latestBroadcastStartTime){var broadcastTime=_latestBroadcastStartTime||this.latestBroadcastStartTime||this.groupLatestBroadcastStartTime;var now=new Date().getTime();if(broadcastTime&&broadcastTime<now){return BBV.utils.date(parseInt(broadcastTime)).format(BBV.settings.l10n.date.shortformat)}else{return""}};Media.prototype.getCast=function(){var data="";if(this.cast){data=this.cast.join(", ")}return data};Media.prototype.getDirectors=function(){var data="";if(this.directors){data=this.directors.join(", ")}return data};Media.prototype.getFormattedAirDate=function(){var airDate=this.startTime;return airDate==null?"":BBV.utils.date(parseInt(airDate)).format(BBV.settings.l10n.date.shortformat)};Media.prototype.getFormattedDate=function(){var dateToDisplay=this.getYear();if(this.isTVMissed()){dateToDisplay=BBV.utils.date(this.latestBroadcastStartTime).format(BBV.settings.l10n.date.longformat)}return dateToDisplay};Media.prototype.getFormattedEpisodeInfo=function(){var episodeInfo="";if(this.seasonNumber){episodeInfo+=this.i18n.season+" "+this.seasonNumber}if(this.seasonNumber&&this.seasonEpisodeNumber){episodeInfo+=" : "}if(this.seasonEpisodeNumber){episodeInfo+=this.i18n.episode+" "+this.seasonEpisodeNumber}return episodeInfo};Media.prototype.hasEpisodeInfo=function(){return this.seasonNumber||this.seasonEpisodeNumber};Media.prototype.getFormattedPlaylistExpirationDate=function(){var maxDays=15;var oneDay=24*60*60*1000;var today=new Date().getTime();var future=today+(maxDays*oneDay);return this.expirationDate&&this.expirationDate>today&&this.expirationDate<future?BBV.utils.date(parseInt(this.expirationDate)).format(BBV.settings.l10n.date.shortformat):false};Media.prototype.getFormattedProductExpirationDate=function(){var expirationDate=this.productExpirationDate;return BBV.utils.date(parseInt(expirationDate)).format(BBV.settings.l10n.date.expirationformat)};Media.prototype.getGenre=function(){var genres=[];var data=this;var uniqueCategories=BBV.unique(data.categories,function(x,y){if(x.id!=null&&y.id!=null){var categoryX=BBV.settings.i18n.genreMap[x.id]||{title:null},categoryY=BBV.settings.i18n.genreMap[y.id]||{title:null};return categoryX.title===categoryY.title}return false});BBV.each(uniqueCategories,function(idx,genre){var category;if(genre.id!==null){category=BBV.settings.i18n.genreMap[genre.id]||{title:null};if(category.title!==null){genres.push('<a href="'+data.buildCategoryUrl(genre.id)+'">'+category.title+"</a>")}}});return genres.join(", ")};Media.prototype.getGenresTitles=function(){var genres=this.categories;var categories=[];for(var i=0;i<genres.length;i++){if(genres[i].title){categories.push(genres[i].title)}}return categories.join(", ")};Media.prototype.getMajorGenre=function(){var self=this;var genres=self.categories;return genres&&genres.length?genres[0].title:""};Media.prototype.getImg=function(){var images=this.images;var imgType=this.imgType||"";var imgStyle=imgType.split("-")[0];var imgSize=imgType.split("-")[1];var img="";BBV.each(images,function(idx,itm){if(itm.assetType===imgStyle+"-"+imgSize){img=itm.url;return false}});return img};Media.prototype.getMedium=function(){var i18nName=value>1?this.medium+"Plural":this.medium;return BBV.settings.i18n.medium[i18nName]};Media.prototype.getStillArtMedium=function(){var images=this.images;var img="";BBV.each(images,function(idx,itm){if(itm.assetType==="still-medium"){img=itm.url;return false}});return img};Media.prototype.getThumb=function(){var img=this.images;var art="";BBV.each(img,function(idx,itm){if(itm.assetType==="still-small"){art=itm.url}});return art};Media.prototype.getYear=function(){return this.year||""};Media.prototype.hasCategories=function(){return(this.categories&&this.categories.length)?this.categories.length:0};Media.prototype.hasChildMedia=function(){return(this.currentChildMediaTypeCounts&&(this.currentChildMediaTypeCounts.Clip||this.currentChildMediaTypeCounts.Episode||this.currentChildMediaTypeCounts.FeatureFilm))?1:0};Media.prototype.hasCurrentProductId=function(productId){var hasId=false;$.each(this.currentProductIds,function(index,value){if(value===productId){hasId=true;return}});return hasId};Media.prototype.hasCurrentTvodProductId=function(productId){var hasId=false;$.each(this.currentTvodProductIds,function(index,value){if(value===productId){hasId=true;return}});return hasId};Media.prototype.hasParentalRating=function(){return !!(this.parentalRating||this.groupParentalRating)};Media.prototype.hasVodType=function(vodType){if(!("currentVodTypes" in this)){return false}for(var i=0;i<this.currentVodTypes.length;i++){var currentVodType=this.currentVodTypes[i];currentVodType=currentVodType.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");if(new RegExp(currentVodType,"i").test(vodType)){return true}}return false};Media.prototype.hiddenEnd=function(){var lastItem=this.length<4?4:this.length;return this.index==lastItem-1?"</div>":""};Media.prototype.hiddenStart=function(){return this.index==3?'<div class="hidden-items">':""};Media.prototype.highestParentalRating=function(){return this.parentalRating||this.groupParentalRating||""};Media.prototype.inPlaylist=function(){if(!this.id){return false}var playlistIds=[];$("#playlist .grid-view .media-item").each(function(index,mediaItem){playlistIds.push($(mediaItem).data("media-id").toString())});return BBV.inArray(this.id.toString(),playlistIds)==-1?false:true};Media.prototype.isEntitlementLocked=function(){var self=this;var session=self.getProtectedData().session;if(session.customer&&$.isArray(session.customer.status)){return $.inArray("vip",session.customer.status)>-1}else{return false}};Media.prototype.isExpandable=function(){return this.index>=3};Media.prototype.isExpiring=function(){var today=new Date().getTime();var tomorrow=today+(24*60*60*1000);return this.expirationDate?this.expirationDate<tomorrow:false};Media.prototype.isFirstItem=function(){return this.index==0};Media.prototype.isLastItem=function(){return this.index==this.length-1};Media.prototype.isMediaGroup=function(){return BBV.isObj(this.currentChildMediaTypeCounts)};Media.prototype.isMovie=function(){return this.medium==="Movie"};Media.prototype.isMovieItem=function(){return(this.medium==="Movie"&&!BBV.isObj(this.currentChildMediaTypeCounts))};Media.prototype.isPlayable=function(){var self=this;return !self.isMediaGroup()||self.medium&&self.medium.toLowerCase()==="movie"};Media.prototype.isProductExpiring=function(){var today=new Date().getTime();var tomorrow=today+(24*60*60*1000);return this.productExpirationDate?this.productExpirationDate<tomorrow:false};Media.prototype.isSVOD=function(){return this.hasVodType("SVOD")};Media.prototype.isTV=function(){return this.medium==="TV"};Media.prototype.isTVMissed=function(){return this.medium==="TV"&&this.hasOwnProperty("latestBroadcastStartTime")};Media.prototype.isMyPrime=function(){return BBV.settings.myPrime.providerIds&&BBV.settings.myPrime.providerIds.length&&BBV.settings.myPrime.providerIds.indexOf(parseInt(this.providerId))!==-1};Media.prototype.isTVItem=function(){return(this.medium==="TV"&&!BBV.isObj(this.currentChildMediaTypeCounts))};Media.prototype.isTVOD=function(){return this.hasVodType("TVOD")};Media.prototype.localizeText=function(){return function(text){return" "+this.localStrings[text]+" "}};Media.prototype.lowerCase=function(){return function(text){if(this[text]){return this[text].toLowerCase()}else{return this[text]}}};Media.prototype.truncatedTitle=function(){var titleLength=this.title.length;if(titleLength>=32){return this.title.substring(0,32)+"..."}else{return this.title}};Media.prototype.getAudioLanguage=function(){var assetType="Orion-HLS";var languages=[];if(this.videoStreams&&this.videoStreams.length){var length=this.videoStreams.length;var streams=this.videoStreams;for(var i=0;i<length;i++){if(streams[i].assetType==assetType){languages.push(streams[i].language)}}}if(languages.length){return languages.filter(function(item,pos){return languages.indexOf(item)==pos}).join(", ")}else{return""}};return Media})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.res").MediaItem=orion.oesp.res.MediaItem||(function($,Media){function MediaItem(data,session){var self=this;Media.call(self,data,session)}orion.util.inherits(MediaItem,Media);MediaItem.DisplayContext={GRID:1,LIST:2};MediaItem.prototype.render=function(context){var self=this;var template;if(context){switch(context){case MediaItem.DisplayContext.GRID:template=orion.templates.MediaItem;break;case MediaItem.DisplayContext.LIST:template=orion.templates.MediaItem;break;default:template=orion.templates.MediaItem;break}}else{template=orion.templates.MediaItem}return Mustache.to_html(template,self)};MediaItem.prototype.isFeatureFilm=function(){var self=this;if(self.mediaType=="FeatureFilm"){return true}else{return false}};MediaItem.prototype.isTrailer=function(){var self=this;if(self.mediaType=="Trailer"){return true}else{return false}};MediaItem.prototype.isPreview=function(){var self=this;if(self.mediaType=="Preview"){return true}else{return false}};MediaItem.prototype.getBackgroundImageUrl=function(){var self=this;return self.getImageUrlByType("aspot-large")};MediaItem.prototype.getImageUrlByType=function(type){var self=this;var i,len;if(self.images){len=self.images.length;for(i=0;i<len;i++){if(self.images[i].assetType===type){return self.images[i].url}}}return""};MediaItem.prototype.isPlayable=function(){return true};MediaItem.prototype.isTVOD=function(){return this.hasVodType("tvod")};MediaItem.prototype.isSvod=function(){return this.hasVodType("svod")};return MediaItem})(jQuery,orion.oesp.res.Media);
BBV.namespace("orion.oesp.res").MediaGroup=orion.oesp.res.MediaGroup||(function($,Media){function MediaGroup(data,session){Media.call(this,data,session)}orion.util.inherits(MediaGroup,Media);MediaGroup.prototype.render=function(){var self=this;return Mustache.to_html(orion.templates.MediaGroup,self)};MediaGroup.prototype.getBackgroundImageUrl=function(imageType){var images=this.images;var assetType=imageType||"web-titlecard-background";if(images){for(var i=0;i<images.length;i++){if(images[i].assetType==assetType){return this.images[i].url}}}return""};MediaGroup.prototype.isPlayable=function(){var self=this;return self.medium.toLowerCase()==="movie"};return MediaGroup})(jQuery,orion.oesp.res.Media);
BBV.namespace("orion.oesp.res").Bookmark=orion.oesp.res.Bookmark||(function($,ServerResource){function Bookmark(data,session){var self=this;ServerResource.call(self,data,session)}orion.util.inherits(Bookmark,ServerResource);Bookmark.schema={programId:"",offset:0,playState:"",lastUpdated:""};return Bookmark})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.res").Station=orion.oesp.res.Station||(function($,ServerResource){function Station(data,session){var self=this;if(!(self instanceof Station)){return new Station(data,session)}ServerResource.call(self,data,session)}orion.util.inherits(Station,ServerResource);Station.prototype.requestCurrentProgram=function(){var self=this;var deferred=$.Deferred();var now=new Date();var year=now.getFullYear();var month=now.getMonth();var day=now.getDate();var hours=now.getHours();var minutes=(Math.floor(now.getMinutes()/5)*5)%60;var seconds=0;var roundedDate=new Date(year,month,day,hours,minutes,seconds).getTime();var query={byStationId:self.id,byStartTime:"~"+(roundedDate+5*60*1000),byEndTime:(roundedDate-5*60*1000)+"~"};var listingsRequest=orion.oesp.listingEndpoint.requestListings(query);listingsRequest.done(function(data){var listings=data.listings;var postRequestNow=$.now();var currentProgram;var i,listing;for(i=0;i<listings.length&&!currentProgram;i++){listing=listings[i];if(listing.startTime<=postRequestNow&&listing.endTime>=postRequestNow){currentProgram=listing.program}}if(currentProgram){deferred.resolve(currentProgram)}else{deferred.reject("PLAYER_PROGRAM_NOT_FOUND")}});return deferred.promise()};return Station})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.res").Channel=orion.oesp.res.Channel||(function($,ServerResource){function Channel(data,session){var self=this;ServerResource.call(self,data,session)}orion.util.inherits(Channel,ServerResource);Channel.prototype.requestCurrentStation=function(){var self=this;var deferred=$.Deferred();deferred.resolve(new orion.oesp.res.Station(self.stationSchedules[0].station,self.getProtectedData().session));return deferred.promise()};Channel.prototype.getBackgroundImageUrl=function(imageType){var self=this;var assetType=imageType||"aspot-large";var images=self.stationSchedules[0].station.images;var i,len;if(images){len=images.length;for(i=0;i<len;i++){if(images[i].assetType==assetType){return self.images[i].url}}}return""};Channel.prototype.getName=function(){var self=this;return self.stationSchedules[0].station.title};Channel.prototype.extractName=Channel.prototype.getName;Channel.prototype.getChannelActiveImage=function(){var self=this;var imgs=self.stations[0].station.images;var thumb;BBV.each(imgs,function(idx,val){if(val.assetType==="station-logo-medium"){thumb=val}});return(thumb&&thumb.url)?thumb.url:""};Channel.prototype.getImageByAssetType=function(asset){var self=this;var imgs=this.stationSchedules[0].station.images;var thumb;BBV.each(imgs,function(idx,val){if(val.assetType===asset){thumb=val;return false}});return(thumb&&thumb.url)?thumb.url:""};Channel.prototype.getChannelInactiveImage=function(){var self=this;var imgs=this.stations[0].station.images;var thumb;BBV.each(imgs,function(idx,val){if(val.assetType==="station-logo-small"){thumb=val}});return(thumb&&thumb.url)?thumb.url:""};Channel.prototype.getStation=function(){var self=this;if(self.stationSchedules&&self.stationSchedules.length){return self.stationSchedules[0].station}return{}};Channel.prototype.getChannelUrl=function(){var self=this;var id=self.getStation().id;var channels=BBV.settings.site.urls.channels;if(self.isLive()){return channels.live+"/"+id}else{return channels.vod+"/"+id}};Channel.prototype.isLive=function(){var self=this;var channelMethods=orion.modules.EPG.TemplateHelperMethods.channels;return(BBV.player.isSilverlight()&&channelMethods.hasHSSStream(self))||(!BBV.player.isSilverlight()&&self.hasLiveStream)};Channel.prototype.getEntitlements=function(){var self=this;if(self.stationSchedules&&self.stationSchedules.length){return self.stationSchedules[0].station.entitlements}return[]};return Channel})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.res").Device=orion.oesp.res.Device||(function($,ServerResource){function Device(data,session){ServerResource.call(this,data,session)}orion.util.inherits(Device,ServerResource);Device.prototype.getFormattedDeviceRegistered=function(){var registered=this.registered;return registered==null?"":BBV.utils.date(parseInt(registered)).format(BBV.settings.l10n.date.deviceregistered)};return Device})(jQuery,orion.oesp.res.ServerResource);BBV.namespace("orion.oesp.res").DeviceRegistrationStatusInfo=orion.oesp.res.DeviceRegistrationStatusInfo||(function($,ServerResource){function DeviceRegistrationStatusInfo(data,session){ServerResource.call(this,data,session)}orion.util.inherits(DeviceRegistrationStatusInfo,ServerResource);DeviceRegistrationStatusInfo.prototype.getFormattedNextDeviceChange=function(){var nextDeviceChange=this.nextDeviceChange;return nextDeviceChange==null?"":BBV.utils.date(parseInt(nextDeviceChange)).format(BBV.settings.l10n.date.nextdevicechange)};return DeviceRegistrationStatusInfo})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.res").Listing=orion.oesp.res.Listing||(function($,ServerResource){function Listing(data,session){var self=this;ServerResource.call(self,data,session)}orion.util.inherits(Listing,ServerResource);Listing.prototype.getBoxArtMedium=function(){var images=this.images,img="";if(!images&&this.program){images=this.program.images}BBV.each(images,function(idx,itm){if(itm.assetType==="boxart-medium"){img=itm.url;return false}});return img};Listing.prototype.getCategoryString=function(){var self=this;return $.map(self.categories,function(item,index){return item.id||""}).join(" ")};Listing.prototype.getFormattedTime=function(){var adjustedStartTime=BBV.utils.adjustToServerTime(this.startTime);var adjustedEndTime=BBV.utils.adjustToServerTime(this.endTime);return adjustedStartTime.format("HH:m")+"-"+adjustedEndTime.format("HH:m")};Listing.prototype.getFormattedDateTime=function(format){var pattern=format?format:BBV.settings.l10n.date.shortformat;return BBV.utils.adjustToServerTime(this.startTime).format(pattern)};Listing.prototype.getAbsoluteUrl=function(){var url="#";if(this.stationId&&this.startTime){url=BBV.settings.site.urls.channels.live+"/"+this.stationId+"/"+this.startTime}return url};Listing.prototype.buildMediaUrl=Listing.prototype.getAbsoluteUrl;Listing.prototype.getListingUrl=Listing.prototype.getAbsoluteUrl;Listing.prototype.truncatedTitle=function(){var title=this.program.title;var titleLength=title.length;if(titleLength>=32){return title.substring(0,32)+"..."}else{return title}};Listing.prototype.isReplayTV=function(){return this.replayTvAvailable};Listing.prototype.getBroadcaster=function(){var stations=orion.entities.stationSchedules;var broadcaster=[];var title="";var station;var ids=this.stationId?this.stationId.split(","):"";if(!stations||!ids){return}for(i=0;i<ids.length;i++){station=stations[ids[i]];if(station){title=station.title;broadcaster.push(title)}}return broadcaster.join(", ")};Listing.prototype.getChildMedia=function(){var media=this.currentChildMediaTypeCounts,display=[],itm=[];BBV.each(media,function(name,value){i18nName=value>1?name.replace(" ","")+"Plural":name.replace(" ","");mediaType=BBV.settings.i18n.mediaType[i18nName];itm.push(value+" ");itm.push(mediaType);display.push(itm.join(""));itm=[]});return display.join(", ")};Listing.prototype.getUpcomingLink=function(){var self=this;var link=[BBV.settings.site.urls.search.tvresults,"?q="];var title=self.title||"";link.push(encodeURIComponent(title.replace(/\s/g,"+")));return link.join("")};return Listing})(jQuery,orion.oesp.res.ServerResource);
BBV.namespace("orion.oesp.req").SessionEndpoint=orion.oesp.req.SessionEndpoint||(function($,Session,routes){var SESSION_COOKIE_NAME=BBV.settings.cookie.tokenName;var clientVersion=BBV.settings.version.major+"."+BBV.settings.version.minor+"."+BBV.settings.version.micro;function SessionEndpoint(){var self=this;if(!(self instanceof SessionEndpoint)){return new SessionEndpoint()}self.session=$.Deferred();self.session.done(function(session){orion.util.oesp.session=session});self.sessionPromise=self.session.promise();self.sessionCookie=BBV.utils.cookie(SESSION_COOKIE_NAME);if(self.sessionCookie.exists){log("There is a session cookie, testing its credentials.");self.testCredentials(self.sessionCookie.get("username"),self.sessionCookie.get("oespToken")).success(function testCredentialsSuccess(data){log("Credentials are valid.");self.session.resolve(new Session(data,true))}).error(function testCredentialsError(event){if(event.statusCode().status===0){log("SessionEndpoint:: Session check canceled by click before session call completed")}else{log("Credentials are invalid.");BBV.utils.cookie.remove(SESSION_COOKIE_NAME);self.aquireAnonymousCredentials()}})}else{self.aquireAnonymousCredentials()}self.sessionPromise.login=$.proxy(self.login,self);self.sessionPromise.logout=$.proxy(self.logout,self);self.sessionPromise.withSession=$.proxy(self.withSession,self);return self.sessionPromise}SessionEndpoint.prototype.testCredentials=function(username,oespToken){var req=$.ajax({url:orion.util.url.fixedOESPURL(routes.session),type:"GET",data:"{}",dataType:"json",contentType:"application/json",headers:{"X-OESP-Token":oespToken,"X-OESP-Username":username,Accept:"application/json","X-Client-Id":clientVersion+"||"+navigator.userAgent}});req.done(function getTimeOffset(d,s,xhr){orion.util.oesp.serverTimeOffset=(new Date(xhr.getResponseHeader("Date"))).getTime()-(new Date()).getTime()});return req};SessionEndpoint.prototype.aquireAnonymousCredentials=function(){var self=this;var req=$.ajax(orion.util.url.fixedOESPURL(routes.session),{type:"GET",headers:{"X-Client-Id":clientVersion+"||"+navigator.userAgent},success:function(data,s,xhr){orion.util.oesp.serverTimeOffset=(new Date(xhr.getResponseHeader("Date"))).getTime()-(new Date()).getTime();self.session.resolve(new Session(data,false))},error:function(){}});return req};SessionEndpoint.prototype.logout=function logout(callback){var self=this;self.session.done(function(credentials){if(credentials.isAuthenticated()){$.ajax(orion.util.url.fixedOESPURL(routes.session),{type:"DELETE",headers:{"X-OESP-Token":credentials.oespToken,"X-OESP-Username":credentials.username,"X-Client-Id":clientVersion+"||"+navigator.userAgent},always:function(){cleanUp()}})}else{cleanUp()}});function cleanUp(){BBV.user().logout();callback()}return self.sessionPromise};SessionEndpoint.prototype.login=function(username,password){var self=this;return self.session.pipe(function(credentials){return $.ajax(orion.util.url.fixedOESPURL(routes.session),{dataType:"json",contentType:"application/json",type:"POST",headers:{"X-OESP-Token":credentials.oespToken,"X-OESP-Username":credentials.username,Accept:"application/json","X-Client-Id":clientVersion+"||"+navigator.userAgent},data:JSON.stringify({username:username,password:password})})}).pipe(function(data){return new Session(data,true)})};SessionEndpoint.prototype.withSession=function withSession(callback){var self=this;self.session.done(callback);return self.sessionPromise};return SessionEndpoint})(jQuery,orion.oesp.res.Session,orion.oesp.routes);
BBV.namespace("orion.oesp").Request=orion.oesp.req.request||(function($){var clientVersion=BBV.settings.version.major+"."+BBV.settings.version.minor+"."+BBV.settings.version.micro;var DEFAULT_OPTIONS={cache:true,dataType:"json",timeout:10000,processData:false,oespSessionOverride:null,contentType:"application/json",headers:{Accept:"application/json","X-Client-Id":clientVersion+"||"+navigator.userAgent},xhrFields:{withCredentials:true}};function Request(url,options,format){if(url&&typeof url=="object"){formatter=options;options=url;url=undefined}options=options||{};if(!options.url){if(typeof url=="string"){options.url=url}else{throw new Error("Request is missing a URL")}}function makeRequest(session){var jqxhr;var headers={headers:{"X-OESP-Token":session.oespToken,"X-OESP-Username":session.username}};options=$.extend(true,headers,DEFAULT_OPTIONS,options);options.url=orion.util.url.fixedOESPURL(options.url);jqxhr=$.ajax(options);if(format){return jqxhr.pipe(function(data){return format(data,session)})}else{return jqxhr}}if(!!options.oespSessionOverride){log("overriding session");return makeRequest(options.oespSessionOverride)}else{return orion.oesp.session.pipe(makeRequest)}}return Request})(jQuery);
BBV.namespace("orion.oesp.req").Endpoint=orion.oesp.req.Endpoint||(function($){function Endpoint(){}Endpoint.prototype.encode=function(data){var stringified;if(typeof data=="object"){if(data.toString&&data.toString!=Object.prototype.toString&&typeof data.toString=="function"){stringified=data.toString();if(stringified!="[object Object]"){data=stringified}}if(typeof data=="object"){data=JSON.stringify(data)}}return data};Endpoint.prototype.queryToString=function(query){var param;var queryStringBuilder=[];if(!query){return""}for(param in query){if(query.hasOwnProperty(param)){queryStringBuilder.push(param+"="+query[param])}}return queryStringBuilder.join("&")};return Endpoint})(jQuery);
BBV.namespace("orion.oesp.req").PurchaseEndpoint=orion.oesp.req.PurchaseEndpoint||(function($,routes,Request,Endpoint){function requestMediaItems(isAdultVerified){var self=this;var deferred=$.Deferred();self.done(function(data){var productIds;var query;var mediaItemRequest;if(data&&data.products&&$.type(data.products)=="array"&&data.products.length){productIds=$.map(data.products,function(product){return product.id}).join("|");log("productIds",productIds);query={byProductIds:productIds,includeInactive:true};if(isAdultVerified){query.includeAdult=true}mediaItemRequest=orion.oesp.mediaItemEndpoint.requestMediaItems(query);mediaItemRequest.done(function(mediaItems){deferred.resolve(mediaItems)})}else{deferred.reject()}});return deferred.promise()}function PurchaseEndpoint(){var self=this;orion.oesp.session.done(function(session){if(session.isAuthenticated()){self.activePurchases=self.requestActivePurchases()}});Endpoint.call(self)}orion.util.inherits(PurchaseEndpoint,Endpoint);PurchaseEndpoint.prototype.makePurchase=function(productId,offerId,pw){var self=this;var url=routes.purchase;var options={type:"POST",data:self.encode({productId:productId,offerId:offerId,credential:pw})};var request=new Request(url,options);return request};PurchaseEndpoint.prototype.requestActivePurchases=function(){var self=this;var url=routes.purchaseactive;var options={type:"GET"};var request=new Request(url,options);request.requestMediaItems=requestMediaItems;return request};PurchaseEndpoint.prototype.requestProductOffers=function(productId){var self=this;var url=routes.purchaseoffers+"/"+self.encode(productId);var options={type:"GET"};var request=new Request(url,options);return request};PurchaseEndpoint.prototype.requestSetOfProductOffers=function(currentTvodProductIds){var self=this;var requests=[];var deferred=$.Deferred();$.each(currentTvodProductIds,function(index,id){requests.push(self.requestProductOffers(id))});$.when.apply($,requests).then(function processItem(data1,data2){var items=[];if($.type(data1)==="array"){items.push(self.mergeOfferItems(data1));items.push(self.mergeOfferItems(data2));output=self.mergeOfferItems(items)}else{output=data1}deferred.resolve(output)});return deferred.promise()};PurchaseEndpoint.prototype.mergeOfferItems=function(items){var output=null;if($.type(items)==="array"){for(var i=0;i<items.length;i++){if($.isPlainObject(items[i])){if(!output){output=items[i];continue}if(items[i].products){for(var j=0;j<items[i].products.length;j++){output.products.push(items[i].products[j])}output.entryCount+=1;output.totalResults+=1}}}}return output};PurchaseEndpoint.prototype.requestPurchaseStatus=function(mediaItem){var self=this;var deferred=$.Deferred();if(mediaItem.isTVOD()){self.activePurchases.done(function(data){var i,l;var purchases=data.products;var item;var purchased;if(!purchases.length){deferred.resolve("purchaseRequired",data)}else{for(i=0,l=purchases.length;i<l&&!purchased;i++){item=purchases[i];if(mediaItem.hasCurrentTvodProductId(item.id)&&item.isEntitled){purchased=true}}if(!purchased){deferred.resolve("purchaseRequired",data)}else{deferred.resolve("purchased",data)}}});self.activePurchases.fail(function(response){deferred.reject("activePurchases",response)})}else{deferred.resolve("isSVOD")}return deferred.promise()};PurchaseEndpoint.prototype.requestOffersStatus=function(mediaItem){var self=this;var deferred=$.Deferred();var purchaseStatus=self.requestPurchaseStatus(mediaItem);var offersRequest;purchaseStatus.done(function(status){if(status==="isSVOD"||status==="purchased"){deferred.resolve(status)}else{offersRequest=self.requestSetOfProductOffers(mediaItem.currentTvodProductIds);offersRequest.done(function(offers){if(offers.totalResults){deferred.resolve("purchaseRequired",offers)}else{deferred.resolve("upgradeRequired")}});offersRequest.fail(function(response){deferred.reject("offers",response)})}});return deferred.promise()};return PurchaseEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").MediaItemEndpoint=orion.oesp.req.MediaItemEndpoint||(function($,routes,Request,Endpoint,MediaItem,Feed){function MediaItemEndpoint(){Endpoint.call(this)}orion.util.inherits(MediaItemEndpoint,Endpoint);var ANY=/.*/;var NUMBER=/\d+/;var RANGE=/\d+-\d+/;var CRID=ANY;var BOOLEAN=/true|false/;MediaItemEndpoint.FilterParams={byCategories:ANY,byCategoryIds:CRID,byIsAdult:BOOLEAN,byMediaGroupId:CRID,byMediaType:ANY,byMedium:ANY,byProductIds:CRID,byId:CRID,byProvider:ANY,byProviderId:CRID,byEntitlements:ANY,byTags:ANY,byTitle:ANY,byTitlePrefix:ANY,endIndex:ANY,includeAdult:BOOLEAN,includeInactive:BOOLEAN,range:RANGE,sort:ANY,startIndex:NUMBER};MediaItemEndpoint.SortParams={secondaryTitle:ANY,tvSeasonEpisodeNumber:ANY,tvSeasonNumber:ANY};MediaItemEndpoint.queryToString=function(query){var param;var queryStringBuilder=[];if(!query){return""}for(param in query){if(MediaItemEndpoint.FilterParams.hasOwnProperty(param)||MediaItemEndpoint.SortParams.hasOwnProperty(param)){queryStringBuilder.push(param+"="+query[param])}}return queryStringBuilder.join("&")};MediaItemEndpoint.format=function(data,session){if(data.mediaItems){data.mediaItems=$.map(data.mediaItems,function(item){return new MediaItem(item,session)})}else{data=new MediaItem(data,session)}return data};MediaItemEndpoint.prototype.requestMediaItem=function(mediaItemId){var self=this;var query={};var dfd=$.Deferred();orion.oesp.session.done(function(session){if(self.includeAdult(session)){query.includeAdult=true}var queryString=MediaGroupEndpoint.queryToString(query);var url=routes.mediaitems+"/"+mediaItemId+"?"+queryString;var options={type:"GET"};var request=new Request(url,options,MediaItemEndpoint.format);request.done(function(data){dfd.resolve(data)});request.fail(function(){dfd.reject()})});return dfd.promise()};MediaItemEndpoint.prototype.requestMediaItems=function(query){var self=this;var query=query||{};var dfd=$.Deferred();orion.oesp.session.done(function(session){if(!("includeAdult" in query)&&self.includeAdult(session)){query.includeAdult=true}var queryString=MediaItemEndpoint.queryToString(query);var url=routes.mediaitems+"?"+queryString;var options={type:"GET"};var request=new Request(url,options,MediaItemEndpoint.format);request.done(function(data){dfd.resolve(data)});request.fail(function(){dfd.reject()})});return dfd.promise()};MediaItemEndpoint.prototype.get=function(query){var self=this;var url=routes.mediaitems;var options={type:"GET"};var request;query=query||{};if(query.id){return self.requestMediaItem(query.id)}url+="?"+MediaItemEndpoint.queryToString(query);request=new Request(url,options,MediaItemEndpoint.format);return request};MediaItemEndpoint.prototype.includeAdult=function(session){return session.isAuthenticated()&&session.isAdultPinVerified(true)};return MediaItemEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint,orion.oesp.res.MediaItem,orion.oesp.res.Feed);
BBV.namespace("orion.oesp.req").MediaGroupEndpoint=orion.oesp.req.MediaGroupEndpoint||(function($,routes,Request,Endpoint,MediaGroup,Feed){function MediaGroupEndpoint(){Endpoint.call(this)}orion.util.inherits(MediaGroupEndpoint,Endpoint);MediaGroupEndpoint.queryToString=function(query){var param;var queryStringBuilder=[];if(!query){return""}for(param in query){queryStringBuilder.push(param+"="+query[param])}return queryStringBuilder.join("&")};MediaGroupEndpoint.format=function(data,session){if(data.mediaGroups){data.mediaGroups=$.map(data.mediaGroups,function(item){return new MediaGroup(item,session)})}else{data=new MediaGroup(data,session)}return data};MediaGroupEndpoint.prototype.requestFormattedMediaGroup=function(mediaGroupId){var self=this;var query={};var dfd=$.Deferred();orion.oesp.session.done(function(session){if(self.includeAdult(session)){query.includeAdult=true}var queryString=MediaGroupEndpoint.queryToString(query);var url=routes.mediagroups+"/"+mediaGroupId+"?"+queryString;var options={type:"GET"};var request=new Request(url,options,MediaGroupEndpoint.format);request.done(function(data){dfd.resolve(data)});request.fail(function(){dfd.reject()})});return dfd.promise()};MediaGroupEndpoint.prototype.includeAdult=function(session){return session.isAuthenticated()&&session.isAdultPinVerified(true)};MediaGroupEndpoint.prototype.get=function(query){};return MediaGroupEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint,orion.oesp.res.MediaGroup,orion.oesp.res.Feed);
BBV.namespace("orion.oesp.req").ProviderEndpoint=orion.oesp.req.ProviderEndpoint||(function($,routes,Request,Endpoint){function ProviderEndpoint(){Endpoint.call(this)}orion.util.inherits(ProviderEndpoint,Endpoint);ProviderEndpoint.prototype.getProviderById=function(id){var self=this;var url=routes.providers+(id?"/"+id:"");var options={type:"GET"};var request=orion.util.oesp.get(url,options);return request};ProviderEndpoint.prototype.get=function(query){var self=this;var url=routes.providers;var options={type:"GET"};var request;query=query||{};if(query.id){return self.getProviderById(query.id)}url+="?"+self.queryToString(query);request=orion.util.oesp.get(url,options);return request};return ProviderEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").BookmarkEndpoint=orion.oesp.req.BookmarkEndpoint||(function($,routes,Request,Endpoint){function BookmarkEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(BookmarkEndpoint,Endpoint);BookmarkEndpoint.prototype.get=function(query){var self=this;var url=routes.bookmarks;var options={type:"GET"};var request;query=query||{};if(query.id){return self.requestBookmarks(query.id)}url+="?"+self.queryToString(query);request=orion.util.oesp.get(url,options);return request};BookmarkEndpoint.prototype.requestBookmarks=function(programId){var self=this;var maxRequests=40;var url=routes.bookmarks+(programId?"/"+programId:"")+"?range=1-"+maxRequests;var options={type:"GET"};var request=orion.util.oesp.get(url,options);return request};BookmarkEndpoint.prototype.setBookmark=function(bookmark){var self=this;var url=routes.bookmarks+"/"+bookmark.programId;var options={type:"PUT",data:bookmark};var request=orion.util.oesp.put(url,options);return request};BookmarkEndpoint.prototype.clearBookmarks=function(){var self=this;var url=routes.bookmarks;var options={type:"DELETE"};var request=orion.util.oesp.del(url,options);return request};return BookmarkEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").ChannelEndpoint=orion.oesp.req.ChannelEndpoint||(function($,routes,Request,Endpoint,Channel){function ChannelEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(ChannelEndpoint,Endpoint);ChannelEndpoint.format=function(data,session){if(data.channels){data.channels=$.map(data.channels,function(item){return new Channel(item,session)})}else{data=new Channel(data,session)}return data};ChannelEndpoint.queryToString=function(query){var param;var queryStringBuilder=[];if(!query){return""}for(param in query){if(query.hasOwnProperty(param)){queryStringBuilder.push(param+"="+query[param])}}return queryStringBuilder.join("&")};function _prepChannel(channel,session){if(channel.subChannels&&channel.subChannels.length>0){var replaceWith=false;if(!channel.stationSchedules[0].station.isHd){var subChannel=channel.subChannels[0];var chanEnt=subChannel.stationSchedules[0].station.entitlements;if(session.hasEntitlement(chanEnt)){replaceWith=subChannel}}else{if(channel.stationSchedules[0].station.isHd&&!session.hasEntitlement(channel.stationSchedules[0].station.entitlements)){replaceWith=channel.subChannels[0]}}if(replaceWith){channel=ChannelEndpoint.format(replaceWith,session)}}if(channel.subChannels){delete channel.subChannels}return channel}ChannelEndpoint.prototype.requestChannel=function(channelId){var self=this;var dfd=$.Deferred();var channelData;orion.oesp.session.done(function(session){var url=routes.channels+"/"+channelId+"?byLocationId="+session.locationId+self.personalize(session);var options={type:"GET"};var request=new Request(url,options,ChannelEndpoint.format);request.done(function(data){channelData=_prepChannel(data,session);dfd.resolve(channelData)});request.fail(function(){log("orion.oesp.req.ChannelEndpoint:","There was an error formatting the channel response from the OESP.","channelId:",channelId);var liveChannelUrl=$(".navigation-bar a[data-rel=#live-channels]");if(liveChannelUrl.length>0){window.location.href=$(liveChannelUrl[0]).attr("href")}})});return dfd.promise()};ChannelEndpoint.prototype.requestChannelByStationId=function(stationId){var self=this;var dfd=$.Deferred();var channelData;orion.oesp.session.done(function(session){var url=routes.channels+"?byStationId="+stationId+"&byLocationId="+session.locationId+self.personalize(session);var options={type:"GET"};var request=new Request(url,options,ChannelEndpoint.format);request.done(function(data){channelData=_prepChannel(data.channels[0],session);dfd.resolve(channelData)});request.fail(function(){log("orion.oesp.req.ChannelEndpoint:","There was an error formatting the channel response from the OESP.","stationId:",stationId);var liveChannelUrl=$(".navigation-bar a[data-rel=#live-channels]");if(liveChannelUrl.length>0){window.location.href=$(liveChannelUrl[0]).attr("href")}})});return dfd.promise()};ChannelEndpoint.prototype.requestChannels=function(query){var self=this;return orion.oesp.session.pipe(function(session){var queryString;var url;query=query||{};if(!query.hasOwnProperty("byLocationId")){query.byLocationId=session.locationId}if(!query.hasOwnProperty("personalised")){query.personalised=routes.config.channels.personalizationEnabled&&session.isAuthenticated()}queryString=ChannelEndpoint.queryToString(query);url=routes.channels+"?"+queryString;var options={type:"GET"};var request=new Request(url,options,ChannelEndpoint.format);request=request.pipe(function(data){$.each(data.channels,function(idx,channel){data.channels[idx]=_prepChannel(channel,session)});return data});return request})};ChannelEndpoint.prototype.personalize=function(session){var enabled=routes.config.channels.personalizationEnabled||true;return enabled&&session.isAuthenticated()?"&personalised=true":""};return ChannelEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint,orion.oesp.res.Channel);
BBV.namespace("orion.oesp.req").SearchEndpoint=orion.oesp.req.SearchEndpoint||(function($,routes,Request,Endpoint){function SearchEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(SearchEndpoint,Endpoint);SearchEndpoint.prototype.constants={allTypes:["linear","catchup","ondemand"],vodTypes:["catchup","ondemand"]};SearchEndpoint.format=function(data,session){data.results=$.map(data.results,function(item){if(item.ondemand||item.catchup){var coerced=item.ondemand||item.catchup;coerced.mediaGroup=new orion.oesp.res.MediaGroup(coerced.mediaGroup,session);return coerced}else{if(item.listing){return new orion.oesp.res.Listing(item.listing,session)}}});return data};SearchEndpoint.prototype.predictiveSearch=function(query,date){var self=this;var url=routes.search+this.getSearchParams("all")+"&byBroadcastTime="+date+"-"+(date+7*24*60*60*1000);url+=((url.indexOf("?")==-1)?"?":"&");url+="q="+query;url+="&range=1-10";var options={type:"GET"};var request=new Request(url,options,SearchEndpoint.format);return request};SearchEndpoint.prototype.getListOfTypes=function(initialList){return initialList.filter(function(el){return BBV.settings.searchDisabledTypes.indexOf(el)<0}).join()};SearchEndpoint.prototype.getSearchParams=function(type){var self=this;var ordering="ASC";var mediaItemSort="";var searchType="";switch(type){case"all":searchType=self.getListOfTypes(self.constants.allTypes);break;case"vod":mediaItemSort="&mediaItemSort=broadcastStartTime|DESC";searchType=self.getListOfTypes(self.constants.vodTypes);ordering="DESC";break;default:searchType=self.getListOfTypes([type])}if(searchType==""){log("Usage of '"+type+"' is prohibited in search")}return"?byTypes="+searchType+"&sort=broadcastStartTime|"+ordering+mediaItemSort};SearchEndpoint.prototype.getEPGSearchURL=function(){return routes.search+this.getSearchParams("linear")};SearchEndpoint.prototype.getVODSearchURL=function(){return routes.search+this.getSearchParams("vod")};return SearchEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").ListingEndpoint=orion.oesp.req.ListingEndpoint||(function($,routes,Request,Endpoint,Listing){function ListingEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(ListingEndpoint,Endpoint);ListingEndpoint.format=function(data){if(data.listings){data.listings=$.map(data.listings,function(item){return new Listing(item)})}else{data=new Listing(data)}return data};ListingEndpoint.queryToString=function(query){var param;var queryStringBuilder=[];if(!query){return""}for(param in query){if(query.hasOwnProperty(param)){queryStringBuilder.push(param+"="+query[param])}}return queryStringBuilder.join("&")};ListingEndpoint.prototype.requestListing=function(listingId){var self=this;return orion.oesp.session.pipe(function(session){var url=routes.listings+"/"+listingId+"?byLocationId="+session.locationId;var options={type:"GET"};var request=new Request(url,options,ListingEndpoint.format);return request})};ListingEndpoint.prototype.requestListings=function(query){var self=this;return orion.oesp.session.pipe(function(session){var queryString;var url;query=query||{};query.byLocationId=session.locationId;queryString=ListingEndpoint.queryToString(query);url=routes.listings+"?"+queryString;var options={type:"GET",timeout:30000};var request=new Request(url,options,ListingEndpoint.format);return request})};ListingEndpoint.prototype.requestListingsByMediaGroupId=function(mediaGroupId){var self=this;var query={};query.byMediaGroupId=mediaGroupId;return self.requestListings(query)};return ListingEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint,orion.oesp.res.Listing);
BBV.namespace("orion.oesp.req").ProfileEndpoint=orion.oesp.req.ProfileEndpoint||(function($,routes,Request,Endpoint){function ProfileEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(ProfileEndpoint,Endpoint);ProfileEndpoint.queryToString=function(query){var param;var queryStringBuilder=[];if(!query){return""}for(param in query){if(query.hasOwnProperty(param)){queryStringBuilder.push(param+"="+query[param])}}return queryStringBuilder.join("&")};ProfileEndpoint.prototype.getProfileStatus=function(){var self=this;var url=routes.profilecredential;var options={type:"GET"};var request=new Request(url,options);return request};ProfileEndpoint.prototype.getCredentialStatus=function(credentialType){var self=this;var profileStatus;var deferred=$.Deferred();var now=new Date().getTime();var status={isLocked:false,lockoutEndTime:"",minutesRemaining:""};function minutesRemaining(endTime){return Math.ceil((endTime-now)/60/1000)}if(self.credentialStatus&&self.credentialStatus[credentialType]&&self.credentialStatus[credentialType].lockoutEndTime>now){status.isLocked=true;status.lockoutEndTime=self.credentialStatus[credentialType].lockoutEndTime;status.minutesRemaining=minutesRemaining(self.credentialStatus[credentialType].lockoutEndTime);deferred.resolve(status)}else{profileStatus=self.getProfileStatus();profileStatus.done(function(response){self.credentialStatus=response.credentialStatus;if(self.credentialStatus&&self.credentialStatus[credentialType]&&self.credentialStatus[credentialType].lockoutStatus==="locked"){status.isLocked=true;status.lockoutEndTime=self.credentialStatus[credentialType].lockoutEndTime;status.credentialType=credentialType;status.minutesRemaining=minutesRemaining(self.credentialStatus[credentialType].lockoutEndTime)}else{status.isLocked=false}deferred.resolve(status)})}return deferred.promise()};ProfileEndpoint.prototype.verifyProfileCredential=function(pinOrPw){var self=this;var url=routes.profilecredentialverify;return self.verifyOrSetCredential(url,pinOrPw)};ProfileEndpoint.prototype.verifyParentalPin=function(pin){var self=this;var url=routes.profileparentalverifypin;return self.verifyOrSetCredential(url,pin)};ProfileEndpoint.prototype.setParentalPin=function(pin){var self=this;var url=routes.profileparentalcredentialset;return self.verifyOrSetCredential(url,pin)};ProfileEndpoint.prototype.setParentalSettings=function(settings){var options={type:"POST",data:JSON.stringify(settings),timeout:20000};var request=new Request(routes.profileparentalset,options);return request};ProfileEndpoint.prototype.setChannelsLineup=function(settings){var self=this;var dfd=$.Deferred();orion.oesp.session.done(function(session){if(!session.isAuthenticated()){log("orion.oesp.req.ProfileEndpoint:","The user has to be logged in to be able to use channels line up.");dfd.reject()}else{var url=routes.profilestations;var options={type:"PUT",data:self.encode(settings)};var request=new Request(url,options);request.done(function(){dfd.resolve()});request.fail(function(error){log("orion.oesp.req.ProfileEndpoint:","There was an error saving lineup","Reason:",error);dfd.reject()})}});return dfd.promise()};ProfileEndpoint.prototype.verifyAdultPin=function(pin){var self=this;var url=routes.profileadultverifypin;return self.verifyOrSetCredential(url,pin)};ProfileEndpoint.prototype.verifyOrSetCredential=function(url,pinOrPw){return orion.oesp.session.pipe(function(session){var options={type:"POST",data:JSON.stringify({value:pinOrPw}),timeout:20000};var request=new Request(url,options);return request})};ProfileEndpoint.prototype.setTerms=function(session,termsVersion){var options={type:"POST",data:JSON.stringify({version:termsVersion}),timeout:20000,oespSessionOverride:session};var request=new Request(routes.termsset,options);return request};ProfileEndpoint.prototype.isRestrictedByTime=function(rating){if(!BBV.settings.timeRestrictions.show){return false}var now=new Date();var nowYear=now.getFullYear();var nowMonth=now.getMonth()+1;var nowDay=now.getDate();var windows=BBV.settings.timeRestrictions.windows;var startTime,endTime,validRating;var restriction=$.grep(windows,function(item){if(item.rating==rating){return item}})[0];if(restriction){startTime=new Date(nowMonth+"/"+nowDay+"/"+nowYear+" "+restriction.start);endTime=new Date(nowMonth+"/"+nowDay+"/"+nowYear+" "+restriction.end);validRating=isNaN(parseInt(rating,10))?0:parseInt(rating,10);if(validRating>=parseInt(restriction.rating,10)&&startTime<now&&endTime>now){return true}}return false};return ProfileEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").PlaylistEndpoint=orion.oesp.req.PlaylistEndpoint||(function($,routes,Request,Endpoint){function PlaylistEndpoint(){Endpoint.call(this)}orion.util.inherits(PlaylistEndpoint,Endpoint);PlaylistEndpoint.prototype.createPlaylist=function(name){var self=this;var url=routes.playlists;var options={type:"POST",data:self.encode({name:name})};var request=new Request(url,options);return request};PlaylistEndpoint.prototype.requestPlaylists=function(){var self=this;var url=routes.playlists;var options={type:"GET"};var request=new Request(url,options);return request};PlaylistEndpoint.prototype.requestPlaylistById=function(playlistId){var self=this;var url=routes.playlists+"/"+self.encode(playlistId);var options={type:"GET"};var request=new Request(url+"?"+$.now(),options);return request};PlaylistEndpoint.prototype.updatePlaylist=function(playlistId,name,mediaItems){var self=this;var url=routes.playlists+"/"+self.encode(playlistId);var options={type:"PUT",data:self.encode({name:name,mediaItems:mediaItems})};var request=orion.util.oesp.put(url,options);return request};PlaylistEndpoint.prototype.deletePlaylist=function(playlistId){var self=this;var url=routes.playlists+"/"+self.encode(playlistId);var options={type:"DELETE"};var request=orion.util.oesp.del(url,options);return request};return PlaylistEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").EventEndpoint=orion.oesp.req.EventEndpoint||(function($,routes,Request,Endpoint){function EventEndpoint(mediaItemId){var self=this;self.mediaItemId=mediaItemId;Endpoint.call(self)}orion.util.inherits(EventEndpoint,Endpoint);EventEndpoint.prototype.trigger=function(eventType){var self=this;var url=routes.events+"/"+self.mediaItemId;var options={type:"POST",dataType:"json",data:JSON.stringify({type:eventType})};var request=orion.util.oesp.post(url,options);return request};return EventEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").DeviceEndpoint=orion.oesp.req.DeviceEndpoint||(function($,routes,Request,Endpoint,Device,DeviceRegistrationStatusInfo){function DeviceEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(DeviceEndpoint,Endpoint);DeviceEndpoint.DeviceClass={TABLET:"tablet",PHONE:"phone",DESKTOP:"desktop",OTHER:"other"};DeviceEndpoint.prototype.formatDeviceRegistrationStatusInfoResponse=function(data,session){data=new DeviceRegistrationStatusInfo(data,session);if(data.devices){data.devices=$.map(data.devices,function(item){return new Device(item,session)});data.devices.sort(function(a,b){return b.registered-a.registered})}return data};DeviceEndpoint.prototype.formatDeviceResponse=function(data,session){if(data){data=new Device(data,session)}return data};DeviceEndpoint.prototype.registerDevice=function(requestParams){var self=this;var dfd=$.Deferred();orion.oesp.session.done(function(session){if(!session.isAuthenticated()){log("orion.oesp.req.DeviceEndpoint:","The user has to be logged in to be able to use this service.");dfd.reject()}else{var url=routes.devices;var options={type:"POST",data:self.encode({deviceId:requestParams.deviceId,deviceName:requestParams.deviceName,customerDefinedName:requestParams.customerDefinedName,deviceClass:requestParams.deviceClass})};var request=new Request(url,options);request.done(function(){dfd.resolve()});request.fail(function(error){log("orion.oesp.req.DeviceEndpoint:","There was an error registering new device",requestParams,"Reason:",error);dfd.reject()})}});return dfd.promise()};DeviceEndpoint.prototype.deleteDevice=function(deviceId){var self=this;var dfd=$.Deferred();orion.oesp.session.done(function(session){if(!session.isAuthenticated()){log("orion.oesp.req.DeviceEndpoint:","The user has to be logged in to be able to use this service.");dfd.reject()}else{var url=routes.devices;url+="/"+deviceId;var options={type:"DELETE"};var request=new Request(url,options);request.done(function(){dfd.resolve()});request.fail(function(error){log("orion.oesp.req.DeviceEndpoint:","There was an error deleting a device",deviceId,"Reason:",error);dfd.reject()})}});return dfd.promise()};DeviceEndpoint.prototype.updateOrReplaceDevice=function(requestParams,replacedDeviceId){var self=this;var dfd=$.Deferred();orion.oesp.session.done(function(session){if(!session.isAuthenticated()){log("orion.oesp.req.DeviceEndpoint:","The user has to be logged in to be able to use this service.");dfd.reject()}else{var url=routes.devices;var id=replacedDeviceId?replacedDeviceId:requestParams.deviceId;url+="/"+id;var options={type:"PUT",data:self.encode({deviceId:requestParams.deviceId,deviceName:requestParams.deviceName,customerDefinedName:requestParams.customerDefinedName,deviceClass:requestParams.deviceClass})};var request=new Request(url,options,self.formatDeviceResponse);request.done(function(data){dfd.resolve(data)});request.fail(function(error){log("orion.oesp.req.DeviceEndpoint:","There was an error updating/replacing a device",requestParams,"Reason:",error);dfd.reject()})}});return dfd.promise()};DeviceEndpoint.prototype.getDevicesRegistrationStatusInfo=function(){var self=this;var dfd=$.Deferred();orion.oesp.session.done(function(session){if(!session.isAuthenticated()){log("orion.oesp.req.DeviceEndpoint:","The user has to be logged in to be able to use this service.");dfd.reject()}else{var url=routes.devices+"/status";var options={type:"GET",cache:false};var request=new Request(url,options,self.formatDeviceRegistrationStatusInfoResponse);request.done(function(data){log("orion.oesp.req.DeviceEndpoint:","Current status of device registration system for the current customer:",data);dfd.resolve(data)});request.fail(function(){log("orion.oesp.req.DeviceEndpoint:","There was an error getting information about the current status of device registration system for the customer from the OESP.");dfd.reject()})}});return dfd.promise()};return DeviceEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint,orion.oesp.res.Device,orion.oesp.res.DeviceRegistrationStatusInfo);
BBV.namespace("orion.oesp.req").TimeEndpoint=orion.oesp.req.TimeEndpoint||(function($,routes,Request,Endpoint){function TimeEndpoint(){var self=this;Endpoint.call(self);this.odds=0;this.busy=false}orion.util.inherits(TimeEndpoint,Endpoint);TimeEndpoint.prototype.setTime=function(data){var serverTime=data.timestamp;var d=new Date();this.offset=Math.floor(data.offset/100)*60+(data.offset%100)+d.getTimezoneOffset();this.refreshDate=d;this.odds=this.offset*60*1000+serverTime-d;this.serverTime=data.timestamp;this.fault=this.serverTime-new Date();return new Date(d.getTime()+this.odds)};TimeEndpoint.prototype.getTimeFromNow=function(now){now=now||+new Date();if(now-this.refreshDate<2*60*60*1000){setTimeout($.proxy(this.getTime,this),1)}return now+this.odds};TimeEndpoint.prototype.getServerTime=function(date){var dfd=$.Deferred();var self=this;this.getTime().done(function(){dfd.resolve(date-self.odds)});return dfd.promise()};TimeEndpoint.prototype.getTimeForRequest=function(date){var self=this;var dfd=$.Deferred();date=date||+new Date();this.getTime().done(function(){dfd.resolve(date-self.fault)});return dfd.promise()};TimeEndpoint.prototype.getTime=function(){var self=this;if(!this.busy){this.dfd=$.Deferred()}if(this.busy){return this.dfd.promise()}else{if(this.odds&&(new Date()-this.refreshDate<2*60*60*1000)){this.dfd.resolve(new Date(new Date().getTime()+this.odds))}else{this.busy=true;orion.oesp.session.done(function(session){if(!session.locationId){log("orion.oesp.req.TimeEndpoint:","There is no location for that point.");self.odds=0;self.busy=false;self.dfd.resolve(new Date())}else{var url=routes.time+"/"+session.locationId;var options={type:"GET",cache:false};var request=new Request(url,options);request.done(function(data){log("orion.oesp.req.TimeEndpoint:","Current time for the current customer:",data);self.busy=false;self.dfd.resolve(self.setTime(data))});request.fail(function(){log("orion.oesp.req.TimeEndpoint:","There was an error getting information about the current time for the customer from the OESP.");self.odds=0;self.busy=false;self.dfd.resolve(new Date())})}})}}return this.dfd.promise()};return TimeEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);
BBV.namespace("orion.oesp.req").ProgramEndpoint=orion.oesp.req.ProgramEndpoint||(function($,routes,Request,Endpoint){var periodTime=6;var cache={};function ProgramEndpoint(){var self=this;Endpoint.call(self)}orion.util.inherits(ProgramEndpoint,Endpoint);ProgramEndpoint.prototype.get=function(date,period){var url=routes.programschedules+"/"+date+"/"+period+"/";var options={type:"GET"};var dfd=$.Deferred();if(cache[date+"/"+period]&&cache[date+"/"+period].state()=="rejected"){delete cache[date+"/"+period]}if(!cache[date+"/"+period]){cache[date+"/"+period]=dfd;(new Request(url,options)).done(function(data){dfd.resolve(data)}).fail(function(error){log("orion.oesp.req.ProgramEndpoint:","Reason:",error);dfd.reject()})}return cache[date+"/"+period].promise()};ProgramEndpoint.prototype.getRange=function(startTime,endTime,offset){if(typeof offset=="undefined"){offset=0}var format="YYYYMMDD";offset=orion.util.time.timeFrameInMilliseconds(offset,"minutes");var startDay=BBV.utils.date(startTime+offset).format(format);var endDay=BBV.utils.date(endTime+offset).format(format);var startPeriod=this.getPeriod(startTime+offset);var endPeriod=this.getPeriod(endTime+offset);var dfd=$.Deferred();$.when(this.get(startDay,startPeriod),this.get(endDay,endPeriod)).then(function(first,second){if(first==second){dfd.resolve([first])}else{dfd.resolve([first,second])}},function(){dfd.reject()});return dfd.promise()};ProgramEndpoint.prototype.getPeriod=function(time){return Math.floor((new Date(time)).getHours()/periodTime)+1};return ProgramEndpoint})(jQuery,orion.oesp.routes,orion.oesp.Request,orion.oesp.req.Endpoint);

BBV.namespace("orion.util").oesp=orion.util.oesp||(function($){var oesp={};oesp.xhr={};oesp.SESSION_URL=$("#login-form").attr("action");oesp.request=function(type,url,options){options=options||{};options.type=type;return new orion.oesp.Request(url,options)};oesp.abortRequest=function(xhr){if(xhr){xhr.abort()}};oesp.username="";oesp.token="";oesp.locationId="";oesp.user=null;oesp.get=function(url,options){return this.request("GET",url,options)};oesp.post=function(url,options){return this.request("POST",url,options)};oesp.del=function(url,options){var parsedUrl;if(BBV.settings.ajax.supportsPutDelete){return this.request("DELETE",url,options)}else{parsedUrl=url.indexOf("?")>-1?url+"&_method=DELETE":url+"?_method=DELETE";return this.request("POST",parsedUrl,options)}};oesp.put=function(url,options){var parsedUrl;if(BBV.settings.ajax.supportsPutDelete){return this.request("PUT",url,options)}else{parsedUrl=url.indexOf("?")>-1?url+"&_method=PUT":url+"?_method=PUT";return this.request("POST",parsedUrl,options)}};oesp.aquireCredentials=function(callback){orion.oesp.session.done(function(session){callback(session.oespToken,session.username);if(!oesp.token){oesp.token=session.token;oesp.username=session.username;log("setting location id from session");log(session.locationId);oesp.locationId=session.locationId;oesp.user=session}})};BBV.ajax.load=function(url,settings){var settings=settings||{},config=BBV.extend({},BBV.ajax.defaults,settings),type=config.type||"GET";orion.util.oesp.request(type,url,config)};return oesp})(jQuery);
BBV.namespace("orion.widgets").Dialog=orion.widgets.Dialog||(function($,PubSub){function hasFixedPositionAncestor($elem){var p=$elem.offsetParent();var pElem=p.get(0);if(document.body==pElem||$elem.get(0)==pElem){return false}if(p.css("position")=="fixed"){return true}return hasFixedPositionAncestor(p)}function Dialog(){var self=this;PubSub.call(self);self.$=null;self.elem=null;self.contentArea=null;self.loadTemplates();self.render()}orion.util.inherits(Dialog,PubSub);Dialog.prototype.setDialogType=function(dialogType){this.$.addClass(dialogType)};Dialog.prototype.render=function(){var self=this;var templateData={};var $dialog=$(Mustache.to_html(orion.templates.Dialog,templateData));$dialog.delegate(".close-dialog","click",function(e){self._onClose()});self.$=$dialog;self.elem=$dialog.get(0);self.contentArea=$dialog.find(".dialog-content");return self};Dialog.prototype.setModal=function(isModal){var self=this;self.modal=isModal};Dialog.prototype.setCloseBehavior=function(fn){this._onClose=fn};Dialog.prototype._onClose=function(){this.hide()};Dialog.prototype.show=function(){var self=this;var container;self.$.show();if(self.modal){container=$("#dialog-container");container.css({top:0,left:0,bottom:$(document.body).height(),right:$(document.body).width()})}return self};Dialog.prototype.hide=function(){this.$.hide();return this};Dialog.prototype.close=function(){var self=this;self._onClose()};Dialog.prototype.pointTo=function(target,pointDirection){var $target=$(target);var isFixed=hasFixedPositionAncestor($target);var tPos=$target.offset();var arrowSize=20;var centerHorizontal;var centerVertical;var top;var left;var topSpace;var bottomSpace;var $window=$(window);var scrollTop=$window.scrollTop();var scrollLeft=$window.scrollLeft();tPos.top-=isFixed?scrollTop:0;tPos.left-=isFixed?scrollLeft:0;tPos.width=$target.outerWidth();tPos.height=$target.outerHeight();tPos.bottom=tPos.top+tPos.height;tPos.right=tPos.left+tPos.width;centerHorizontal=tPos.left+(tPos.width/2)-(this.$.innerWidth()/2);centerVertical=tPos.top+(tPos.height/2)-(this.$.innerHeight()/2);if(!pointDirection){topSpace=tPos.top-scrollTop;bottomSpace=$window.height()+scrollTop-tPos.bottom;pointDirection=topSpace>bottomSpace?"down":"up"}if(pointDirection==="up"){left=centerHorizontal;top=tPos.bottom+arrowSize}if(pointDirection==="down"){left=centerHorizontal;top=tPos.top-this.$.innerHeight()-arrowSize}if(pointDirection==="left"){left=tPos.right+arrowSize;top=centerVertical}if(pointDirection==="right"){left=tPos.left-this.$.innerWidth()-arrowSize;top=centerVertical}this.$.css({left:left,top:top,position:isFixed?"fixed":"absolute"});this.$.removeClass("up down left right");this.$.addClass(pointDirection)};Dialog.prototype.centerOn=function(target){var self=this;var tw,th,tt,tl,dw,dh,toffset,$target,pos;var top,left;if(target==="window"||target===window){$target=$(window);tt=0;tl=0;pos="fixed"}else{$target=$(target);toffset=$target.offset();tt=toffset.top;tl=toffset.left;pos="absolute"}tw=$target.width();th=$target.height();dw=self.$.width();dh=self.$.height();top=tt+th/2-dh/2;left=tl+tw/2-dw/2;self.$.removeClass("up down left right");self.$.css({top:top,left:left,position:pos})};Dialog.prototype.setHtmlContent=function(content){this.contentArea.html(content)};Dialog.prototype.setTextContent=function(content){this.contentArea.text(content)};Dialog.prototype.startLoadingAnimation=function(){var self=this;if(!self.isLoaderInitialized){self.$.loader({elementClass:"pin-loading",flow:["overlay"],target:".dialog-inner"});self.isLoaderInitialized=true}self.$.trigger("loading")};Dialog.prototype.stopLoadingAnimation=function(){var self=this;self.$.trigger("loaded")};Dialog.prototype.loadTemplates=function(){var self=this;var template1=$("#dialog-tmpl1").html();Mustache.parse(template1);self.template1=template1};return Dialog})(jQuery,orion.util.PubSub);
BBV.namespace("orion.widgets").TvodDialog=orion.widgets.TvodDialog||(function($,Dialog,DialogManager){function TvodDialog(){var self=this;if(orioni18n.titleCardOffers){self.localStrings=orioni18n.titleCardOffers.offersDialog}else{self.localStrings=orioni18n.tvodCheckout}Dialog.call(self);self.item=null}function formatPrice(price){if(price){var result=/(\d*[\.\,]\d*)/.exec(price);if(result&&result.length>0){var priceResult=result[0].replace(",",".");var priceNum=parseFloat(priceResult);var priceCents=(priceNum-Math.floor(priceNum));var priceDollars=priceNum-priceCents;priceCents=Math.round(priceCents*100);var priceStr=priceDollars===0?"0.":priceDollars+".";if(priceCents===0){return priceStr+"00"}else{if(priceCents<10){return priceStr+"0"+priceCents}}return priceStr+priceCents}}return price}orion.util.inherits(TvodDialog,Dialog);TvodDialog.prototype.setItem=function(item){var self=this;self.item=item;log("TvodDialog rendered with item! ",item);self.render();var providerTcShort=$(".media-item-title-card.has-offers").find(".provider-tc-short");self.$.find(".about-rentals .content").html(providerTcShort.html());var providerTcAcceptPhrase=$(".media-item-title-card.has-offers").find(".provider-tc-accept");self.$.find("#tvod-checkout .actions").prepend(providerTcAcceptPhrase.html())};TvodDialog.prototype.render=function(){var self=this;var viewModel;if(!orioni18n.titleCardOffers){viewModel={i18n_review_order:self.localStrings.i18n_review_order,i18n_bill_to_account:self.localStrings.i18n_bill_to_account,item:self.item,i18n_about_rentals:self.localStrings.i18n_about_rentals,i18n_by_clicking:self.localStrings.i18n_by_clicking,i18n_enter_pin:self.localStrings.i18n_enter_pin,i18n_buy_now_button:self.localStrings.i18n_buy_now_button,i18n_enter_pin_or:self.localStrings.i18n_enter_pin_or,i18n_why_pin_required:self.localStrings.i18n_why_pin_required,i18n_cancel:self.localStrings.i18n_cancel,i18n_enter_pw:self.localStrings.i18n_enter_pw,i18n_enter_pw_or:self.localStrings.i18n_enter_pw_or,i18n_why_pw_required:self.localStrings.i18n_why_pw_required}}else{viewModel={i18n_review_order:self.localStrings.review_order,i18n_bill_to_account:self.localStrings.bill_to_account,item:self.item,i18n_about_rentals:self.localStrings.about_rentals,i18n_by_clicking:self.localStrings.by_clicking,i18n_enter_pin:self.localStrings.enter_pin,i18n_buy_now_button:self.localStrings.buy_now_button,i18n_enter_pin_or:self.localStrings.enter_pin_or,i18n_cancel:self.localStrings.cancel,i18n_enter_pw:self.localStrings.enter_pw,i18n_enter_pw_or:self.localStrings.enter_pw_or}}var content=Mustache.to_html(orion.templates.TvodDialog,viewModel);if(!self.$){Dialog.prototype.render.call(self);self.bindEvents()}else{self.setHtmlContent(content);orion.util.analytics.trackEvent("action",{pageName:"Order Process/Checkout",channel:"Order Process",prop23:"Order Process",prop24:"Order Process",prop26:"Checkout",eVar32:self.item.productId,products:";"+self.item.productId+";1;"+formatPrice(self.item.cost),events:"event9,scCheckout"})}return self};TvodDialog.prototype.bindEvents=function(){var self=this;if(!self.$){return}self.$.delegate("#offer-cancel-link, .close-dialog","click",function closeOffer(){self.hide();orion.util.analytics.trackEvent("action",{pageName:"Order Process/Order Cancelled",channel:"Order Process",prop23:"Order Process",prop24:"Order Process",prop26:"Order Cancelled",eVar32:self.item.productId,products:";"+self.item.productId+";1;"+formatPrice(self.item.cost),events:"event9"});return false});self.$.delegate('.field input[maxlength="1"]',"keydown",function(event){var BACKSPACE=8,TAB=9,DELETE=46,ENTER=13,$this=$(this),siblings=$this.siblings(),pinValue="";siblings.each(function(){pinValue+=$(this).val()});var str=$this.attr("name");if(!(event.which===DELETE||event.which===BACKSPACE||event.which===TAB||event.which===ENTER)){event.preventDefault();if((event.which>=48&&event.which<=57)||(event.which>=96&&event.which<=105)){$this.attr("value",String.fromCharCode(event.which>=96?event.which-48:event.which));if(!(parseInt(str.substring(str.length-1))===4)){$this.next().focus()}}}else{if(event.which===ENTER){self.$.find("form").submit();return false}else{if(event.which===BACKSPACE&&siblings.index($this)!==0){event.preventDefault();$this.val("").prev().focus()}}}});self.$.delegate("form","submit",function submitForm(){if(self.processingOrder===undefined){self.submitOrder()}arguments[0].preventDefault()});self.$.delegate("#buynow","click",function buyNow(){if(self.processingOrder===undefined){self.submitOrder()}return false})};TvodDialog.prototype.setFocus=function(){var self=this;if(self.item.isAdult){self.$.find('[name="pin1"]').focus()}else{self.$.find('[name="pw"]').focus()}};TvodDialog.prototype.getProductId=function(){var self=this;return self.item.productId};TvodDialog.prototype.getOfferId=function(){var self=this;return self.item.offerId};TvodDialog.prototype.getPw=function(){var self=this;if(self.item.isAdult){var pin1=self.$.find('[name="pin1"]').val();var pin2=self.$.find('[name="pin2"]').val();var pin3=self.$.find('[name="pin3"]').val();var pin4=self.$.find('[name="pin4"]').val();return""+pin1+pin2+pin3+pin4}else{return self.$.find('[name="pw"]').val()}};TvodDialog.prototype.submitOrder=function(){var self=this;self.processingOrder=true;var purchaseEndpoint=orion.oesp.purchaseEndpoint;var purchase;var productId=self.getProductId();log("productid",productId);var offerId=self.getOfferId();log("offerId",offerId);var pw=self.getPw();if(pw.length===0){delete self.processingOrder;if(self.item.isAdult){self.showPwError(self.localStrings.pin_invalid)}else{self.showPwError(self.localStrings.pw_invalid)}}else{if(productId&&offerId){self.startLoadingAnimation();purchase=purchaseEndpoint.makePurchase(productId,offerId,pw);purchase.done($.proxy(self.orderSuccess,self));purchase.fail($.proxy(self.orderFail,self));purchase.always(function afterPurchase(){delete self.processingOrder})}}};TvodDialog.prototype.showPwError=function(errorMessage,errorBody){var self=this;var errorField=self.$.find("form.dialog-tvod-pw-form .error, form.dialog-tvod-pin-form .error");var bodyField=self.$.find("form.dialog-tvod-pw-form .body, form.dialog-tvod-pin-form .body");$(".pin-settings .field","#tvod-checkout").find("input").val("").eq(0).focus();errorField.html(errorMessage).show();if(errorBody){bodyField.html(errorBody).show()}};TvodDialog.prototype.hidePwError=function(){var self=this;var errorField=self.$.find("form.dialog-tvod-pw-form .error, form.dialog-tvod-pin-form .error");var bodyField=self.$.find("form.dialog-tvod-pw-form .body, form.dialog-tvod-pin-form .body");errorField.hide();bodyField.hide()};TvodDialog.prototype.orderSuccess=function(data){var self=this;orion.util.analytics.trackEvent("action",{pageName:"Order Process/Order Completed",channel:"Order Process",prop23:"Order Process",prop24:"Order Process",prop26:"Order Completed",eVar32:self.item.productId,products:";"+self.item.productId+";1;"+formatPrice(self.item.cost),events:"event9,purchase"});window.location.reload()};TvodDialog.prototype.orderFail=function(error){var self=this;var err,pinDialog,pinType;try{err=JSON.parse(error.responseText)[0]}catch(e){err=null}self.stopLoadingAnimation();orion.util.analytics.trackEvent("action",{pageName:"Order Process/Incorrect PIN",channel:"Order Process",prop23:"Order Process",prop24:"Order Process",prop26:"Incorrect PIN",eVar32:self.item.productId,products:";"+self.item.productId+";1;"+formatPrice(self.item.cost),events:"event9"});if(!err){self.showPwError(orioni18n.utilityBar.unknownError)}else{if(err.reason==="prohibited"){self.hide();pinDialog=orion.app.dialogManager.getDialog("pin-verification");pinType=self.item.isAdult?"adultPin":"parentalPin";pinDialog.trigger("pinRejected",{pinType:pinType,credentialType:pinType==="parentalPin"?"password":"adultPin",reason:"prohibited"});pinDialog.showDialog()}else{if(self.item.isAdult){self.showPwError(orioni18n.navigationBar.invalidpin)}else{self.showPwError(orioni18n.navigationBar.invalidpw)}}}};return TvodDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").PinChangeDialog=orion.widgets.PinChangeDialog||(function($,Dialog,DialogManager){function PinChangeDialog(){var self=this;self.localStrings=orioni18n.utilityBar;Dialog.call(self);var tmpl=Mustache.to_html(orion.templates.PinChangeDialog,{title:self.localStrings.pinChangeTitle,message:self.localStrings.pinChangeMessage,i18nConfirm:self.localStrings.confirmationDialogButtonConfirm,i18nCancel:self.localStrings.confirmationDialogButtonCancel});var tmpl=$("<textarea />").html(tmpl).val();self.setHtmlContent(tmpl);orion.util.analytics.trackEvent("action",{pageName:"Pin change/Pin change required",channel:"Pin change/Pin change/Pin change required.",prop23:"Pin change",prop24:"Pin change",prop26:"Pin change required",events:"event9"});self.bindEvents()}orion.util.inherits(PinChangeDialog,Dialog);PinChangeDialog.prototype.bindEvents=function(){var self=this;self.$.delegate(".confirm","click",function(e){self.trigger("accept");self.hide();orion.util.analytics.trackEvent("action",{pageName:"Pin change/Pin change accepted",channel:"Pin change",prop23:"Pin change",prop24:"Pin change",prop26:"Pin change accepted",events:"event9"});return false});self.$.delegate(".cancel, .close-dialog","click",function(e){self.trigger("cancel");self.hide();orion.util.analytics.trackEvent("action",{pageName:"Pin change/Pin change declined",channel:"Pin change",prop23:"Pin change",prop24:"Pin change",prop26:"Pin change declined",events:"event9"});return false})};return PinChangeDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").ResumeDialog=orion.widgets.ResumeDialog||(function($,Dialog,DialogManager){function ResumeDialog(){var self=this;var prompt=$.Deferred();Dialog.call(self);self.$.delegate(".replay a, .close-dialog","click",function(e){e.preventDefault();self.trigger("replay");self.hide();return false});self.$.delegate(".resume a","click",function(e){e.preventDefault();self.trigger("resume");self.hide();return false})}orion.util.inherits(ResumeDialog,Dialog);ResumeDialog.prototype.render=function(){var self=this;Dialog.prototype.render.call(self);var content=$(".video-player-module .welcome-back");self.contentArea.append(content);content.show();return self};ResumeDialog.prototype.bindEvents=function(){var self=this;if(!self.$){return}self.setCloseBehavior(function(){self.$.find(".resume a").click();self.hide();return false})};return ResumeDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").ConfirmationDialog=orion.widgets.ConfirmationDialog||(function($,Dialog){function ConfirmationDialog(){var self=this;self.$utilityBar=$("#site-utility-bar");self.localStrings=orioni18n.utilityBar;self.viewModel={title:self.localStrings.confirmationDialogButtonConfirm,body:"",i18nConfirm:self.localStrings.confirmationDialogButtonConfirm,i18nCancel:self.localStrings.confirmationDialogButtonCancel,i18nClose:self.localStrings.confirmationDialogButtonCancel};self.setCloseBehavior(function(){self.hide();self.trigger("cancel")});Dialog.call(self)}orion.util.inherits(ConfirmationDialog,Dialog);ConfirmationDialog.prototype.setContent=function(_title,_body){var self=this;self.viewModel.title=_title;self.viewModel.body=_body;self.render()};ConfirmationDialog.prototype.render=function(){var self=this;var content=Mustache.to_html(orion.templates.ConfirmationDialog,self.viewModel);if(!self.$){Dialog.prototype.render.call(self);self.bindEvents()}self.$.addClass("confirmation");self.setHtmlContent(content);return self};ConfirmationDialog.prototype.bindEvents=function(){var self=this;if(!self.$){return}self.$.delegate(".close-dialog, .cancel","click",function(){self.hide();self.trigger("cancel");return false});self.$.delegate(".confirm","click",function(){self.hide();self.trigger("confirm");return false})};return ConfirmationDialog})(jQuery,orion.widgets.Dialog);
BBV.namespace("orion.widgets").PinDialog=orion.widgets.PinDialog||(function($,Dialog){function PinDialog(){log("Initialized PinDialog");var self=this;Dialog.call(self);self.setHtmlContent($("form.dialog-pin-form"));self.publisher=orion.app;self.verifiedHandlerDefault=$.noop;self.verifiedHandler=self.verifiedHandlerDefault;self.canceledHandlerDefault=$.noop;self.canceledHandler=self.canceledHandlerDefault;self.bindEvents()}orion.util.inherits(PinDialog,Dialog);PinDialog.prototype.views={parentalPin:{hasEntry:true,hasLockout:true,lockoutType:"parentalPin",header:orioni18n.navigationBar.pinparentalheader,body:orioni18n.navigationBar.pinparentalbody,error:orioni18n.navigationBar.invalidpin},adultPin:{hasEntry:true,hasLockout:true,lockoutType:"adultPin",header:orioni18n.navigationBar.pinadultheader,body:orioni18n.navigationBar.pinadultbody,error:orioni18n.navigationBar.invalidpin},adultPinNotRegistered:{hasEntry:false,hasLockout:false,header:orioni18n.navigationBar.pinadultheader,body:function(body,linkText,linkHref,linkReplace){var output=body;var linkHtml="";if(linkText&&linkHref){linkHtml='<a href="'+linkHref+'" target="_blank">'+linkText+"</a>"}return body.split(linkReplace).join(linkHtml)}(orioni18n.navigationBar.notregisteredadult,orioni18n.navigationBar.notregisteredadultlinktext,orioni18n.navigationBar.notregisteredadultlinkhref,"{{notRegisteredLink}}"),error:null},youthPin:{hasEntry:true,hasLockout:true,lockoutType:"parentalPin",header:orioni18n.navigationBar.pinyouthheader,body:orioni18n.navigationBar.pinyouthbody,error:orioni18n.navigationBar.invalidpin},lockedPin:{hasEntry:false,hasLockout:false,header:orioni18n.navigationBar.pinparentalheader,body:orioni18n.navigationBar.pinlockedbody,error:orioni18n.navigationBar.pinlockederror},lockedPassword:{hasEntry:false,hasLockout:false,header:orioni18n.navigationBar.pinparentalheader,body:orioni18n.navigationBar.pinlockedbody,error:orioni18n.navigationBar.pwlockederror},defaultPin:{hasEntry:true,hasLockout:false,header:orioni18n.navigationBar.pindefaultheader,body:orioni18n.navigationBar.pindefaultbody,error:orioni18n.navigationBar.invalidpin}};PinDialog.prototype.showDialog=function(verificationType){var self=this;var isVisible=$(".dialog-pin-form:visible").length;if(isVisible){return}if(verificationType){self.setVerificationType(verificationType)}self.centerOn(window);self.show();self.setFocus()};PinDialog.prototype.setFocus=function(){var self=this;self.$.find('[name="pin1"]').focus();self.$.find(".pin-settings").find("input").keydown(function(event){var BACKSPACE=8,TAB=9,DELETE=46,ENTER=13,$this=$(this),siblings=$this.siblings(),pinValue="";siblings.each(function(){pinValue+=$(this).val()});var str=$this.attr("name");if(!(event.which===DELETE||event.which===BACKSPACE||event.which===TAB||event.which===ENTER)){event.preventDefault();if((event.which>=48&&event.which<=57)||(event.which>=96&&event.which<=105)){$this.attr("value",String.fromCharCode(event.which>=96?event.which-48:event.which));if(parseInt(str.substring(str.length-1),10)!==4){$this.next().focus()}}}else{if(event.which===ENTER){$("form.dialog-pin-form").submit();return false}else{if(event.which===BACKSPACE&&siblings.index($this)!==0){event.preventDefault();$this.val("").prev().focus()}}}})};PinDialog.prototype.setVerificationType=function(pinType){var self=this;orion.oesp.session.done(function(session){self.pinVerificationType=pinType;self.setPinView()})};PinDialog.prototype.setPinView=function(validationError){var self=this;var profileStatus;self.$pinMessage=self.$.find("#pin-message");self.$pinEntry=self.$.find("#pin-entry");self.hasError=validationError&&self.views[validationError.pinType];if(self.hasError){self.pinView=self.views[validationError.pinType]}else{self.pinView=self.views[self.pinVerificationType]}if(!validationError){self.$pinMessage.hide();self.$pinEntry.hide()}if((!validationError&&!self.pinView.hasLockout)||(validationError&&validationError.reason!=="prohibited")){self.setPinContent()}else{if(validationError&&validationError.reason==="prohibited"){self.setPinContent({isLockout:true,credentialType:validationError.credentialType,minutesRemaining:validationError.minutesRemaining})}else{if(self.pinView.hasLockout){self.stopLoadingAnimation();self.startLoadingAnimation();credentialStatus=orion.oesp.profileEndpoint.getCredentialStatus(self.pinView.lockoutType);credentialStatus.done(function(status){if(status.isLocked){self.setPinContent({isLockout:true,credentialType:status.credentialType,minutesRemaining:status.minutesRemaining})}else{self.setPinContent()}});credentialStatus.fail(function(){self.setPinContent()})}}}};PinDialog.prototype.setPinContent=function(options){var self=this;var $pinHeader=self.$pinMessage.find("h3");var $pinBody=self.$pinMessage.find(".body");var $pinError=self.$pinMessage.find(".error");options=$.extend({isLockout:false,credentialType:"parentalPin",minutesRemaining:BBV.settings.pin.defaultLockoutDuration},options);if(options.isLockout){self.pinView=options.credentialType==="password"?self.views.lockedPassword:self.views.lockedPin;self.pinView.newBody=self.pinView.body.replace("{{timeoutRemaining}}",options.minutesRemaining);self.hasError=true}else{self.pinView.newBody=self.pinView.body}if(self.hasError){$pinError.text(self.pinView.error).show()}else{$pinError.hide()}$pinHeader.html(self.pinView.header);$pinBody.html(self.pinView.newBody);self.$pinMessage.show();if(self.pinView.hasEntry){self.$pinEntry.show();self.$pinEntry.find("input").val("").eq(0).focus()}else{self.$pinEntry.hide()}self.stopLoadingAnimation()};PinDialog.prototype.bindEvents=function(){var self=this;$(self.$).delegate("form.dialog-pin-form","submit",function(event){event.preventDefault();if(self.alreadySubmitted){return}self.form=this;self.$form=$(this);self.$error=$(".error",self.$form);var pin=self.getPin();self.verifyPin(pin);self.alreadySubmitted=true});$(self.$).delegate(".close-dialog","click",function(){self.canceledHandler();self.canceledHandler=self.canceledHandlerDefault;self.verifiedHandler=self.verifiedHandlerDefault;self.publisher.trigger("pinDialogCancelled")});$(self).bind("pinRejected",function(e,validationError){self.setPinView(validationError)});$(self).bind("pinVerified",function(){self.verifiedHandler();self.verifiedHandler=self.verifiedHandlerDefault})};PinDialog.prototype.verifyPin=function(pin){var self=this;switch(self.pinVerificationType){case"adultPin":self.pinVerifyAdult(pin);break;default:self.pinVerifyParental(pin);break}};PinDialog.prototype.getPin=function(){var self=this;return self.form.pin1.value+self.form.pin2.value+self.form.pin3.value+self.form.pin4.value};PinDialog.prototype.pinVerifyParental=function(pin){var self=this;var parentalPinRequest=orion.oesp.profileEndpoint.verifyParentalPin(pin);self.stopLoadingAnimation();self.startLoadingAnimation();parentalPinRequest.done(function(){self.publisher.trigger("pinVerified","parentalPin");self.trigger("pinVerified","parentalPin");self.alreadySubmitted=false});parentalPinRequest.fail(function(response){var error=JSON.parse(response.responseText)[0];error.pinType=self.pinVerificationType;self.trigger("pinRejected",error);self.alreadySubmitted=false})};PinDialog.prototype.pinVerifyAdult=function(pin){var self=this;var adultPinRequest=orion.oesp.profileEndpoint.verifyAdultPin(pin);self.stopLoadingAnimation();self.startLoadingAnimation();adultPinRequest.done(function(){orion.app.setCredential(pin);self.publisher.trigger("pinVerified","adultPin");self.trigger("pinVerified","adultPin");self.alreadySubmitted=false});adultPinRequest.fail(function(response){var error=JSON.parse(response.responseText)[0];error.pinType="adultPin";self.trigger("pinRejected",error);self.alreadySubmitted=false})};PinDialog.prototype.onVerified=function(callback){var self=this;self.verifiedHandler=callback};PinDialog.prototype.onCanceled=function(callback){var self=this;self.canceledHandler=callback};return PinDialog})(jQuery,orion.widgets.Dialog);
BBV.namespace("orion.widgets").CannotRegisterDeviceDialog=orion.widgets.CannotRegisterDeviceDialog||(function($,Dialog,DialogManager){function CannotRegisterDeviceDialog(){var self=this;Dialog.call(self);self.i18n=orioni18n.dialogs;self.viewModel={dialog_class:"device-registration-dialog",icon:"device-deny",headline:self.i18n.mydevicescannotregisteredheadertext,lines:[{line:function(){var self=this;return self.i18n.mydevicescannotregisterlimitregistrationbodytext.replace("{{0}}",$("<b/>").append(self.deviceRegistrationStatus.getFormattedNextDeviceChange()).prop("outerHTML"))}.bind(self)}],controls:[{style:"button confirmation-dialog-button",action_class:"ok",action_text:self.i18n.mydevicescannotregisteredokbuttontext}]}}orion.util.inherits(CannotRegisterDeviceDialog,Dialog);CannotRegisterDeviceDialog.prototype.updateContent=function(){var self=this;var rendered=Mustache.render(self.template1,self.viewModel);self.setDialogType("device");self.setHtmlContent(rendered);self.bindEvents()};CannotRegisterDeviceDialog.prototype.bindEvents=function(){var self=this;self.$.on("click",".controls .ok",function(){self.hide();return false})};CannotRegisterDeviceDialog.prototype.setData=function(data){var self=this;self.deviceId=data.deviceIdToRegister;self.deviceRegistrationStatus=data.deviceRegistrationStatus;self.updateContent()};return CannotRegisterDeviceDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").DeviceRegisteredDialog=orion.widgets.DeviceRegisteredDialog||(function($,Dialog,DialogManager){function DeviceRegisteredDialog(){var self=this;Dialog.call(self);self.i18n=orioni18n.dialogs;self.viewModel={dialog_class:"device-registration-dialog",icon:"device-success",headline:self.i18n.mydevicesregisteredheadertext,lines:[{line:function(){var self=this;return self.i18n.mydevicesregisteredlimitbodytext.replace("{{0}}",self.deviceRegistrationStatus.maxRegisteredDevices)}.bind(self)}],controls:[{style:"button confirmation-dialog-button",action_class:"ok",action_text:self.i18n.mydevicesregisteredokbuttontext}]}}orion.util.inherits(DeviceRegisteredDialog,Dialog);DeviceRegisteredDialog.prototype.updateContent=function(){var self=this;var rendered=Mustache.render(self.template1,self.viewModel);self.setDialogType("device");self.setHtmlContent(rendered);self.bindEvents()};DeviceRegisteredDialog.prototype.bindEvents=function(){var self=this;self.$.on("click",".controls .ok",function(){self.close();return false})};DeviceRegisteredDialog.prototype.setData=function(data){var self=this;self.deviceRegistrationStatus=data.deviceRegistrationStatus;self.updateContent()};return DeviceRegisteredDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").RegisterDeviceDialog=orion.widgets.RegisterDeviceDialog||(function($,Dialog,DialogManager){function RegisterDeviceDialog(){var self=this;Dialog.call(self);self.i18n=orioni18n.dialogs;self.viewModel={dialog_class:"device-registration-dialog",icon:false,headline:self.i18n.mydevicesregisterheadertext,lines:[{line:self.i18n.mydevicesregisterquestiontext}],controls:[{style:"button confirmation-dialog-button",action_class:"confirm",action_text:self.i18n.mydevicesregistersubmitbuttontext},{action_class:"cancel",action_text:self.i18n.mydevicesregistercancelbuttontext},]}}orion.util.inherits(RegisterDeviceDialog,Dialog);RegisterDeviceDialog.prototype.setContent=function(){var self=this;var rendered=Mustache.render(self.template1,self.viewModel);self.setDialogType("device");self.setHtmlContent(rendered);self.bindEvents()};RegisterDeviceDialog.prototype.bindEvents=function(){var self=this;self.$.on("click",".controls .confirm",function(){self.registerDevice();return false});self.$.on("click",".controls .cancel",function(){self.close();return false})};RegisterDeviceDialog.prototype.setDeviceRegisteredBehavior=function(fn){var self=this;self._onRegistered=fn};RegisterDeviceDialog.prototype.registerDevice=function(){var self=this;var deviceToRegister={deviceId:self.deviceId,deviceName:"My Computer",customerDefinedName:"My Computer",deviceClass:orion.oesp.req.DeviceEndpoint.DeviceClass.DESKTOP};var request=orion.oesp.deviceEndpoint.registerDevice(deviceToRegister);$.when(request).done(function(){$.when(orion.oesp.deviceEndpoint.getDevicesRegistrationStatusInfo()).done(function(latestStatus){var d=orion.app.dialogManager.getDialog("device-registered");d.setData({deviceRegistrationStatus:latestStatus});d.centerOn("window");if(self._onRegistered){self._onRegistered()}self.hide();d.show()})})};RegisterDeviceDialog.prototype.setData=function(data){var self=this;self.deviceId=data.deviceIdToRegister;self.deviceRegistrationStatus=data.deviceRegistrationStatus;self.setContent()};return RegisterDeviceDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").ReplaceDeviceDialog=orion.widgets.ReplaceDeviceDialog||(function($,Dialog,DialogManager){function ReplaceDeviceDialog(){var self=this;Dialog.call(self);self.i18n=orioni18n.dialogs;self.viewModel={dialog_class:"device-registration-dialog",icon:false,headline:self.i18n.mydevicesreplaceheadertext,lines:[{line:self.i18n.mydevicesreplacelimitregistrationbodytext}],controls:[{style:"button confirmation-dialog-button",action_class:"replace",action_text:self.i18n.mydevicesreplacesubmitbuttontext},{style:"",action_class:"cancel",action_text:self.i18n.mydevicesreplacecancelbuttontext},]}}orion.util.inherits(ReplaceDeviceDialog,Dialog);ReplaceDeviceDialog.prototype.setContent=function(){var self=this;var rendered=Mustache.render(self.template1,self.viewModel);self.setDialogType("device");self.setHtmlContent(rendered);self.bindEvents()};ReplaceDeviceDialog.prototype.bindEvents=function(){var self=this;self.$.on("click",".controls .replace",function(){var linkToMyDevices=$("#mydevices-link").attr("href");if(!linkToMyDevices){log("Cannot find link to My Devices section. Did you enable the section in User's menu?");return false}linkToMyDevices+="/replace/"+self.newDeviceId;linkToMyDevices+="?callback="+orion.util.url.fixedEncodeURIComponent(window.location.href);window.location=linkToMyDevices;return false});self.$.on("click",".controls .cancel",function(){self.close();return false})};ReplaceDeviceDialog.prototype.setData=function(data){var self=this;self.newDeviceId=data.replaceWithDeviceId;self.setContent()};return ReplaceDeviceDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").LoginDialog=orion.widgets.LoginDialog||(function($,Dialog){function LoginDialog(){var self=this;Dialog.call(self);self.$utilityBar=$("#site-utility-bar");self.localStrings=orioni18n.utilityBar;self.canceledHandlerDefault=$.noop;self.canceledHandler=self.canceledHandlerDefault;self.setContent();self.bindEvents()}orion.util.inherits(LoginDialog,Dialog);LoginDialog.prototype.addError=function(message){var self=this;var form=self.form;self.clearError();form.prepend('<p class="error">'+message+"</p>");form.addClass("error")};LoginDialog.prototype.clearError=function(){var self=this;var form=self.form;form.removeClass("error");form.find("p.error").remove()};LoginDialog.prototype.clearLogin=function(session){var self=this;self.form.find("#login-username-input, #login-password-input").val("");self.form.find("#login-remember-input").attr("checked",false)};LoginDialog.prototype.validate=function(forceValidation){var self=this;var form=self.form;var username=form.find("#login-username-input");var password=form.find("#login-password-input");var localStrings=orioni18n.utilityBar;var uError=/^\s*$/.test(username.val())&&(forceValidation||username.hasClass("touched"));var pError=/^\s*$/.test(password.val())&&(forceValidation||password.hasClass("touched"));if(uError){username.addClass("error")}else{username.removeClass("error")}if(pError){password.addClass("error")}else{password.removeClass("error")}if(uError&&!pError){self.addError(localStrings.missingUsername)}if(!uError&&pError){self.addError(localStrings.missingPassword)}if(uError&&pError){self.addError(localStrings.missingBoth)}if(!uError&&!pError){self.clearError()}return !uError&&!pError};LoginDialog.prototype.setContent=function(){var self=this;var content=$("#login-form");self.form=content;self.setHtmlContent(content)};LoginDialog.prototype.show=function(){var self=this;var signupHorizonLink=$("#signup-horizon");self.useOrionAsAProduct=BBV.settings.useOrionAsAProduct;Dialog.prototype.show.call(self);self.form.find("#login-username-input").focus();if(self.useOrionAsAProduct){signupHorizonLink.show()}orion.util.analytics.trackEvent("action",{pageName:"Login screen",channel:"Login",prop23:"Login",prop24:"Login",prop26:"Login",events:"event9"})};LoginDialog.prototype.bindEvents=function(){var self=this;var content=self.$;var form=self.form;var nameFromCookie=BBV.utils.cookie("rememberUser").get("username");if(nameFromCookie){content.find("#login-remember-input").prop("checked",true);content.find("#login-username-input").val(nameFromCookie)}else{content.find("#login-remember-input").prop("checked",false)}content.delegate("input","blur",function(){$(this).addClass("touched")});content.delegate("input.required","blur change keyup",function(){var cont=$("#login-form-content");setTimeout(function(){if(self.isValidationEnabled){self.validate()}},100)});content.delegate(".login-links a","mousedown",function(){self.isValidationEnabled=false});content.delegate("#login-forgot","click",function(e){e.preventDefault();var cont=$("#login-form-content");var info=$("#login-forgot-info");info.width(cont.width());cont.hide();info.show();self.clearError()});content.delegate("#cancel-forgot","click",function(e){e.preventDefault();$("#login-form-content").show();$("#login-forgot-info").hide();self.isValidationEnabled=true});self.$.delegate(".close-dialog","click",function(e){e.preventDefault();$("#login-form-content").show();$("#login-forgot-info").hide();self.canceledHandler();self.canceledHandler=self.canceledHandlerDefault});self.$.find("form").on("keypress","input",function(event){if(event.which===13){self.$.find("form").submit();return false}});self.$.delegate("form","submit",function(event){self.submitLogin();return false})};LoginDialog.prototype.submitLogin=function(){var self=this;var content=self.$;var form=self.form;var username=form.find("#login-username-input").val();var password=form.find("#login-password-input").val();var loginRequest;if(!self.validate(true)){return false}loginRequest=orion.oesp.session.login(username,password);self.startLoadingAnimation();loginRequest.done(function(session){self.loginSuccess(session,username)});loginRequest.fail(function(e){var errorCode;try{errorCode=JSON.parse(e.responseText)[0].code}catch(err){errorCode="unknown"}self.loginFail(errorCode)});return false};LoginDialog.prototype.loginSuccess=function(session,username){var self=this;var termsDialog;var serverTermsDate=$("#site-utility-bar").data("terms-date");var clientTermsDate=null;var isOrionUser;if(session.profileSettings.termsSettings!==null){clientTermsDate=session.profileSettings.termsSettings.version}self.hide();self.stopLoadingAnimation();if((!clientTermsDate||clientTermsDate<serverTermsDate)&&!self.useOrionAsAProduct){termsDialog=orion.app.dialogManager.getDialog("terms");termsDialog.setUsername(username);termsDialog.centerOn("window");termsDialog.bind("accept",function(){var termsRequest=orion.oesp.profileEndpoint.setTerms(session,serverTermsDate);termsRequest.done(function(){self.acceptTerms(session);termsDialog.unbind("cancel");termsDialog.unbind("accept")})});termsDialog.bind("cancel",function(){self.clearLogin();termsDialog.unbind("cancel");termsDialog.unbind("accept")});termsDialog.show()}else{self.acceptTerms(session)}};LoginDialog.prototype.loginFail=function(errorCode){var self=this;self.stopLoadingAnimation();log("Sign-in call was unsuccessful. Error code is: ",errorCode);switch(errorCode){case"accountLocked":self.addError(self.localStrings.accountLocked);self.clearLogin();break;case"invalidCredentials":self.addError(self.localStrings.invalidCredentials);break;case"noOrionEntitlement":self.addError(self.localStrings.orionAsAProduct);break;default:self.addError(self.localStrings.unknownError);break}};LoginDialog.prototype.acceptTerms=function(session){var self=this;var content=self.$;var form=self.form;var username=form.find("#login-username-input").val();var rememberMe;var pinChangeDialog;BBV.user().login(session,0);rememberMe=form.find("#login-remember-input").prop("checked");if(rememberMe){BBV.utils.cookie("rememberUser").set("username",username)}else{BBV.utils.cookie.remove("rememberUser")}if(session.isPinDefault()){pinChangeDialog=orion.app.dialogManager.getDialog("pin-change-confirmation");pinChangeDialog.centerOn("window");pinChangeDialog.bind("accept",function(){window.location.href=self.$utilityBar.data("pin-management-url")+"?acceptedPinChange=true"});pinChangeDialog.bind("cancel",function(){window.location.reload()});pinChangeDialog.show()}else{orion.app.reInitialize()}};LoginDialog.prototype.handleRedirect=function(session){var self=this};LoginDialog.prototype.onCanceled=function(callback){var self=this;self.canceledHandler=callback};return LoginDialog})(jQuery,orion.widgets.Dialog);
BBV.namespace("orion.widgets").TermsDialog=orion.widgets.TermsDialog||(function($,Dialog,DialogManager){function TermsDialog(){var self=this;Dialog.call(self);self.bindEvents()}orion.util.inherits(TermsDialog,Dialog);TermsDialog.prototype.render=function(){var self=this;var privacyPolicy;var container;var termsRequest;if(!self.$){Dialog.prototype.render.call(self)}privacyPolicy=$("#privacy-policy");self.setHtmlContent(privacyPolicy);container=self.contentArea.find(".eu-privacy-policy");termsRequest=$.get($("#site-utility-bar").data("terms-url"));termsRequest.success(function(data){self.stopLoadingAnimation();orion.util.analytics.trackEvent("action",{pageName:"Privacy and terms/Privacy and terms required",channel:"Privacy and terms/Privacy and terms required",prop23:"Privacy and terms",prop24:"Privacy and terms",prop26:"Privacy and terms required",events:"event9"})});termsRequest.fail(function(){self.stopLoadingAnimation();container.html("Unable to load terms and conditions")})};TermsDialog.prototype.show=function(){var self=this;Dialog.prototype.show.call(self);if(!self.isDialogRendered){self.startLoadingAnimation();self.isDialogRendered=true}};TermsDialog.prototype.bindEvents=function(){var self=this;self.$.delegate("#accept-tos","click",function(e){var cookieName=encodeURIComponent(self.username)+"_terms";BBV.utils.cookie(cookieName).set("acceptTerms",$.now());self.trigger("accept");self.hide();orion.util.analytics.trackEvent("action",{pageName:"Privacy and terms/Privacy and terms accepted",channel:"Privacy and terms",prop23:"Privacy and terms",prop24:"Privacy and terms",prop26:"Privacy and terms accepted",events:"event9"});return false});self.$.delegate("#decline-tos, .close-dialog","click",function(e){self.trigger("cancel");self.hide();orion.util.analytics.trackEvent("action",{pageName:"Privacy and terms/Privacy and terms declined",channel:"Privacy and terms",prop23:"Privacy and terms",prop24:"Privacy and terms",prop26:"Privacy and terms declined",events:"event9"});return false})};TermsDialog.prototype.setUsername=function(username){var self=this;self.username=username};return TermsDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").DvrSettingsDialog=orion.widgets.DvrSettingsDialog||(function($,Dialog){function DvrSettingsDialog(){var self=this;Dialog.call(self)}orion.util.inherits(DvrSettingsDialog,Dialog);DvrSettingsDialog.prototype.render=function(){var self=this;if(!self.$){Dialog.prototype.render.call(self);self.setHtmlContent($("#dvr-settings"));self.$.find("form#dvr-settings").bind("submit",function(e){e.preventDefault();self.submit()});self.setCloseBehavior(function(){self.hide();self.$.find(".error").hide()});var form=self.$.find("#dvr-settings");var profile=form.data("profile");if(!profile){return}var $multipleBoxes=self.$.find("#multiple-boxes");var $ul=$multipleBoxes.find("ul");var boxes=profile.boxes;var boxInput="";if(boxes&&boxes.length===1){$.each(boxes,function(idx,box){if(box.isRemoteRecordingCapable){var capability="record";boxInput+="<li>"+box.boxType+" "+box.smartCardId+" <span>"+form.data(capability+"-label")+"</span></li>"}});$ul.append(boxInput).show();form.find(".close").css({display:"block"});$ul.show()}if(boxes&&boxes.length>1&&boxes.length!==$multipleBoxes.find("li").length){$.each(boxes,function(idx,box){var checked=profile.defaultSmartCardId==box.smartCardId?' checked="checked"':"";if(box.isRemoteRecordingCapable){var capability="record";boxInput+='<li><input type="radio" id="box-'+box.smartCardId+'" name="box" value="'+box.smartCardId+'"'+checked+' /> <label for="box-'+box.smartCardId+'">'+box.boxType+" "+box.smartCardId+" <span>"+form.data(capability+"-label")+"</span></label></li>"}});$ul.append(boxInput).show();form.find(".save").css({display:"block"});$ul.show()}}};DvrSettingsDialog.prototype.submit=function(){var self=this;var $boxes=self.$.find('input[name="box"]');var $defaultBox=self.$.find('input[name="box"]:checked');var $notifications=$("#dvr-settings #notifications:checked");var errors=0;if(!$boxes.length){self._onClose();return}self.$.find(".error").hide();if($boxes.length&&!$defaultBox.length){errors++;self.$.find(".error.default-box").show()}if(errors){return}var settings=JSON.stringify({defaultSmartCardId:$defaultBox.val(),accountEnabled:true});var rbUrl=$("#site-utility-bar").data("remote-bookings-url");orion.util.oesp.put(rbUrl+"/profile/",{data:settings,success:function(data){var $trigger=$(self.$.find("#dvr-settings").data("trigger"));self.$.find(".error").hide();if($trigger.length){self._onClose()}else{orion.app.trigger("requestDialog",{dialogName:"dvr-booking",centerOn:"window",destroyOnClose:true})}},error:function(){log("dvr error")},complete:function(){self._onClose()}})};return DvrSettingsDialog})(jQuery,orion.widgets.Dialog);
BBV.namespace("orion.widgets").BookingErrorDialog=orion.widgets.BookingErrorDialog||(function($,Dialog,DialogManager){function BookingErrorDialog(){var self=this;Dialog.call(self)}orion.util.inherits(BookingErrorDialog,Dialog);BookingErrorDialog.prototype.render=function(){var self=this;var BookingError;if(!self.$){Dialog.prototype.render.call(self)}BookingError=$("#booking-error");self.setHtmlContent(BookingError)};BookingErrorDialog.prototype.show=function(){var self=this;Dialog.prototype.show.call(self)};return BookingErrorDialog})(jQuery,orion.widgets.Dialog,orion.widgets.DialogManager);
BBV.namespace("orion.widgets").DialogManager=orion.DialogManager||(function($){function DialogManager(publisher){var self=this;var container;if(!(self instanceof DialogManager)){return new DialogManager(publisher)}container=$("#dialog-container");if(container.size()<1){$("body").append('<div id="dialog-container"/>');container=$("#dialog-container")}self._container=container;self._dialogInstances={};self._dialogConstructors={tvod:orion.widgets.TvodDialog,resume:orion.widgets.ResumeDialog,confirmation:orion.widgets.ConfirmationDialog,login:orion.widgets.LoginDialog,terms:orion.widgets.TermsDialog,"dvr-settings":orion.widgets.DvrSettingsDialog,"booking-error":orion.widgets.BookingErrorDialog,"pin-verification":orion.widgets.PinDialog,"pin-change-confirmation":orion.widgets.PinChangeDialog,"register-device":orion.widgets.RegisterDeviceDialog,"replace-device":orion.widgets.ReplaceDeviceDialog,"device-registered":orion.widgets.DeviceRegisteredDialog,"cannot-register-device":orion.widgets.CannotRegisterDeviceDialog};self.initScripts={};self.publisher=publisher;self.setInitScripts();self.subscribeToEvents()}DialogManager.prototype.getDialog=function(dialogName,destroyOnClose){var self=this;var $oldDialog;var dialog;if(destroyOnClose){$oldDialog=self._dialogInstances[dialogName]?self._dialogInstances[dialogName].$:null;delete self._dialogInstances[dialogName]}if(self._dialogInstances[dialogName]){dialog=self._dialogInstances[dialogName]}else{dialog=new (self.lookupConstructor(dialogName))();self._dialogInstances[dialogName]=dialog;self._container.append(dialog.$);if(self.initScripts[dialogName]){self.initScripts[dialogName](dialog)}}if($oldDialog){$oldDialog.remove()}return dialog};DialogManager.prototype.registerConstructor=function(name,Constructor){var self=this;self._dialogConstructors[name]=Constructor};DialogManager.prototype.lookupConstructor=function(dialogName){var self=this;if(self._dialogConstructors[dialogName]){return self._dialogConstructors[dialogName]}else{return orion.widgets.Dialog}};DialogManager.prototype.setInitScripts=function(){var dm=this;var publisher=dm.publisher;dm.initScripts={"dvr-booking":function(dialog){var $dialog=$("#dvr-booking");var $trigger=$($dialog.data("trigger"));var $programDetails=$trigger.closest(".program-details-wrap");var $channel=$programDetails.prev("dl");var closeDialog=function(){dialog.hide();$dialog.find(".error").hide();$("input:checked","#dvr-booking").each(function(idx,field){$(field).removeAttr("checked")});$("#dvr-booking .submit button").removeAttr("disabled").parent().removeClass("disabled")};var $content=$dialog.find("#schedule-recording");var program={name:$dialog.data("show"),channelId:$channel.data("channel-id"),channelName:$dialog.data("channel")};if(dialog.contentArea.html()===""){dialog.setHtmlContent($dialog)}$dialog.children().hide();$content.find(".show").text(program.name);$content.find(".channel").text(program.channelName);$content.show();orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set Recording/"+program.channelId,channel:"TV Guide/Set Recording/Set Recording",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording",eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event41"});dialog.$.delegate("#dvr-booking .submit button","click",function(e){e.preventDefault();var $elem=$(e.target);var listingId=$dialog.data("listing-id");var rbUrl=$("#site-utility-bar").data("remote-bookings-url");var $listing=$("						li.listing[data-listing-id='"+listingId+"'] .notifications,						div.program-details-wrap[data-listing-id='"+listingId+"'] .user-functionality					");if(!$("input:checked","#schedule-recording fieldset").length){$dialog.find(".error").show();return}$dialog.find(".error").hide();$elem.attr("disabled","disabled").parent().addClass("disabled");var bookingType="recordings",overwriteExisting=$("input:checked","#schedule-recording fieldset").val()=="1"?true:false,bookingData=JSON.stringify({listingId:listingId,overwriteExisting:overwriteExisting});orion.util.oesp.post(rbUrl+"/"+bookingType+"/",{data:bookingData,success:function(data){var status=data[bookingType][0].status;var errorMsg=data[bookingType][0].reason;$("#dvr-booking .submit button").removeAttr("disabled").parent().removeClass("disabled");$listing.each(function(idx,icon){$(icon).addClass(bookingType+"-pending")});if(bookingType==="recordings"&&(status==="success"||status==="pending")){orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set recording success",channel:"TV Guide/Set Recording/Set Recording success",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording success",prop44:"[INSERT EPG transaction ID]",eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event43"})}else{if(bookingType==="recordings"&&status==="failure"){orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set recording failed",channel:"TV Guide/Set Recording/Set Recording failed",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording failed",prop41:errorMsg,eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event48"})}}publisher.trigger("getRemoteBookings",bookingType)},error:function(data){$listing.each(function(idx,icon){$(icon).addClass(bookingType+"-failed")});publisher.trigger("requestDialog",{dialogName:"booking-error",centerOn:"window",destroyOnClose:true});if(data[bookingType]){var errorMsg=orioni18n.RemoteBookingMessages.bookingErrors[data[bookingType][0].reason]}else{var errorMsg=orioni18n.RemoteBookingMessages.bookingErrors.unknown}$("#booking-error .show").text($("#booking-error").data("show"));$("#booking-error .channel").text($("#booking-error").data("channel"));$("#booking-error .error").text(errorMsg);if(bookingType==="recordings"){orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set recording failed",channel:"TV Guide/Set Recording/Set Recording failed",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording failed",prop41:errorMsg,eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event48"})}},complete:function(){closeDialog()}})});dialog.$.delegate("#dvr-booking a.cancel","click",function(e){closeDialog()});dialog.setCloseBehavior(function(){closeDialog()})}}};DialogManager.prototype.subscribeToEvents=function(){var self=this;self.publisher.subscribe("requestDialog",function(eventOptions){log("[DEPRECATION] Requesting dialogs via the global pubsub object should not be used in new code.");var dialog;if(!eventOptions.dialogName){throw new Error("dialogName not specified")}destroyOnClose=eventOptions.destroyOnClose||false;dialog=self.getDialog(eventOptions.dialogName,destroyOnClose);if(eventOptions.centerOn){dialog.centerOn(eventOptions.centerOn)}if(eventOptions.pointTo){dialog.pointTo(eventOptions.pointTo.target,eventOptions.pointTo.direction)}if(eventOptions.setVerificationType){dialog.setVerificationType(eventOptions.setVerificationType)}dialog.show()})};return DialogManager})(jQuery);
BBV.namespace("orion").Recommendations=orion.Recommendations||(function($){function Recommendations(publisher,isDialog){var self=this;if(!(self instanceof Recommendations)){return new Recommendations(publisher)}self.isDialog=(isDialog)?true:false;self.publisher=publisher;self.$myOrionBar=$("#site-orion-bar");self.hideViewToggling=!!self.$myOrionBar.data("hide-view-toggling");self.elem="#recommendations";self.url=self.$myOrionBar.data("recommendations-url");self.i18n=orioni18n.myOrionBar;self.$containers=$("#recommendations, #recommendations-module");self.$containerDialog=$("#myorionbar-dialog .dialog-inner");self.$containerModule=$("#recommendations-module");self.$myorionbarDialogs=$("#myorionbar-dialog");if(!self.url){log("missing url for recommendations");return}orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.initialize();self.handlers()}});return self}Recommendations.prototype.initialize=function(){var self=this;orion.util.oesp.get(self.url,{success:function(data){self.mediaTemplate=new orion.util.MediaTemplate();self.mediaItems=self.mediaTemplate.formatData(data.mediaItems,{i18n:self.i18n,imgType:"still-medium",isMyOrionBar:true,isRecommendations:true});self.build();self.attach()},fail:function(){self.recommendations=[];self.build();self.attach()}});return self};Recommendations.prototype.handlers=function(){var self=this;self.$containerModule.on("click",".view-toggle a",function(event){event.preventDefault();var hash=orion.util.modules.getHash(event);orion.util.modules.toggleView(self.$containerModule,hash)})};Recommendations.prototype.build=function(){var self=this;var target,html;if(self.isDialog){html=self.mediaTemplate.getMarkup(self.mediaItems,{template:"Recommendations",count:self.mediaItems.length,hideView:self.hideViewToggling,isThumb:true,disabledHover:true});self.$templateDialog=$(html)}else{if(self.$containerModule.length){html=self.mediaTemplate.getMarkup(self.mediaItems,{template:"Media",count:self.mediaItems.length,isThumb:true,disabledHover:true});self.$templateModule=$(html)}}return self};Recommendations.prototype.attach=function(options){var self=this;if(self.isDialog){self.$containerDialog.append(self.$templateDialog);orion.modules.MyOrionBar.showDialog("recommendations")}else{if(self.$containerModule.length){self.$containerModule.find(".section").empty().html(self.$templateModule)}}self.stopLoaders();orion.Playlist.setState("#recommendations");return self};Recommendations.prototype.stopLoaders=function(){var self=this;self.$myorionbarDialogs.trigger("loaded")};return Recommendations})(jQuery);
BBV.namespace("orion").Playlist=orion.Playlist||(function($){function unique(arr){var a=arr.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j,1)}}}return a}var initialized=false;function PlaylistModel(controller){var self=this;self.controller=controller}function Playlist(publisher,isDialog){var self=this;self.isDialog=(isDialog)?true:false;self.publisher=publisher;self.$myOrionBar=$("#site-orion-bar");self.elem="#playlist";self.dialogContent=".dialog-content";self.name=self.$myOrionBar.data("playlist-name")||"default";self.mediaUrl=self.$myOrionBar.data("mediaitems-url");self.manageUrl=self.$myOrionBar.data("manage-playlist-url");self.i18n=$.extend(orioni18n.myOrionBar,orioni18n.playlist);self.$myorionbarDialogs=$("#myorionbar-dialog");self.$containers=$("#myorionbar-dialog, .myorionbar-module");self.$containerDialog=$("#myorionbar-dialog .dialog-inner");self.$containerModule=$("#playlist-module");self.$modules=$(".module, .module-ng");self.currentPlaylistItemIds=[];self.playlists=orion.oesp.playlistEndpoint;orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.model=new PlaylistModel(self)}});if(initialized&&!orion.app.resettingNow){return}initialized=true;if(orion.app.resettingNow){self.destroyBindings()}if(!(self instanceof Playlist)){throw new Error("Playlist called without new.")}orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.isAuthenticated=true;self.handlers();self.initialize()}else{self.handlers()}});self.publisher.subscribe("updatePlaylist",function(eventOptions){if(!eventOptions.action){throw new Error("action not specified")}orion.oesp.session.withSession(function(session){if(!session.isAuthenticated()){self.publisher.trigger("requestDialog",{dialogName:"login",pointTo:{target:self.$myOrionBar.find('[data-dialog="playlist"]'),direction:"down"}})}else{var options={action:eventOptions.action,mediaId:eventOptions.mediaId||"",moduleId:eventOptions.moduleId||"",isGroup:eventOptions.isGroup||false,isPlaylistModule:eventOptions.isPlaylistModule||false,sortBy:eventOptions.sortBy||"",success:eventOptions.success||self.addRemoveSuccess,complete:eventOptions.complete||BBV.noop};self.update(options)}});return self});return self}Playlist.prototype.destroyBindings=function(){var self=this;self.$modules.not("#playlist-module").undelegate(".media-item .add a, .media-item .remove a, .add-all a","click");self.$containers.undelegate(".media-item a.remove, .media-item .remove a, .view-toggle a","click");self.$modules.not("#playlist-module").undelegate(".media-item .add a, .add-all a, .view-toggle a","click");self.$modules.not("#playlist-module").undelegate(".media-item","mouseover");self.$modules.not("#playlist-module").undelegate(".media-item .add a, .media-item .remove a","click");self.$modules.not("#playlist-module").undelegate(".add-all a","click");self.$containers.undelegate(".media-item a.add, .media-item a.remove, .media-item .add a, .media-item .remove a","click");orion.app.dialogManager.getDialog("confirmation").unbind("confirm");$(document).unbind("playlist:updateMediaItems")};Playlist.containsProgramId=function(options){options=$.extend({},options);var id=options.id||0;var inPlaylist=false;var localMediaItemIds=(typeof(model)!=="undefined")?model.mediaItemIds:[];var mediaItemIds=sessionStorage.getItem("playlist")?$.parseJSON(sessionStorage.getItem("playlist")).mediaItems:localMediaItemIds;if(mediaItemIds&&mediaItemIds.length){$.each(mediaItemIds,function(idx,mediaItemId){if(id===mediaItemId){inPlaylist=true}})}return inPlaylist};Playlist.getNext=function(options){var playlistId=$("#playlist").data("playlist-id");if(!playlistId){orion.oesp.playlistEndpoint.requestPlaylists().done(function(response){orion.Playlist.getNextDone(options,response.playlists[0].id)})}else{orion.Playlist.getNextDone(options,playlistId)}};Playlist.getNextDone=function(options,playlistId){options=$.extend({},options);var id=options.id||0;var count=options.count||4;var callback=options.callback||BBV.noop;var mediaItems=[];var nextMediaItems=[];var getPlaylist=orion.oesp.playlistEndpoint.requestPlaylistById(playlistId);getPlaylist.done(function(data){$.each(data.mediaItems,function(index,mediaItem){if(id==mediaItem.id||(nextMediaItems.length<=count)){nextMediaItems.push(mediaItem)}});if(nextMediaItems.length<=1){return}nextMediaItems.shift();callback.call(unique(nextMediaItems))})};Playlist.getItemsIdInPlaylist=function(){var mediaItemIds=sessionStorage.getItem("playlist")?$.parseJSON(sessionStorage.getItem("playlist")).mediaItems:null;return mediaItemIds};Playlist.setState=function(context){var self=this;var mediaItemIds=sessionStorage.getItem("playlist")?$.parseJSON(sessionStorage.getItem("playlist")).mediaItems:null;$("[data-media-id]",context).each(function(){if(!mediaItemIds||!$(this).data("media-id")){return}if($.inArray($(this).data("media-id").toString(),mediaItemIds)>-1){$(this).addClass("in-playlist")}else{$(this).removeClass("in-playlist")}})};Playlist.prototype.handlers=function(){var self=this;var model=self.model;if(self.isAuthenticated){$(document).bind("playlist:updateMediaItems",function(event,options){var mediaItems=[];var updatePlaylist;model.mediaItemIds=options.mediaItems?unique(options.mediaItems):unique(model.mediaItemIds);$.each(model.mediaItemIds,function(){mediaItems.push({id:this})});updatePlaylist=self.playlists.updatePlaylist(model.id,self.name,mediaItems);updatePlaylist.done(function(){options.success.call(self,options)}).fail(function(){self.stopLoaders()})});self.$modules.not("#playlist-module").delegate(".media-item .add a, .media-item .remove a, .add-all a","click",function(event){event.preventDefault()});self.$containers.delegate(".media-item a.remove, .media-item .remove a, .view-toggle a","click",function(event){event.preventDefault()})}else{self.$modules.not("#playlist-module").delegate(".media-item .add a, .add-all a, .view-toggle a","click",function(event){event.preventDefault();self.publisher.trigger("requestDialog",{dialogName:"login",pointTo:{target:$('#site-orion-bar li[data-dialog="playlist"]'),direction:"down"}})})}};Playlist.prototype.handlersLoggedIn=function(){var self=this;var model=self.model;self.handlersBound=true;self.confirmationDialog=orion.app.dialogManager.getDialog("confirmation");self.$modules.not("#playlist-module").delegate(".media-item .add a, .media-item .remove a","click",function(event){event.preventDefault();var elem=event.target;var $elem=$(elem);var mediaId=$elem.closest(".media-item").data("media-id");var isGroup=$elem.closest(".media-item").is(".media-group");var action=$elem.closest("span").attr("class");self.publisher.trigger("updatePlaylist",{action:action,mediaId:mediaId,isGroup:isGroup})});self.$modules.not("#playlist-module").delegate(".add-all a","click",function(event){event.preventDefault();var elem=event.target;var $elem=$(elem);var moduleId=$elem.closest("section").find("ul.tabs").length?$elem.closest("div.section").attr("id"):$elem.closest("section").attr("id");self.publisher.trigger("updatePlaylist",{action:"addAll",moduleId:moduleId})});self.$containers.delegate("a#clear-playlist","click",function(event){event.preventDefault();if(model.id){self.startLoaders();self.confirmationDialog=orion.app.dialogManager.getDialog("confirmation");self.confirmationDialog.setContent(self.i18n.confirmDeletePlaylistTitle,self.i18n.confirmDeletePlaylistMessage);self.confirmationDialog.centerOn("window");self.confirmationDialog.show();self.confirmationDialog.bind("confirm",function(){var deletePlaylist=self.playlists.deletePlaylist(model.id);deletePlaylist.done(function(){self.create()}).fail(function(){self.stopLoaders()});return false});self.confirmationDialog.bind("cancel",function(){self.stopLoaders();return false})}return false});self.$containers.delegate(".media-item a.add, .media-item a.remove, .media-item .add a, .media-item .remove a","click",function(event){event.preventDefault();var elem=event.target;var $elem=$(elem);var mediaId=$elem.closest(".media-item").data("media-id");var isPlaylistModule=$elem.closest(".playlist").is("section");var action=$elem.attr("class")||$elem.closest("span").attr("class");self.publisher.trigger("updatePlaylist",{action:action,mediaId:mediaId,isGroup:false,isPlaylistModule:isPlaylistModule})});self.$containers.on("click",".medium-toggle.view-toggle a",function(event){event.preventDefault();var hash=orion.util.modules.getHash(event);self.toggleMedium(hash)});self.$containerModule.on("click",".myorionbar-sub-functionality .view-toggle a",function(event){event.preventDefault();var hash=orion.util.modules.getHash(event);orion.util.modules.toggleView(self.$containerModule,hash)});self.$containers.delegate(".sort-playlist li a","click",function(event){event.preventDefault();var elem=event.target;var $elem=$(elem);var sortStr="INFO";self.sortByMethod=$(event.target).closest("li").attr("class").substr(7);if(self.sortByMethod=="title"){sortStr=self.i18n.titleheading}else{if(self.sortByMethod=="air-date"){sortStr=self.i18n.airDate}else{if(self.sortByMethod=="expiration-date"){sortStr=self.i18n.expirationDate}}}self.$containers.find(".sort-confirmation,.sort-confirmation .dialog").show();self.$containers.find(".sort-confirmation .dialog h2 span").html(sortStr)});self.$containers.find(".sort-confirmation .close-alt, .sort-confirmation .cancel-sort, .my-orion-list li").on("click",function(event){event.preventDefault();self.$containers.find(".sort-confirmation,.sort-confirmation .dialog").hide()});self.$containers.find(".sort-confirmation .button a").on("click",function(event){event.preventDefault();self.sortText=self.$containers.find(".sort-confirmation .dialog h2 span").text();self.publisher.trigger("updatePlaylist",{action:"sort",sortBy:self.sortByMethod,isPlaylistModule:true});self.$containers.find(".sort-confirmation,.sort-confirmation .dialog").hide();self.stopLoaders()})};Playlist.prototype.initialize=function(){var self=this;var model=self.model;self.load();self.$containerModule.loader({flow:["overlay"],target:".section",minheight:438,minwidth:926});return self};Playlist.prototype.get=function(){var self=this;var $playlists=$.Deferred();self.playlists.requestPlaylists().done(function(data){self.set(data.playlists).done(function(){$playlists.resolve()})});return $playlists.promise()};Playlist.prototype.set=function(playlists){var self=this;var model=self.model;var $playlist=$.Deferred();if(!playlists.length){self.create().done(function(){$playlist.resolve()})}else{model.id=playlists[0].id;model.mediaItemIds=playlists[0].mediaItems||[];$playlist.resolve()}return $playlist.promise()};Playlist.prototype.clear=function(){var self=this;var $playlists=$.Deferred();self.playlists.requestPlaylists().done(function(data){$.each(data.playlists,function(){self.playlists.deletePlaylist(this.id)});$playlists.resolve()});return $playlists.promise()};Playlist.prototype.create=function(){var self=this;var model=self.model;var $playlist=$.Deferred();self.playlists.createPlaylist(self.name).done(function(playlist){model.id=playlist.id;model.mediaItemIds=playlist.mediaItems;self.onLoadSuccess.call(self,playlist);$playlist.resolve()});return $playlist.promise()};Playlist.prototype.load=function(options){var self=this;var model=self.model;var $playlist=$.Deferred();var getPlaylists=self.get();var getPlaylist;options=$.extend({},options);getPlaylists.done(function(){getPlaylist=self.playlists.requestPlaylistById(model.id);getPlaylist.done(function(playlist){self.onLoadSuccess.call(self,playlist,options);$playlist.resolve()}).fail(function(data){self.onLoadError.call(self,data);$playlist.reject()})});return $playlist.promise()};Playlist.prototype.onLoadSuccess=function(data,options){var self=this;var model=self.model;var entitledMediaItems;self.mediaTemplate=new orion.util.MediaTemplate();self.mediaTemplateProperties={i18n:self.i18n,imgType:"still-medium",isMyOrionBar:true,isPlaylist:true};entitledMediaItems=self.mediaTemplate.formatData(data.mediaItems,self.mediaTemplateProperties);orion.oesp.session.done(function(session){if(!session.adultPinVerified){var resultItems=[];$.each(entitledMediaItems,function(index,mediaItem){if(mediaItem&&!mediaItem.isAdult){resultItems.push(mediaItem)}});entitledMediaItems=resultItems}model.mediaItems=entitledMediaItems;self.counts={tv:0,movie:0,all:0};for(var i=0;i<model.mediaItems.length;i++){var mediaItem=model.mediaItems[i];if(!session.adultPinVerified&&mediaItem.isAdult){continue}model.mediaItemIds.push(mediaItem.id);if(mediaItem.medium=="TV"){self.counts.tv++}else{self.counts.movie++}self.counts.all++}model.mediaItemIds=unique(model.mediaItemIds);sessionStorage.setItem("playlist",JSON.stringify({id:model.id,name:self.name,mediaItems:model.mediaItemIds}));self.render(options)})};Playlist.prototype.onLoadError=function(data){var self=this;self.stopLoaders()};Playlist.prototype.render=function(options){var self=this;var model=self.model;options=$.extend({},options);if(!self.handlersBound){self.handlersLoggedIn()}self.getPurchases(options);orion.Playlist.setState(".module, .dialog");self.publisher.trigger("playlistLoaded");if(options.complete){options.complete.call(self,options)}return self};Playlist.prototype.getPurchases=function(options){var self=this;var model=self.model;var activePurchases=orion.oesp.purchaseEndpoint.activePurchases;activePurchases.done(function(purchases){$.each(purchases.products,function(productIdx,product){$.each(model.mediaItems,function(itemIdx,item){if(product.id===item.productId){item.expirationDate=product.entitlementEnd}})})}).always(function(){self.build(options)})};Playlist.prototype.build=function(options){var self=this;var model=self.model;var floor=0;var ceil=100;var floorLimitReached=model.mediaItemIds.length==floor?true:false;var ceilLimitReached=model.mediaItemIds.length>=ceil?true:false;$.each(model.mediaItems,function(index,item){item.index=index;item.order=index+1});if(floorLimitReached||ceilLimitReached){if(floorLimitReached){if(self.$containerModule.length){self.$templateModule=self.mediaTemplate.getMarkup(model.mediaItems,{template:"PlaylistEmpty"})}self.$templateDialog=self.mediaTemplate.getMarkup(model.mediaItems,{template:"Playlist",manageUrl:self.manageUrl,isEmpty:true})}else{if(self.$containerModule.length){self.$templateModule=self.mediaTemplate.getMarkup(model.mediaItems,{template:"Media",isThumb:true})}self.$templateDialog=self.mediaTemplate.getMarkup(model.mediaItems,{template:"Playlist",manageUrl:self.manageUrl,isFull:true})}}else{if(self.$containerModule.length){self.$templateModule=self.mediaTemplate.getMarkup(model.mediaItems,{template:"Media",isThumb:true})}self.$templateDialog=self.mediaTemplate.getMarkup(model.mediaItems,{template:"Playlist",manageUrl:self.manageUrl,isThumb:true})}self.attach(options);self.updateCounts();$(self.elem).data("playlist-id",model.id);return self};Playlist.prototype.attach=function(options){var self=this;var model=self.model;var $dialogContent=self.$containerDialog.find(".content-list");var $userFunctionality=self.$containerModule.find(".user-functionality");options=$.extend({},options);var reorderOptions={opacity:0.9,cursor:"move",helper:"clone",forceHelperSize:true,appendTo:"body",scroll:false,zIndex:99999,over:function(event,ui){self.isDraggedOut=false;self.$myorionbarDialogs.addClass("over")},out:function(event,ui){self.isDraggedOut=true;self.$myorionbarDialogs.removeClass("over")},update:function(event,ui){self.makeDraggable(event,ui)},beforeStop:function(event,ui){self.dragStop(event,ui)}};if(self.$containerModule.length){self.$containerModule.find(".section").empty().html(self.$templateModule);if(self.$mediaItems){var hash=self.$containerModule.find(".myorionbar-sub-functionality .active").attr("href");orion.util.modules.toggleView(self.$containerModule,hash);self.toggleMedium("#all")}orion.app.recommendations.updateRatedItems(self.$containerModule.find(".section"));if(self.sortText){self.sortSuccess()}self.stopLoaders()}$(self.elem).remove();self.$containerDialog.append(self.$templateDialog);orion.app.recommendations.updateRatedItems(self.$containerDialog);self.$mediaItems=self.$containers.find(".media-item");self.$disabledItems=self.$mediaItems.find(".highlight");orion.modules.MyOrionBar.showDialog("playlist");if(options.visibility==="visible"){self.$myorionbarDialogs.show();$(self.elem).show();self.$containerDialog.find(".content-list").animate({scrollTop:10000},2000)}$("#playlist .content-list ul, #playlist-module .content-list ul").sortable(reorderOptions).disableSelection();if(model.mediaItemIds.length){$userFunctionality.show()}else{$userFunctionality.hide()}self.stopLoaders();return self};Playlist.prototype.updateCounts=function(options){var self=this;self.$containers.find(".count-all").html(self.counts.all);self.$containers.find(".count-tv").html(self.counts.tv);self.$containers.find(".count-movies").html(self.counts.movie);self.$containers.find(".medium-toggle").show()};Playlist.prototype.update=function(options){var self=this;if(!options.isPlaylistModule){self.$myorionbarDialogs.show();$(self.dialogContent).hide();$(self.elem).show()}self.startLoaders();self[options.action](options);return self};Playlist.prototype.add=function(options){var self=this;var model=self.model;var mediaId=options.mediaId.toString();if($.inArray(mediaId,model.mediaItemIds)==-1){model.mediaItemIds.push(mediaId)}if(options.isGroup){orion.util.oesp.get(self.mediaUrl+"?byMediaGroupId="+encodeURIComponent(mediaId)+"&includeAdult=true",{success:function(data){$.each(data.mediaItems,function(index,mediaItem){switch(mediaItem.mediaType.toLowerCase()){case"featurefilm":case"episode":if($.inArray(mediaItem.id,model.mediaItemIds)==-1){model.mediaItemIds.push(mediaItem.id)}break;default:break}if(index===data.mediaItems.length-1){options.mediaItems=unique(model.mediaItemIds);$(document).trigger("playlist:updateMediaItems",options)}});orion.util.analytics.trackEvent("action",{pageName:"Playlist/Add to Playlist",channel:"Playlist/Add to Playlist",prop23:"Playlist",prop24:"Playlist",prop26:"Add to Playlist",eVar32:mediaId,events:"event9,event31"})},error:function(){self.stopLoaders()}})}else{orion.util.analytics.trackEvent("action",{pageName:"Playlist/Add to Playlist",channel:"Playlist/Add to Playlist",prop23:"Playlist",prop24:"Playlist",prop26:"Add to Playlist",eVar32:mediaId,events:"event9,event31"});options.mediaItems=unique(model.mediaItemIds);$(document).trigger("playlist:updateMediaItems",options)}return self};Playlist.prototype.addMediaGroupItems=function(options){var self=this;var model=self.model;$.each(options.mediaId,function(index,id){if($.inArray(id,model.mediaItemIds)==-1){model.mediaItemIds.push(id)}});options.mediaItems=unique(model.mediaItemIds);$(document).trigger("playlist:updateMediaItems",options)};Playlist.prototype.addAll=function(options){var self=this;var model=self.model;var $module=$("#"+options.moduleId);$module.find(".media-item").each(function(index,mediaItem){var mediaId=$(mediaItem).data("media-id");if($.inArray(mediaId,model.mediaItemIds)==-1){model.mediaItemIds.push(mediaId)}orion.util.analytics.trackEvent("action",{pageName:"Playlist/Add to Playlist",channel:"Playlist/Add to Playlist",prop23:"Playlist",prop24:"Playlist",prop26:"Add to Playlist",eVar32:mediaId,events:"event9,event31"})});options.mediaItems=unique(model.mediaItemIds);$(document).trigger("playlist:updateMediaItems",options);return self};Playlist.prototype.removeMediaGroupItems=function(options){var self=this;var model=self.model;var mediaItemsIdsInGroup=options.mediaId;var mediaItemsIdsObj={};var aMediaItemIds=[];for(var i=0;i<mediaItemsIdsInGroup.length;i++){mediaItemsIdsObj[mediaItemsIdsInGroup[i]]=true}$.each(model.mediaItemIds,function(index,mediaItemId){if(!(mediaItemId in mediaItemsIdsObj)&&$.inArray(mediaItemId,model.mediaItemIds)!==-1){aMediaItemIds.push(mediaItemId)}});orion.util.analytics.trackEvent("action",{pageName:"Playlist/Remove from Playlist",channel:"Playlist/Remove from Playlist",prop23:"Playlist",prop24:"Playlist",prop26:"Remove from Playlist",eVar32:mediaItemsIdsInGroup.join(),events:"event9,event32"});model.mediaItemIds=unique(aMediaItemIds);options.mediaItems=model.mediaItemIds;$(document).trigger("playlist:updateMediaItems",options);return self};Playlist.prototype.remove=function(options){var self=this;var model=self.model;var mediaId=options.mediaId.toString();var aMediaItemIds=[];$.each(model.mediaItemIds,function(index,mediaItemId){if(mediaItemId!==mediaId&&$.inArray(mediaItemId,model.mediaItemIds)!==-1){aMediaItemIds.push(mediaItemId)}});orion.util.analytics.trackEvent("action",{pageName:"Playlist/Remove from Playlist",channel:"Playlist/Remove from Playlist",prop23:"Playlist",prop24:"Playlist",prop26:"Remove from Playlist",eVar32:mediaId,events:"event9,event32"});model.mediaItemIds=unique(aMediaItemIds);options.mediaItems=model.mediaItemIds;$(document).trigger("playlist:updateMediaItems",options);return self};Playlist.prototype.addRemoveSuccess=function(options){var self=this;options=$.extend({},options);var completeCallback=options.complete||$.noop;self.load({visibility:options.isPlaylistModule?"hidden":"visible",complete:completeCallback});self.publisher.trigger("playlistUpdated",{action:options.action,mediaId:options.mediaId.toString()})};Playlist.prototype.dragStop=function(event,ui){var self=this;var container=ui.item.closest(".myorionbar-dialog, .myorionbar-module");var isPlaylistModule=container.is("section");if(self.isDraggedOut){self.publisher.trigger("updatePlaylist",{action:"remove",mediaId:ui.item.data("media-id"),isGroup:false,isPlaylistModule:isPlaylistModule})}};Playlist.prototype.makeDraggable=function(event,ui){var self=this;if(self.isDraggedOut){return}var container=ui.item.closest(".myorionbar-dialog, .myorionbar-module"),isPlaylistModule=container.is("section"),aMediaItems=[];container.find(".media-item:visible").each(function(index,mediaItem){aMediaItems.push($(mediaItem).data("media-id").toString())});self.publisher.trigger("updatePlaylist",{action:"reorder",mediaId:aMediaItems,isPlaylistModule:isPlaylistModule,success:self.reorderSuccess});return self};Playlist.prototype.reorder=function(options){var self=this;options.mediaItems=options.mediaId;$(document).trigger("playlist:updateMediaItems",options);return self};Playlist.prototype.reorderSuccess=function(options){var self=this;var model=self.model;var getPlaylist=orion.oesp.playlistEndpoint.requestPlaylistById(model.id);getPlaylist.done(function(playlist){model.mediaItems=self.mediaTemplate.formatData(playlist.mediaItems,self.mediaTemplateProperties);self.setOrderNumber()});self.stopLoaders()};Playlist.prototype.setOrderNumber=function(){var self=this;var gridItemsModule=$(".grid-view .order",self.$containerModule);var listItemsModule=$(".list-view .order",self.$containerModule);var gridItems=$(".grid-view .order","#playlist");var listItems=$(".list-view .order","#playlist");if(self.$containerModule.length){gridItemsModule.each(function(idx,item){if(idx===0){$(".grid-view .order:first",self.$containerModule).text("1")}else{$(item).text(idx+1)}});listItemsModule.each(function(idx,item){if(idx===0){$(".list-view .order:first",self.$containerModule).text("1")}else{$(item).text(idx+1)}})}gridItems.each(function(idx,item){if(idx===0){$(".grid-view .order:first","#playlist").text("1")}else{$(item).text(idx+1)}});listItems.each(function(idx,item){if(idx===0){$(".list-view .order:first","#playlist").text("1")}else{$(item).text(idx+1)}});return self};Playlist.prototype.sort=function(options){var self=this;var model=self.model;options=$.extend({},options);var sortBy=options.sortBy;var map={title:"title","air-date":"airDate","expiration-date":"expirationDate"};var aMediaItemObjs=[];var aMediaItemsSorted=[];self.sortOrder=sortBy==self.sortBy?self.sortOrder=="DESC"?"ASC":"DESC":"ASC";self.sortBy=sortBy;$.each(model.mediaItems,function(index,mediaItem){aMediaItemObjs.push({id:mediaItem.id,sorted:mediaItem[map[sortBy]]})});aMediaItemObjs.sort(function(a,b){var x=!a.sorted?"":isNaN(a.sorted)?a.sorted.toLowerCase():a.sorted;var y=!b.sorted?"":isNaN(b.sorted)?b.sorted.toLowerCase():b.sorted;if(self.sortOrder=="DESC"){return((y<x)?-1:((y>x)?1:0))}else{return((x<y)?-1:((x>y)?1:0))}});$.each(aMediaItemObjs,function(index,mediaItem){aMediaItemsSorted.push(mediaItem.id)});model.mediaItemIds=unique(aMediaItemsSorted);options.mediaItems=model.mediaItemIds;$(document).trigger("playlist:updateMediaItems",options);return self};Playlist.prototype.sortSuccess=function(){var self=this;$(".sort-playlist .sort span").text(self.sortText)};Playlist.prototype.toggleMedium=function(hash){var self=this;var $elem=self.$containers.find('a[href="'+hash+'"]');var viewClass=hash.replace("#",".");var $links,$enabledItems,$lists;$links=self.$containers.find(".medium-toggle");if(hash==="#all"){self.$disabledItems.css("display","none")}else{self.$disabledItems.css("display","block");$enabledItems=self.$mediaItems.filter(viewClass).find(".highlight");$enabledItems.css("display","none")}$links.find(".active").removeClass("active");$elem.addClass("active")};Playlist.prototype.startLoaders=function(){var self=this;if(self.$containerModule.length&&!self.$containerModule.find(".loading-wrapper").length){self.$containerModule.trigger("loading")}if(!self.$myorionbarDialogs.find(".loading-wrapper").length){$(self.elem).trigger("loading")}return self};Playlist.prototype.stopLoaders=function(){var self=this;if(self.$containerModule.length&&self.$containerModule.find(".loading-wrapper").length){self.$containerModule.trigger("loaded")}if(self.$myorionbarDialogs.find(".loading-wrapper").length){$(self.elem).trigger("loaded")}return self};return Playlist})(jQuery);
BBV.namespace("orion").RecentlyViewed=orion.RecentlyViewed||(function($){function RecentlyViewed(publisher,isDialog){var self=this;self.publisher=publisher;self.$myOrionBar=$("#site-orion-bar");self.elem="#recently-viewed";self.mediaUrl=self.$myOrionBar.data("mediaitems-url");self.i18n=orioni18n.myOrionBar;self.$container=$("#myorionbar-dialog .dialog-inner");self.$myorionbarDialogs=$("#myorionbar-dialog");if(!(self instanceof RecentlyViewed)){throw new Error("RecentlyViewed called without new.")}if(BBV.user().isLoggedIn){self.handlers();self.initialize()}return self}RecentlyViewed.prototype.handlers=function(){var self=this;self.$container.delegate("#clear-recent","click",function(event){var bookmarkRequest=orion.oesp.bookmarkEndpoint.clearBookmarks();bookmarkRequest.done(function(){log("clear");$(self.elem).find("ul.grid-view").empty()});event.preventDefault()})};RecentlyViewed.prototype.initialize=function(){var self=this;var bookmarkRequest=orion.oesp.bookmarkEndpoint.requestBookmarks();self.templateProperties={i18n:self.i18n,imgType:"still-medium",isMyOrionBar:true,isRecentlyViewed:true};bookmarkRequest.done(function(data){self.bookmarks=data.bookmarks;if(self.bookmarks.length){self.getBookmarks()}else{self.mediaTemplate=new orion.util.MediaTemplate();self.mediaItems=self.mediaTemplate.formatData({},self.templateProperties);self.render()}});return self};RecentlyViewed.prototype.getBookmarks=function(){var self=this;var programs=$.map(self.bookmarks,function(bookmark){return bookmark.mediaItemId}).join("|");orion.oesp.mediaItemEndpoint.requestMediaItems({byId:programs}).done(function(data){self.mediaTemplate=new orion.util.MediaTemplate();self.mediaItems=self.mediaTemplate.formatData(data.mediaItems,self.templateProperties);self.render()}).fail(function(){self.mediaItems={};self.render()});return self};RecentlyViewed.prototype.render=function(){var self=this;self.build();self.attach();return self};RecentlyViewed.prototype.build=function(){var self=this;self.$template=self.mediaTemplate.getMarkup(self.mediaItems,{template:"RecentlyViewed",count:self.mediaItems.length,isThumb:true,disabledHover:true});return self};RecentlyViewed.prototype.attach=function(){var self=this;$(self.elem).remove();self.$container.append(self.$template);self.$myorionbarDialogs.trigger("loaded");return self};return RecentlyViewed})(jQuery);
BBV.namespace("orion").MyRentals=orion.MyRentals||(function($){function MyRentals(publisher,isDialog){var self=this;self.isDialog=(isDialog)?true:false;self.publisher=publisher;self.$myOrionBar=$("#site-orion-bar");self.hideViewToggling=!!self.$myOrionBar.data("hide-view-toggling");self.elem="#my-rentals";self.i18n=orioni18n.myOrionBar;self.manageUrl=self.$myOrionBar.data("manage-my-rentals-url");self.$containerModule=$("#my-rentals-module");self.$containerDialog=$("#myorionbar-dialog .dialog-inner");self.$containers=self.$containerModule.add(self.$containerDialog);self.$myorionbarDialogs=$("#myorionbar-dialog");self.isAdult=false;if(!(self instanceof MyRentals)){throw new Error("MyRentals called without new.")}orion.oesp.session.done(function(session){if(session.isAuthenticated()){self.isAdult=session.isAdultPinVerified(true);self.initialize();self.handlers()}});return self}MyRentals.prototype.initialize=function(){var self=this;var purchaseEndpoint=orion.oesp.purchaseEndpoint;var activePurchases=purchaseEndpoint.activePurchases;var mediaRequest=activePurchases.requestMediaItems(self.isAdult);activePurchases.done(function(purchaseData){mediaRequest.done(function(mediaData){self.products=purchaseData.products;self.mediaItems=mediaData.mediaItems;self.extendMediaItems();log("MyRentals is dialog: ",self.isDialog);if(self.isDialog){self.buildDialogTemplate()}else{self.buildModuleTemplate();self.activeRentalCount()}self.activeRentalCount()});mediaRequest.fail(function(){log("MyRentals: no purchased items");self.mediaItems=[];self.extendMediaItems();if(self.isDialog){self.buildDialogTemplate()}else{self.buildModuleTemplate()}})}).fail(function(){log("MyRentals purchase request failed")});return self};MyRentals.prototype.handlers=function(){var self=this;self.$containerModule.on("click",".view-toggle a",function(event){event.preventDefault();var hash=orion.util.modules.getHash(event);orion.util.modules.toggleView(self.$containerModule,hash)})};MyRentals.prototype.extendMediaItems=function(){var self=this;self.mediaTemplate=new orion.util.MediaTemplate();self.mediaItems=self.mediaTemplate.formatData(self.mediaItems,{i18n:self.i18n,imgType:"still-medium",isMyOrionBar:true,isMyRentals:true});BBV.each(self.mediaItems,function(mediaIdx,item){item.index=mediaIdx;BBV.each(self.products,function(productIdx,product){if(item.hasCurrentProductId(product.id)){item.productExpirationDate=product.entitlementEnd}})});return self};MyRentals.prototype.buildDialogTemplate=function(){var self=this;var html=self.mediaTemplate.getMarkup(self.mediaItems,{template:"MyRentals",manageUrl:self.manageUrl,hideView:self.hideViewToggling,count:self.mediaItems.length,isThumb:true,disabledHover:true});self.$containerDialog.append(html);orion.modules.MyOrionBar.showDialog("my-rentals");orion.Playlist.setState("#my-rentals");self.stopLoaders()};MyRentals.prototype.buildModuleTemplate=function(){var self=this;var html;if(self.$containerModule.length){html=self.mediaTemplate.getMarkup(self.mediaItems,{template:"Media",isThumb:true,disabledHover:true});self.$containerModule.find(".section").empty().html(html);orion.app.recommendations.updateRatedItems(self.$containerModule.find(".section"))}self.stopLoaders()};MyRentals.prototype.stopLoaders=function(){var self=this;self.$myorionbarDialogs.trigger("loaded")};MyRentals.prototype.activeRentalCount=function(){var self=this;var arCount=(self.mediaItems)?self.mediaItems.length:0;self.$containerModule.find(".active-rental-count").html(arCount)};return MyRentals})(jQuery);
BBV.namespace("orion.widgets").FeedContainer=orion.widgets.FeedContainer||(function($,window){function parseBoolean(value){if(typeof value=="boolean"){return value}if(typeof value==="string"){value=value.replace(/^\s+|\s+$/g,"").toLowerCase();if(value==="true"||value==="false"){return value==="true"}else{if(value==="1"||value==="0"){return value==="1"}}}return false}function FeedContainer(elem,options){var self=this;var $elem=$(elem);var range,rangeParts;var template;options=options||{};if(!(this instanceof FeedContainer)){return new FeedContainer(elem,feedObj)}self.elem=elem;self.$=$elem;self.i18n=options.i18n||orioni18n[$elem.data("i18n-property")];self.imgType=options.imgType||$elem.data("image-type");self.loaderWidth=options.loaderWidth||926;self.loaderHeight=options.loaderHeight||260;self.pageSize=options.pageSize||$elem.data("page-size");self.pageSize=typeof self.pageSize=="number"?self.pageSize:0;self.enablePaging=options.enablePaging||parseBoolean($elem.data("enable-paging"));self.excludeId=options.excludeId||$elem.data("exclude-id");self._beforeRender=options.beforeRender||$.noop;self._onRawDataReceived=options.onRawDataReceived||$.noop;self.isThumb=typeof options.isThumb!=="undefined"?options.isThumb:true;template=$elem.data("template");if(template&&template.indexOf&&template.indexOf(",")>-1){self.template=[];self.templates=$elem.data("template").split(",");$.each(self.templates,function(idx,template){self.template.push($.trim(template))})}else{self.template=$elem.data("template")||"MediaGrid"}range=options.range||orion.util.url.getParam(self.feedUrl,"range");if(range){rangeParts=range.split("-");self.outerRange={start:parseInt(rangeParts[0],10),end:parseInt(rangeParts[1],10)}}if(options.feedData){self.feedUrl="";self.processFeed(options.feedData)}else{self.feedUrl=$elem.data("feed-url");self.$.empty().loader({flow:["append","overlay"],target:".content-list",minheight:self.loaderHeight,minwidth:self.loaderWidth});self.queryForFeed()}return self}FeedContainer.prototype.processFeed=function(feedData){var self=this;self.mediaTemplate=new orion.util.MediaTemplate();self.items=self.mediaTemplate.formatData(feedData,{i18n:self.i18n,imgType:self.imgType,isFeed:true});self.$.empty();if(typeof(self.template)==="string"){self.render()}else{$.each(self.template,function(idx,template){self.render(template)})}self.$.trigger("loaded");view=self.$.closest(".content-list").siblings(".user-functionality").find(".view-toggle a.active").closest("li").attr("class")||"grid";self.$.children("ul").hide();self.$.children("ul."+view+"-view").show()};FeedContainer.prototype.filterFeed=function(feedData){var self=this;var filteredFeed=feedData;if(self.excludeId){var mediaType=filteredFeed.mediaGroups?"mediaGroups":"mediaItems";filteredFeed[mediaType]=$.grep(filteredFeed[mediaType],function(asset){if(asset.id===self.excludeId){return false}return true}).slice(0,self.pageSize);if(filteredFeed.entryCount){filteredFeed.entryCount-=1}}return filteredFeed};FeedContainer.prototype.queryForFeed=function(){var self=this;var range={start:1,end:self.pageSize};var baseFeedUrl=self.feedUrl;var canExcludeId=true;if("outerRange" in self&&(self.outerRange.end-self.outerRange.start)){range.start=self.outerRange.start;range.end=range.start-1+self.pageSize;canExcludeId=false}if(canExcludeId&&self.excludeId){range.end+=1}else{}self.feedUrl=orion.util.url.setParam(self.feedUrl,"range",range.start+"-"+range.end);self.$.trigger("loading");orion.util.oesp.get(self.feedUrl,{success:function(data){self._onRawDataReceived.call(self,data);data=self.filterFeed(data);self.totalResults=data.totalResults;self.entryCount=data.entryCount;self.processFeed(data);orion.app.trigger("feedLoaded:"+baseFeedUrl,self.entryCount)},error:function(){orion.app.trigger("feedFailed:"+baseFeedUrl);log("There was an error aquiring the feed.")}})};FeedContainer.prototype.render=function(template){var self=this;var isThumb=self.isThumb;template=template||self.template;self._beforeRender.call(this,self.items);var html=self.mediaTemplate.getMarkup(self.items,{template:template,isThumb:isThumb,disabledHover:true});self.$.append(html);if(self.enablePaging){var pagerOptions={elem:self.$,pageSize:self.pageSize,totalLength:self.totalResults,updateFn:function(range){var outerRange={start:1,end:Infinity};if("outerRange" in self){outerRange=self.outerRange}range.start=(range.start-1)+outerRange.start;range.end=(range.start-1)+self.pageSize;range.end=Math.min(range.end,outerRange.end);new orion.widgets.FeedContainer(self.elem,{range:range.start+"-"+range.end})}};if(!self.$.siblings(".pagination").length){this.pager=new orion.widgets.Pager(pagerOptions)}}else{}orion.Playlist.setState(self.$);orion.app.recommendations.updateRatedItems(self.$)};return FeedContainer})(jQuery,window);
BBV.namespace("orion.widgets").ListingContainer=orion.widgets.ListingContainer||(function($){function parseBoolean(value){if(typeof value=="boolean"){return value}if(typeof value==="string"){value=value.replace(/^\s+|\s+$/g,"").toLowerCase();if(value==="true"||value==="false"){return value==="true"}else{if(value==="1"||value==="0"){return value==="1"}}}return false}function ListingContainer(elem,options){var self=this;var $elem=$(elem);var range,rangeParts;this.publisher=orion.app;options=options||{};if(!(this instanceof ListingContainer)){return new ListingContainer(elem,options)}self.elem=elem;self.$=$elem;self.typeCard=$elem.data("type");self.localStrings=orioni18n[$elem.data("i18n-property")];if($.type(self.localStrings)==="string"){self.localStrings=JSON.parse(self.localStrings)}self.isLive=$elem.data("isLive");self.title=$elem.data("title");self.startTime=(function(){var n=new Date();n.setMinutes(Math.floor(n.getMinutes()/30)*30);n.setSeconds(0);n.setMilliseconds(0);return n.getTime()})();self.pageSize=options.pageSize||$elem.data("page-size");self.pageSize=typeof self.pageSize=="number"?self.pageSize:0;self.enablePaging=options.enablePaging||parseBoolean($elem.data("enable-paging"));self.startTime=options.startTime||self.startTime;if($elem.data("template").indexOf(",")>-1){self.template=[];self.templates=$elem.data("template").split(",");$.each(self.templates,function(idx,template){self.template.push(orion.templates[$.trim(template)])})}else{self.template=orion.templates[$elem.data("template")]||orion.templates.CardListings}range=options.range||orion.util.url.getParam(self.listingUrl,"range");if(range){rangeParts=range.split("-");self.outerRange={start:parseInt(rangeParts[0],10),end:parseInt(rangeParts[1],10)}}if(options.listingData){self.listingUrl="";self.processListing(options.listingData)}else{self.listingUrl=$elem.data("listing-url");self.$.loader({flow:["append","overlay"],target:".content-list",minheight:260,minwidth:926});self.queryForListing();self.RemoteBookings=new orion.modules.EPG.RemoteBookings(self.publisher);self.RemoteBookings.initialize()}var $currentSelection=null;self.$.delegate("li","click",function(event){var $container=$(event.target).closest("li");if(!$container.hasClass("focused")){if($currentSelection!=null){$currentSelection.removeClass("focused");$currentSelection.find(".program-details-wrap").slideUp()}$currentSelection=$container;$container.addClass("focused");$container.find(".program-details-wrap").slideDown()}});return self}ListingContainer.prototype={constructor:ListingContainer,processListing:function(listingData){var self=this;self.listings=self.formatData(listingData);self.$.empty();if(typeof(self.template)==="string"){self.render()}else{$.each(self.template,function(idx,template){self.render(template)})}if(self.RemoteBookings){self.RemoteBookings.dvrStatus.done(self.setRemoteBooking.bind(self))}self.$.trigger("loaded")},setRemoteBooking:function(){this.listings.nav=this.RemoteBookings.hasRecordingDvr===true;if(this.listings.nav){this.$.find("td.nav a.record-btn").fadeIn()}},queryForListing:function(){var self=this,range={start:1,end:self.pageSize};if("outerRange" in self&&(self.outerRange.end-self.outerRange.start)){range.start=self.outerRange.start;range.end=range.start-1+self.pageSize}orion.oesp.session.withSession(function(session){self.listingUrl=orion.util.url.setParam(self.listingUrl,"range",range.start+"-"+range.end);self.listingUrl=orion.util.url.setParam(self.listingUrl,"byStartTime",self.startTime+"~");self.listingUrl=orion.util.url.setParam(self.listingUrl,"byLocationId",session.locationId);self.$.trigger("loading");orion.util.oesp.get(self.listingUrl,{success:function(data){self.totalResults=data.totalResults;if(data.listings){data.listings=$.map(data.listings,function(item){return new orion.oesp.res.Listing(item)})}else{data=new orion.oesp.res.Listing(data)}self.processListing(data)},error:function(){}})})},render:function(template){var lc=this,listings=lc.listings,len=listings.length,i=0,data=[],date=new Date();date.setMinutes(date.getMinutes()+5);for(;i<len;i++){if(listings[i].program){data.push(BBV.extend({localStrings:lc.localStrings},{index:i,listingId:listings[i].id,stationId:listings[i].stationId,stationTitle:lc.title,isLive:lc.isLive,startTime:listings[i].startTime,endTime:listings[i].endTime,rating:listings[i].program.parentalRating,nav:(listings[i].endTime>date.getTime())},listings[i],listings[i].program,BBV.utils.listings))}else{if(lc.typeCard==="Series"){data.push(BBV.extend({localStrings:lc.localStrings},{index:i,listingId:listings[i].id,stationTitle:lc.title,startTime:listings[i].startTime,endTime:listings[i].endTime,rating:listings[i].parentalRating},listings[i],BBV.utils.listings))}}}data={listings:data,ratedLabel:orioni18n.channelCardFeed.ratedlabel};if(orioni18n.titleCardCommon){data=$.extend(data,{i18nTitleCardCommon:orioni18n.titleCardCommon})}if(orioni18n.titleCardLinear){data=$.extend(data,{i18nActivePage:orioni18n.titleCardLinear})}if(orioni18n.titleCardSeries){data=$.extend(data,{i18nActivePage:orioni18n.titleCardSeries})}if(lc.typeCard==="Channel"){data=$.extend(data,{channel:true})}else{if(lc.typeCard==="Series"){data=$.extend(data,{series:true})}}var template=template||lc.template;var listing=Mustache.to_html(template,data);lc.$.append(listing);if(lc.enablePaging){var pagerOptions={elem:lc.$,pageSize:lc.pageSize,totalLength:lc.totalResults,updateFn:function(range){var outerRange={start:1,end:Infinity};if("outerRange" in lc){outerRange=lc.outerRange}range.start=(range.start-1)+outerRange.start;range.end=(range.start-1)+lc.pageSize;range.end=Math.min(range.end,outerRange.end);new orion.widgets.ListingContainer(lc.elem,{range:range.start+"-"+range.end});orion.Playlist.setState(lc.$)}};if(!lc.$.siblings(".pagination").length){this.pager=new orion.widgets.Pager(pagerOptions)}}else{}this.publisher.trigger("listingsRendered")},formatData:function(data){var result=[];var listingAssets=data.listings||data;var i,length;var asset,mediaObject;var self=this;if(self.pageSize===0){length=listingAssets.length}else{length=Math.min(self.pageSize,listingAssets.length);if("outerRange" in self){length=Math.min(length,((self.outerRange.end+1)-self.outerRange.start))}}self.totalLength=length;for(i=0;i<length;i++){asset=listingAssets[i];asset=BBV.extend({localStrings:self.localStrings},asset,BBV.utils.listings);result.push(asset)}return result}};return ListingContainer})(jQuery);
BBV.namespace("orion.widgets").VideoPlayer=orion.widgets.VideoPlayer||(function($){var MIN_FLASH_VERSION="10.1",FLASH_INSTALL_URL="swf/expressInstall.swf",PLAYER_STANDARD_WIDTH="768",PLAYER_STANDARD_HEIGHT="436",PLAYER_MINI_WIDTH="317",PLAYER_MINI_HEIGHT="180",PLAYER_ID_BASE="orionPlayer",VIDEO_EVENTS={setOptData:function(vp,e){if(e.offset){vp.setOptDatas((e.offset>0)?e.offset:0)}},assetReady:function(vp,e){$(".video-player-module > .loader").hide();vp.playHandler()},assetLoaded:null,contentStart:null,contentEnd:null,stateChange:function(vp,e){vp.stateChange(e)},addedToPlaylist:null,shareClicked:null,fullScreen:null,channelSelected:null,programChanged:function(vp,e){vp.trigger("programChange",e)},errorOccurred:function(vp,e){vp.addError(e)},inactivity:function(vp,e){vp.handleInactivity(e)},parentalPINUnverified:null,inactivityTimeout:null,debug:null,likeUpdated:function(player,stateObj){orion.app.trigger("likeUpdated",{crid:player.mediaItem.id,state:stateObj.state})}};var idCounter=1;var makeEventHandler=function(videoPlayer,eventName,publisher,fn){return function(event){if(fn&&typeof fn=="function"){fn(videoPlayer,event)}videoPlayer.trigger(eventName,event);publisher.trigger(eventName,event)}};function VideoPlayer(playerMode,placeholder){var self=this;window.videoPlayerWidget=self;orion.util.PubSub.call(self);if(!(this instanceof VideoPlayer)){return new VideoPlayer(playerMode,placeholder)}log("Widget:VideoPlayer: Creating a video player widget.");self.id=idCounter++;self._player=new $.Deferred();self.playerMode=playerMode||"standard";isSilverlight=BBV.player.isSilverlight(self.playerMode);log("VideoPlayer type is: ",isSilverlight?"Silverlight":"Widevine");self.width=PLAYER_STANDARD_WIDTH;self.height=PLAYER_STANDARD_HEIGHT;if(isSilverlight){self.languagePack=BBV.settings.videoPlayer.silverlightLanguagePackPath}else{self.languagePack=BBV.settings.videoPlayer.languagePackPath}self.swfUrl=BBV.settings.videoPlayer.swfPath;self.offset;self.errors=[];self.playState="playing";self.isPlayerVerified=true;self.placeholder=placeholder||null;if(placeholder){this.embed(placeholder)}if($.isFunction(widevine.pluginInstalled)&&!isSilverlight){widevine.pluginInstalled()}if($.isFunction(checkFlash)&&!isSilverlight){checkFlash()}}orion.util.inherits(VideoPlayer,orion.util.PubSub);VideoPlayer.prototype.getId=function(){return PLAYER_ID_BASE+this.id};VideoPlayer.prototype.getSelector=function(){return"#"+this.getId()};VideoPlayer.prototype.isEmbeded=function(){var self=this;return self._player.isResolved()};VideoPlayer.prototype.stateChange=function(event){var self=this;if(event){self.playState=event.state==="playing"||event.state==="paused"?event.state:""}};VideoPlayer.prototype.addError=function(error){var self=this;self.errors.push(error.errorCode)};VideoPlayer.prototype.embed=function(elem,flashVars,params,attributes){log("Widget:VideoPlayer: Embedding player widget.");var self=this;var swf={};var $elem=$(elem);if(self.isEmbeded()){return}swf.placeholderId=$elem.attr("id");if(!swf.placeholderId){swf.placeholderId=self.getId()+"placeholder";$elem.attr("id",swf.placeholderId)}orion.oesp.session.withSession(function(session){var playerInitFn="onPlayerLoaded_"+self.getId();var cookie=BBV.utils.cookie(BBV.settings.cookie.tokenName);self.baseUrl=/[^\/]*\/\/[^\/]*/.exec(window.location)[0];self.username=session.username;self.token=session.oespToken;self.tpToken=cookie.get("tpToken")||"asdasdasdaefewfdksldkcjlsdkcs";self.mediaItem=null;var _flashVars;if(isSilverlight){_flashVars={playerMode:self.playerMode,OESPUsername:self.username,authToken:self.token,languagePack:self.languagePack,playerLoadedCallback:playerInitFn,errorCallback:"onErrorOccurred",debugCallback:"onDebug",omnitureAccount:BBV.settings.omniture.s_account,omnitureVisitorNamespace:BBV.settings.omniture.visitorNamespace,omnitureTrackingServer:BBV.settings.omniture.trackingServer,omnitureTrackSeconds:"",omniturePageName:"player/videoplayer",OESPBaseUrl:BBV.settings.api.urls.externalBase,posterFrameUrl:self.baseUrl+"/etc/designs/orion/upc/nl/img/backgrounds/player_bg.png",favouriteChannelList:null,viewedCheckPoint:300,inactivityLimit:"14400",sharing:true,autoPlay:true,countryCode:session.countryCode,languageCode:session.languageCode,bufferTime:1,disableScaling:false,disableSmoothing:false,logLevel:"debug",listingsInterval:5,showMinimisedScrubber:false,bufferReportingPeriod:"",bufferReportingRepeat:"",width:PLAYER_STANDARD_WIDTH,height:PLAYER_STANDARD_HEIGHT,errorDelay:2,bufferReloadTime:3}}else{_flashVars={OESPBaseUrl:BBV.settings.api.urls.externalBase+"/",OESPUsername:self.username,TPAuthToken:self.tpToken,authToken:self.token,autoPlay:true,showMinimisedScrubber:false,favouriteChannelList:null,languagePack:self.baseUrl+self.languagePack,omnitureBaseUri:BBV.settings.site.urls.omniture.script,playerLoadedCallback:playerInitFn,playerMode:self.playerMode,omnitureAccount:BBV.settings.omniture.s_account,omnitureVisitorNamespace:BBV.settings.omniture.visitorNamespace,omnitureTrackingServer:BBV.settings.omniture.trackingServer,omniturePageName:"player/videoplayer",posterFrameURL:"/etc/designs/orion/upc/nl/img/backgrounds/player_bg.png",sharing:true,viewedCheckPoint:300,countryCode:session.countryCode,languageCode:session.languageCode,inactivityLimit:"14400",bufferTime:1}}var _params={allowFullScreen:"true",allowScriptAccess:"always",wmode:"opaque",bgcolor:"#000000"};var _attributes={id:self.getId()};swf.flashVars=$.extend(flashVars||{},_flashVars);swf.params=$.extend(params||{},_params);swf.attributes=$.extend(attributes||{},_attributes);window[playerInitFn]=function(){var i,event,handler,delay=100;if(isSilverlight===false){orionPlayer=$(self.getSelector()).get(0);delay=0}setTimeout(function(){log("Widget:VideoPlayer: Initializing player");window.orionPlayer=orionPlayer;if(!window.orionPlayer){log("Widget:VideoPlayer: Warning: cannot find the orionPlayer.");log("Aborting video player event binding.");return}for(event in VIDEO_EVENTS){handler="on"+event.substr(0,1).toUpperCase()+event.substr(1)+"_"+self.getId();window[handler]=makeEventHandler(self,event,orion.app,VIDEO_EVENTS[event]);window.orionPlayer.addListener(event,handler)}self._player.resolveWith(window.orionPlayer)},delay)};swf.savedClasses=$("#"+swf.placeholderId).attr("class");if(session.isAuthenticated()){orion.util.oesp.get(orion.oesp.routes.favouritechannels,{success:function(responseFavorites){self.favorites=responseFavorites.favouriteChannels;orion.util.oesp.get(orion.oesp.routes.channels,{success:function(responseChannels){self.channels=responseChannels.channels;swf.flashVars.favouriteChannelList=self.getFavouriteChannels();if(isSilverlight){swf.flashVars.favouriteChannelList=self.getFavouriteChannels().replace(/,/g,"+");self.initializeSilverlight(swf)}else{self.initializeSwf(swf)}}})}})}else{if(isSilverlight){self.initializeSilverlight(swf)}else{self.initializeSwf(swf)}}})};VideoPlayer.prototype.initializeSilverlight=function(swf){var self=this,_initParamStr="",altHtml="";$.each(swf.flashVars,function(i,n){if(i!="autoplay"){_initParamStr=_initParamStr+i+"="+n+","}});_initParamStr=_initParamStr.substr(0,_initParamStr.length-1);self.placeholderId="player-placeholder";self.placeholder=$("#"+self.placeholderId).get(0);altHtml="<div class='silverlight-install'><p><a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a></p><div>";altHtml=altHtml.replace("{1}","5.0.61118.0");altHtml=altHtml.replace("{2}",Silverlight.fwlinkRoot+"108181");Silverlight.createObject(BBV.settings.videoPlayer.xapPath,self.placeholder,"orionPlayer1",{width:self.width,height:self.height,background:"#000000",version:"5.0.61118.0",isWindowless:"true",alt:altHtml},{onError:self.onSilverlightError,onLoad:self.onSLLoad},_initParamStr,self.placeholderId)};VideoPlayer.prototype.onDebug=function(event){if(event.debug){var debugMessage=event.debug}log("DEBUG ",debugMessage)};VideoPlayer.prototype.onErrorOccurred=function(event){var errorCode;if(event.errorCode){errorCode=event.errorCode}if(event.causedPlaybackFailure){errorCode=errorCode+" : causedPlaybackFailure="+event.causedPlaybackFailure}log(errorCode);log(event);log("errorOccurred",errorCode)};VideoPlayer.prototype.onSLLoad=function(plugIn,userContext,sender){try{orionPlayer=sender.getHost().Content.OrionPlayer}catch(err){log("Slplayer init error")}};VideoPlayer.prototype.onSilverlightError=function(sender,args){var appSource="";if(sender!=null&&sender!=0){appSource=sender.getHost().Source}var errorType=args.ErrorType;var iErrorCode=args.ErrorCode;if(errorType=="ImageError"||errorType=="MediaError"){return}var errMsg="Unhandled Error in Silverlight Application "+appSource+"\n";errMsg+="Code: "+iErrorCode+"    \n";errMsg+="Category: "+errorType+"       \n";errMsg+="Message: "+args.ErrorMessage+"     \n";if(errorType=="ParserError"){errMsg+="File: "+args.xamlFile+"     \n";errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n"}else{if(errorType=="RuntimeError"){if(args.lineNumber!=0){errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n"}errMsg+="MethodName: "+args.methodName+"     \n"}}throw new Error(errMsg)};VideoPlayer.prototype.initializeSwf=function(swf){var self=this;swfobject.embedSWF(self.swfUrl,swf.placeholderId,self.width,self.height,MIN_FLASH_VERSION,FLASH_INSTALL_URL,swf.flashVars,swf.params,swf.attributes,function(e){if(e.success){log("Widget:VideoPlayer: Player embed success.");$("#"+swf.attributes.id).addClass(swf.savedClasses)}else{log("Widget:VideoPlayer: Player failed to embed.")}})};VideoPlayer.prototype.remove=function(){var player=this;var $container,placeholder;if(!player.isEmbeded()){return}player._player.then(function(){log("Widget:VideoPlayer: Removing player widget:",player.getId());$container=$("#"+player.getId()).closest(".video-player");swfobject.removeSWF(player.getId());placeholder=$('<div id="player-placeholder" />');$container.empty().append(placeholder);player._player=new $.Deferred()})};VideoPlayer.prototype.setOptDatas=function(offset){var self=this;var offsetStr=(offset)?",offset="+offset:"";var token=self.token?self.token:"";var username=self.username?self.username:"";orion.oesp.session.done(function(session){var optData="={token="+token+",username="+username+",mediaItemId="+self.mediaItem.id+offsetStr+",playState="+self.playState;if(session.isAdultPinVerified()){optData+=",adultCredential="+orion.app.getCredential()}optData+="}";if(!isSilverlight){document.getElementById("WidevinePlugin").setOptData(optData)}log("setOptDatas:Widget:VideoPlayer: optData = ",optData)})};VideoPlayer.prototype.loadVideo=function(mediaItem){var self=this;self.mediaItem=mediaItem;self.setOptDatas(self.offset);self._player.done(function(){var swf=this;if(!isSilverlight){WVSetEmmURL(WVConfig.WV_EMM_URL);WVSetHeartbeatUrl(WVConfig.WV_HEARTBEAT_URL);WVSetHeartbeatPeriod(WVConfig.WV_HEARTBEAT_PERIOD)}var pollCount=0;var isSwfReady=setInterval(function(){pollCount++;try{log("VideoPlayer.loadVideo -> pollCount: "+pollCount);swf.loadVideo(mediaItem.id);log("VideoPlayer.loadVideo -> swf.loadVideo exists, loading mediaItem.id: "+mediaItem.id);clearInterval(isSwfReady);if(self.playerMode=="standard"){var events=new orion.oesp.req.EventEndpoint(mediaItem.id);events.trigger("play")}var inList=orion.Playlist.containsProgramId({id:mediaItem.id});if(inList){log("VideoPlayer.loadVideo -> playlist success");self.playlistSuccess()}}catch(e){if(pollCount>=100){log("VideoPlayer.loadVideo -> swf.loadVideo DNE, we gave up on it");clearInterval(isSwfReady)}}},100)});self._player.fail(function(){log("Widget:VideoPlayer: There was an error loading the mediaItem.")});return self};VideoPlayer.prototype.loadChannel=function(channelId){var self=this;self._player.done(function(){var swf=this;var token=self.token?self.token:"";var username=self.username?self.username:"";orion.oesp.session.done(function(session){var optData="={token="+token+",username="+username+",channelId="+channelId+",playState="+self.playState;if(session.isAdultPinVerified()){optData+=",adultCredential="+orion.app.getCredential()}optData+="}";if(!isSilverlight){document.getElementById("WidevinePlugin").setOptData(optData);log("Widget:VideoPlayer: optData = ",optData);log("Widget:VideoPlayer: Loading channel into the swf.",channelId);WVSetEmmURL(WVConfig.WV_EMM_URL);WVSetHeartbeatUrl(WVConfig.WV_HEARTBEAT_URL);WVSetHeartbeatPeriod(WVConfig.WV_HEARTBEAT_PERIOD)}swf.loadChannel(channelId)})});return self};VideoPlayer.prototype.playHandler=function(){var self=this;if(self.playerMode=="standard"){self._player.done(function(){if(self.offset){self.playFrom(self.offset)}else{self.play()}})}else{log("Ignore AssetReady Handler For Live Player...")}};VideoPlayer.prototype.play=function(){var self=this;self._player.done(function(){var swf=this;try{swf.playVideo()}catch(e){log('error trying to call method "playVideo" on the orion player swf');log(e)}});return self};VideoPlayer.prototype.pause=function(){var self=this;self._player.done(function(){var swf=this;swf.pauseVideo()});return self};VideoPlayer.prototype.likeClicked=function(state){var self=this;self._player.done(function(){var swf=this;swf.likeClicked(state)});return self};VideoPlayer.prototype.stop=function(){var self=this;self._player.done(function(){var swf=this;try{swf.stopVideo()}catch(e){log('error trying to call method "stopVideo" on the orion player swf');log(e)}});return self};VideoPlayer.prototype.seekTo=function(bookmark){var self=this;self._player.done(function(){var swf=this;swf.seekTo(bookmark)});return self};VideoPlayer.prototype.playFrom=function(offset){var self=this;self._player.done(function(){var swf=this;log("offset",offset);try{swf.playFrom(offset)}catch(e){log('error trying to call method "playFrom" on the orion player swf');log(e)}});return self};VideoPlayer.prototype.playlistSuccess=function(){var self=this;self._player.done(function(){var swf=this;if(swf.playlistSuccess){swf.playlistSuccess()}else{$(".video-player-module > .loader").hide()}});return self};VideoPlayer.prototype.loadMediaItem=function(mediaItem,options){var self=this;options=$.extend({offset:0,hasPermission:true},options);self.mediaItem=mediaItem;orion.oesp.session.done(function(session){if(!options.hasPermission){var permission=session.getPermissionToPlayMediaItem(mediaItem);permission.done(function(){self.offset=options.offset;self.loadVideo(mediaItem)}).fail(function(reason){self.trigger("permission.fail."+reason)})}else{self.offset=options.offset;self.loadVideo(mediaItem)}})};VideoPlayer.prototype.playChannel=function(channel){var self=this;orion.oesp.session.done(function(session){self.loadChannel(channel.id);self.bind("programChange",function(e,program){var p=session.getPermissionToPlayChannel(channel,self.isPlayerVerified);self.isPlayerVerified=false;p.fail(function(reason){self.trigger("permission.fail."+reason)})})})};VideoPlayer.prototype.getFavouriteChannels=function(){var self=this;var channelIds=[];var channels=[];$.each(self.favorites,function(){channelIds.push(this.channelId)});$.each(self.channels,function(){if($.inArray(this["id"],channelIds)>=0){channels.push(this["channelNumber"])}});return channels.join(",")};VideoPlayer.prototype.handleInactivity=function(){var self=this,confirm=orion.app.dialogManager.getDialog("confirmation"),resumePlay=function(){clearTimeout(deactiveTimer);cleanupConfirmDialog();self.play()},deactivatePlayer=function(){cleanupConfirmDialog();log("TODO: Send error to player saying the user is inactive.");self.trigger("inactivityTimeout")},cleanupConfirmDialog=function(){confirm.hide();confirm.unbind("cancel",deactivatePlayer);confirm.unbind("confirm",resumePlay);delete confirm};self.stop();confirm.bind("cancel",deactivatePlayer);confirm.bind("confirm",resumePlay);confirm.setContent(orioni18n.videoPlayer.inactivityAlertTitle,orioni18n.videoPlayer.inactivityAlertMessage);confirm.centerOn("window");confirm.show();var deactiveTimer=setTimeout(deactivatePlayer,60000);return self};return VideoPlayer})(jQuery);function onErrorOccurred(event){var errorCode,eventDetails="";window.videoPlayerWidget.addError(event);if(event.errorCode=="LINEAR_BLACKOUT_OCCURRED"&&window.videoPlayerWidget){eventDetails=event.eventDetails}window.videoPlayerWidget.trigger("errorOccurred",{errorCode:event.errorCode,causedPlaybackFailure:event.causedPlaybackFailure,eventDetails:eventDetails});if(event.errorCode){errorCode=event.errorCode}if(event.causedPlaybackFailure){errorCode=errorCode+" : causedPlaybackFailure="+event.causedPlaybackFailure}if(event.eventDetails){errorCode=errorCode+"<br/>details: "+event.eventDetails}log("errorOccurred","red",errorCode)}function onDebug(event){if(event.debug){var debugMessage=event.debug}log("DEBUG","blue",debugMessage)};
BBV.namespace("orion.widgets").VideoMessage=orion.widgets.VideoMessage||(function($){function VideoMessage(message,direction){log("Running VideoMessage constructor.");this.message=message;this.direction=direction||"left"}VideoMessage.prototype.render=function(){var videoMessage=this;var templateContent={close:"close",message:videoMessage.message||"",onLeftSide:videoMessage.direction=="left"};if(videoMessage.message!=""){var $videoMessage=$(Mustache.to_html(orion.templates.VideoMessage,templateContent));videoMessage.$=$videoMessage;videoMessage.elem=$videoMessage.get(0);videoMessage.contentArea=$videoMessage.find(".message-body");$videoMessage.delegate(".close","click",function(){videoMessage.hide()});return this}};VideoMessage.prototype.appendTo=function(elem){if(!this.$){this.render()}$(elem).append(this.$);return this};VideoMessage.prototype.show=function(){if(!this.$){this.render()}this.$.show();return this};VideoMessage.prototype.hide=function(){if(this.$){this.$.hide()}return this};VideoMessage.prototype.remove=function(){if(this.$){this.$.remove()}return this};return VideoMessage})(jQuery);
BBV.namespace("orion.widgets").SLVideoPlayerWidget=orion.widgets.SLVideoPlayerWidget||(function($){var PLAYER_STANDARD_WIDTH="940",PLAYER_STANDARD_HEIGHT="529",PLAYER_ID_BASE="orionPlayer",VIDEO_EVENTS={assetReady:function(vp,e){$(".video-player-module > .loader").hide();vp.playHandler()},assetLoaded:null,contentStart:null,contentEnd:null,stateChange:function(vp,e){vp.stateChangeHandler(e)},addedToPlaylist:null,shareClicked:null,fullScreen:null,channelSelected:null,programChanged:null,errorOccurred:function(vp,e){if(e.errorCode=="GET_DEVICE_ID_FAILED"){vp._deviceId.reject()}},inactivity:function(vp,e){vp.handleInactivity(e)},parentalPINUnverified:null,inactivityTimeout:null,debug:null,likeUpdated:function(player,stateObj){orion.app.trigger("likeUpdated",{crid:player.mediaItem.id,state:stateObj.state})},deviceIdAvailable:function(vp,event){log("Widget:SLVideoPlayer","deviceId = ",event.deviceId);vp._deviceId.resolve(event.deviceId)}};var idCounter=1;var makeEventHandler=function(videoPlayer,eventName,publisher,fn){return function(event){if(fn&&typeof fn=="function"){fn(videoPlayer,event)}publisher.trigger(BBV.player.generateSLEventName(eventName),event)}};function SLVideoPlayerWidget(playerMode,placeholder){var self=this;window.videoPlayerWidget=self;if(!(this instanceof SLVideoPlayerWidget)){return new SLVideoPlayerWidget(playerMode,placeholder)}log("Widget:VideoPlayer: Creating a video player widget.");self.id=idCounter++;self._player=new $.Deferred();self._deviceId=new $.Deferred();self.playerMode=playerMode||"standard";log("VideoPlayer type is: Silverlight");self.width=PLAYER_STANDARD_WIDTH;self.height=PLAYER_STANDARD_HEIGHT;self.languagePack=BBV.settings.videoPlayer.silverlightLanguagePackPath;self.offset;self.errors=[];self.playState="playing";self.isPlayerVerified=true;self.placeholder=placeholder||null;if(placeholder){this.embed(placeholder)}self.publisher=orion.app}orion.util.inherits(SLVideoPlayerWidget,orion.util.PubSub);SLVideoPlayerWidget.prototype.getId=function(){return PLAYER_ID_BASE+this.id};SLVideoPlayerWidget.prototype.getSelector=function(){return"#"+this.getId()};SLVideoPlayerWidget.prototype.isEmbeded=function(){var self=this;return self._player.isResolved()};SLVideoPlayerWidget.prototype.stateChangeHandler=function(event){var self=this;if(event){self.playState=event.state==="playing"||event.state==="paused"?event.state:""}};SLVideoPlayerWidget.prototype.embed=function(elem){log("Widget:VideoPlayer: Embedding player widget.");var self=this;var playerObject={};var $elem=$(elem);if(self.isEmbeded()){return}playerObject.placeholderId=$elem.attr("id");if(!playerObject.placeholderId){playerObject.placeholderId=self.getId()+"placeholder";$elem.attr("id",playerObject.placeholderId)}orion.oesp.session.withSession(function(session){var playerInitFn="onPlayerLoaded_"+self.getId();var cookie=BBV.utils.cookie(BBV.settings.cookie.tokenName);self.baseUrl=/[^\/]*\/\/[^\/]*/.exec(window.location)[0];self.username=session.username;self.token=session.oespToken;self.tpToken=cookie.get("tpToken")||"asdasdasdaefewfdksldkcjlsdkcs";self.mediaItem=null;playerObject.initVars={playerMode:self.playerMode,languagePack:self.languagePack,playerLoadedCallback:playerInitFn,errorCallback:"onSLErrorOccurred",debugCallback:null,omnitureAccount:BBV.settings.omniture.s_account,omnitureVisitorNamespace:BBV.settings.omniture.visitorNamespace,omnitureTrackingServer:BBV.settings.omniture.trackingServer,omnitureTrackSeconds:"",omniturePageName:"player/videoplayer",OESPBaseUrl:BBV.settings.api.urls.externalBase,posterFrameUrl:self.baseUrl+"/etc/designs/orion/upc/nl/img/backgrounds/player_bg.png",favouriteChannelList:null,viewedCheckPoint:300,inactivityLimit:"14400",sharing:true,autoPlay:true,countryCode:session.countryCode,languageCode:session.languageCode,bufferTime:1,disableScaling:false,disableSmoothing:false,logLevel:"debug",listingsInterval:5,showMinimisedScrubber:false,bufferReportingPeriod:"",bufferReportingRepeat:"",width:PLAYER_STANDARD_WIDTH,height:PLAYER_STANDARD_HEIGHT,errorDelay:2,bufferReloadTime:3};if(self.username&&self.token){playerObject.initVars.OESPUsername=self.username;playerObject.initVars.authToken=self.token}playerObject.params={allowFullScreen:"true",allowScriptAccess:"always",wmode:"opaque",bgcolor:"#000000"};playerObject.attributes={id:self.getId()};window[playerInitFn]=function(){var i,event,handler,delay=100;setTimeout(function(){log("Widget:VideoPlayer: Initializing player");if(!window.orionPlayer){log("Widget:VideoPlayer: Warning: cannot find the orionPlayer.");log("Aborting video player event binding.");return}for(event in VIDEO_EVENTS){handler="on"+event.substr(0,1).toUpperCase()+event.substr(1)+"_"+self.getId();window[handler]=makeEventHandler(self,event,orion.app,VIDEO_EVENTS[event]);window.orionPlayer.addListener(event,handler)}self._player.resolveWith(window.orionPlayer)},delay)};playerObject.savedClasses=$("#"+playerObject.placeholderId).attr("class");if(session.isAuthenticated()){orion.util.oesp.get(orion.oesp.routes.favouritechannels,{success:function(responseFavorites){self.favorites=responseFavorites.favouriteChannels;orion.util.oesp.get(orion.oesp.routes.channels,{success:function(responseChannels){self.channels=responseChannels.channels;playerObject.initVars.favouriteChannelList=self.getFavouriteChannels();playerObject.initVars.favouriteChannelList=self.getFavouriteChannels().replace(/,/g,"+");self.initializeSilverlight(playerObject)}})}})}else{self.initializeSilverlight(playerObject)}})};SLVideoPlayerWidget.prototype.initializeSilverlight=function(playerObject){var self=this,_initParamStr="",altHtml="";$.each(playerObject.initVars,function(i,n){if(i!="autoplay"){_initParamStr=_initParamStr+i+"="+n+","}});_initParamStr=_initParamStr.substr(0,_initParamStr.length-1);self.placeholderId="player-placeholder";self.placeholder=$("#"+self.placeholderId).get(0);altHtml="<div class='silverlight-install'><p><a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a></p><div>";altHtml=altHtml.replace("{1}","5.0.61118.0");altHtml=altHtml.replace("{2}",Silverlight.fwlinkRoot+"108181");Silverlight.createObject(BBV.settings.videoPlayer.xapPath,self.placeholder,"orionPlayer1",{width:self.width,height:self.height,background:"#000000",version:"5.0.61118.0",isWindowless:"true",alt:altHtml},{onError:self.onSilverlightError,onLoad:self.onSLLoad},_initParamStr,self.placeholderId)};SLVideoPlayerWidget.prototype.onSLLoad=function(plugIn,userContext,sender){try{orionPlayer=sender.getHost().Content.OrionPlayer}catch(err){log("Slplayer init error")}};SLVideoPlayerWidget.prototype.onSilverlightError=function(sender,args){var appSource="";if(sender!=null&&sender!=0){appSource=sender.getHost().Source}var errorType=args.ErrorType;var iErrorCode=args.ErrorCode;if(errorType=="ImageError"||errorType=="MediaError"){return}var errMsg="Unhandled Error in Silverlight Application "+appSource+"\n";errMsg+="Code: "+iErrorCode+"    \n";errMsg+="Category: "+errorType+"       \n";errMsg+="Message: "+args.ErrorMessage+"     \n";if(errorType=="ParserError"){errMsg+="File: "+args.xamlFile+"     \n";errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n"}else{if(errorType=="RuntimeError"){if(args.lineNumber!=0){errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n"}errMsg+="MethodName: "+args.methodName+"     \n"}}throw new Error(errMsg)};SLVideoPlayerWidget.prototype.removeObjectInIE=function(id){var obj=document.getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null}}obj.parentNode.removeChild(obj)}};SLVideoPlayerWidget.prototype.removeObject=function(id){var obj=document.getElementById(id),self=this;ua=function(){u=navigator.userAgent.toLowerCase(),p=navigator.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1";return{ie:ie,win:windows}}();if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){self.removeObjectInIE(id)}else{setTimeout(arguments.callee,10)}})()}else{obj.parentNode.removeChild(obj)}}};SLVideoPlayerWidget.prototype.remove=function(){var player=this;var $container,placeholder;if(!player.isEmbeded()){return}player._player.then(function(){log("Widget:VideoPlayer: Removing player widget:",player.getId());$container=$("#"+player.getId()).closest(".video-player");player.removeObject(player.getId());placeholder=$('<div id="player-placeholder" />');$container.empty().append(placeholder);player._player=new $.Deferred()})};SLVideoPlayerWidget.prototype.loadVideo=function(mediaItem){var self=this;self.mediaItem=mediaItem;self._player.done(function(){var playerObject=this;var pollCount=0;var isPlayerReady=setInterval(function(){pollCount++;try{log("VideoPlayer.loadVideo -> pollCount: "+pollCount);playerObject.loadVideo(mediaItem.id);log("VideoPlayer.loadVideo -> slobject.loadVideo exists, loading mediaItem.id: "+mediaItem.id);clearInterval(isPlayerReady);if(self.playerMode=="standard"){var events=new orion.oesp.req.EventEndpoint(mediaItem.id);events.trigger("play")}var inList=orion.Playlist.containsProgramId({id:mediaItem.id});if(inList){log("VideoPlayer.loadVideo -> playlist success");self.playlistSuccess()}}catch(e){if(pollCount>=100){log("VideoPlayer.loadVideo -> slobject.loadVideo DNE, we gave up on it");clearInterval(isPlayerReady)}}},100)});self._player.fail(function(){log("Widget:VideoPlayer: There was an error loading the mediaItem.")});return self};SLVideoPlayerWidget.prototype.loadChannel=function(channelId){var self=this;self._player.done(function(){var playerObject=this;orion.oesp.session.done(function(session){playerObject.loadChannel(channelId)})});return self};SLVideoPlayerWidget.prototype.playHandler=function(){var self=this;if(self.playerMode=="standard"){self._player.done(function(){if(self.offset){self.playFrom(self.offset)}else{self.play()}})}else{log("Ignore AssetReady Handler For Live Player...")}};SLVideoPlayerWidget.prototype.play=function(){var self=this;self._player.done(function(){var playerObject=this;try{playerObject.playVideo()}catch(e){log('error trying to call method "playVideo" on the orion player object');log(e)}});return self};SLVideoPlayerWidget.prototype.pause=function(){var self=this;self._player.done(function(){var playerObject=this;playerObject.pauseVideo()});return self};SLVideoPlayerWidget.prototype.likeClicked=function(state){var self=this;self._player.done(function(){var playerObject=this;playerObject.likeClicked(state)});return self};SLVideoPlayerWidget.prototype.stop=function(){var self=this;self._player.done(function(){var playerObject=this;try{playerObject.stopVideo()}catch(e){log('error trying to call method "stopVideo" on the orion player object');log(e)}});return self};SLVideoPlayerWidget.prototype.seekTo=function(bookmark){var self=this;self._player.done(function(){var playerObject=this;playerObject.seekTo(bookmark)});return self};SLVideoPlayerWidget.prototype.playFrom=function(offset){var self=this;self._player.done(function(){var playerObject=this;log("offset",offset);try{playerObject.playFrom(offset)}catch(e){log('error trying to call method "playFrom" on the orion player object');log(e)}});return self};SLVideoPlayerWidget.prototype.playlistSuccess=function(){var self=this;self._player.done(function(){var playerObject=this;if(playerObject.playlistSuccess){playerObject.playlistSuccess()}else{$(".video-player-module > .loader").hide()}});return self};SLVideoPlayerWidget.prototype.getDeviceId=function(){var self=this;self._player.done(function(){var swf=this;swf.getDeviceId()});return self._deviceId.promise()};SLVideoPlayerWidget.prototype.loadMediaItem=function(mediaItem,options){var self=this;options=$.extend({offset:0,hasPermission:true},options);self.mediaItem=mediaItem;orion.oesp.session.done(function(session){if(!options.hasPermission){var permission=session.getPermissionToPlayMediaItem(mediaItem);permission.done(function(){self.offset=options.offset;self.loadVideo(mediaItem)}).fail(function(reason){self.trigger("permission.fail."+reason)})}else{self.offset=options.offset;self.loadVideo(mediaItem)}})};SLVideoPlayerWidget.prototype.playChannel=function(channel){var self=this;orion.oesp.session.done(function(session){self.loadChannel(channel.id)})};SLVideoPlayerWidget.prototype.getFavouriteChannels=function(){var self=this;var channelIds=[];var channels=[];$.each(self.favorites,function(){channelIds.push(this.channelId)});$.each(self.channels,function(){if($.inArray(this["id"],channelIds)>=0){channels.push(this["channelNumber"])}});return channels.join(",")};SLVideoPlayerWidget.prototype.handleInactivity=function(){var self=this,confirm=orion.app.dialogManager.getDialog("confirmation"),resumePlay=function(){clearTimeout(deactiveTimer);cleanupConfirmDialog();self.play()},deactivatePlayer=function(){cleanupConfirmDialog();log("TODO: Send error to player saying the user is inactive.");self.trigger(BBV.player.generateSLEventName("inactivityTimeout"))},cleanupConfirmDialog=function(){confirm.hide();confirm.unbind("cancel",deactivatePlayer);confirm.unbind("confirm",resumePlay);delete confirm};self.stop();confirm.bind("cancel",deactivatePlayer);confirm.bind("confirm",resumePlay);confirm.setContent(orioni18n.titleCardVideoPlayerErrors.inactivityAlertTitle,orioni18n.titleCardVideoPlayerErrors.inactivityAlertMessage);confirm.centerOn("window");confirm.show();var deactiveTimer=setTimeout(deactivatePlayer,60000);return self};return SLVideoPlayerWidget})(jQuery);function onSLErrorOccurred(event){log("Widget:SLVideoPlayer","errorOccurred","errorCode",event.errorCode,"causedPlaybackFailure",event.causedPlaybackFailure,"details",event.eventDetails)};
BBV.namespace("orion.widgets").Pager=orion.widgets.Pager||(function($){function Pager(options){var self=this;self.pagingElement=$('<div class="pagination"><ul></ul></div>');var opts={elem:null,pageSize:15,totalLength:0,updateFn:function(){}};$.extend(opts,options);this.elem=opts.elem;this.pageSize=opts.pageSize;this.totalLength=opts.totalLength;this.update=opts.updateFn;this.currentStartIndex=1;$(this.elem).after(self.pagingElement);if(this.totalLength>0){this.render()}this.bindEvents()}Pager.prototype={constructor:Pager,setTotalLength:function(value){if(typeof value==="number"&&value!==this.totalLength){this.totalLength=value;if(this.currentStartIndex>this.totalLength){this.currentStartIndex=this.totalLength}this.render()}},render:function(){var self=this,current,last,li1,li2,li3,li5,li6,li7;current=Math.ceil(self.currentStartIndex/self.pageSize);last=Math.ceil(self.totalLength/self.pageSize);if(last<=1){self.pagingElement.remove();return}self.pagingElement.children("ul").empty();li1=current!==1?current<=4?'<li><a href="javascript:/*1*/;" data-page-number="1">1</a></li>':'<li><a href="javascript:/*1*/;" data-page-number="1">1</a></li><li>...</li>':"";li2=(current-2)>1?'<li><a href="javascript:/*'+(current-2)+'*/;" data-page-number="'+(current-2)+'">'+(current-2)+"</a></li>":"";li3=(current-1)>1?'<li><a href="javascript:/*'+(current-1)+'*/;" data-page-number="'+(current-1)+'">'+(current-1)+"</a></li>":"";li5=(current+1)<last?'<li><a href="javascript:/*'+(current+1)+'*/;" data-page-number="'+(current+1)+'">'+(current+1)+"</a></li>":"";li6=(current+2)<last?'<li><a href="javascript:/*'+(current+2)+'*/;" data-page-number="'+(current+2)+'">'+(current+2)+"</a></li>":"";li7=current!==last?current>=(last-3)?'<li><a href="javascript:/*'+last+'*/;" data-page-number="'+last+'">'+last+"</a></li>":'<li>...</li><li><a href="javascript:/*'+last+'*/;" data-page-number="'+last+'">'+last+"</a></li>":"";self.pagingElement.children("ul").append("				"+li1+"				"+li2+"				"+li3+'				<li><a href="javascript:/*'+current+'*/;" data-page-number="'+current+'" class="active">'+current+"</a></li>				"+li5+"				"+li6+"				"+li7+"			")},bindEvents:function(){var self=this;self.pagingElement.delegate("a","click",function(e){e.preventDefault();var $this=$(this),pageNumber=$this.data("pageNumber"),newOffsetIndex=(pageNumber-1)*self.pageSize,newRange={start:newOffsetIndex+1,pageNumber:pageNumber};self.currentStartIndex=newRange.start;self.render();self.update(newRange)})}};return Pager})(jQuery);
BBV.namespace("orion.widgets").ActionBar=orion.widgets.ActionBar||(function($,Model){function TitleCardActionBarModel(){var self=this;this.titlecardRenderStatus=false;this.buttonName={record:"recordings",watchlist:"watchlist",trailer:"trailer",share:"share"};this.options={items:{mediaObjectId:[],mediaIds:[],buttons:[{title:"record",text:"record",name:this.buttonName.record,action:"record"},{title:"share",text:"share",name:this.buttonName.share,action:"share"},{id:"",title:"trailer",text:"",name:this.buttonName.trailer,action:"trailer"},{title:"watchlist",text:"watchlist",textActive:"on watchlist",name:this.buttonName.watchlist,action:"watchlist",active:false,isGroup:false}]}};Model.call(self)}orion.util.inherits(TitleCardActionBarModel,Model);TitleCardActionBarModel.prototype.getButtonByName=function(name){var button="";var buttons=this.options.items.buttons;for(var i=0;i<buttons.length;i++){if(buttons[i].name===name){button=buttons[i];break}}return button};function TitleCardActionBar(){this._elem="#actionbar";this.$=$(this._elem);this._template=orion.templates.ActionBar;this._titlecardOffersPlaceholder="#actionbar-container";this.model=new TitleCardActionBarModel();this.bindEvents();this.handlers()}TitleCardActionBar.prototype.bindEvents=function(){var self=this;var model=this.model;var publisher=orion.app;model.bind("change",$.proxy(self.render,self));publisher.subscribe("playlistLoaded",$.proxy(this.render,this));publisher.subscribe("titlecardDescriptionRendered",function(){model.set("titlecardRenderStatus",true,true);self.attachTo(self._titlecardOffersPlaceholder)})};TitleCardActionBar.prototype.handlers=function(){var self=this;var items=this.model.options.items;var $helpMsg=$(self._elem).find(".about");if(!items){return}var buttons=items.buttons;for(var i=0;i<buttons.length;i++){var selector='[data-role="button"][data-name="'+items.buttons[i].name+'"]';(function(i){$(document).on("click",selector,function(e){e.preventDefault();this.action[items.buttons[i].action].apply(this)}.bind(self))})(i)}$(document).delegate('[data-name="'+this.model.get("buttonName").watchlist+'"].active',"hover",function(evt){var $me=$(evt.currentTarget);var $innerTxt=$me.find(".btn-inner-text");var watchlistBtnOptions=self.model.getButtonByName("watchlist");if(evt.type==="mouseenter"){$me.addClass("remove");$innerTxt.text(watchlistBtnOptions.text)}else{$me.removeClass("remove");$innerTxt.text(watchlistBtnOptions.textActive)}})};TitleCardActionBar.prototype.action={record:function(){},share:function(){var self=this;var content=$(".video-social-overlay");var social=orion.app.dialogManager.getDialog("video-social-overlay");if(social.contentArea.find(".video-social-overlay").length===0){social.setHtmlContent(content)}social.contentArea.show();social.contentArea.find(".video-social-overlay").show();social.centerOn(window);social.show();$(".addthis_toolbox").delegate("a","click",function(e){$(".dialog").hide()});orion.util.analytics.trackEvent("action",{pageName:"Engagement/Social/Share",channel:"Engagement/Social/Share",prop23:"Engagement",prop24:"Social",prop26:"Share",eVar32:self.model.get("options").mediaObjectId.join(),events:"event9,event34"});return self},trailer:function(){var self=this;var trailerId=model.get("trailerId");var groupId=model.get("mediaGroupId");var prefix=model.get("pathPrefix");var pageName=model.get("mediaPageName");var url=prefix+"/"+groupId+"/"+pageName+"/"+trailerId+"/"+pageName;Path.history.pushState({},"",url)},watchlist:function(){var self=this;var action;var isSeason=false;var btn=this.model.getButtonByName("watchlist");var mediaIds=this.model.get("options").mediaIds;var mediaObjectId=this.model.get("options").mediaObjectId;if(mediaIds.length>1){action=btn.active?"removeMediaGroupItems":"addMediaGroupItems"}else{action=btn.active?"remove":"add"}orion.app.trigger("updatePlaylist",{action:action,mediaId:mediaIds,isGroup:btn.isGroup||false})}};TitleCardActionBar.prototype.checkInPlaylistState=function(){var self=this;var parentNode=this._elem.parentNode;var itemsIdInplaylist=orion.Playlist.getItemsIdInPlaylist();var itemsIdInplaylistObj={};var isInPlaylist=false;var mediaitemsIds=this.model.get("options").mediaIds||[];var isItemsInPlaylist=false;this.model.set("inPlaylist",false,true);if(itemsIdInplaylist){for(var i=0;i<itemsIdInplaylist.length;i++){itemsIdInplaylistObj[itemsIdInplaylist[i]]=true}if(mediaitemsIds.length){isItemsInPlaylist=true;for(i=0;i<mediaitemsIds.length;i++){if(!(mediaitemsIds[i] in itemsIdInplaylistObj)){isItemsInPlaylist=false;break}}}if(isItemsInPlaylist){isInPlaylist=true;this.model.set("inPlaylist",true,true)}}};TitleCardActionBar.prototype.updateWatchlistBtn=function(e){var isInPlaylist;var watchlistBtn=this.model.getButtonByName("watchlist");this.checkInPlaylistState();isInPlaylist=this.model.get("inPlaylist");watchlistBtn.active=isInPlaylist?true:false};TitleCardActionBar.prototype.isTrailerPage=function(){var item=model.get("mediaItem");var isTrailerPage=false;if(item){isTrailerPage=item.isTrailer()?true:false}return isTrailerPage};TitleCardActionBar.prototype.render=function(){var self=this;var html;var model=this.model;var items=model.options.items;var publisher=orion.app;var titleCardActionBarContainer=$(self._elem);var isTrailerScreen=this.isTrailerPage();this.updateWatchlistBtn();if(isTrailerScreen){var trailerBtn=model.getButtonByName("trailer");trailerBtn.hidden=true}html=Mustache.to_html(this._template,items);titleCardActionBarContainer.empty().append(html);if(this.model.get("titlecardRenderStatus")){this.attachTo(this._titlecardOffersPlaceholder)}};TitleCardActionBar.prototype.attachTo=function(target){$(target).html(this.$.children())};return TitleCardActionBar})(jQuery,orion.util.mvc.Model);
BBV.namespace("orion.widgets").Offers=orion.widgets.Offers||(function($,Model,View){function OffersModel(view){var self=this;this.view=view;this.titlecardRenderStatus=false;Model.call(self)}orion.util.inherits(OffersModel,Model);function OffersView(model,elem,localization){var self=this;var $elem;this.localStrings=localization;this._titlecardOffersPlaceholder="#offers-description";View.call(self,model);self.$=$(elem);self.model=model}orion.util.inherits(OffersView,View);function Offers(){this._elem="#offers";this.$=$(this._elem);if(!orioni18n.titleCardOffers){log("Offers:: localization is not available")}this.localStrings=orioni18n.titleCardOffers;this.view=new OffersView(this.model,this._elem,this.localStrings);this.model=new OffersModel(this.view);if(!orioni18n.titleCardOffers){log("Offers widget:: Localization for Offers does not exist!!! Can't initialize widget.");return}this.bindEvents()}OffersView.formatPrice=function(price){var priceLength=price.length;var whole,fraction;if(priceLength<5){for(i=0;i<5-priceLength;i++){price="0"+price}}whole=price.slice(0,price.length-4);fraction=price.slice(price.length-4,price.length-2);price=whole+","+fraction;return price};OffersView.prototype.showLockout=function(options){var self=this;var pinDialog=orion.app.dialogManager.getDialog("pin-verification");options=$.extend({pinType:"parentalPin",credentialType:"password",minutesRemaining:BBV.settings.pin.defaultLockoutDuration},options);pinDialog.trigger("pinRejected",{pinType:options.pinType,credentialType:options.credentialType,reason:"prohibited",minutesRemaining:options.minutesRemaining});pinDialog.showDialog()};Offers.prototype.showTvodDialog=function(purchaseMap){var self=this;var model=self.model;var id=purchaseMap.offerId;var productId=purchaseMap.productId;var tvodDialog=orion.app.dialogManager.getDialog("tvod");orion.util.analytics.set.offerId(id);var products=model.offers.products;var product,offer,item;$.each(products,function(){product=this;$.each(this.offers,function(){if(this.id==id){offer=this;return false}});if(offer){return false}});if(!offer){log("not able to find matching offer")}var rentalDays=product.rentalPeriodInSeconds/(60*60*24);var rentalDuration=rentalDays+" "+self.localStrings.offers[rentalDays>1?"days":"day"];item={offerId:id,productId:productId,productIds:model.mediaItem.currentProductIds,isAdult:model.mediaItem.isAdult,tvodProductIds:model.mediaItem.currentTvodProductIds,title:product.title,secondary_title:offer.name||"",cost:BBV.settings.currency.symbol+" "+OffersView.formatPrice(offer.price),rental_duration:rentalDuration};tvodDialog.setItem(item);tvodDialog.centerOn("window");tvodDialog.show();tvodDialog.setFocus()};Offers.prototype.handlers=function(){var self=this,view=self.view;var popoverData={i18n_head:this.localStrings.offersDialog.head,i18n_text:this.localStrings.offersDialog.text};$(view._titlecardOffersPlaceholder).popover({selector:"[rel=popover]",trigger:"hover",placement:"bottom",container:"body",viewport:{selector:".description"},content:Mustache.to_html(orion.templates.TitleCardOffersTooltip,popoverData),html:true});$(view._titlecardOffersPlaceholder).delegate(".offer-buy-button","click",function(event){event.preventDefault();view.trigger("purchase",{offerId:$(this).data("offer-id"),productId:$(this).data("product-id")})});$(view._titlecardOffersPlaceholder).delegate(".offer-button-login","click",function(event){event.preventDefault();var publisher=orion.app;var loginDialog=orion.app.dialogManager.getDialog("login");loginDialog.pointTo($(this),"right");loginDialog.show()})};Offers.prototype.bindEvents=function(){var self=this;var model=this.model;var view=this.view;var publisher=orion.app;this.renderOffers=this.renderOffers.bind(this);publisher.subscribe("offersResolved",this.renderOffers,this);model.titlecardDescriptionRendered=model.titlecardDescriptionRendered.bind(this);publisher.subscribe("titlecardDescriptionRendered",model.titlecardDescriptionRendered,this);model.bind("change.inPlaylist",$.proxy(self.renderPlaylistLinks,self));view.bind("purchase",function(event,purchaseMap){var pinType=model.mediaItem.isAdult?"adultPin":"parentalPin";var credentialType=model.mediaItem.isAdult?"adultPin":"password";var credentialStatus=orion.oesp.profileEndpoint.getCredentialStatus(credentialType);var profileStatus;var offers=model.get("offers");credentialStatus.done(function(status){if(status.isLocked){view.showLockout({pinType:pinType,credentialType:credentialType,minutesRemaining:status.minutesRemaining})}else{self.showTvodDialog(purchaseMap)}});return false});orion.app.recommendations.updateRatedItems(self.$)};OffersModel.prototype.titlecardDescriptionRendered=function(){this.model.set("titlecardRenderStatus",true,true);this.view.attachTo(this.view._titlecardOffersPlaceholder)};Offers.prototype.getData=function(){var self=this;var model=this.model;var type=model.get("type");var mode=model.get("mode");var publisher=orion.app;var mediaItem=self.model.get("mediaItem");model.unset("linearStatus");$.when(orion.oesp.session).done(function(session){if(!session.isAuthenticated()){model.set("loginToSeeOffers",true);if(mode==="replay"){mediaItem=""}if(mediaItem&&mediaItem.isTrailer()){publisher.trigger("offersResolved","playable")}else{publisher.trigger("offersResolved","notPlayable")}}else{if(type==="live"){self.configureChannelModel(session)}else{self.configureVideoModel(session)}}})};Offers.prototype.configureChannelModel=function(session){var self=this;var model=self.model;var publisher=orion.app;var channel=model.get("channel");if(!channel.isLive()){model.set("linearStatus","hasNoLiveStream");publisher.trigger("offersResolved","notPlayable")}else{if(!session.isVip()&&!session.hasEntitlement(channel.getEntitlements())){model.set("linearStatus","updateSubscription");publisher.trigger("offersResolved","notPlayable")}else{publisher.trigger("offersResolved","playable")}}};Offers.prototype.configureVideoModel=function(session){var self=this;var model=this.model;var publisher=orion.app;var purchases=orion.oesp.purchaseEndpoint;var mediaObject={};var mediaItem=model.get("mediaItem");var mode=model.get("mode");var isTrailer=mode==="replay"?false:mediaItem&&mediaItem.isTrailer();model.unset("rentalTime");model.unset("offers");if(mediaItem===""){publisher.trigger("offersResolved","notPlayable");return}mediaObject=isTrailer?model.get("mediaItemFilm"):mediaItem;var playerAccess={PLAYABLE:"playable",NOTPLAYABLE:"notPlayable"};if(session.isVip()){self.triggerPlayableStatus(isTrailer,playerAccess.PLAYABLE)}else{var isReplayEntitled=session.isReplayTVEntitled();if(!isReplayEntitled&&mode==="replay"){model.set("linearStatus","updateSubscription")}if((!isReplayEntitled||!mediaObject.replayTvAvailable)&&mode==="replay"){publisher.trigger("offersResolved",playerAccess.NOTPLAYABLE)}else{if(mode!=="replay"){if(mediaObject.isTVOD()){purchaseStatus=purchases.requestPurchaseStatus(mediaObject);purchaseStatus.done(function(status,activePurchases){var purchases=orion.oesp.purchaseEndpoint;var playerStatus;switch(status){case"isSVOD":model.set("offers",{});playerStatus=playerAccess.NOTPLAYABLE;self.triggerPlayableStatus(isTrailer,playerStatus);break;case"purchaseRequired":offersStatus=purchases.requestOffersStatus(mediaObject);offersStatus.done(function(status,offers){if(status==="upgradeRequired"){model.set("offers",{})}else{model.set("offers",offers)}playerStatus=playerAccess.NOTPLAYABLE;self.triggerPlayableStatus(isTrailer,"notPlayable")});break;default:var timeRemaining=0;var purchases=activePurchases.products;var i,length=purchases.length;for(i=0;i<length&&!timeRemaining;i++){if(mediaObject.hasCurrentTvodProductId(purchases[i].id)){if(purchases[i].isEntitled){timeRemaining=purchases[i].entitlementEnd-$.now()}}}if(timeRemaining){model.set("rentalTime",timeRemaining)}playerStatus=playerAccess.PLAYABLE;self.triggerPlayableStatus(isTrailer,playerStatus)}})}else{if(session.hasEntitlement(mediaObject.entitlements)){self.triggerPlayableStatus(isTrailer,"playable")}else{model.set("offers",{});self.triggerPlayableStatus(isTrailer,"notPlayable")}}}}}};Offers.prototype.triggerPlayableStatus=function(isTrailer,status){var playableStatus=status;var publisher=orion.app;if(isTrailer){playableStatus="playable"}publisher.trigger("offersResolved",playableStatus)};Offers.prototype.formatPrice=function(price){var priceLength=price.length;var whole,fraction;if(priceLength<5){for(i=0;i<5-priceLength;i++){price="0"+price}}whole=price.slice(0,price.length-4);fraction=price.slice(price.length-4,price.length-2);price=whole+","+fraction;return price};Offers.prototype.renderOffers=function(){var self=this;var model=this.model;var type=this.model.get("type");var offers=model.get("offers");var mediaItem=model.get("mediaItem");var rentalTime=model.get("rentalTime");var loginRequired=model.get("loginToSeeOffers");var linearStatus=model.get("linearStatus");var mode=model.get("mode");var viewModel={products:[],offers_link:BBV.settings.site.urls.offers.upcoming};var html,i18nFor,i18nBuy;var numberOfOffers=0;orion.oesp.session.done(function(session){var generateHtmlSection={clear:function(){$(self._elem).empty();return},rentalTime:function(){viewModel.simple=true;viewModel.rentalTime=true;viewModel.rental_status=self.localStrings.rented.rentedtext;viewModel.i18n_text=self.localStrings.rented.tvodrentaltime;var rt=new Date(rentalTime+$.now());viewModel.rental_time=BBV.utils.date(rt).format(BBV.settings.l10n.date.rentaltimeformat);html=Mustache.to_html(orion.templates.TitleCardOffers,viewModel)},loginRequired:function(){viewModel.simple=true;viewModel.i18n_text=self.localStrings.login.loginMessageText;viewModel.i18n_login_btn=true;viewModel.i18n_btn=self.localStrings.login.loginButtonText;html=Mustache.to_html(orion.templates.TitleCardOffers,viewModel)},offersAvailable:function(){i18nFor=self.localStrings.offers["for"];viewModel.i18n_link=self.localStrings.offers.btn_link;viewModel.i18n_for=self.localStrings.offers["for"];i18nBuy=self.localStrings.offersDialog.buy;viewModel.btn_text=self.localStrings.offersDialog.buy;$.each(offers.products,function(productIndex,product){if(!product.offers){log("Offers:: product.offers is null - exiting rendering of offer",product);return}var rentalDays=product.rentalPeriodInSeconds/(60*60*24);var rentalDuration=rentalDays+" "+self.localStrings.offers[rentalDays>1?"days":"day"];$.each(product.offers,function(offerIndex,offer){if(numberOfOffers<3){viewModel.products.push({name:product.title,currency:BBV.settings.currency.symbol,price:self.formatPrice(offer.price),i18n_for:i18nFor,i18n_buy:i18nBuy,rentalDuration:rentalDuration,offerId:offer.id,productId:product.id});numberOfOffers++}else{return false}})});html=Mustache.to_html(orion.templates.TitleCardOffers,viewModel)},offersNotAvailable:function(){this.updateSubscription()},updateSubscription:function(){viewModel.simple=true;viewModel.i18n_link=self.localStrings.updateSubscription.upgradelink;viewModel.i18n_text=mode!=="replay"?self.localStrings.updateSubscription.upgrademessagenotentitled:self.localStrings.updateSubscription.upgradeReplayTV;viewModel.i18n_btn=self.localStrings.updateSubscription.upgradetext;html=Mustache.to_html(orion.templates.TitleCardOffers,viewModel)}};generateHtmlSection.clear();if(loginRequired){generateHtmlSection.loginRequired()}else{if(linearStatus=="updateSubscription"){generateHtmlSection.updateSubscription()}else{if(rentalTime&&type!=="live"){generateHtmlSection.rentalTime()}else{if(offers&&offers.products&&type!=="live"){generateHtmlSection.offersAvailable()}else{if(offers&&type!=="live"){generateHtmlSection.offersNotAvailable()}}}}}if(!$(self._elem).length){log("Offers widget:: DOM Element does not exist. Can not render!");return}if(html){self.render(html);self.handlers()}})};OffersView.prototype.attachTo=function(target){$(target).html(this.$.children())};Offers.prototype.render=function(html){var self=this;var publisher=orion.app;var offersContainer=$(self._elem);offersContainer.empty().append(html);if(this.model.get("titlecardRenderStatus")){var target=this.view._titlecardOffersPlaceholder;this.view.attachTo(target)}};Offers.prototype.unbindEvents=function(){var publisher=orion.app;var model=this.model;publisher.unsubscribe("offersResolved",this.renderOffers);publisher.unsubscribe("titlecardDescriptionRendered",model.titlecardDescriptionRendered)};Offers.prototype.destroy=function(){this.unbindEvents()};return Offers})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.widgets").Recommendations=orion.widgets.Recommendations||(function($){var oesp=orion.util.oesp;var RATINGS_URL=BBV.settings.oespRoutes.mediaitemratings;var EVENTS_URL=BBV.settings.oespRoutes.events;var RATINGS_CACHE="ratingsCache";function Rating(customerId,countryCode,mediaItemId,rating){this.customerId=customerId;this.countryCode=countryCode;this.mediaItemId=mediaItemId;this.rating=rating}function findIndexByKeyValue(obj,key,value){for(var i=0;i<obj.length;i++){if(obj[i][key]==value){return i}}return null}Rating.prototype.toString=function(){return JSON.stringify(this)};function Recommendations(){var self=this;self.initialize();self.bindRatingEvents();self.listenForSocialEvents();orion.app.subscribe("loggedIn",$.proxy(self.initialize,self,true))}Recommendations.Rating={LIKE:"like",DISLIKE:"dislike",NEUTRAL:"neutral"};Recommendations.prototype.initialize=function(resettingNow){var self=this;var ratings;cacheDeferred=$.Deferred();self.ratingsCache=cacheDeferred.promise();orion.oesp.session.done(function(session){if(session.isAuthenticated()){if(sessionStorage&&$.isFunction(sessionStorage.getItem)&&sessionStorage.getItem(RATINGS_CACHE)){ratings=JSON.parse(sessionStorage.getItem(RATINGS_CACHE));if(ratings){ratings=$.map(ratings,function(rating){return new Rating(rating.customerId,rating.countryCode,rating.mediaItemId,rating.rating)});cacheDeferred.resolve(ratings)}}if(!ratings){oesp.get(RATINGS_URL+"/",{success:function(data){ratings=$.map(data.mediaItemRatings,function(rating){return new Rating(rating.customerId,rating.countryCode,rating.mediaItemId,rating.rating)});if(sessionStorage&&$.isFunction(sessionStorage.setItem)){sessionStorage.setItem(RATINGS_CACHE,JSON.stringify(ratings))}cacheDeferred.resolve(ratings)}})}}if(resettingNow){cacheDeferred.done(function(){session.setModuleStateAll()})}})};Recommendations.prototype.clearCache=function(){sessionStorage.removeItem(RATINGS_CACHE)};Recommendations.prototype.inspectCache=function(){var self=this;self.ratingsCache.done(function(cache){log("Ratings Cache:",cache)})};Recommendations.prototype.bindRatingEvents=function(){var self=this;$(".thumbs-up a").live("click",function(e){e.preventDefault();target=$(e.target);if(target.closest(".rating-like").length){handleRating(e,"reset")}else{handleRating(e,"like")}});$(".thumbs-down a").live("click",function(e){e.preventDefault();target=$(e.target);if(target.closest(".rating-dislike").length){handleRating(e,"reset")}else{handleRating(e,"dislike")}});orion.app.subscribe("likeUpdated",function(options){switch(options.state){case"like":case"dislike":self.rateAsset(options.crid,options.state,true);break;case"removed":self.rateAsset(options.crid,"neutral",true);break}});function handleRating(e,status){var element=e.target;orion.oesp.session.done(function(session){if(session.isAuthenticated()){if(status==="like"){self.likeAsset(getAssetId(element))}else{if(status==="dislike"){self.dislikeAsset(getAssetId(element))}else{if(status==="reset"){self.resetAsset(getAssetId(element))}}}orion.app.trigger("likeUpdated",{state:status})}else{var loginDialog=orion.app.dialogManager.getDialog("login");loginDialog.pointTo(element);loginDialog.show()}})}function getAssetId(element){var item=$(element).closest(".media-item, .media-group, .media-item-title-card");return item.data("media-id")}};Recommendations.prototype.likeAsset=function(assetId){log("user likes",assetId);this.rateAsset(assetId,Recommendations.Rating.LIKE)};Recommendations.prototype.dislikeAsset=function(assetId){log("user dislikes",assetId);this.rateAsset(assetId,Recommendations.Rating.DISLIKE)};Recommendations.prototype.resetAsset=function(assetId){log("user neither likes nor dislikes",assetId);this.rateAsset(assetId,Recommendations.Rating.NEUTRAL)};Recommendations.prototype.rateAsset=function(assetId,ratingValue,updateCacheOnly){var self=this;updateCacheOnly=updateCacheOnly===true;orion.oesp.session.done(function(session){var rating=new Rating(session.username,session.countryCode,assetId,ratingValue);var ratingPut={rating:ratingValue};var updateRatingsCache=function(){self.ratingsCache.done(function(cache){self.removeRatedItems(cache,assetId);cache.push(rating);if(sessionStorage&&$.isFunction(sessionStorage.setItem)){sessionStorage.setItem(RATINGS_CACHE,JSON.stringify(cache))}$('[data-media-id="'+assetId+'"]').each(function(){self.updateRatedItems(this)});if(ratingValue==="like"){orion.util.analytics.trackEvent("action",{pageName:"Engagement/Rating/Like",channel:"Engagement/Rating/Like",prop23:"Engagement",prop24:"Rating",prop26:"Like",eVar32:assetId,events:"event9,event33"})}else{orion.util.analytics.trackEvent("action",{pageName:"Engagement/Rating/Dislike",channel:"Engagement/Rating/Dislike",prop23:"Engagement",prop24:"Rating",prop26:"Dislike",eVar32:assetId,events:"event9,event30"})}})};var removeFromRatingsCache=function(){self.ratingsCache.done(function(cache){self.removeRatedItems(cache,assetId)})};if(ratingValue==="neutral"){if(updateCacheOnly){removeFromRatingsCache();return}oesp.del(RATINGS_URL+"/"+assetId,{success:removeFromRatingsCache})}else{if(updateCacheOnly){updateRatingsCache();return}oesp.put(RATINGS_URL+"/"+assetId,{data:JSON.stringify(ratingPut),success:updateRatingsCache})}}).fail(function(){log("user is not logged in and therfore cannot rate items")})};Recommendations.prototype.withRating=function(assetId,callback){var self=this;self.ratingsCache.done(function(cache){var i=cache.length;var rating=null;while(i--){if(cache[i].mediaItemId===assetId){rating=cache[i].rating;break}}callback(rating)})};Recommendations.prototype.removeRatedItems=function(cache,assetId){var self=this;var assetIndex=findIndexByKeyValue(cache,"mediaItemId",assetId);if(assetIndex&&assetIndex>=0){cache.splice(assetIndex,1);if(sessionStorage&&$.isFunction(sessionStorage.setItem)){sessionStorage.setItem(RATINGS_CACHE,JSON.stringify(cache))}$('[data-media-id="'+assetId+'"]').each(function(){self.updateRatedItems(this)})}};Recommendations.prototype.updateRatedItems=function(element){var self=this;var selector="[data-media-id]";var $elem=$(element);var items=$elem.is(selector)?$elem:$elem.find(selector);items.each(function(){var item=$(this);var crid=item.data("media-id");self.withRating(crid,function(rating){if(rating===Recommendations.Rating.LIKE){item.removeClass("rating-dislike");item.addClass("rating-like")}else{if(rating===Recommendations.Rating.DISLIKE){item.removeClass("rating-like");item.addClass("rating-dislike")}else{item.removeClass("rating-like");item.removeClass("rating-dislike")}}})})};Recommendations.prototype.learnEvent=function(eventType,assetId){oesp.post(EVENTS_URL+"/"+assetId,{data:JSON.stringify({type:eventType})})};Recommendations.prototype.learnSocialLike=function(assetId,assetName){this.learnEvent("socialLike",assetId);orion.util.analytics.trackEvent("action",{pageName:"Engagement/Social/Facebook Like",channel:"Engagement/Social/Facebook Like",prop23:"Engagement",prop24:"Social",prop26:"Facebook Like",eVar14:assetId,eVar15:assetName,events:"event9,event29"})};Recommendations.prototype.listenForSocialEvents=function(){var self=this;window.facebook.done(function(){FB.Event.subscribe("edge.create",function(response){if(arguments[1]&&arguments[1].dom&&$(arguments[1].dom).data("asset-id")){self.learnSocialLike($(arguments[1].dom).data("asset-id"),$(arguments[1].dom).data("asset-name"))}else{log('Recommendations: missing "asset-id" data for .fb-like element')}})})};return Recommendations})(jQuery);
BBV.namespace("orion.widgets").PredictiveSearch=orion.widgets.PredictiveSearch||(function($){function PredictiveSearch(container,date){var self=this;self.form=$(container).find("form");if(self.form.length>1){throw"PredictiveSearchError\n -> form has too many elements"}self.dropDownTarget=self.form.find(".predictive-search");self.linkText=self.form.data("link-text");orion.oesp.session.done(function(session){if(session.isAuthenticated()){$("#site-search-form-logged-in",self.form).attr("id","site-search-form");self.searchBox=self.form.find("#site-search-text-input-logged-in").attr("id","site-search-text-input")}else{$("#site-search-form-logged-out",self.form).attr("id","site-search-form");self.searchBox=self.form.find("#site-search-text-input-logged-out").attr("id","site-search-text-input")}self.initialize(date)})}PredictiveSearch.buildSearchItemUrl=function(item){var url=item.oespRes.buildMediaUrl();if(url==="#"){url=[BBV.settings.site.urls.base,"404.html"].join("/")}return url};PredictiveSearch.sorted=function(searchResults){var getDeliveryType=function(item){return(item.isTVProgram)?"linear":"vod"};searchResults=searchResults.sort(function(a,b){a.deliveryType=getDeliveryType(a);b.deliveryType=getDeliveryType(b);if(a.deliveryType==b.deliveryType){return 0}if(a.deliveryType=="linear"&&b.deliveryType=="vod"){return 1}if(a.deliveryType=="vod"&&b.deliveryType=="linear"){return -1}});return searchResults};PredictiveSearch.prototype.initialize=function(date){var self=this,$positionOf=self.form.find(".field:first");var auto=self.searchBox.autocomplete({appendTo:self.dropDownTarget,minLength:2,source:function(req,callback){var searchQuery=encodeURIComponent(req.term);$.when(orion.oesp.searchEndpoint.predictiveSearch(searchQuery,date)).done(function(searchResults){var results=PredictiveSearch.sorted(searchResults.results);callback($.map(results,function(item){var regex=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+req.term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi");var labelSource;if(item instanceof orion.oesp.res.Listing){labelSource=item.program.title}else{item=item.mediaGroup;labelSource=item.title}var menuItem={label:labelSource.replace(regex,"<span>$1</span>"),value:labelSource,isTVProgram:item.program?true:false,oespRes:item};return menuItem}))}).fail(function(error){callback()})},create:function(event,ui){$('<p class="view-all"><a class="view-all-link" href="#"></a></p>').appendTo(self.dropDownTarget).hide();self.seeAllResultsFor=self.dropDownTarget.find("a.view-all-link")},open:function(event,ui){var searchTerm=Mustache.escapeHtml(self.searchBox.val());self.seeAllResultsFor.text(self.linkText+" '"+searchTerm+"'");self.dropDownTarget.find("p.view-all").show()},close:function(event,ui){self.dropDownTarget.find("p.view-all").hide()},select:function(event,ui){if(ui.item){window.location.href=PredictiveSearch.buildSearchItemUrl(ui.item)}},position:{my:"left top",at:"left center",of:$positionOf}}).each(function(){var autoData=$(this).data("autocomplete");autoData._renderItem=self.renderItem;autoData._renderMenu=self.renderMenu});self.form.bind("submit",function(){if(self.searchBox.val().trim()==""){return false}});self.form.on("click",".view-all-link",function(event){event.preventDefault();self.form.submit()})};PredictiveSearch.prototype.renderMenu=function(ul,items){var self=this,currentCategory="",firstCategory=true;$.each(items,function(index,item){var categoryText=item.isTVProgram?orioni18n.utilityBar.predictiveSearchLinearText:orioni18n.utilityBar.predictiveSearchOnDemandText;if(categoryText!=currentCategory){ul.append('<li class="ui-autocomplete-category'+(firstCategory?" first":"")+'">'+categoryText+"</li>");currentCategory=categoryText;first=false}self._renderItem(ul,item)})};PredictiveSearch.prototype.renderItem=function(ul,item){var dateText="";if(item.isTVProgram){dateText=item.oespRes.getFormattedDateTime()}else{dateText=item.oespRes.getLatestBroadcastDate?item.oespRes.getLatestBroadcastDate():""}return $('<li class="suggestion"></li>').data("item.autocomplete",item).append('<a class="suggestion-link">'+item.label+" "+dateText+"</a>").appendTo(ul)};return PredictiveSearch})(jQuery);
BBV.namespace("orion.modules").UtilityBar=orion.modules.UtilityBar||(function($,Model,View){function UtilityBarModel(){var self=this;Model.call(self);self.userSignedIn=false;self.currentMenu="none";self.username=""}orion.util.inherits(UtilityBarModel,Model);function UtilityBarView(model,element){var self=this;View.call(self,model);self.$=$(element);self.bindEvents();self.model.bind("change",function(){self.render()})}UtilityBarView.MENU_OPEN_CLASS="open";UtilityBarView.getMenuOverlay=function getMenuOverlay(){var overlay;overlay=$("#generated-menu-overlay");if(overlay.size()===0){overlay=$('<div id="generated-menu-overlay"/>');overlay.css({width:$(window).width(),height:$(window).height()})}return overlay};UtilityBarView.prototype.render=function render(){var view=this;var model=this.model;var overlay;var currentMenu=model.get("currentMenu");if(model.get("userSignedIn")){$("#welcome-username .username").text(model.get("username"));view.$.find(".no-js").hide();view.$.find(".logged-out").hide();$(".dialog").hide();view.$.find(".logged-in").show()}else{view.$.find(".no-js").hide();view.$.find(".logged-out").show();view.$.find(".logged-in").hide()}if(currentMenu=="none"){overlay=UtilityBarView.getMenuOverlay();overlay.hide();view.hideMenu("account-menu");view.hideMenu("notification-menu");view.hideMenu("language-menu")}else{view.showMenu(currentMenu);if(currentMenu!="account-menu"){view.hideMenu("account-menu")}if(currentMenu!="notification-menu"){view.hideMenu("notification-menu")}if(currentMenu!="language-menu"){view.hideMenu("language-menu")}}};UtilityBarView.prototype.setMediboxLinkVisibility=function(){orion.util.oesp.get(BBV.settings.oespRoutes.remotebookingsprofile,{success:function(profile){if(!profile.boxes.length){$("body").addClass("no-dvr")}},error:function(){$("body").addClass("no-dvr")}})};UtilityBarView.prototype.getMenu=function getMenu(menuName){var containerSelector=this.model.get("userSignedIn")?".logged-in":".logged-out";var menuSelector;if("account-menu"==menuName){menuSelector=".user-options.menu"}if("notification-menu"==menuName){menuSelector=".user-notifications.menu"}if("language-menu"==menuName){menuSelector=".user-language.menu"}return this.$.find(containerSelector).find(menuSelector)};UtilityBarView.prototype.hideMenu=function hideMenu(menuName){var trigger=this.$.find('[data-trigger="'+menuName+'"]');trigger.removeClass(UtilityBarView.MENU_OPEN_CLASS);trigger.closest(".function").find(".menu").hide()};UtilityBarView.prototype.showMenu=function showMenu(menuName){var view=this;var overlay=UtilityBarView.getMenuOverlay();var dvrSettingsLink=$("#dvr-settings-link");var menu=view.getMenu(menuName);var ancestor=menu.closest(".logged-in, .logged-out");var trigger=ancestor.find('[data-trigger="'+menuName+'"]');var menuWidth=menu.width()>125?menu.width():125;if(trigger.width()+12>menuWidth){menuWidth=trigger.width()+12;menu.width(menuWidth)}trigger.addClass(UtilityBarView.MENU_OPEN_CLASS);menu.show();ancestor.append(overlay);overlay.show();overlay.unbind("click");overlay.click(function(){$(view).trigger("closemenus");overlay.hide()});dvrSettingsLink.click(function(){$(view).trigger("closemenus");overlay.hide()})};UtilityBarView.prototype.bindEvents=function(){var view=this;var $view=$(view);if(this._eventsBound){return}this._eventsBound=true;$(".user-language").on("click",".language-item",function(e){$view.trigger("setlanguage",this);return false});view.$.delegate("#utility-signin-link","click",function(e){$view.trigger("signin",this);return false});view.$.delegate(".menu-trigger","click",function(e){var menuName=$(this).data("trigger");$view.trigger("togglemenu",menuName);return false});view.$.delegate("#sign-out-link","click",function(e){if(window.location.hash.indexOf("byCategoryIds")>-1){window.location.hash=""}$view.trigger("signout",this.href);return false});view.$.delegate("#account-link","click",function(e){$view.trigger("accountlink",this.href);return false})};function UtilityBar(elem,publisher){var self=this;var util,view,model;if(!elem){throw new Error("Please provide an element to use for the utility bar.")}if(!(this instanceof UtilityBar)){throw new Error("UtilityBar called without new.")}self.pub=publisher;self.model=new UtilityBarModel();self.view=new UtilityBarView(self.model,elem);self.initialize()}UtilityBar.prototype.initialize=function(){var self=this;var model=self.model;var view=self.view;orion.oesp.timeEndpoint=orion.oesp.timeEndpoint||new orion.oesp.req.TimeEndpoint();self.bindEvents();orion.oesp.session.done(function(session){model.set({userSignedIn:session.isAuthenticated(),username:session.username});if(session.isAuthenticated()){view.setMediboxLinkVisibility()}});self.predictiveSearches=[];orion.oesp.timeEndpoint.getTimeForRequest().done(function(date){view.$.find(".search").each(function(index,element){self.predictiveSearches.push(new orion.widgets.PredictiveSearch(element,date))})})};UtilityBar.prototype.bindEvents=function(){var util=this;var view=this.view;var model=this.model;var $view=$(view);$view.bind("setlanguage",function(e,target){$langItem=$(target);var language=$langItem.data("language");var oespLanguage=$langItem.data("oesplanguage");var oespCountry=$langItem.data("oespcountry");if(language){localStorage.setItem("language",language);log("setting local storage language to: ",language)}orion.util.oesp.put(BBV.settings.oespRoutes.session,{xhrId:"sessionUpdate",data:JSON.stringify({languageCode:oespLanguage}),success:function(){log("UTILITYBAR::Session Language Updated Successfully")},error:function(){log("UTILITYBAR::Session Language change failed")},complete:function(){window.location.href=$langItem.attr("href")}})});$view.bind("signin",function(e,target){model.set("currentMenu","none");util.pub.trigger("requestDialog",{dialogName:"login",pointTo:{target:target,direction:"up"}})});$view.bind("openmenu",function(e,menuName){model.set("currentMenu",menuName)});$view.bind("closemenus",function(){model.set("currentMenu","none")});$view.bind("togglemenu",function(e,menuName){if(menuName==model.get("currentMenu")){model.set("currentMenu","none")}else{model.set("currentMenu",menuName)}});$view.bind("signout",function(e,url){sessionStorage.clear();orion.util.oesp.del(url,{complete:function(data){BBV.user().logout();window.location.reload()}})});$view.bind("accountlink",function(e,url){var accountDialog=orion.app.dialogManager.getDialog("accountLink");var accountUrl=url;var menu=view.getMenu("account-menu");var os=menu.offset();this.model.set("currentMenu","none");accountDialog.setHtmlContent($("#account-link-dialog-content"));accountDialog.contentArea.delegate("#cancel-redirect","click.redirect",function(){accountDialog.hide()});accountDialog.$.css("position","fixed");accountDialog.$.css({left:0,top:0});accountDialog.$.offset(os);accountDialog.show()})};return UtilityBar})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").NavigationBar=orion.modules.NavigationBar||(function($,Model,View){function NavigationBarModel(){var self=this;Model.call(self);self.currentMenu=null}orion.util.inherits(NavigationBarModel,Model);function NavigationBarView(model,elem){var self=this;View.call(self,model);self.$=$(elem);if(BBV.settings.showMegaNavs){self.setupMegaMenus()}var uaHas=(function(uA){return function(text){return uA.indexOf(text)!==-1}})(navigator.userAgent);var isMacSafari=(uaHas("Macintosh")&&uaHas("Safari")&&!uaHas("Chrome"));if(isMacSafari){self.setupMacSafariDisplayFix()}}orion.util.inherits(NavigationBarView,View);NavigationBarView.prototype.setupMacSafariDisplayFix=function(){var resizeTimeout,fixSelector="#site-utility-bar, div.navigation-bar-wrapper";$(window).resize(function(){clearTimeout(resizeTimeout);resizeTimeout=setTimeout(function(){$(fixSelector).css("z-index","8998");setTimeout(function(){$(fixSelector).css("z-index","8999")},1)},10)})};NavigationBarView.prototype.setupMegaMenus=function(){var self=this;self.$.find(".nav-item").each(function(){var item=$(this);var megamenus=$(".megamenu");var megamenu=item.find(".megamenu[data-url]");var sidebarLink=$(".megamenu").find(".column").children("a");var url;if(megamenu.size()>0){url=megamenu.attr("data-url");if(url){item.bind("mouseenter",function(event){var delay=megamenus.is(":visible")?0:400;self.model.currentMenu=item;item.data("is-open",true);setTimeout(function(){self.openMenu(item)},delay)});item.bind("mouseleave",function(event){item.data("is-open",false);setTimeout(function(){self.closeMenu(item)},400)})}}})};NavigationBarView.prototype.openMenu=function(navItem){var self=this;var $navItem=$(navItem);if(!$navItem.data("is-open")){return}self.loadMenu(navItem);if(navItem&&self.model.get("currentMenu")===navItem){self.$.find(".nav-item").removeClass("hover");$navItem.addClass("hover");if($navItem.hasClass("hover")){$navItem.find(".megamenu-wrapper").slideDown(125)}}};NavigationBarView.prototype.closeMenu=function(navItem){var self=this;var $navItem=$(navItem);if($navItem.data("is-open")){return}$navItem.removeClass("hover");$navItem.find(".megamenu-wrapper").fadeOut(100)};NavigationBarView.prototype.loadMenu=function(navItem){var self=this;var $navItem=$(navItem);var megaMenu=$navItem.find(".megamenu");var url=megaMenu.data("url");if(!megaMenu.data("loaded")){$.get(url,function(content){megaMenu.empty().html(content);megaMenu.data("loaded",true);megaMenu.find(".column").delegate("a","click",function(){$(navItem).trigger("mouseleave")})})}};function NavigationBar(elem,publisher){var self=this;var model,view;if(!elem){log("No navigation bar element is available. Aborting NavigationBar constructor.");return}if(!(this instanceof NavigationBar)){return new NavigationBar(elem,publisher)}self.model=new NavigationBarModel();self.view=new NavigationBarView(self.model,elem);NavigationBar.setupAdultMonitoring();NavigationBar.setupHeaderPinning()}NavigationBar.categoryIsAdult=function(categoryId){return categoryId&&BBV.settings.i18n.genreMap[categoryId]&&BBV.settings.i18n.genreMap[categoryId].isAdult};NavigationBar.getCategoryIdFromHash=function(){var hash=window.location.hash;var index=hash.indexOf("byCategoryIds=");var categoryId;if(index>=0){categoryId=hash.replace("#byCategoryIds=","")}else{categoryId=0}return categoryId};NavigationBar.showPinIfNeeded=function(){var categoryId=NavigationBar.getCategoryIdFromHash();orion.oesp.session.done(function(session){if(NavigationBar.categoryIsAdult(categoryId)&&!session.isAdultPinVerified(true)){orion.util.AdultAdapter.showAdultDialogs(function(){window.location.reload()})}})};NavigationBar.setupAdultMonitoring=function(){NavigationBar.showPinIfNeeded();$(window).bind("hashchange",function(){NavigationBar.showPinIfNeeded()})};NavigationBar.setupHeaderPinning=function(){var self=this,navBar=$(".navigationbar"),utilityBar=$(".utilitybar"),prevBar=$(".servicenav"),pinClass="pinned";$(window).bind("scroll",function(){if($(window).scrollTop()>prevBar.height()){utilityBar.addClass(pinClass);navBar.addClass(pinClass);prevBar.css("margin-bottom",utilityBar.height()+navBar.height()+"px")}else{utilityBar.removeClass(pinClass);navBar.removeClass(pinClass);prevBar.removeAttr("style")}})};return NavigationBar})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").NetworkBanner=orion.modules.NetworkBanner||(function($){function NetworkBanner(elem){var self=this;self.$=$(elem);self.setGooglePlusHandler();self.setDescription()}NetworkBanner.prototype.setGooglePlusHandler=function(){var self=this;self.$.find(".social-icon-google a").click(function(e){e.preventDefault();window.open("https://plus.google.com/share?url="+document.URL,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")})};NetworkBanner.prototype.setDescription=function(){var self=this,$description;$description=self.$.find(".banner-description");$description.ellipsis({live:true});$description.show()};return NetworkBanner})(jQuery);
BBV.namespace("orion.modules").ProviderBanner=orion.modules.ProviderBanner||(function($,Model){function ProviderBannerModel(elem){this.$=$(elem);this.providerId="";Model.call(this);return this}orion.util.inherits(ProviderBannerModel,Model);function ProviderBanner(elem){var self=this;self.$=$(elem);this.assetBgContainer="#site-wrapper";this.pageGradient="#site-wrapper > .pagegradient";this.model=new ProviderBannerModel(elem);self.initialize()}ProviderBanner.prototype.initialize=function(){this._bindEvents()};ProviderBanner.prototype._bindEvents=function(){var self=this;var publisher=orion.app;publisher.subscribe("providerChanged",function(providerId){if(!providerId){self.$.hide();self.setProviderBackground();return}var provider=orion.oesp.ProviderEndpoint.getProviderById(providerId);provider.done(function(provider){self.model.set("provider",provider,true);self.update();self.$.fadeIn(750)})})};ProviderBanner.prototype.update=function(){var self=this;var provider=this.model.get("provider");if(!provider){log("ProviderBanner:::","Could not get Provider Id");return}provider.isFacevookEnabled=this.$.data("facebook-enabled");provider.isTwitterEnabled=this.$.data("twitter-enabled");provider.isGooglePlusEnabled=this.$.data("googleplus-enabled");provider.bannerUrl=this.getProviderBannerUrl(provider);this.setProviderBackground(provider);var tpl=$(Mustache.to_html(orion.templates.ProviderBanner,provider));$(".provider-banner").html(tpl);orion.app.addthis.done(function(){addthis.toolbox(".banner-social")});self.setGooglePlusHandler();self.setDescription()};ProviderBanner.prototype.setProviderBackground=function(provider){var self=this;function getBackgroundImageUrl(provider){var images=provider.images;var assetType="provider-titlecard-gradient";if(images){for(var i=0;i<images.length;i++){if(images[i].assetType==assetType){return images[i].url}}}return""}var bgImage=provider?getBackgroundImageUrl(provider):"";if(bgImage){$(this.pageGradient).hide();$(this.assetBgContainer).css("background-image",'url("'+bgImage+'")');$(this.assetBgContainer).css("background-repeat","repeat-x")}else{$(this.assetBgContainer).css("background-image","none");$(this.pageGradient).show()}};ProviderBanner.prototype.setGooglePlusHandler=function(){var self=this;self.$.find(".social-icon-google a").click(function(e){e.preventDefault();window.open("https://plus.google.com/share?url="+document.URL,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")})};ProviderBanner.prototype.setDescription=function(){var self=this,$description;$description=self.$.find(".banner-description");$description.ellipsis({live:true});$description.show()};ProviderBanner.prototype.getProviderBannerUrl=function(provider){var self=this;var images=provider.images;var bannerUrl=images.filter(function(item){return item.assetType==="provider-titlecard-banner"});return(bannerUrl.length)?bannerUrl[0].url:""};return ProviderBanner})(jQuery,orion.util.mvc.Model);
BBV.namespace("orion.modules").SubNavigationBar=orion.modules.SubNavigationBar||(function($,Model,View){function SubNavigationBarModel(){Model.call(this)}orion.util.inherits(SubNavigationBarModel,Model);SubNavigationBarModel.prototype.resetCategories=function(data){this.set("categories",[])};SubNavigationBarModel.prototype.updateCategories=function(data){var categories=[];if(this.has("categories")){categories=this.get("categories")}for(var i=0;i<data.length;i++){var categoryId=data[i];if(BBV.settings.i18n.genreMap.hasOwnProperty(categoryId)&&BBV.settings.i18n.genreMap[categoryId].parentId=="null"){var category=BBV.settings.i18n.genreMap[categoryId];category.id=categoryId;if(this.currentGenre==categoryId){category.active=" active"}else{category.active=""}if($.inArray(category,categories)===-1){categories.push(category)}}}categories.sort(function(a,b){return a.title.localeCompare(b.title)});this.set("categories",categories)};function SubNavigationBarView(model,element){View.call(this,model);this.$=$(element);this.model.bind("change",$.proxy(this.update,this))}orion.util.inherits(SubNavigationBarView,View);SubNavigationBarView.prototype.update=function(){var self=this;if(self.model.has("categories")){self.addCategories()}};SubNavigationBarView.prototype.addCategories=function(){var $dropdown=this.$.find("#nav-genre + .subnavigation");var $categories=$dropdown.children();var $first=$($categories[0]).clone();var categories=this.model.get("categories");$dropdown.empty();$dropdown.append($first);for(var i=0;i<categories.length;i++){if(categories[i].hasOwnProperty("title")){$dropdown.append('<li class="nav-item'+categories[i]["active"]+'" data-categoryId="'+categories[i].id+'" data-parentId="'+categories[i].parentId+'"><a href="#byCategoryIds='+categories[i].id+'">'+categories[i].title+"</a></li>")}}};function SubNavigationBar(element,publisher){var model,view;if(!element){log("No sub navigation bar element is available. Aborting SubNavigationBar constructor.");return}if(!(this instanceof SubNavigationBar)){return new SubNavigationBar(elem,publisher)}this.publisher=publisher;this.model=new SubNavigationBarModel();this.view=new SubNavigationBarView(this.model,element);this.setupHandlers()}SubNavigationBar.prototype.updateCategories=function updateCategories(data){this.model.updateCategories(data)};SubNavigationBar.prototype.setGenresFilter=function(genreId){var $subnav=$("#site-sub-navigation-bar");var $genre=$("#nav-genre");$subnav.find(".nav-item").removeClass("active");if(BBV.settings.i18n.genreMap[genreId]){$genre.parent(".nav-item").addClass("active");$genre.text(BBV.settings.i18n.genreMap[genreId].title);this.model.currentGenre=genreId}else{this.model.currentGenre="";$genre.text($genre.next().find(".nav-item:first").text())}$genre.find("li").removeClass("active");$genre.next().find('li[data-categoryid="'+genreId+'"]').addClass("active")};SubNavigationBar.prototype.resetCategories=function resetCategories(){this.model.resetCategories()};SubNavigationBar.prototype.setupHandlers=function setupHandlers(){var self=this;this.view.$.delegate(".subnavigation li[data-isadult=true] a","click",function(event){event.preventDefault();orion.oesp.session.done(function(session){if(session.isAuthenticated()&&session.isAdultPinVerified(true)){window.location.href=event.target.href}else{orion.util.AdultAdapter.showAdultDialogs(function(){var tmpSlash="";if(navigator.appVersion.indexOf("MSIE")>-1&&window.location.pathname.indexOf("/")==0&&event.target.pathname.indexOf("/")>0){tmpSlash="/"}window.location.href=event.target.href;if(window.location.pathname===tmpSlash+event.target.pathname){window.location.reload()}})}})});this.publisher.subscribe("EPG.updateCategories",$.proxy(this.updateCategories,this));this.publisher.subscribe("EPG.resetCategories",$.proxy(this.resetCategories,this));this.publisher.subscribe("EPG.genreChanged",$.proxy(this.setGenresFilter,this))};return SubNavigationBar})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").ContentDiscovery=orion.modules.ContentDiscovery||(function($,MediaGroup,MediaItem,time){var viewstates={GRID:{template:"MediaGrid",size:6},LIST:{template:"MediaList",size:6}};function readUrlString(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}}function parseParam(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj}function topInView(el){var windowTop=$(window).scrollTop();var windowBottom=windowTop+$(window).height();var elTop=el.offset().top;return(elTop>windowTop&&elTop<windowBottom)}function ContentDiscoveryModel(c){var model=this;model.content=c;return model}ContentDiscoveryModel.prototype.data=null;ContentDiscoveryModel.prototype.datamedia=[];ContentDiscoveryModel.prototype.getMediaRange=function(strt,stp){var model=this;var content=model.content;var view=content.view;return model.datamedia.slice(strt,stp)};ContentDiscoveryModel.prototype.update=function(data){var model=this;var content=model.content;var view=content.view;model.mediaTemplate=new orion.util.MediaTemplate();model.data=data;model.datamedia=model.mediaTemplate.formatData(model.data,{i18n:content.i18n});content.$.trigger("loaded");model.content.view.notify(data)};function ContentDiscoveryView(c){var view=this,content;view.notifications={};view.content=content=c;view.model=content.model;view.root=view.content.$;view.element=view.root.find(".content-list");view.currentview=(function(){var current=view.root.find(".view-toggle > li").has(".active").attr("class");if(current){return viewstates[current.toUpperCase()]}else{return viewstates.GRID}})();view.start=0;view.end=6;return view}ContentDiscoveryView.prototype.bind=function(){var view=this;var model=this.model;var content=model.content;var media=model.getMediaRange(0,view.currentview.size);var didScroll=false;var interval;var html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});function applyFeed(){view.element.empty().html(html);if($(html).find(".media-group").length==0){$(view.element).addClass("landscape")}orion.oesp.session.done(function(session){session.setModuleState(view.element)})}if(topInView(content.$)){applyFeed()}else{$(window).on("scroll.ContentDiscovery",function(){didScroll=true});interval=window.setInterval(function(){if(didScroll&&topInView(content.$)){$(window).off("scroll.ContentDiscovery");window.clearInterval(interval);applyFeed()}},250)}};ContentDiscoveryView.prototype.handlers=function(){var view=this,content=view.content,model=content.model,controller=content.controller;view.subscribe("bind",view.bind);content.$.loader({flow:["overlay"],target:".content-list",minheight:260,minwidth:926});content.$.find(".view-toggle").delegate("a","click",function(e){var $root=$(this).closest(".view-toggle"),$this=$(this),currentview=$this.context.parentNode.getAttribute("class");if(viewstates[currentview.toUpperCase()]!==view.currentview){view.currentview=viewstates[currentview.toUpperCase()];view.bind();$root.find(".active").removeClass("active");$this.addClass("active")}return false});content.$.find(".add-all .count").bind("contentloaded",function(){var datatype=content.model.data.mediaGroups||content.model.data.mediaItems;$(this).text(datatype.length)});if(content.$.find(".tabs").find(".tab").length){var $first=content.$.find(".tabs .tab:eq(0)"),$active=content.$.find(".tabs .active a"),refine=($active.length)?$active.attr("href").substr(1):$first.find("a").attr("href").substr(1);if(!$active.length){$first.addClass("active")}controller.setParam(refine)}content.$.find(".tabs").each(function(){var $root=$(this),$active=$root.find(".active");$root.delegate("a","click",function(e){var $this=$(this),$parent=$($this.context.parentNode),refine=$this.attr("href").substr(1);if(!$parent.hasClass("active")){$active.removeClass("active");$active=$parent.addClass("active");controller.setParam(refine);controller.update()}return false})})};ContentDiscoveryView.prototype.notify=function(name,data_){var view=this,data=(BBV.type(name)==="string")?data_||{}:name;if(BBV.type(name)==="string"){view.notifications[name].call(view,data);return}BBV.each(view.notifications,function(name,notification){notification.call(view,data)})};ContentDiscoveryView.prototype.subscribe=function(name,fn){var view=this;view.notifications[name]=fn;return view};function ContentDiscoveryController(c,url){var controller=this,content;controller.content=content=c;controller.feed=new BBV.feed(controller.content.$.attr("id"),{url:readUrlString(url).url,callback:function(){content.model.update(this.data)}});return controller}ContentDiscoveryController.prototype.clearParams=function(){var controller=this,content=controller.content;content.appliedFilters.params={};return controller};ContentDiscoveryController.prototype.removeParam=function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.each(content.appliedFilters.params,function(name,value){if(content.appliedFilters.params[name]){delete content.appliedFilters.params[name]}});return controller};ContentDiscoveryController.prototype.serializeParams=function(){var controller=this,qs=[];if(controller.content.appliedFilters.default_){qs.push(controller.content.appliedFilters.default_)}BBV.each(controller.content.appliedFilters.params,function(name,val){qs.push(val)});controller.feed.settings.data=qs.join("&")};ContentDiscoveryController.prototype.setParam=function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.extend(content.appliedFilters.params,param);return controller};ContentDiscoveryController.prototype.load=function(){var controller=this,model=controller.content.model;model.datamedia=[];controller.update()};ContentDiscoveryController.prototype.load=function(){var controller=this,model=controller.content.model;model.datamedia=[];controller.update()};ContentDiscoveryController.prototype.update=function(){var controller=this;var content=controller.content;var view=content.view;var now=new Date();var dateTime=time.roundDate(now,"floor",5);if(content.feedType&&content.feedType==="catchup"){controller.setParam("byLatestBroadcastStartTime=~"+dateTime)}controller.setParam("range="+view.start+"-"+view.end);controller.serializeParams();controller.feed.update();content.$.trigger("loading")};function ContentDiscovery(elem,publisher){var id;var url;var content;var model,view,controller;content=this;content.root=elem;content.publisher=publisher;content.$=$(content.root);content.i18n=orioni18n.contentDiscovery;id=content.$.attr("id");orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){url=content.$.attr("data-module-logged-in-feed-url");if(!url){url=content.$.attr("data-module-feed-url")}}else{url=content.$.attr("data-module-feed-url")}if(!url){return false}content.feedType=content.$.data("module-feed-type")==="feedtype"?"":content.$.data("module-feed-type");content.feedUrlParams=(content.$.data("module-feed-params")&&content.$.data("module-feed-params").trim()!="")?content.$.data("module-feed-params"):"";content.model=model=new ContentDiscoveryModel(content);content.view=view=new ContentDiscoveryView(content);content.controller=controller=new ContentDiscoveryController(content,url);content.appliedFilters={default_:readUrlString(url).query};rxMediaItems=/mediaitems/;if(!url.match(rxMediaItems)&&content.feedUrlParams==""){content.appliedFilters.params={byVod:"byHasCurrentVod=true"}}else{content.appliedFilters.params=BBV.utils.uri.toFilterObject(content.feedUrlParams)}content.bindEvents();controller.load()});return content}ContentDiscovery.prototype.bindEvents=function(sortType){this.view.handlers(sortType)};return ContentDiscovery})(jQuery,orion.oesp.res.MediaGroup,orion.oesp.res.MediaItem,orion.util.time);
BBV.namespace("orion.modules").ContentBrowse=orion.modules.ContentBrowse||(function($,time){var now=new Date();var startOfDay=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0);var startOfDayOffset=now.getTime()-startOfDay.getTime();var viewTypes={DEFAULT:"alpha",COLLATE:"collate",DATE:"date"},dateRange={today:{start:(function(){return Date.parse(now)-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},yesterday:{start:(function(){var less=1000*60*60*24*1;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},week:{start:(function(){var less=1000*60*60*24*6;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},month:{start:(function(){var less=1000*60*60*24*7*29;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},within:function(date_){if(date_>=dateRange.today.start&&date_<=dateRange.today.end){return"today"}else{if(date_>=dateRange.yesterday.start&&date_<=dateRange.yesterday.end){return"yesterday"}else{if(date_>=dateRange.week.start&&date_<=dateRange.week.end){return"week"}else{if(date_>=dateRange.month.start&&date_<=dateRange.month.end){return"month"}else{return -1}}}}}},encode_=["#"],defaultParam=getHashFilter(),defaulthash=defaultParam;if(!("onhashchange" in window)){var loc=window.location,hash;setInterval(function(){var hash=getHashFilter();if(hash!==defaulthash){BBV.events.trigger("hashchange",{hash:hash,oldhash:defaulthash});defaulthash=hash}},1000)}else{$(window).bind("hashchange",function(){var hash=getHashFilter();BBV.events.trigger("hashchange",{hash:hash,oldhash:defaulthash});defaulthash=hash})}function escapeCharacters(str_){var raw=str_,purity=raw;BBV.each(encode_,function(idx,itm){var regex=new RegExp(itm,"g");purity=purity.replace(regex,encodeURIComponent(itm))});return purity}function getHashFilter(){return decodeURIComponent(window.location.hash.substr(1))}function updatePreFilter(){return defaultParam=getHashFilter()}function mapPreFilter(char_){return(char_&&/[a-zA-Z]/.test(char_))?char_.toLowerCase():"pound"}function readUrlString(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}}function parseParam(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj}function parseCategory(cat_){var catIDs=cat_.split("=");var catID=catIDs[catIDs.length-1];var category=BBV.settings.i18n.genreMap[catID];return category.title}function parseCategoryID(param){var catID=parseParam(param).byCategoryIds?parseParam(param).byCategoryIds.split("=")[1]:null;return orion.util.url.fixedEncodeURIComponent(catID)}function filterAlphaList(content,filter_){var pattern=/byCollateChar=([\w\#])/i,char1=(filter_&&pattern.test(filter_))?pattern.exec(filter_)[1]:null,char2=(char1)?mapPreFilter(char1):null,t,$results=((t=content.$.find(".sort-"+char2)).length)?t:[];content.$.find(".content-list").hide();if($results.length){$results.show()}}function topInView(el){var windowTop=$(window).scrollTop();var windowBottom=windowTop+$(window).height();var elTop=el.offset().top;return(elTop>windowTop&&elTop<windowBottom)}function ContentBrowseModel(c){var model=this;model.content=c;return model}ContentBrowseModel.prototype.data=null;ContentBrowseModel.prototype.datamedia=[];ContentBrowseModel.prototype.update=function(data,q){var model=this;var content=model.content;model.mediaTemplate=new orion.util.MediaTemplate();model.data=data;newData=model.mediaTemplate.formatData(model.data,{isBrowse:true});model.datamedia=model.datamedia.concat(newData);content.$.trigger("loaded");model.content.view.notify([data,q])};function ContentBrowseView(c){var view=this;view.notifications={};view.content=c;view.size=30;view.start=1;view.end=view.size;view.element=view.content.$.find(".content-list .results");view.isCatchupSectionEnabled=$(".navigation-bar").data("catchup-enabled")||false;return view}ContentBrowseView.prototype.collate=function(q){var view=this;var model=view.content.model;var feed={};var cnt_=view.start-1;var media_=model.datamedia;var lngth_=model.datamedia.length;var $items;var char_,$tmp;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];char_=mapPreFilter(itm.collateChar);feed[char_]=feed[char_]||[];feed[char_].push(itm)}BBV.each(feed,function(name,media){var sort;var regex=new RegExp(name==="pound"?"#":name.toUpperCase());var $results;var $newImages;var html;if(regex.test(getHashFilter())||!getHashFilter()){sort=$(".sort-"+name).show(),$results=sort.find(".results");$items=$results.find(".grid-view").children("li");if(!$items.length){html=model.mediaTemplate.getMarkup(media);$results.html(html)}else{var newMedia=[];for(var i=0;i<media.length;i++){var hasVal=false;$items.each(function(){var current=$(this);if(current.data("media-id")===media[i].id){hasVal=true}});if(!hasVal){newMedia.push(media[i])}}html=model.mediaTemplate.getMarkup(newMedia,{isItem:true,disabledHover:true});$items.closest(".grid-view").append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)})}});view.notify("rendered","collate")};ContentBrowseView.prototype.handlers=function(type){var view=this,content=view.content,defaultFilter=$('a[href*="'+defaultParam+'"]');content.$.loader({element:{append:"<div/>",insert:"<li/>"},elementClass:"grid-item",flow:["append","insert"],location:"inside",minheight:204,minwidth:110,target:".content-list:visible .grid-view:last"});BBV.events.bind("hashchange",function(e,params){view.resetRange();var param=params.hash;category=view.category=parseCategoryID(param);$(".grid-view").empty();if(param&&param.indexOf("byCategoryIds")>-1&&BBV.settings.i18n.genreMap[category].parentId=="null"){content.$.find("#genre-category").text(" - "+parseCategory(param));$("#nav-genre",".subnav-wrapper").text(parseCategory(param))}if(param){content.controller.setParam(param)}else{content.controller.removeParam(params.oldhash)}content.controller.load()});if(defaultFilter.length&&!defaultFilter.hasClass("active")){content.$.find(".active").removeClass("active");defaultFilter.addClass("active");filterAlphaList(content,defaultParam)}view.subscribe("render",function(a){if(type===viewTypes.COLLATE){this.collate(a[1])}else{if(type===viewTypes.DATE){this.sort()}else{this.render()}}}).subscribe("count",function(a){var results=a[0],resultCount;if(results){resultCount=results.totalResults;view.content.$.find(".results-listed .count").text(resultCount)}}).subscribe("rendered",function(data){if($.isArray(data)){return}var selectors=content.$.find(".grid-item");var selector=content.$.find(".grid-item:not(.loading-wrapper)").last();var idx=selectors.index(selector)+1;content.$.off("inview",".content-list");selector.on("inview",function(e,isInView){if(view.end===idx&&view.end<view.content.model.data.totalResults&&isInView){view.scroll();selector.off("inview")}else{if(idx>=view.content.model.data.totalResults){selector.off("inview")}}})});content.$.find(".sort-by").delegate("a","click",function(e){var selectors=content.$.find(".grid-item");selector=content.$.find(".grid-item:eq("+parseInt(selectors.length-1)+")");selector.off("inview");var $root=content.$.find(".sort-by"),$this=$(this),$href=decodeURIComponent($this.attr("href").substr(1)),$active=$root.find(".active");if(!$this.hasClass("active")){view.resetRange();$active.removeClass("active");$this.addClass("active");window.location.hash=$this.attr("href");filterAlphaList(content,$href);view.notify("count")}return false});content.$.find(".back-to-top a").live("click",function(){$("html, body").animate({scrollTop:0},"fast");return false});content.$.find("#subgenres .current").live("click",function(e){e.preventDefault()})};ContentBrowseView.prototype.notify=function(name,data_){var view=this,data=(BBV.type(name)==="string")?data_||{}:name;if(BBV.type(name)==="string"){view.notifications[name].call(view,data);return}BBV.each(view.notifications,function(name,notification){notification.call(view,data)})};ContentBrowseView.prototype.render=function(){var view=this;var model=view.content.model;var cnt_=view.start-1;var media=[];var media_=model.datamedia;var lngth_=model.datamedia.length;var $results=view.element;var $items=$results.find(".grid-view");var html;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];media.push(itm)}view.content.$.find(".content-list").show();if(!$items.length){html=model.mediaTemplate.getMarkup(media);$results.html(html)}else{html=model.mediaTemplate.getMarkup(media,{isItem:true,disabledHover:true});$items.append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)});view.notify("rendered","alpha")};ContentBrowseView.prototype.resetRange=function(){var view=this;view.start=1;view.end=view.size};ContentBrowseView.prototype.sort=function(){var view=this;var content=view.content;var model=view.content.model;var range={};var timeframe_;var cnt_=view.start-1;var media_=model.datamedia;var lngth_=model.datamedia.length;var $results,$items,html;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];var bucketParam;if(content.pathContext==="tv_recently-added"&&view.isCatchupSectionEnabled){bucketParam="lastChildAddedDate"}else{if(content.pathContext==="tv_recently-added"){bucketParam="latestBroadcastStartTime"}else{if(content.feedType&&content.feedType==="catchup"){bucketParam="latestBroadcastStartTime"}else{bucketParam="lastChildAddedDate"}}}timeframe_=dateRange.within(itm[bucketParam]);range[timeframe_]=range[timeframe_]||[];range[timeframe_].push(itm)}BBV.each(range,function(name,media){var sort=$(".sort-"+name).show();$results=$(".sort-"+name).find(".results");$items=$results.find(".grid-view");if(!$items.length){html=model.mediaTemplate.getMarkup(media);$results.html(html)}else{html=model.mediaTemplate.getMarkup(media,{isItem:true,disabledHover:true});$items.append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)})});view.notify("rendered","sort")};ContentBrowseView.prototype.scroll=function(){var view=this,controller=view.content.controller;view.start=view.end+1;view.end=view.end+view.size;controller.update()};ContentBrowseView.prototype.subscribe=function(name,fn){var view=this;view.notifications[name]=fn;return view};function ContentBrowseController(c,url){var controller=this;controller.content=c;this.fetch(url);return controller}BBV.extend(ContentBrowseController.prototype,{fetch:function(url){var controller=this,attempts=0;controller.feed=new BBV.feed(controller.content.$.attr("id"),{url:readUrlString(url).url,callback:function(query_){attempts=0;controller.content.model.update(this.data,query_)},error:function(jqXHR,textStatus,errorThrown){window.setTimeout(function(){attempts++;if(attempts<6){controller.feed.update()}},0);log("ContentBrowseController.feed.error\n -> jqXHR: ",jqXHR)}})},clearParams:function(){var controller=this,content=controller.content;content.appliedFilters.params={};return controller},removeParam:function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.each(content.appliedFilters.params,function(name,value){if(content.appliedFilters.params[name]){delete content.appliedFilters.params[name]}});return controller},serializeParams:function(){var controller=this,qs=[];if(controller.content.appliedFilters.default_){qs.push(controller.content.appliedFilters.default_)}BBV.each(controller.content.appliedFilters.params,function(name,val){qs.push(val)});controller.feed.settings.data=escapeCharacters(qs.join("&"))},setParam:function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.extend(content.appliedFilters.params,param);return controller},load:function(){var controller=this,model=controller.content.model;model.datamedia=[];controller.update()},update:function(){var controller=this;var content=controller.content;var view=content.view;var category=view.category?view.category:parseCategoryID(defaultParam)||null;var now=new Date();var dateTime=time.roundDate(now,"floor",5);orion.oesp.session.done(function(session){if(session.isAdultPinVerified(true)&&BBV.settings.i18n.genreMap[category]&&BBV.settings.i18n.genreMap[category].isAdult){controller.setParam("includeAdult=true")}if(content.feedType&&content.feedType==="catchup"&&(content.pathContext!=="tv_recently-added"||(content.pathContext==="tv_recently-added"&&!view.isCatchupSectionEnabled))){controller.setParam("byLatestBroadcastStartTime=~"+dateTime)}controller.setParam("range="+view.start+"-"+view.end);controller.serializeParams();controller.feed.update();controller.setSubGenres();content.$.trigger("loading")})},setSubGenres:function(){var defaultParam=getHashFilter(),category=parseCategoryID(defaultParam),medium=$("ul.subnavigation",".subnav-wrapper").data("medium"),topCategory,subCategory="";$("#subgenres").hide().find("li").remove();if(BBV.settings.i18n.genreMap[category]){if(BBV.settings.i18n.genreMap[category].parentId=="null"){$("#subgenres .current").html('<a href="#">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[category].title+"</a>");topCategory='<li><a href="#byCategoryIds='+category+'">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[category].title+"</a></li>";$.each(BBV.settings.i18n.genreMap,function(index,genre){if(category==genre.parentId&&genre.mediaItemCounts[medium]){subCategory+='<li><a href="#byCategoryIds='+index+'">'+genre.title+"</a></li>"}})}else{$("#subgenres .current").html('<a href="#">'+BBV.settings.i18n.genreMap[category].title+"</a>");topCategory='<li><a href="#byCategoryIds='+BBV.settings.i18n.genreMap[category].parentId+'">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[BBV.settings.i18n.genreMap[category].parentId].title+"</a></li>";$.each(BBV.settings.i18n.genreMap,function(index,genre){if((category==index||BBV.settings.i18n.genreMap[category].parentId==genre.parentId)&&genre.mediaItemCounts[medium]){subCategory+='<li><a href="#byCategoryIds='+index+'">'+genre.title+"</a></li>"}})}if(subCategory.length){var $ul=$("#subgenres ul").length?$("#subgenres ul"):$("<ul></ul>").appendTo("#subgenres");$ul.append(topCategory).append(subCategory);$("#subgenres").show()}}}});function ContentBrowse(elem,publisher){var id,url,sortType,content,model,view,controller;content=this;content.root=elem;content.$=$(content.root);id=content.$.attr("id");url=content.$.attr("data-module-feed-url");this.sortType=sortType=content.$.data("module-sort-type");this.pathContext=content.$.data("module-path-context");this.feedType=content.$.data("module-feed-type")==="feedtype"?"":content.$.data("module-feed-type");this.byTimePeriod=this.getDateRangeString(-30);content.model=model=new ContentBrowseModel(content);content.view=view=new ContentBrowseView(content);content.controller=controller=new ContentBrowseController(content,url);content.appliedFilters={default_:readUrlString(url).query,params:{}};if(defaultParam){if(defaultParam.indexOf("?")>=0){defaultParam=defaultParam.split("?")[0]}controller.setParam(defaultParam);var category=parseCategoryID(defaultParam);if(defaultParam.indexOf("byCategoryIds")>-1){content.$.find("#genre-category").append(" - "+parseCategory(BBV.settings.i18n.genreMap[category].parentId=="null"?defaultParam:BBV.settings.i18n.genreMap[category].parentId));$("#nav-genre",".subnav-wrapper").text(parseCategory(BBV.settings.i18n.genreMap[category].parentId=="null"?defaultParam:BBV.settings.i18n.genreMap[category].parentId))}}content.bindEvents(sortType);controller.load()}BBV.extend(ContentBrowse.prototype,{bindEvents:function(sortType){this.view.handlers(sortType)},getDateRangeString:function getDateRangeString(days){var roundToFifteen=1000*60*15;var nowRounded=Math.floor((new Date()).getTime()/roundToFifteen)*roundToFifteen;var now=new Date(nowRounded);var then=new Date(now);then.setDate(then.getDate()+days);return then.getTime()+"~"+now.getTime()}});return ContentBrowse})(jQuery,orion.util.time);
BBV.namespace("orion.modules").ContentBrowseNG=orion.modules.ContentBrowseNG||(function($,MediaGroup,MediaItem,time){var viewstates={GRID:{template:"MediaGrid",size:7},LIST:{template:"MediaList",size:7}};var now=new Date();var startOfDay=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0);var startOfDayOffset=now.getTime()-startOfDay.getTime();var viewTypes={DEFAULT:"alpha",COLLATE:"collate",DATE:"date"},dateRange={today:{start:(function(){return Date.parse(now)-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},yesterday:{start:(function(){var less=1000*60*60*24*1;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},week:{start:(function(){var less=1000*60*60*24*6;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},month:{start:(function(){var less=1000*60*60*24*7*29;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},within:function(date_){if(date_>=dateRange.today.start&&date_<=dateRange.today.end){return"today"}else{if(date_>=dateRange.yesterday.start&&date_<=dateRange.yesterday.end){return"yesterday"}else{if(date_>=dateRange.week.start&&date_<=dateRange.week.end){return"week"}else{if(date_>=dateRange.month.start&&date_<=dateRange.month.end){return"month"}else{return -1}}}}}};encode_=["#"],defaultParam=getHashFilter(),defaulthash=defaultParam;function escapeCharacters(str_){var raw=str_,purity=raw;BBV.each(encode_,function(idx,itm){var regex=new RegExp(itm,"g");purity=purity.replace(regex,encodeURIComponent(itm))});return purity}function getHashFilter(){return""}function updatePreFilter(){return defaultParam=getHashFilter()}function mapPreFilter(char_){return(char_&&/[a-zA-Z]/.test(char_))?char_.toLowerCase():"pound"}function readUrlString(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}}function parseParam(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj}function parseCategory(cat_){var catIDs=cat_.split("=");var catID=catIDs[catIDs.length-1];var category=BBV.settings.i18n.genreMap[catID];return category.title}function parseCategoryID(param){var catID=parseParam(param).byCategoryIds?parseParam(param).byCategoryIds.split("=")[1]:null;return orion.util.url.fixedEncodeURIComponent(catID)}function filterAlphaList(content,filter_){var pattern=/byCollateChar=([\w\#])/i,char1=(filter_&&pattern.test(filter_))?pattern.exec(filter_)[1]:null,char2=(char1)?mapPreFilter(char1):null,t,$results=((t=content.$.find(".sort-"+char2)).length)?t:[];content.$.find(".content-list").hide();if($results.length){$results.show()}}function topInView(el){var windowTop=$(window).scrollTop();var windowBottom=windowTop+$(window).height();var elTop=el.offset().top;return(elTop>windowTop&&elTop<windowBottom)}function ContentBrowseNGModel(c){var model=this;model.content=c;return model}ContentBrowseNGModel.prototype.data=null;ContentBrowseNGModel.prototype.datamedia=[];ContentBrowseNGModel.prototype.update=function(data,q){var model=this;var content=model.content;model.mediaTemplate=new orion.util.MediaTemplate();model.data=data;newData=model.mediaTemplate.formatData(model.data,{isBrowse:true,i18n:content.i18n});model.datamedia=model.datamedia.concat(newData);content.$.trigger("loaded");model.content.view.notify([data,q])};function ContentBrowseNGView(c){var view=this;view.notifications={};view.content=c;view.size=30;view.start=1;view.end=view.size;view.element=view.content.$.find(".content-list .results");view.isCatchupSectionEnabled=$(".navigation-bar").data("catchup-enabled")||false;view.currentview=(function(){var current=view.content.$.find(".view-toggle > li").has(".active").attr("class");if(current){return viewstates[current.toUpperCase()]}})();return view}ContentBrowseNGView.prototype.collate=function(q){var view=this;var model=view.content.model;var feed={};var cnt_=view.start-1;var media_=model.datamedia;var lngth_=model.datamedia.length;var $items;var char_,$tmp;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];char_=mapPreFilter(itm.collateChar);feed[char_]=feed[char_]||[];feed[char_].push(itm)}BBV.each(feed,function(name,media){var sort;var $results;var html;sort=view.content.$.find(".sort-"+name).show(),$results=sort.find(".results");$items=$results.find(".grid-view, .list-view").children("li");if(!$items.length){html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});$results.html(html)}else{var newMedia=[];for(var i=0;i<media.length;i++){var hasVal=false;$items.each(function(){var current=$(this);if(current.data("media-id")===media[i].id){hasVal=true}});if(!hasVal){newMedia.push(media[i])}}html=model.mediaTemplate.getMarkup(newMedia,{template:view.currentview.template,isItem:true,disabledHover:true});$items.closest(".grid-view, .list-view").append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)})});view.notify("rendered","collate")};ContentBrowseNGView.prototype.bind=function(){var root=this,model=root.content.model,content=root.content,view=root.element.find(".grid-view, .list-view"),didScroll=false,interval;var media=model.mediaTemplate.formatData(model.datamedia,{isBrowse:true,i18n:content.i18n});var html=model.mediaTemplate.getMarkup(media,{template:root.currentview.template,disabledHover:true});function applyFeed(){view.replaceWith(html)}applyFeed()};ContentBrowseNGView.prototype.handlers=function(type){console.log("------ "+type);var view=this,content=view.content,defaultFilter=$('a[href*="'+defaultParam+'"]'),loader={};loader.opts={element:{append:"<div/>",insert:"<li/>"},elementClass:"grid-item",flow:["append","insert"],location:"inside",target:".content-list:visible .grid-view:last, .content-list:visible .list-view:last"};content.$.loader(loader.opts);content.$.find(".view-toggle").delegate("a","click",function(e){var $root=$(this).closest(".view-toggle"),$this=$(this),currentview=$this.context.parentNode.getAttribute("class");if(viewstates[currentview.toUpperCase()]!==view.currentview){view.currentview=viewstates[currentview.toUpperCase()];view.bind();$root.find(".active").removeClass("active");$this.addClass("active");view.notify("rendered")}return false});if(defaultFilter.length&&!defaultFilter.hasClass("active")){content.$.find(".active").removeClass("active");defaultFilter.addClass("active");filterAlphaList(content,defaultParam)}view.subscribe("render",function(a){if(type===viewTypes.COLLATE){this.collate(a[1])}else{if(type===viewTypes.DATE){this.sort()}else{this.render()}}}).subscribe("count",function(a){var results=a[0],resultCount;if(results){resultCount=results.totalResults;view.content.$.find(".results-listed .count").text(resultCount);view.content.$.find(".results-listed").show()}}).subscribe("rendered",function(data){if($.isArray(data)){return}var selectors=content.$.find(".media-item");var selector=content.$.find(".media-item:not(.loading-wrapper)").last();var idx=selectors.index(selector)+1;content.$.off("inview",".content-list");selector.on("inview",function(e,isInView){if(view.end===idx&&view.end<view.content.model.data.totalResults&&isInView){view.scroll();selector.off("inview")}else{if(idx>=view.content.model.data.totalResults){selector.off("inview")}}})});content.$.find(".sort-by").delegate("a","click",function(e){var selectors=content.$.find(".media-item");selector=content.$.find(".media-item:eq("+parseInt(selectors.length-1)+")");selector.off("inview");var paramName="byCollateChar";var $root=content.$.find(".sort-by"),$this=$(this),$href=decodeURIComponent($this.data("collate-char")?paramName+"="+$this.data("collate-char"):""),$active=$root.find(".active");if(!$this.hasClass("active")){view.resetRange();$active.removeClass("active");$this.addClass("active");selectors.empty();var param=$href;content.$.find(".grid-view, .list-view").empty();content.$.find(".results-listed").hide();if(param){content.controller.setParam(param)}else{content.controller.removeParam(paramName)}content.controller.load();filterAlphaList(content,param);view.notify("count")}return false});content.$.find(".back-to-top a").live("click",function(){$("html, body").animate({scrollTop:0},"fast");return false});content.$.find("#subgenres .current").live("click",function(e){e.preventDefault()})};ContentBrowseNGView.prototype.notify=function(name,data_){var view=this,data=(BBV.type(name)==="string")?data_||{}:name;if(BBV.type(name)==="string"){view.notifications[name].call(view,data);return}BBV.each(view.notifications,function(name,notification){notification.call(view,data)})};ContentBrowseNGView.prototype.render=function(){var view=this;var model=view.content.model;var cnt_=view.start-1;var media=[];var media_=model.datamedia;var lngth_=model.datamedia.length;var $results=view.element;var $items=$results.find(".grid-view, .list-view");var html;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];media.push(itm)}view.content.$.find(".content-list").show();if(media.length&&!$items.length){html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});$results.html(html)}else{html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,isItem:true,disabledHover:true});$items.append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)});view.notify("rendered","alpha")};ContentBrowseNGView.prototype.resetRange=function(){var view=this;view.start=1;view.end=view.size};ContentBrowseNGView.prototype.sort=function(){var view=this;var content=view.content;var model=view.content.model;var range={};var timeframe_;var cnt_=view.start-1;var media_=model.datamedia;var lngth_=model.datamedia.length;var $results,$items,html;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];var bucketParam;if(content.pathContext==="tv_recently-added"&&view.isCatchupSectionEnabled){bucketParam="lastChildAddedDate"}else{if(content.pathContext==="tv_recently-added"){bucketParam="latestBroadcastStartTime"}else{if(content.feedType&&content.feedType==="catchup"){bucketParam="latestBroadcastStartTime"}else{bucketParam="lastChildAddedDate"}}}timeframe_=dateRange.within(itm[bucketParam]);range[timeframe_]=range[timeframe_]||[];range[timeframe_].push(itm)}BBV.each(range,function(name,media){var sort=view.content.$.find(".sort-"+name).show();$results=sort.find(".results");$items=$results.find(".grid-view, .list-view");if(!$items.length){html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});$results.html(html)}else{html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,isItem:true,disabledHover:true});$items.append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)})});view.notify("rendered","sort")};ContentBrowseNGView.prototype.scroll=function(){var view=this,controller=view.content.controller;view.start=view.end+1;view.end=view.end+view.size;controller.update()};ContentBrowseNGView.prototype.subscribe=function(name,fn){var view=this;view.notifications[name]=fn;return view};function ContentBrowseNGController(c,url){var controller=this;controller.content=c;this.fetch(url);return controller}BBV.extend(ContentBrowseNGController.prototype,{fetch:function(url){var controller=this;controller.feed=new BBV.feed(controller.content.$.attr("id"),{url:readUrlString(url).url,callback:function(query_){controller.content.model.update(this.data,query_)},error:function(jqXHR,textStatus,errorThrown){window.setTimeout(function(){controller.feed.update()},0);log("ContentBrowseNGController.feed.error\n -> jqXHR: ",jqXHR)}})},clearParams:function(){var controller=this,content=controller.content;content.appliedFilters.params={};return controller},removeParam:function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.each(content.appliedFilters.params,function(name,value){if(content.appliedFilters.params[name]){delete content.appliedFilters.params[name]}});return controller},serializeParams:function(){var controller=this,qs=[];if(controller.content.appliedFilters.default_){qs.push(controller.content.appliedFilters.default_)}BBV.each(controller.content.appliedFilters.params,function(name,val){qs.push(val)});controller.feed.settings.data=escapeCharacters(qs.join("&"))},setParam:function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.extend(content.appliedFilters.params,param);return controller},load:function(){var controller=this,model=controller.content.model;model.datamedia=[];controller.update()},update:function(){var controller=this;var content=controller.content;var view=content.view;var category=view.category?view.category:parseCategoryID(defaultParam)||null;var now=new Date();var dateTime=time.roundDate(now,"floor",5);orion.oesp.session.done(function(session){if(session.isAdultPinVerified(true)&&BBV.settings.i18n.genreMap[category]&&BBV.settings.i18n.genreMap[category].isAdult){controller.setParam("includeAdult=true")}if(content.feedType&&content.feedType==="catchup"&&(content.pathContext!=="tv_recently-added"||(content.pathContext==="tv_recently-added"&&!view.isCatchupSectionEnabled))){controller.setParam("byLatestBroadcastStartTime=~"+dateTime)}controller.setParam("range="+view.start+"-"+view.end);controller.serializeParams();controller.feed.update();content.$.trigger("loading")})},setSubGenres:function(){var defaultParam=getHashFilter(),category=parseCategoryID(defaultParam),medium=$("ul.subnavigation",".subnav-wrapper").data("medium"),topCategory,subCategory="";$("#subgenres").hide().find("li").remove();if(BBV.settings.i18n.genreMap[category]){if(BBV.settings.i18n.genreMap[category].parentId=="null"){$("#subgenres .current").html('<a href="#">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[category].title+"</a>");topCategory='<li><a href="#byCategoryIds='+category+'">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[category].title+"</a></li>";$.each(BBV.settings.i18n.genreMap,function(index,genre){if(category==genre.parentId&&genre.mediaItemCounts[medium]){subCategory+='<li><a href="#byCategoryIds='+index+'">'+genre.title+"</a></li>"}})}else{$("#subgenres .current").html('<a href="#">'+BBV.settings.i18n.genreMap[category].title+"</a>");topCategory='<li><a href="#byCategoryIds='+BBV.settings.i18n.genreMap[category].parentId+'">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[BBV.settings.i18n.genreMap[category].parentId].title+"</a></li>";$.each(BBV.settings.i18n.genreMap,function(index,genre){if((category==index||BBV.settings.i18n.genreMap[category].parentId==genre.parentId)&&genre.mediaItemCounts[medium]){subCategory+='<li><a href="#byCategoryIds='+index+'">'+genre.title+"</a></li>"}})}if(subCategory.length){var $ul=$("#subgenres ul").length?$("#subgenres ul"):$("<ul></ul>").appendTo("#subgenres");$ul.append(topCategory).append(subCategory);$("#subgenres").show()}}}});function ContentBrowseNG(elem,publisher){var id,url,sortType,content,model,view,controller;content=this;content.root=elem;content.$=$(content.root);content.i18n=orioni18n.contentbrowseNG;id=content.$.attr("id");url=content.$.attr("data-module-feed-url");this.sortType=sortType=content.$.data("module-sort-type");this.pathContext=content.$.data("module-path-context");this.feedType=content.$.data("module-feed-type")==="feedtype"?"":content.$.data("module-feed-type");content.model=model=new ContentBrowseNGModel(content);content.view=view=new ContentBrowseNGView(content);content.controller=controller=new ContentBrowseNGController(content,url);content.appliedFilters={default_:readUrlString(url).query,params:{}};if(defaultParam){if(defaultParam.indexOf("?")>=0){defaultParam=defaultParam.split("?")[0]}controller.setParam(defaultParam);var category=parseCategoryID(defaultParam);if(defaultParam.indexOf("byCategoryIds")>-1){content.$.find("#genre-category").append(" - "+parseCategory(BBV.settings.i18n.genreMap[category].parentId=="null"?defaultParam:BBV.settings.i18n.genreMap[category].parentId));$("#nav-genre",".subnav-wrapper").text(parseCategory(BBV.settings.i18n.genreMap[category].parentId=="null"?defaultParam:BBV.settings.i18n.genreMap[category].parentId))}}content.bindEvents(sortType);controller.load()}BBV.extend(ContentBrowseNG.prototype,{bindEvents:function(sortType){this.view.handlers(sortType)}});return ContentBrowseNG})(jQuery,orion.oesp.res.MediaGroup,orion.oesp.res.MediaItem,orion.util.time);
BBV.namespace("orion.modules").FacetedNavigation=orion.modules.FacetedNavigation||(function($,Request,Model,View){function FacetedNavigationModel(elem,publisher){this.$=$(elem);this.i18n=orioni18n.facetedNavigationContainer;this.filters=orion.settings.facetedNavigationContainer;this.routes=BBV.settings.oespRoutes;this.sectionType=this.$.data("section-type");this.primaryFeed="";this.feed="";this.historyUrl="";this.isFilterEverChanged=false;this.publisher=publisher;Model.call(this);return this}orion.util.inherits(FacetedNavigationModel,Model);FacetedNavigationModel.prototype.sortChanged=function(value){this.sortStatus=value};FacetedNavigationModel.prototype.getFilterByName=function(name){var filter="";for(var i=0;i<this.filters.length;i++){if(this.filters[i].name.toLowerCase()===name){filter=this.filters[i];break}}return filter};FacetedNavigationModel.prototype.getNoneConfigurableFilters=function(){return this.filters.filter(function(item){return !item.configurable})};FacetedNavigationModel.prototype.getFilterByFeedParam=function(feedParam){var filter="";for(var i=0;i<this.filters.length;i++){if(this.filters[i].feedParam===feedParam){filter=this.filters[i];break}}return filter};FacetedNavigationModel.prototype.categoryCallback=function(filter){var activeItem=filter.data.filter(function(item){return item.active});filter.allFeed=activeItem[0].id==="0"?true:false};FacetedNavigationModel.prototype.providersCallback=function(filter){var activeItem=filter.data.filter(function(item){return item.active});this.publisher.trigger("providerChanged",activeItem.length?activeItem[0].id:0)};FacetedNavigationModel.prototype.resetUrlParams=function(){this.urlData.params={}};FacetedNavigationModel.prototype.getSecondaryFilters=function(){return this.filters.filter(function(item){return !item.primary})};FacetedNavigationModel.prototype.changeActiveInFilterData=function(filter,id){if(!filter){return}var url=this.urlData;var name=filter.feedParam;var actived=false;for(var i=0;i<filter.data.length;i++){filter.data[i].active=false;if(filter.data[i].id.toString()===id){actived=true;filter.data[i].active=true;if(url.params){url.params[name]=id}filter.checked=true}}if(!actived&&filter.data.length&&filter.name==="category"){filter.data[0].active=true;if(url.params){delete url.params[name]}filter.checked=true}this.urlData=url};FacetedNavigationModel.prototype.updateData=function(select,data){var self=this;var name=select.feedName;select.data=select.filter?self.filterData(name,select.filter,data):data[name];select.data=select.sort?self.sortData(select.sort,select.data):select.data};FacetedNavigationModel.prototype.getPrimaryFeed=function(){var feed="";var filters=this.filters;if(this.sectionType==="catchup"){feed=this.$.data("feed-all")}else{var filter=filters.filter(function(item){return item.primary});filter=filter[0];var activeItem=filter.data.filter(function(item){return item.active});if(activeItem.length){activeItem=activeItem[0];feed=activeItem.feed}}if(!feed){log("FACETED NAVIGATION::: ","Primary select is not defined")}this.primaryFeed=feed};FacetedNavigationModel.prototype.setFeedParams=function(){var feed=this.primaryFeed;var params="";var query=[];var urlQuery=[];var filters=this.filters;var activeSelectClassName="faceted-filter-selected";var includeAdult=this.isAdultSection();filters=filters.filter(function(item){return item.checked});for(var i=0;i<filters.length;i++){var name=filters[i].name;var select=document.getElementsByName(name)[0];var activeItem=filters[i].data.filter(function(item){return item.active});if(activeItem.length){activeItem=activeItem[0];if(filters[i].primary){urlQuery.push(filters[i].feedParam+"="+activeItem.id)}else{query.push(filters[i].feedParam+"="+activeItem.id)}if(select&&name!=="category"){select.classList.add(activeSelectClassName)}}else{if(select){select.classList.remove(activeSelectClassName)}}}if(query.length){params="?"+query.join("&")}if(includeAdult){params+=((params.indexOf("?")==-1)?"?":"&");params+="includeAdult=true"}if(this.sortStatus&&this.sortStatus!=="0"){query.push("sort="+this.sortStatus)}if(urlQuery.length){query.unshift(urlQuery[0])}if(query.length){urlQuery="?"+query.join("&")}this.feed=feed+params;this.historyUrl=document.location.origin+document.location.pathname+urlQuery;this.publisher.trigger("ItemsFeedReady",this.feed)};FacetedNavigationModel.prototype.isAdultSection=function(){var isAdultSection=false;var primaryFilter=this.getFilterByName("category");if(primaryFilter&&primaryFilter.data){var currentCategory=primaryFilter.data.filter(function(item){return item.active});if(currentCategory&&currentCategory.length){currentCategory=currentCategory[0];isAdultSection=currentCategory.isAdult}}return isAdultSection};FacetedNavigationModel.prototype.filterData=function(feedName,filter,data){var self=this;switch(filter.type){case"byFieldName":if(filter.values.length){data[feedName]=$.makeArray(data[feedName]).filter(function(item){return filter.values.indexOf(item[filter.name])!==-1})}break;case"byLevel":var isAdult=self.isAdultSection();data[feedName]=data[feedName].filter(function(item){return isAdult?item.level==="1":item.level==="0"});break}return data[feedName]};FacetedNavigationModel.prototype.sortData=function(sortField,data){return data.sort(function(obj1,obj2){return obj1[sortField]-obj2[sortField]})};FacetedNavigationModel.prototype.configureSecondaryFilters=function(){var self=this;var filtersLoaded=$.Deferred();var feed=this.primaryFeed;var filters=this.filters;var secondaryFilters=[];var endPoint;var i=0;secondaryFilters=filters.filter(function(item){return !item.primary&&item.configurable});var requestArr=[];for(i=0;i<secondaryFilters.length;i++){var filter=secondaryFilters[i];var feedName=filter.feedName;filter.checked=false;endPoint=feed+"/"+feedName+"?byHasCurrentVod=true";if(self.isAdultSection()){endPoint+="&includeAdult=true"}var options={type:"GET",timeout:30000};var request=new Request(endPoint,options);(function(request,filter){request.done(function(data){self.updateData(filter,data)});request.fail(function(data){log("FacetedNavifation:","Could not get filter data from OESP.");log("FacetedNavifation:",data)})})(request,filter);requestArr.push(request)}$.when.apply(self,requestArr).done(function(){filtersLoaded.resolve(filters)});return filtersLoaded.promise()};function FacetedNavigationView(elem,model,publisher){this.root=elem;this.$=$(elem);this.placeholder=this.$.find("#filters-placeholder");this.model=model;this.selectsTemplate=orion.templates.FiltersGrid;this.publisher=publisher;this.staticSection=this.$.find(".faceted-static-box");this.dynamicSection=this.$.find(".faceted-dynamic-box");this.selectClass=".faceted-filter";this.sectionType=this.model.get("sectionType");View.call(self,model);this._handlers();this.createLoader();return this}orion.util.inherits(FacetedNavigationView,View);FacetedNavigationView.prototype._handlers=function(){var self=this;this._onFilterChange=this._onFilterChange.bind(this);this.$.on("change",'[data-role="filter"]',this._onFilterChange);this.$.on("click",'[data-button-type="filter"]',function(evt){evt.preventDefault();window.history.pushState({},"",evt.currentTarget.href);self.publisher.trigger("FilterChangedWithModule")})};FacetedNavigationModel.prototype.adultProtected=function(onAdultVerifiedFunc,onCanceledFunc){var self=this;if(self.isAdultSection()){orion.oesp.session.done(function(session){if(session.isAuthenticated()&&session.isAdultPinVerified(true)){onAdultVerifiedFunc()}else{orion.util.AdultAdapter.showAdultDialogs(function(){onAdultVerifiedFunc()},function(){onCanceledFunc()})}})}else{onAdultVerifiedFunc()}};FacetedNavigationView.prototype._onFilterChange=function(evt){var self=this;var me=evt.currentTarget;var name=me.name.toLowerCase();var selected=me.options[me.selectedIndex];var selectedId=selected.value;var filter=this.model.getFilterByName(name);var isFilterPrimary=filter.primary;var query="";var model=this.model;var prevSelectedId=0;if(name==="category"){var activeItem=filter.data.filter(function(item){return item.active});if(activeItem.length){prevSelectedId=activeItem[0].id}}self.disableFilters();model.changeActiveInFilterData(filter,selectedId);model.adultProtected(function(){if(filter.primary){self.publisher.trigger("providerChanged",0);self.model.resetUrlParams()}if(filter.callback){if(model[filter.callback]){model[filter.callback](filter)}}if(!model.get("isFilterEverChanged")&&!window.CQ){self.setDynamicVisible()}self.publisher.trigger("facetedFilterChanged",isFilterPrimary);self.publisher.trigger("filtering")},function(){model.changeActiveInFilterData(filter,prevSelectedId);self._render();self.enableFilters()})};FacetedNavigationView.prototype.setDynamicVisible=function(){this.staticSection.hide();this.dynamicSection.fadeIn(1000);this.model.set("isFilterEverChanged",true,true)};FacetedNavigationView.prototype.setStaticVisible=function(){this.staticSection.fadeIn(1000);this.dynamicSection.hide()};FacetedNavigationView.prototype._render=function(){var filters=this.model.get("filters");filters={filters:filters};var partials={FilterItem:orion.templates.FilterItem};var template=$(Mustache.to_html(this.selectsTemplate,filters,partials));this.placeholder.empty();this.placeholder.html(template);this.$.find(this.selectClass).chosen({disable_search:true});this.$.trigger("loaded")};FacetedNavigationView.prototype.disableFilters=function(){var selects=this.$.find(this.selectClass);var filters=this.model.get("filters");selects.attr("disabled",true).trigger("chosen:updated");for(var i=0;i<filters.length;i++){filters[i].disabled=true}};FacetedNavigationView.prototype.enableFilters=function(){var selects=this.$.find(this.selectClass);var filters=this.model.get("filters");selects.removeAttr("disabled").trigger("chosen:updated");for(var i=0;i<filters.length;i++){filters[i].disabled=false}};FacetedNavigationView.prototype.createLoader=function(){var self=this;self.loader=self.$.loader({element:{overlay:"<div/>"},target:self.placeholder,flow:["overlay"]})};function FacetedNavigation(elem,publisher){this.$=$(elem);this.publisher=publisher;this.model=new FacetedNavigationModel(elem,publisher);this.view=new FacetedNavigationView(elem,this.model,publisher);this.bindEvents();this.initialize()}FacetedNavigation.prototype.bindEvents=function(){var self=this;window.onpopstate=function(event){self.publisher.trigger("filtering");self.update()};this.publisher.subscribe("ItemsBrowseRendered",this.view.enableFilters.bind(this.view));this.publisher.subscribe("FilterChangedWithModule",this.update.bind(this));this.publisher.subscribe("facetedFilterChanged",function(isFilterPrimary){if(isFilterPrimary){self.$.trigger("loading");self.model.getPrimaryFeed();var filtersConfigured=self.model.configureSecondaryFilters();filtersConfigured.done(function(){self.model.setFeedParams();self.view._render();window.history.pushState({},"",self.model.historyUrl);self.publisher.subscribe("ItemsBrowse.sortChanged",$.proxy(self.model.sortChanged,self.model))})}else{self.model.setFeedParams();window.history.pushState({},"",self.model.historyUrl);self.publisher.subscribe("ItemsBrowse.sortChanged",$.proxy(self.model.sortChanged,self.model))}})};FacetedNavigation.prototype.getDefaultDateValues=function(date){var days=[];var i18n=this.model.get("i18n");var now=new Date(date.setHours(0,0,0,0));var datesCount=this.$.data("dates-count")||10;var dayArrange=[+now,now.setDate(now.getDate()+1)-1];for(var i=0;i<datesCount;i++){var formatedDate=dayArrange.join("~");var formatedDateText=BBV.utils.date(dayArrange[0]).format("DDD DD MMM");var day={id:formatedDate,title:formatedDateText};if(i===0){day.title=i18n.today}else{if(i===1){day.title=i18n.yesterday}}days.push(day);now.setDate(now.getDate()-2);dayArrange=[+now,now.setDate(now.getDate()+1)-1]}return days};FacetedNavigation.prototype.initialize=function(){var self=this;this.$.trigger("loading");this.getInitialValues()};FacetedNavigation.prototype.update=function(){var self=this;this.buildUrlData();this.model.getPrimaryFeed();self.view._render();self.model.adultProtected(function(){orion.oesp.session.done(function(){var filtersConfigured=self.model.configureSecondaryFilters();filtersConfigured.done(function(filters){self.model.set("filters",filters,true);self.updateFiltersWithUrlData();self.view._render();self.model.setFeedParams();self.fireFiltersCallbacks()})})},function(){orion.oesp.session.done(function(){var primaryFilter=self.model.getFilterByName("category");self.model.changeActiveInFilterData(primaryFilter,0);self.model.getPrimaryFeed();var filtersConfigured=self.model.configureSecondaryFilters();filtersConfigured.done(function(filters){self.model.set("filters",filters,true);self.updateFiltersWithUrlData();self.view._render();self.model.setFeedParams();self.fireFiltersCallbacks()})})})};FacetedNavigation.prototype.buildUrlData=function(){var url={};if(document.location.search){url=BBV.utils.uri.builder(document.location.href);if(!this.model.isFilterEverChanged&&!window.CQ){this.view.setDynamicVisible()}}if(!this.model.isFilterEverChanged&&!window.CQ){this.view.setStaticVisible()}this.model.set("urlData",url,true);this.updateFiltersWithUrlData()};FacetedNavigation.prototype.updateFiltersWithUrlData=function(){var url=this.model.get("urlData");var filters=this.model.get("filters");var sectionType=this.model.get("sectionType");var CQconfigurableChanged=false;if(!url.params||!url.params.sort){this.model.sortStatus=0}else{this.model.sortStatus=url.params.sort}var selects=document.querySelectorAll('[data-role="change-view"]');for(var i=0;i<selects.length;i++){$(selects[i]).find("option").removeAttr("selected");$(selects[i]).find('[data-value="'+this.model.sortStatus+'"]').attr("selected","selected")}$(selects).trigger("chosen:updated");var $tabs=$('[data-role="tabs"]').find('[data-role="tab-container"]');$tabs.addClass("hidden");var value=selects[0].value;$tabs.filter("#"+value).removeClass("hidden");for(var feedParam in url.params){var filter=self.model.getFilterByFeedParam(feedParam);var id=url.params[feedParam];this.model.changeActiveInFilterData(filter,id);if(!filter.configurable){CQconfigurableChanged=true}}if(!CQconfigurableChanged){filter=self.model.getNoneConfigurableFilters()[0];id="0";this.model.changeActiveInFilterData(filter,id)}this.model.set("filters",filters,true)};FacetedNavigation.prototype.fireFiltersCallbacks=function(){var model=this.model;var filters=model.filters;for(var i=0;i<filters.length;i++){if(filters[i].callback){if(model[filters[i].callback]){model[filters[i].callback](filters[i])}}}};FacetedNavigation.prototype.getInitialValues=function(){var self=this;var filters=this.model.get("filters");var sectionType=this.model.get("sectionType");var i18n=this.model.get("i18n");if(sectionType==="catchup"){orion.oesp.timeEndpoint=orion.oesp.timeEndpoint||new orion.oesp.req.TimeEndpoint();var serverTime=orion.oesp.timeEndpoint.getTimeForRequest();serverTime.done(function(date){date=new Date(date);var days=self.getDefaultDateValues(date);var filterDate=self.model.getFilterByFeedParam("byLatestBroadcastStartTime");filters=self.model.getSecondaryFilters();if(!filterDate){filters.unshift({placeholder:i18n.fncontainerdate,name:"Date",disabled:false,feedName:"Date",feedParam:"byLatestBroadcastStartTime",primary:false,configurable:false,checked:false,data:days,isAdult:false})}self.model.set("filters",filters,true);self.update()})}else{this.model.set("filters",filters,true);this.update()}};return FacetedNavigation})(jQuery,orion.oesp.Request,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").ItemsBrowse=orion.modules.ItemsBrowse||(function($,MediaGroup,MediaItem,time){var viewstates={GRID:{template:"MediaGrid",size:7},LIST:{template:"MediaList",size:7}};var encode_=["#"],defaultParam=getHashFilter();function escapeCharacters(str_){var raw=str_,purity=raw;BBV.each(encode_,function(idx,itm){var regex=new RegExp(itm,"g");purity=purity.replace(regex,encodeURIComponent(itm))});return purity}function getHashFilter(){return""}function updatePreFilter(){return defaultParam=getHashFilter()}function mapPreFilter(char_){return(char_&&/[a-zA-Z]/.test(char_))?char_.toLowerCase():"pound"}function readUrlString(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}}function parseParam(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj}function parseCategory(cat_){var catIDs=cat_.split("=");var catID=catIDs[catIDs.length-1];var category=BBV.settings.i18n.genreMap[catID];return category.title}function parseCategoryID(param){var catID=parseParam(param).byCategoryIds?parseParam(param).byCategoryIds.split("=")[1]:null;return orion.util.url.fixedEncodeURIComponent(catID)}function filterAlphaList(content,filter_){var pattern=/byCollateChar=([\w\#])/i,char1=(filter_&&pattern.test(filter_))?pattern.exec(filter_)[1]:null,char2=(char1)?mapPreFilter(char1):null,t,$results=((t=content.$.find(".sort-"+char2)).length)?t:[];content.$.find(".content-list").hide();if($results.length){$results.show()}}function topInView(el){var windowTop=$(window).scrollTop();var windowBottom=windowTop+$(window).height();var elTop=el.offset().top;return(elTop>windowTop&&elTop<windowBottom)}function ItemsBrowseModel(c){var model=this;model.content=c;return model}ItemsBrowseModel.prototype.data=null;ItemsBrowseModel.prototype.datamedia=[];ItemsBrowseModel.prototype.update=function(data,q){var model=this;var content=model.content;model.mediaTemplate=new orion.util.MediaTemplate();model.data=data;var media=model.mediaTemplate.formatData(model.data,{isBrowse:true,i18n:content.i18n});model.datamedia=model.datamedia.concat(media);content.commonLoader.trigger("loaded");content.$.find(".loading-wrapper").remove();content.$.trigger("loaded");content.$.find(".loader-container").empty();model.content.view.notify([data,q])};function ItemsBrowseView(c){var view=this;view.notifications={};view.content=c;view.size=30;view.start=1;view.end=view.size;view.element=view.content.$.find(".content-list .results");view.isCatchupSectionEnabled=$(".navigation-bar").data("catchup-enabled")||false;view.currentview=(function(){var current=view.content.$.find(".view-toggle > li").has(".active").attr("class");if(current){return viewstates[current.toUpperCase()]}})();view.content.$.find(".no-results").hide();return view}ItemsBrowseView.prototype.collate=function(){var view=this;var model=view.content.model;var feed={};var cnt_=view.start-1;var media_=model.datamedia;var lngth_=model.datamedia.length;var $items;var char_;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];char_=mapPreFilter(itm.collateChar);feed[char_]=feed[char_]||[];feed[char_].push(itm)}BBV.each(feed,function(name,media){var sort;var $results;var html;sort=view.content.$.find(".sort-"+name).show();$results=sort.find(".results");$items=$results.find(".grid-view, .list-view").children("li");if(!$items.length){html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});$results.html(html)}else{var newMedia=[];for(var i=0;i<media.length;i++){var hasVal=false;$items.each(function(){var current=$(this);if(current.data("media-id")===media[i].id){hasVal=true}});if(!hasVal){newMedia.push(media[i])}}html=model.mediaTemplate.getMarkup(newMedia,{template:view.currentview.template,disabledHover:true,isItem:true});$items.closest(".grid-view, .list-view").append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)})});view.notify("rendered","collate")};ItemsBrowseView.prototype.sortByLetters=function(sortLetterLink){var content=this.content;var selectors=content.$.find(".media-item");var selector=content.$.find(".media-item:eq("+parseInt(selectors.length-1)+")");selector.off("inview");var paramName="byCollateChar";var $this,param="";if(sortLetterLink){$this=sortLetterLink;param=decodeURIComponent($this.data("collate-char")?paramName+"="+$this.data("collate-char"):"")}selectors.empty();content.$.find(".grid-view, .list-view").empty();param?content.controller.setParam(param):content.controller.removeParam(paramName);content.controller.load();filterAlphaList(content,param);content.$.find(".content-list .results, .loader-container").empty();content.commonLoader.trigger("loading");this.notify("count")};ItemsBrowseView.prototype.handlers=function(type){console.log("------ "+type);this.loader={};var publisher=orion.app;var view=this,content=view.content,defaultFilter=$('a[href*="'+defaultParam+'"]'),loader=this.loader;loader.opts={element:{append:"<div/>",insert:"<li/>"},elementClass:"grid-item",flow:["append","insert"],location:"inside",target:".content-list:visible .grid-view:last, .content-list:visible .list-view:last"};this.content.$.find(".sort-nav select").chosen({disable_search:true,width:"auto",minWidth:"100px"});content.$.loader(loader.opts);publisher.subscribe("itemsBrowseChangeView",function(currentview){var $root=content.$.find(".view-toggle");if(viewstates[currentview.toUpperCase()]!==view.currentview){view.currentview=viewstates[currentview.toUpperCase()];view.sortByLetters();var $this=$root.find("a").not(".active");$root.find(".active").removeClass("active");$this.addClass("active");view.notify("rendered")}});content.$.on("click",".view-toggle a",function(e){e.preventDefault();var currentview=$(this).context.parentNode.getAttribute("class");publisher.trigger("itemsBrowseChangeView",currentview);return false});if(defaultFilter.length&&!defaultFilter.hasClass("active")){content.$.find(".active").removeClass("active");defaultFilter.addClass("active");filterAlphaList(content,defaultParam)}view.subscribe("render",function(){var viewTypes={DEFAULT:"alpha",COLLATE:"collate",DATE:"date"};if(type===viewTypes.COLLATE){this.collate()}else{if(type===viewTypes.DATE){this.sort()}else{this.render()}}}).subscribe("count",function(a){var results=a[0],resultCount;if(results){resultCount=results.totalResults;view.content.$.find(".results-listed .count").text(resultCount);view.content.$.find(".results-listed").show()}}).subscribe("rendered",function(data){if($.isArray(data)){return}var selectors=content.$.find(".media-item");var selector=content.$.find(".media-item:not(.loading-wrapper)").last();var idx=selectors.index(selector)+1;content.$.off("inview",".content-list");selector.on("inview",function(e,isInView){if(view.end===idx&&view.end<view.content.model.data.totalResults&&isInView){view.scroll();selector.off("inview")}else{if(idx>=view.content.model.data.totalResults){selector.off("inview")}}});var publisher=orion.app;publisher.trigger("ItemsBrowseRendered")});content.$.on("click",".sort-by a",function(e){e.preventDefault();content.$.find(".no-results").hide();var paramName="byCollateChar";var $root=content.$.find(".sort-by"),$this=$(this),$href=decodeURIComponent($this.data("collate-char")?paramName+"="+$this.data("collate-char"):""),$active=$root.find(".active");if(!$this.hasClass("active")){view.resetRange();$active.removeClass("active");$this.addClass("active");view.sortByLetters($(this))}});var $sortFilter=$(".sort-filter");$sortFilter.on("chosen:showing_dropdown",function(){$(this).parents(".sort-nav").addClass("active")});$sortFilter.on("chosen:hiding_dropdown",function(){$(this).parents(".sort-nav").removeClass("active")});content.$.on("change",'[data-role="change-view"]',function(evt){var me=evt.currentTarget;var selected=me.options[me.selectedIndex];var id=selected.value;var url="?";var dataValue=me.options[me.selectedIndex].dataset.value;if(window.location.search){var ActiveFilters=BBV.utils.uri.toObject(window.location.href.split("?")[1])}var selects=document.querySelectorAll('[data-role="change-view"]');for(var i=0;i<selects.length;i++){if(selects[i].value!==id){selects[i].options[me.selectedIndex].selected="selected"}}var $tabs=$('[data-role="tabs"]').find('[data-role="tab-container"]');$tabs.addClass("hidden");$tabs.filter("#"+id).removeClass("hidden");if(ActiveFilters&&ActiveFilters.sort){delete ActiveFilters.sort}for(i in ActiveFilters){if(ActiveFilters.hasOwnProperty(i)){url=url+i+"="+ActiveFilters[i]+"&"}}orion.app.trigger("ItemsBrowse.sortChanged",dataValue);if(dataValue!=="0"){url=url+"sort="+dataValue}else{url=url.substring(0,url.length-1)}history.pushState(null,null,url);$(selects).trigger("chosen:updated")});content.$.find(".back-to-top a").live("click",function(){$("html, body").animate({scrollTop:0},"fast");return false});content.$.find("#subgenres .current").live("click",function(e){e.preventDefault()})};ItemsBrowseView.prototype.notify=function(name,data_){var view=this,data=(BBV.type(name)==="string")?data_||{}:name;if(BBV.type(name)==="string"){view.notifications[name].call(view,data);return}BBV.each(view.notifications,function(name,notification){notification.call(view,data)})};ItemsBrowseView.prototype.render=function(){var view=this;var model=view.content.model;var cnt_=view.start-1;var media=[];var media_=model.datamedia;var lngth_=model.datamedia.length;var $results=view.element;var $items=$results.find(".grid-view, .list-view");var html;for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];media.push(itm)}view.content.$.find(".content-list").show();if(media.length&&!$items.length){html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});$results.html(html)}else{html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true,isItem:true});$items.append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)});view.notify("rendered","alpha")};ItemsBrowseView.prototype.resetRange=function(){var view=this;view.start=1;view.end=view.size};ItemsBrowseView.prototype.sort=function(){var view=this;var content=view.content;var model=view.content.model;var range={};var timeframe_;var cnt_=view.start-1;var media_=model.datamedia;var lngth_=model.datamedia.length;var $results,$items,html;var nowOnServer=orion.oesp.timeEndpoint.getTime();nowOnServer.done(function(now){var startOfDay=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0);var startOfDayOffset=now.getTime()-startOfDay.getTime();var dateRange={today:{start:(function(){return Date.parse(now)-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},yesterday:{start:(function(){var less=1000*60*60*24*1;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},week:{start:(function(){var less=1000*60*60*24*6;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},month:{start:(function(){var less=1000*60*60*24*7*29;return Date.parse(now)-less-startOfDayOffset})(),end:(function(){return Date.parse(now)})()},within:function(date_){if(date_>=dateRange.today.start&&date_<=dateRange.today.end){return"today"}else{if(date_>=dateRange.yesterday.start&&date_<=dateRange.yesterday.end){return"yesterday"}else{if(date_>=dateRange.week.start&&date_<=dateRange.week.end){return"week"}else{if(date_>=dateRange.month.start&&date_<=dateRange.month.end){return"month"}else{return -1}}}}}};for(;cnt_<lngth_;cnt_++){var itm=media_[cnt_];var bucketParam;if(content.pathContext==="tv_recently-added"&&view.isCatchupSectionEnabled){bucketParam="lastChildAddedDate"}else{if(content.pathContext==="tv_recently-added"){bucketParam="latestBroadcastStartTime"}else{if(content.feedType&&content.feedType==="catchup"){bucketParam="latestBroadcastStartTime"}else{bucketParam="lastChildAddedDate"}}}timeframe_=dateRange.within(itm[bucketParam]);range[timeframe_]=range[timeframe_]||[];range[timeframe_].push(itm)}BBV.each(range,function(name,media){var sort=view.content.$.find(".sort-"+name).show();$results=sort.find(".results");$items=$results.find(".grid-view, .list-view");if(!$items.length){html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true});$results.html(html)}else{html=model.mediaTemplate.getMarkup(media,{template:view.currentview.template,disabledHover:true,isItem:true});$items.append(html)}orion.oesp.session.done(function(session){session.setModuleState($results)})});view.notify("rendered","sort")})};ItemsBrowseView.prototype.scroll=function(){var view=this,controller=view.content.controller;view.start=view.end+1;view.end=view.end+view.size;controller.update()};ItemsBrowseView.prototype.subscribe=function(name,fn){var view=this;view.notifications[name]=fn;return view};function ItemsBrowseController(c,url){var controller=this;controller.content=c;this.bindEvents();this.fetch(url);return controller}BBV.extend(ItemsBrowseController.prototype,{fetch:function(url){var controller=this;controller.feed=new BBV.feed(controller.content.$.attr("id"),{url:readUrlString(url).url,withoutCache:true,callback:function(query_){var selectedLetter=controller.content.$.find(".sort-by a[class='active']");var selectedLetterText=selectedLetter.data("collate-char")?selectedLetter.data("collate-char").toLowerCase():"";if(!selectedLetterText&&selectedLetter.attr("data-collate-char")===""){selectedLetterText="all"}controller.content.model.update(this.data,query_);var noResults=controller.content.$.find(".no-results");if(!this.data||this.data.totalResults<=0){noResults.show();controller.content.$.find(".sort-"+selectedLetterText).show()}else{noResults.hide()}},error:function(jqXHR,textStatus,errorThrown){window.setTimeout(function(){controller.feed.update()},0);log("ItemsBrowseController.feed.error\n -> jqXHR: ",jqXHR)}})},bindEvents:function(){var publisher=orion.app;var self=this;publisher.subscribe("filtering",function(){self.content.$.find(".loader-container").empty();self.content.$.find(".content-list").hide();self.content.commonLoader.trigger("loading")});publisher.subscribe("ItemsFeedReady",function(feed){var url=self.content.$.attr("data-module-feed-url");var selectedLetter=self.content.$.find(".sort-by a[class='active']");var paramName="byCollateChar";var param=decodeURIComponent(selectedLetter.data("collate-char")?paramName+"="+selectedLetter.data("collate-char"):"");self.content.$.find(".grid-view, .list-view").empty();self.content.appliedFilters={default_:readUrlString(url).query,params:{}};self.setParam(readUrlString(feed).query);if(param){self.setParam(param)}else{self.removeParam(paramName)}self.content.$.find(".content-list").hide();self.content.view.size=30;self.content.view.start=1;self.content.view.end=self.content.view.size;self.fetch(feed);self.load()})},clearParams:function(){var controller=this,content=controller.content;content.appliedFilters.params={};return controller},removeParam:function(param_){var controller=this,content=controller.content;BBV.each(content.appliedFilters.params,function(name,value){if(name===param_){delete content.appliedFilters.params[name]}});return controller},serializeParams:function(){var controller=this,qs=[];if(controller.content.appliedFilters.default_){qs.push(controller.content.appliedFilters.default_)}BBV.each(controller.content.appliedFilters.params,function(name,val){qs.push(val)});controller.feed.settings.data=escapeCharacters(qs.join("&"))},setParam:function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.extend(content.appliedFilters.params,param);return controller},load:function(){var controller=this,model=controller.content.model;model.datamedia=[];controller.update()},update:function(){var controller=this;var content=controller.content;var view=content.view;var category=view.category?view.category:parseCategoryID(defaultParam)||null;var nowOnServer=orion.oesp.timeEndpoint.getTime();nowOnServer.done(function(now){var dateTime=time.roundDate(now,"floor",5);orion.oesp.session.done(function(session){if(session.isAdultPinVerified(true)&&BBV.settings.i18n.genreMap[category]&&BBV.settings.i18n.genreMap[category].isAdult){controller.setParam("includeAdult=true")}if(content.feedType&&content.feedType==="catchup"&&(content.pathContext!=="tv_recently-added"||(content.pathContext==="tv_recently-added"&&!view.isCatchupSectionEnabled))){controller.setParam("byLatestBroadcastStartTime=~"+dateTime)}controller.setParam("range="+view.start+"-"+view.end);controller.serializeParams();controller.feed.update();content.$.trigger("loading")})})},setSubGenres:function(){var defaultParam=getHashFilter(),category=parseCategoryID(defaultParam),medium=$("ul.subnavigation",".subnav-wrapper").data("medium"),topCategory,subCategory="";$("#subgenres").hide().find("li").remove();if(BBV.settings.i18n.genreMap[category]){if(BBV.settings.i18n.genreMap[category].parentId=="null"){$("#subgenres .current").html('<a href="#">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[category].title+"</a>");topCategory='<li><a href="#byCategoryIds='+category+'">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[category].title+"</a></li>";$.each(BBV.settings.i18n.genreMap,function(index,genre){if(category==genre.parentId&&genre.mediaItemCounts[medium]){subCategory+='<li><a href="#byCategoryIds='+index+'">'+genre.title+"</a></li>"}})}else{$("#subgenres .current").html('<a href="#">'+BBV.settings.i18n.genreMap[category].title+"</a>");topCategory='<li><a href="#byCategoryIds='+BBV.settings.i18n.genreMap[category].parentId+'">'+orioni18n.contentBrowse.alltextSingular+" "+BBV.settings.i18n.genreMap[BBV.settings.i18n.genreMap[category].parentId].title+"</a></li>";$.each(BBV.settings.i18n.genreMap,function(index,genre){if((category==index||BBV.settings.i18n.genreMap[category].parentId==genre.parentId)&&genre.mediaItemCounts[medium]){subCategory+='<li><a href="#byCategoryIds='+index+'">'+genre.title+"</a></li>"}})}if(subCategory.length){var $ul=$("#subgenres ul").length?$("#subgenres ul"):$("<ul></ul>").appendTo("#subgenres");$ul.append(topCategory).append(subCategory);$("#subgenres").show()}}}});function ItemsBrowse(elem,publisher){orion.oesp.timeEndpoint=orion.oesp.timeEndpoint||new orion.oesp.req.TimeEndpoint();var self=this;var id,url,sortType,controller;self.root=elem;self.$=$(elem);self.i18n=orioni18n.itemsBrowse;id=self.$.attr("id");url=self.$.attr("data-module-feed-url");self.sortType=sortType=self.$.data("module-sort-type");self.pathContext=self.$.data("module-path-context");self.feedType=self.$.data("module-feed-type")==="feedtype"?"":self.$.data("module-feed-type");self.model=new ItemsBrowseModel(self);self.view=new ItemsBrowseView(self);self.controller=controller=new ItemsBrowseController(self,url);self.appliedFilters={default_:readUrlString(url).query,params:{}};if(defaultParam){if(defaultParam.indexOf("?")>=0){defaultParam=defaultParam.split("?")[0]}controller.setParam(defaultParam);var category=parseCategoryID(defaultParam);if(defaultParam.indexOf("byCategoryIds")>-1){self.$.find("#genre-category").append(" - "+parseCategory(BBV.settings.i18n.genreMap[category].parentId=="null"?defaultParam:BBV.settings.i18n.genreMap[category].parentId));$("#nav-genre",".subnav-wrapper").text(parseCategory(BBV.settings.i18n.genreMap[category].parentId=="null"?defaultParam:BBV.settings.i18n.genreMap[category].parentId))}}self.createCommonLoader();self.bindEvents(sortType);if(!controller.feed.url){return}controller.load()}BBV.extend(ItemsBrowse.prototype,{bindEvents:function(sortType){this.view.handlers(sortType)},createCommonLoader:function(){this.commonLoader=this.$.find(".loader-container").loader({flow:["append"]})}});return ItemsBrowse})(jQuery,orion.oesp.res.MediaGroup,orion.oesp.res.MediaItem,orion.util.time);
BBV.namespace("orion.modules").EPG=orion.modules.EPG||(function($,time){function _getHash(){return BBV.utils.uri.toObject(window.location.hash.substr(1))}var defaultHash=_getHash();var defaultGenreFilter=null;var keyTime={totalWidth:749,borderWidth:2};var timeFrameInHours=2.5;keyTime.minutesWidth=(keyTime.totalWidth/timeFrameInHours/60);function EPG(elem,publisher){this.templateHelperMethods=orion.modules.EPG.TemplateHelperMethods;this.publisher=publisher;this.$=$(elem);this.i18n=orioni18n.EPG;this.availableReplayWindow=(BBV.settings.backwardsEPGEnabled&&parseInt(this.$.attr("data-module-replay-window"),10))||0;this.availableForwardsWindow=(parseInt(this.$.attr("data-module-future-window"),10)||0)+1;this.manualMode=false;this.channelsContainer=this.$.find(".grid-container");var loaderHeight=this.$.find(".channel-guide-wrap").height();loaderHeight=loaderHeight>600?loaderHeight:600;this.$.loader({elementClass:"grid-loading",flow:["overlay"],minheight:loaderHeight,minwidth:923,target:".channel-guide-wrap",img:{top:"250px"}});this.now=orion.oesp.timeEndpoint.getTimeFromNow();this.timeView=new orion.modules.EPG.TimeView(elem,publisher,this);var startDate=new Date(this.now);startDate.setDate(startDate.getDate()-this.availableReplayWindow);this.timeView.setupDateRange(this.templateHelperMethods.parseDateToStart(startDate.getTime()),parseInt(this.availableReplayWindow,10)+this.availableForwardsWindow,this.now);this.listingsView=new orion.modules.EPG.ListingsView(elem,publisher);this.RemoteBookings=new orion.modules.EPG.RemoteBookings(publisher);this.RemoteBookings.initialize();this.bindHandlers();this.hashChange()}EPG.prototype.bindHandlers=function(){this.publisher.subscribe("TimeView.goNext",$.proxy(this.onNewTimeGo,this,timeFrameInHours));this.publisher.subscribe("TimeView.goPrevious",$.proxy(this.onNewTimeGo,this,-timeFrameInHours));this.publisher.subscribe("TimeView.goNow",$.proxy(this.onNewTimeGo,this));this.publisher.subscribe("EPG.startListingsRendering",$.proxy(this.goToDate,this));$("#nav-genre").next().on("click",".nav-item a",$.proxy(this.onGenreChanged,this));$(".date-select .select").on("click","a.calendday",$.proxy(this.calendarHandler,this));this.RemoteBookings.delegate(".channel-guide",[".program-details-wrap .user-functionality .btn-record","#dvr-settings-link"]);this.RemoteBookings.delegate(".user-options",["#dvr-settings-link"]);setInterval($.proxy(this.makeTick,this),60000);$(window).bind("hashchange",$.proxy(this.hashChange,this));this.publisher.subscribe("loggedIn",$.proxy(this.getListings,this,0));this.publisher.subscribe("loggedIn",orion.services.LinearDataService.clearCache)};EPG.prototype.goToDate=function(){var date=orion.oesp.timeEndpoint.getTimeFromNow();this.timeView.goToDate(this.currentTimeSetId,true,date)};EPG.prototype.onGenreChanged=function(e){e.preventDefault();var category=$(e.target).parent().data("categoryid")||null;defaultHash=_getHash();if(defaultGenreFilter==category){category=null}if(category){defaultHash.byCategoryIds=category}else{delete defaultHash.byCategoryIds}if(defaultGenreFilter!==category){this.buildUrl()}};EPG.prototype.calendarHandler=function(e){e.preventDefault();var value=parseInt($(e.target).data("value"),10);this.currentTimeSetId=time.roundTo30Minutes(new Date(this.now)).getTime();if(value){this.onNewTimeGo(value*24)}else{this.currentTimeSetId=0;this.onNewTimeGo()}};EPG.prototype.makeTick=function(){var now=orion.oesp.timeEndpoint.getTimeFromNow();this.now=now;var start=this.currentTimeSetId;var stop=new Date(this.currentTimeSetId);stop=time.addTime(stop,2.5,"hours").getTime();if(!this.manualMode&&now>stop){this.timeView.onNext()}else{this.timeView.setCurrentTime(start,now)}};EPG.prototype.hashChange=function(){defaultHash=_getHash();var start=parseInt(defaultHash.startDate,10);var genreKey=defaultHash.byCategoryIds||null;var date=orion.oesp.timeEndpoint.getTimeFromNow();var timeFlag=false;switch(true){case (genreKey==defaultGenreFilter&&isNaN(start)):start=new Date(date-time.timeFrameInMilliseconds(Math.floor(timeFrameInHours/2),"hours"));this.manualMode=false;timeFlag=true;break;default:timeFlag=true;if(isNaN(start)){start=new Date(date-time.timeFrameInMilliseconds(Math.floor(timeFrameInHours/2),"hours"))}start=new Date(start);break}if(genreKey!=defaultGenreFilter){defaultGenreFilter=genreKey;this.updateGenre(genreKey)}if(timeFlag){start=time.roundTo30Minutes(start).getTime();if(this.manualMode){start=this.checkForDate(start)}if(start){this.currentTimeSetId=start;this.getListings()}else{this.cancelHashChange()}}};EPG.prototype.cancelHashChange=function(){delete defaultHash.startDate;this.buildUrl()};EPG.prototype.checkForDate=function(date){var backwardDays=-this.availableReplayWindow-timeFrameInHours/24/2;var forwardDays=this.availableForwardsWindow-1+timeFrameInHours/24;var current=date||this.currentTimeSetId;var days=(current-this.now)/1000/60/60/24;switch(true){case (days<0&&Math.abs(days)<timeFrameInHours/24):return 1;break;case ((days>0)&&(days<=forwardDays)||(days<0)&&(days-backwardDays>=0)):return date;break;default:return false;break}};EPG.prototype.checkForNow=function(date){var now=(date||this.currentTimeSetId)+time.timeFrameInMilliseconds(Math.floor(timeFrameInHours/2),"hours");return now!=time.roundTo30Minutes(new Date(orion.oesp.timeEndpoint.getTimeFromNow())).getTime()};EPG.prototype.onNewTimeGo=function(hours){this.manualMode=true;defaultHash=_getHash();if(hours){var newDate=time.addTime(new Date(this.currentTimeSetId),hours,"hours");var flag=this.checkForDate(+newDate);if(flag>1){defaultHash.startDate=+newDate;this.buildUrl()}else{if(flag===1){delete defaultHash.startDate;this.buildUrl()}}}else{if(this.checkForNow()){delete defaultHash.startDate;this.buildUrl()}}};EPG.prototype.updateGenre=function(genreId){this.publisher.trigger("EPG.genreChanged",genreId)};EPG.prototype.getListings=function(iteration){var start=this.currentTimeSetId-time.timeFrameInMilliseconds(orion.oesp.timeEndpoint.offset,"minutes");var end=start+time.timeFrameInMilliseconds(timeFrameInHours,"hours");iteration=(iteration||0)+1;if(iteration==1){this.$.trigger("loading");this.publisher.trigger("EPG.resetCategories");this.channelsContainer.find(".listings > ol").empty()}if(iteration<3){orion.services.LinearDataService.getDataListings(start,end).done($.proxy(this.listingsDone,this)).fail($.proxy(this.getListings,this,iteration))}else{this.$.trigger("loaded")}};EPG.prototype.listingsDone=function(channels){var epg=this;orion.oesp.session.withSession(function(session){epg.completeListings(channels.channels,session);epg.listingsView.renderListings(channels.channels);epg.publisher.trigger("EPG.startListingsRendering")})};EPG.prototype.completeListings=function(channels,session){for(var i=0;i<channels.length;i++){var genres=[];this.completeChannel(channels[i],orion.modules.EPG.TemplateHelperMethods.channels);if(!channels[i].listings){channels[i].listings=[{}]}for(var j=0;j<channels[i].listings.length;j++){var listing=channels[i].listings[j];if(listing.categoryId){genres=genres.concat(listing.categoryId.split(" "))}this.setWidth(listing);this.extendListing(listing,channels[i].station,session)}this.publisher.trigger("EPG.updateCategories",genres)}};EPG.prototype.extendListing=function(listing,station,session){if(!listing.title){listing.title=orioni18n.EPG.TBA}listing.channelIsEntitled=(session.hasEntitlement(station.entitlements)&&session.isAuthenticated());listing.rbIsEntitled=(session.hasRbEntitlement(station.entitlements)&&session.isAuthenticated());listing.replayTv=listing.replayTv&&session.customer.replayTvAvailable;listing.channelOrRbIsEntitled=listing.channelIsEntitled||listing.rbIsEntitled;listing.stationId=station.id};EPG.prototype.completeChannel=function(channel,tool){channel.channelNumber=tool.formatChannel(channel.channelNumber);channel.station=channel.getStation();channel.URL=tool.getUrl({id:channel.station.id,title:channel.station.title,hasLiveStream:channel.hasLiveStream,hasHSSStream:tool.hasHSSStream(channel)});channel.images=tool.getImages(channel.station.images);channel.isLive=tool.isLive(channel);channel.isOOH=channel.station.isOutOfHomeEnabled;channel.i18n=this.i18n};EPG.prototype.setWidth=function(listing){var frameStart=this.currentTimeSetId-time.timeFrameInMilliseconds(orion.oesp.timeEndpoint.offset,"minutes");var frameEnd=frameStart+time.timeFrameInMilliseconds(timeFrameInHours,"hours");var listingStart=((listing.startTime<frameStart)?frameStart:listing.startTime)||frameStart;var listingEnd=((listing.endTime>frameEnd)?frameEnd:listing.endTime)||frameEnd;var durationMinutes=(listingEnd-listingStart)/1000/60;listing.width=Math.floor(durationMinutes*keyTime.minutesWidth-keyTime.borderWidth/2);if(listing.width<0){listing.width=0}if(listing.width<10){listing["short"]=true}};EPG.prototype.buildUrl=function(){if(!defaultHash.byCategoryIds&&!defaultHash.startDate){history.pushState(null,null,window.location.href.split("#")[0]);$(window).trigger("hashchange")}else{var url=[];if(defaultHash.startDate){url.push("startDate="+defaultHash.startDate)}if(defaultHash.byCategoryIds){url.push("byCategoryIds="+defaultHash.byCategoryIds)}window.location.href=window.location.href.split("#")[0]+"#"+url.join("&")}};EPG.keyTime=keyTime;EPG.timeFrameInHours=timeFrameInHours;return EPG})(jQuery,orion.util.time);
BBV.namespace("orion.modules").MyChannelsLineUp=orion.modules.MyChannelsLineUp||(function($){function MyChannelsLineUp(elem,publisher){this.channels=[];this.excluded=[];this.publisher=publisher;this.$=$(elem);this.$leftColumn=this.$.find(".left_column");this.$rightColumn=this.$.find(".right_column");this.$lineup=this.$.find("#channel_lineup");this.$excluded=this.$.find("#excluded_channels");this.init();this.addHandlers()}MyChannelsLineUp.prototype.init=function(){var self=this;orion.oesp.session.withSession(function(session){if(!session.isAuthenticated()){self.$leftColumn.hide();self.$rightColumn.hide();self.$.find(".logout_message").show()}else{orion.oesp.channelEndpoint.requestChannels({includeInvisible:true}).done(function(data){self.$.find(".logout_message").hide();self.$leftColumn.show();self.$rightColumn.show();for(var i=0;i<data.entryCount;i++){if(data.channels[i].visible==true){self.channels.push(new ChannelPresentation(data.channels[i]))}else{self.excluded.push(new ChannelPresentation(data.channels[i]))}}self.render()})}})};MyChannelsLineUp.prototype.render=function(){this.$lineup.html(Mustache.to_html(orion.templates.MyChannelsLineUp,{visible:this.channels}));this.$excluded.html(Mustache.to_html(orion.templates.MyChannelsLineUp,{excluded:this.excluded}));this.correctionsForWarnings()};MyChannelsLineUp.prototype.destroy=function(){$(".lineup_button.exclude").off("click");$(".lineup_button.reset").off("click")};MyChannelsLineUp.prototype.addHandlers=function(){$("#channel_lineup, #excluded_channels").sortable({beforeStop:$.proxy(this.dragEnd,this),connectWith:".connectedSortable"}).disableSelection();$(".lineup_button.exclude").on("click",$.proxy(this.excludeAll,this));$(".lineup_button.reset").on("click",$.proxy(this.resetDefault,this))};MyChannelsLineUp.prototype.resetDefault=function(event){if(!$(event.target).hasClass("disabled")){this.dialog=orion.app.dialogManager.getDialog("reset_default_lineup");this.dialog.setHtmlContent($(".restore_default_confirmation").html());var self=this;this.dialog.setDialogType("device");this.dialog.$.css("position","fixed");this.dialog.show();this.dialog.centerOn(window);$(".dialog.device").delegate("a.confirm","click",function(){self.dialog.hide();var channels=self.excluded;channels.unshift(self.channels.length,0);Array.prototype.splice.apply(self.channels,channels);self.excluded.length=0;self.channels.sort(self.sort);self.render();self.saveWithOesp()})}};MyChannelsLineUp.prototype.sort=function(a,b){return a.channelNumber-b.channelNumber};MyChannelsLineUp.prototype.excludeAll=function(event){if(!$(event.target).hasClass("disabled")){var channels=this.channels;channels.unshift(this.excluded.length,0);Array.prototype.splice.apply(this.excluded,channels);this.channels.length=0;this.render();this.saveWithOesp()}};MyChannelsLineUp.prototype.dragEnd=function(event,ui){var item=ui.item,movedTo=this.excluded,from=this.channels,curr=false;if(item.closest("ul").attr("id")=="channel_lineup"){movedTo=this.channels;from=this.excluded}for(var i=0;i<from.length;i++){if(from[i].serviceId==item.data("id")){curr=from.splice(i,1);movedTo.splice(item.index(),0,curr[0])}}if(!curr){for(i=0;i<movedTo.length;i++){if(movedTo[i].serviceId==item.data("id")){curr=movedTo.splice(i,1);movedTo.splice(item.index(),0,curr[0])}}}this.correctionsForWarnings();this.saveWithOesp()};MyChannelsLineUp.prototype.correctionsForWarnings=function(){if(this.channels.length==0){this.$leftColumn.find(".lineup_button").addClass("disabled");this.$leftColumn.find(".warning").addClass("the_only")}else{this.$leftColumn.find(".lineup_button").removeClass("disabled");this.$leftColumn.find(".warning").removeClass("the_only")}if(this.excluded.length==0){this.$rightColumn.find(".lineup_button").addClass("disabled")}else{this.$rightColumn.find(".lineup_button").removeClass("disabled")}var maxElem=Math.max(this.channels.length,this.excluded.length);this.$lineup.height(66*maxElem);this.$excluded.height(66*maxElem);this.$leftColumn.find(".warning").css("marginTop",(this.channels.length-maxElem)*66);this.$rightColumn.find(".warning").css("marginTop",(this.excluded.length-maxElem)*66)};MyChannelsLineUp.prototype.saveWithOesp=function(){var data={stations:[]};for(var i=0;i<this.channels.length;i++){data.stations.push({serviceId:this.channels[i].serviceId,sortOrder:i,visible:true})}for(i=0;i<this.excluded.length;i++){data.stations.push({serviceId:this.excluded[i].serviceId,sortOrder:0,visible:false})}orion.oesp.profileEndpoint.setChannelsLineup(data);sessionStorage.clear()};function ChannelPresentation(channel){var station=channel.getStation();this.serviceId=station.serviceId;this.title=station.title;this.visible=channel.visible;this.icon=channel.getImageByAssetType("station-logo-medium");this.channelNumber=channel.channelNumber}return MyChannelsLineUp})(jQuery);
BBV.namespace("orion.modules").PinManagement=orion.modules.PinManagement||(function($){var viewstates={UNVERIFIED:{elem:$("#first-time"),form:$(".pw-form").find(".field, .submit")},VERIFIED:{elem:$("#controls-enabled")}};function PinManagement(elem,publisher){var model,view;var self=this;self.publisher=publisher;self.elem=elem;self.$=$(elem);self.MESSAGES=orioni18n.pinManagement;self.$slider=$("#slider");self.ratingGroups=orion.util.oesp.get(orion.oesp.routes.ratinggroups);orion.oesp.session.done(function(session){if(session.isAuthenticated()){self.parentalPinVerified=session.parentalPinVerified;self.profileCredentialVerified=session.profileCredentialVerified;self.profileSettings=session.profileSettings;self.init()}});return self}PinManagement.prototype.init=function(){var self=this;self.ratingGroups.done(function(response){self.ratings=response.ratingGroups;self.setRatings();self.handlers();self.buildSlider();self.buildRatings();self.showView()})};PinManagement.prototype.handlers=function(){var self=this;self.$.delegate(".pw-form","submit",function(e){e.stopPropagation();e.preventDefault();self.verifyPw(this)});self.$.delegate(".pin-form .default a","click",function(e){e.preventDefault();self.showChangePin()});self.$.delegate(".pin-form .change a","click",function(e){e.preventDefault();self.resetAndHideChangePin()});$(document).find(".pin-settings").find("input").keydown(function(e){self.setPinFocus(this,e)});self.$.delegate(".pin-form","submit",function(e){e.stopPropagation();e.preventDefault();if($("button:disabled",e.target).length==0){self.setDisabled($("button",e.target),true);self.updatePin(this)}});self.$.delegate(".content-form","submit",function(e){e.preventDefault();self.updateParentalSettings()})};PinManagement.prototype.showView=function(){var self=this;var $container,credentialStatus;if(self.profileCredentialVerified){viewstates.VERIFIED.elem.show()}else{$container=viewstates.UNVERIFIED.elem.find(".pw-settings");credentialStatus=orion.oesp.profileEndpoint.getCredentialStatus("password");credentialStatus.done(function(status){if(status.isLocked){self.verifyPwError($container,orioni18n.navigationBar.pwlockederror+"<br />"+orioni18n.navigationBar.pinlockedbody.replace("{{timeoutRemaining}}",status.minutesRemaining));viewstates.UNVERIFIED.form.hide()}viewstates.UNVERIFIED.elem.show()})}};PinManagement.prototype.verifyPw=function(form){var self=this;var $container=$(form).find(".pw-settings");var pw=form.pw.value;var verifyProfileCredential=orion.oesp.profileEndpoint.verifyProfileCredential(pw);var defaultLockoutDuration=BBV.settings.pin.defaultLockoutDuration;if(pw){verifyProfileCredential.done(function(data){self.verifyPwSuccess($container)}).fail(function(error){var err=JSON.parse(error.responseText)[0];if(err.reason==="prohibited"){self.verifyPwError($container,orioni18n.navigationBar.pwlockederror+"<br />"+orioni18n.navigationBar.pinlockedbody.replace("{{timeoutRemaining}}",defaultLockoutDuration));viewstates.UNVERIFIED.form.hide()}else{self.verifyPwError($container,orioni18n.navigationBar.invalidpw)}})}else{self.verifyPwError($container)}};PinManagement.prototype.verifyPwSuccess=function(container){var $container=container;viewstates.UNVERIFIED.elem.hide();viewstates.VERIFIED.elem.show();$container.find('[name="pw"]').val("")};PinManagement.prototype.verifyPwError=function(container,message){var self=this;var $container=container;message=message||self.MESSAGES.invalidpassword;$container.find(".confirmation").hide().empty();$container.find("input").val("").eq(0).focus();$container.find(".error").show().html(message)};PinManagement.prototype.setRatings=function(){var self=this;self.parentalRatings=self.profileSettings.parentalSettings.unrestrictedContentRatingCodes;self.ratingsVisible=[];self.parentalRatingsVisible=[];$.each(self.ratings,function(index,rating){if(rating.visible){self.ratingsVisible.push(rating);if($.inArray(rating.ratings[0].rating,self.parentalRatings)>-1){self.parentalRatingsVisible.push(rating.ratings[0].rating)}}})};PinManagement.prototype.buildSlider=function(){var self=this;var $pinRequiredLabel=$("#parental-labels .pin-required");var $allowedLabel=$("#parental-labels .allowed");var defaultPosition=100*(self.parentalRatingsVisible.length/self.ratingsVisible.length);if(self.parentalRatingsVisible.length===self.ratingsVisible.length){$pinRequiredLabel.hide()}$("#slider").data("ratings",self.parentalRatings);self.$slider.slider({range:"min",value:self.parentalRatingsVisible.length,min:0,max:self.ratingsVisible.length-1,step:1,change:function(event,ui){var $selected=$(self.$ratingsList.find("li").get(ui.value));var ordinal=$selected.data("ordinal");var parentalRatingsChanged=[];if(ui.value===0){$allowedLabel.hide()}else{$allowedLabel.show()}if(ui.value>=(self.ratingsVisible.length-1)){$pinRequiredLabel.hide()}else{$pinRequiredLabel.show().css({left:($(ui.handle).position().left+"px")})}viewstates.VERIFIED.elem.find(".confirmation").hide();$.each(self.ratings,function(index,rating){if(rating.ordinal<ordinal){$.each(rating.ratings,function(id,innerRating){parentalRatingsChanged.push(innerRating.rating)})}});$("#slider").data("ratings",parentalRatingsChanged)}});if(defaultPosition===0){$allowedLabel.hide()}$pinRequiredLabel.css({left:defaultPosition+"%"})};PinManagement.prototype.buildRatings=function(){var self=this;self.$ratingsList=$("<ul>");$.each(self.ratingsVisible,function(index,rating){var localizedKey="rating"+rating.name.toUpperCase();var localizedString=self.MESSAGES[localizedKey]||rating.name;self.$ratingsList.append('<li data-role="slide" title="'+localizedString+'" data-ordinal="'+rating.ordinal+'">'+localizedString+"</li>")});self.$ratingsList.insertAfter(self.$slider);self.$ratingsList.on("click","[data-role='slide']",function(){var index=self.$ratingsList.find("[data-role='slide']").index(this);self.$slider.slider("value",index)});self.resizeSlider()};PinManagement.prototype.resizeSlider=function(){var self=this;var $container=self.$slider.closest("fieldset");var itemIndent=13;var itemWidth=Math.floor(self.$slider.width()/(self.ratingsVisible.length-1))-itemIndent;$container.width(self.$slider.width()+itemWidth+itemIndent);$container.find("li").css({width:itemWidth,"padding-left":itemIndent})};PinManagement.prototype.updateParentalSettings=function(){var self=this;var parentalSettings={unrestrictedContentRatingCodes:$("#slider").data("ratings"),isDefault:false};var setParentalSettings=orion.oesp.profileEndpoint.setParentalSettings(parentalSettings);setParentalSettings.done(function(data){viewstates.VERIFIED.elem.find(".content-form .confirmation").show().html(self.MESSAGES.settingsSaved)})};PinManagement.prototype.showChangePin=function(){$(".default").hide();viewstates.VERIFIED.elem.find(".confirmation").hide();$(".change").show()};PinManagement.prototype.resetAndHideChangePin=function(){$(".old-pin input").get(0).focus();$(".change").hide();$(".default").show();$(".error").empty().hide();$(".old-pin,.new-pin").removeClass("invalid").children("input").attr("value","")};PinManagement.prototype.setPinFocus=function(field,event){var BACKSPACE=8;var TAB=9;var DELETE=46;var ENTER=13;var $field=$(field);var siblings=$field.siblings();var pinValue="";var str=$field.attr("name");siblings.each(function(){pinValue+=$(field).val()});if(!(event.keyCode===DELETE||event.keyCode===BACKSPACE||event.keyCode===TAB||event.keyCode===ENTER)){event.preventDefault();if((event.keyCode>=48&&event.keyCode<=57)||(event.keyCode>=96&&event.keyCode<=105)){$field.attr("value",String.fromCharCode(event.keyCode>=96?event.keyCode-48:event.keyCode));if(!(parseInt(str.substring(str.length-1))===4)){$field.next().focus()}}}else{if(event.keyCode===BACKSPACE&&siblings.index($field)!==0){event.preventDefault();$field.val("").prev().focus()}}};PinManagement.prototype.updatePin=function(form){var self=this;var $container=$(form).find(".pin-settings");var oldPin=form.oldPin1.value+form.oldPin2.value+form.oldPin3.value+form.oldPin4.value;var newPin=form.newPin1.value+form.newPin2.value+form.newPin3.value+form.newPin4.value;var verifyParentalPin=orion.oesp.profileEndpoint.verifyParentalPin(oldPin);if(newPin&&newPin.length==4){verifyParentalPin.done(function(){self.verifyPinSuccess($container,newPin)}).fail(function(){self.verifyPinError($container)})}else{self.changePinError($container)}};PinManagement.prototype.verifyPinSuccess=function(container,newPin){var self=this;var $container=container;var setParentalPin=orion.oesp.profileEndpoint.setParentalPin(newPin);if(newPin){setParentalPin.done(function(){self.changePinSuccess(newPin)})}else{$container.removeClass("invalid-old");self.setDisabled($(".pin-form button"),false)}};PinManagement.prototype.verifyPinError=function(container){var self=this;var $container=container;var $oldPin=$container.find(".old-pin");var $newPin=$container.find(".new-pin");$oldPin.addClass("invalid");$oldPin.find("input").val("").eq(0).focus();$newPin.removeClass("invalid");$container.find(".confirmation").hide().empty();$container.find(".error").show().html(self.MESSAGES.invalidOldPin);self.setDisabled($(".pin-form button"),false)};PinManagement.prototype.changePinSuccess=function(newPin){var self=this;self.resetAndHideChangePin();viewstates.VERIFIED.elem.find(".pin-form .confirmation").show().html(self.MESSAGES.pinChanged);self.setDisabled($(".pin-form button"),false)};PinManagement.prototype.changePinError=function(){var self=this;viewstates.VERIFIED.elem.find(".old-pin").removeClass("invalid").end().find(".new-pin").addClass("invalid");viewstates.VERIFIED.elem.find(".error").show().html(self.MESSAGES.invalidNewPin);self.setDisabled($(".pin-form button"),false)};PinManagement.prototype.setDisabled=function(elem,disabled){if(disabled){elem.attr("disabled","disabled")}else{elem.removeAttr("disabled")}};return PinManagement})(jQuery);
BBV.namespace("orion.modules").VideoPlayer=orion.modules.VideoPlayer||(function($,Model,View){function VideoPlayerModel(){var self=this;Model.call(this);self.flashVars={autoplay:false};self.params={};self.attributes={}}orion.util.inherits(VideoPlayerModel,Model);function VideoPlayerView(elem,model,publisher){var self=this;var playerType;View.call(self,model);self.$=$(elem);orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.isAuthenticated=true;self.$.removeClass("video-player-signed-out");log("VIDEOPLAYER:IS AUTHENTICATED")}});if($(".subnav-wrapper").length>0){$("#backgrounds-div-container").addClass("sub-nav-gap");$(".video-player-module").addClass("sub-nav-gap")}self.background=$("#backgrounds-div");self.background.removeClass().addClass("vod-bg").hide();self.publisher=publisher;self.playerScreen=self.$.find(".video-player");self.playerScreenShowCSS={width:self.playerScreen.width(),height:self.playerScreen.height(),overflow:"visible"};self.playerScreenHideCSS={width:"0px",height:"0px",overflow:"hidden"};self.playerScreen.css(self.playerScreenHideCSS);self.endScreen=self.$.find(".video-finished").hide();self.loginScreen=self.$.find(".logged-out-video-aspot").hide();self.upgradeScreen=self.$.find(".upgrade-video-aspot").hide();self.pinScreen=self.$.find(".parental-settings").hide();self.errorScreen=self.$.find(".player-error").hide();self.loaderOverlay=$(".video-player-module > .loader").hide();self.screens=[self.playerScreen,self.loginScreen,self.endScreen,self.pinScreen,self.errorScreen];self.placeholderId="player-placeholder";self.placeholder=$("#"+self.placeholderId).get(0);self.$.show();self.loadVideoPlayer()}orion.util.inherits(VideoPlayerView,View);VideoPlayerView.prototype.handlers=function(viewType){var self=this;var model=self.model;var mediaItem,channel;self.$.delegate(".replay","click",function(e){e.preventDefault();self.player.remove();self.showPlayerScreen();if(viewType==="channel"){channel=model.get("channel");orion.oesp.session.done(function(session){var p=session.getPermissionToPlayChannel(channel,self.isPlayerVerified);p.done(function(){self.player.loadChannel(channel.id)});p.fail(function(reason){self.player.trigger("permission.fail."+reason)})})}else{mediaItem=model.get("mediaItem");location.reload()}return false})};VideoPlayerView.prototype.loadVideoPlayer=function(){var self=this;self.player=new orion.widgets.VideoPlayer(self.model.playerType=="channel"?"live":"standard");return self};VideoPlayerView.prototype.setScreen=function(screen){var self=this;var i=self.screens.length;while(i--){if(self.screens[i]!=screen){if(self.screens[i]==self.playerScreen){self.screens[i].css(self.playerScreenHideCSS)}else{self.screens[i].hide()}}}if(screen==self.playerScreen){screen.css(self.playerScreenShowCSS)}else{screen.show()}return self};VideoPlayerView.prototype.showSocialOverlay=function(){var self=this;var content=$(".video-social-overlay");var social=orion.app.dialogManager.getDialog("video-social-overlay");var assetId=self.$.data("media-id");if(social.contentArea.find(".video-social-overlay").length===0){social.setHtmlContent(content)}social.contentArea.show();social.contentArea.find(".video-social-overlay").show();if(self.playerScreen.is(":visible")){social.centerOn(self.playerScreen.get(0))}else{social.centerOn(self.endScreen.get(0))}social.show();orion.util.analytics.trackEvent("action",{pageName:"Engagement/Social/Share",channel:"Engagement/Social/Share",prop23:"Engagement",prop24:"Social",prop26:"Share",eVar32:assetId,events:"event9,event34"});return self};VideoPlayerView.prototype.showPlayerScreen=function(){var self=this;self.setScreen(self.playerScreen);self.ensurePlayerIsEmbedded();self.background.addClass("player-bg").show();self.loaderOverlay.show();return self};VideoPlayerView.prototype.showLoginScreen=function(){var self=this;var model=self.model;var playerType=model.get("playerType");var signinButton=self.$.find(".sign-in");var bgImg;var mediaItem;var channel;self.loaderOverlay.hide();self.setScreen(self.loginScreen);if(playerType==="channel"){channel=model.get("channel");bgImg=channel.getBackgroundImageUrl();currentStationRequest=channel.requestCurrentStation();currentStationRequest.done(function(station){var currentProgramRequest=station.requestCurrentProgram();currentProgramRequest.done(function(program){var aspot=self.loginScreen.find(".aspot-messaging");var boxart;aspot.find(".channel-title").text(channel.title||station.title);aspot.find(".show-title").text(program.title);if(program.title!=program.secondaryTitle){aspot.find(".episode-title").text(program.secondaryTitle)}aspot.find(".season-number").text(program.seasonNumber);aspot.find(".episode-number").text(program.seriesEpisodeNumber);if(program.images){boxart=orion.util.mediamethods.getBoxArtMedium.call(program);if(boxart){aspot.find(".box-art").html('<img src="'+boxart+'" alt="'+program.title+'" />')}}})})}else{mediaItem=model.get("mediaItem");if(mediaItem.isMyPrime()){bgImg=BBV.settings.myPrime.backgroundImageUrl}else{bgImg=mediaItem.getBackgroundImageUrl()}}if(bgImg){self.background.css({"background-image":'url("'+bgImg+'")'}).removeClass().addClass("vod-login-bg")}else{self.background.addClass("vod-default-bg")}self.background.show();signinButton.bind("click",function(){self.publisher.trigger("requestDialog",{dialogName:"login",centerOn:self.$.get(0)});return false});return self};VideoPlayerView.prototype.showUpgradeScreen=function(){var self=this;var model=self.model;var playerType=model.get("playerType");var purchases=orion.oesp.purchaseEndpoint;var bgImg;var mediaItem;var channel;var currentStationRequest;self.loaderOverlay.hide();self.setScreen(self.upgradeScreen);if(playerType==="channel"){channel=model.get("channel");bgImg=channel.getBackgroundImageUrl();currentStationRequest=channel.requestCurrentStation();currentStationRequest.done(function(station){var currentProgramRequest=station.requestCurrentProgram();currentProgramRequest.done(function(program){var aspot=self.upgradeScreen.find(".aspot-messaging");var previewButton=aspot.find(".play-preview").hide();var boxart;aspot.find(".channel-title").text(channel.title||station.title);aspot.find(".show-title").text(program.title);aspot.find(".episode-title").text(program.secondaryTitle);aspot.find(".season-number").text(program.seasonNumber);aspot.find(".episode-number").text(program.seriesEpisodeNumber);if(program.images){boxart=orion.oesp.res.MediaItem.prototype.getImageUrlByType.call(program,"box-art");if(boxart){aspot.find(".box-art").html('<img src="'+boxart+'" alt="'+program.title+'" />')}}})})}else{mediaItem=model.get("mediaItem");bgImg=mediaItem.getBackgroundImageUrl();offersRequest=purchases.requestSetOfProductOffers(mediaItem.currentTvodProductIds);orion.oesp.session.done(function(session){offersRequest.done(function(offers){if(!mediaItem.hasVodType("SVOD")&&offers.products.length){self.upgradeScreen.find("a.upgrade").closest("span.button").hide()}if(mediaItem.isTVOD()&&!offers.products.length){self.upgradeScreen.find("a.upgrade").closest("span.button").hide()}if(!session.customer.stbType){self.upgradeScreen.find(".upgrade-message").text(self.$.data("upgrade-no-box"))}else{if(!offers||!offers.products.length){if(mediaItem.isTVOD()){self.upgradeScreen.find(".upgrade-message").text(self.$.data("upgrade-not-entitled-cannot-purchase"))}else{self.upgradeScreen.find(".upgrade-message").text(self.$.data("upgrade-not-entitled-not-subscribed"))}}}})})}if(bgImg){self.background.css({"background-image":'url("'+bgImg+'")'}).removeClass().addClass("vod-upgrade-bg")}else{self.background.addClass("vod-default-bg")}self.background.show();return self};VideoPlayerView.prototype.showEndScreen=function(){var self=this;var endScreen=self.endScreen;var feedContainerElem=endScreen.find(".feed-container");var mediaItem=self.model.get("mediaItem");var mediaGroup=self.model.get("mediaGroup");mediaItem=BBV.extend(mediaItem,orion.util.mediamethods);var mediaItemId=mediaItem.id;if(mediaItem.isTrailer()&&mediaGroup&&$(mediaGroup.currentChildMediaCounts).length>1){var redirectUrl=mediaItem.buildMediaUrl();if(redirectUrl.length>0){window.location.assign(redirectUrl);return self}}if(!self.endScreen.initialized){self.$.delegate(".share","click",function(e){e.preventDefault();self.showSocialOverlay()});if(orion.Playlist.containsProgramId({id:mediaItemId})){orion.Playlist.getNext({id:mediaItemId,count:4,callback:function(){var nextItems=this;var nextUp=[nextItems.shift()];var nextUpElem=endScreen.find(".related ul");var nextUpParent=nextUpElem.parent();endScreen.feedContainer=new orion.widgets.FeedContainer(feedContainerElem,{feedData:nextItems});new orion.widgets.FeedContainer(nextUpElem,{feedData:nextUp,pageSize:0,enablePaging:false})}})}else{endScreen.feedContainer=new orion.widgets.FeedContainer(feedContainerElem,{imgType:"boxart-small",loaderHeight:200,loaderWidth:450})}endScreen.initialized=true}self.setScreen(endScreen);self.background.hide();$(".video-finished .no-hover .title a").ellipsis({setTitle:"onEllipsis"});return self};VideoPlayerView.prototype.showRelatedItem=function(){var self=this;var relatedItem=self.model.get("relatedItem");var $relatedItem;if(self.endScreen.find(".related").length){$relatedItem=self.relatedItemTemplate.getMarkup(relatedItem,{template:"MediaGrid",disabledHover:true,isThumb:true});self.endScreen.find(".related").append($relatedItem)}return self};VideoPlayerView.prototype.showPinScreen=function(pinType,onVerified,onCanceled){var self=this;pinType=pinType||"parental";onVerified=onVerified||function(){log("Pin verified.");pinDialog.close();orion.app.reInitialize()};onCanceled=onCanceled||function(){if(pinType==="adultPinNotRegistered"){self.showUpgradeScreen();log("pin not registered dialog closed, showing upgrade screen")}else{self.showErrorScreen("PIN_ERROR");log("pin dialog closed, showing error screen")}};self.setScreen(self.pinScreen);var pinDialog=orion.app.dialogManager.getDialog("pin-verification");pinDialog.showDialog(pinType);pinDialog.onVerified(onVerified);pinDialog.onCanceled(onCanceled);return self};VideoPlayerView.prototype.showErrorScreen=function(errorType){var self=this;self.loaderOverlay.hide();self.errorScreen.find(".error").hide();log("Module:VideoPlayer: Showing errorType",errorType);switch(errorType){case"PLAYER_PROGRAM_NOT_FOUND":self.errorScreen.find(".listing-error").show();break;case"TP_GEO_BLOCKED":case"RESTRICTION_POLICY_FAILED":self.errorScreen.find(".geo-error").show();break;case"WV_CONCURRENT_HB_FAILURE":case"LICENSE_CONCURRENT_HB_FAILURE":self.errorScreen.find(".concurrency-error").show();break;case"INACTIVITY_TIMEOUT":self.errorScreen.find(".inactivity-error").show();break;case"VIDEO_BUFFERING_PLAY_STOPPED":self.errorScreen.find(".buffering-error").show();break;case"LINEAR_BLACKOUT_OCCURRED":self.errorScreen.find(".blackout-error").show();break;default:self.errorScreen.find(".generic-error").show();break}self.setScreen(self.errorScreen)};VideoPlayerView.prototype.showMessage=function(message){var self=this;if(self.currentMessage){self.currentMessage.remove()}self.currentMessage=new orion.widgets.VideoMessage(message,"left");self.currentMessage.appendTo(self.playerScreen);return self};VideoPlayerView.prototype.ensurePlayerIsEmbedded=function(){var self=this;if(!self.player.isEmbeded()){self.player.embed(self.placeholder,self.model.flashVars,self.model.params,self.model.attributes)}};function VideoPlayer(elem,publisher){if(!(this instanceof VideoPlayer)){return new VideoPlayer(elem,publisher)}var self=this;var view,model;var $elem=$(elem);self.publisher=publisher;self.$elem=$elem;self.model=model=new VideoPlayerModel();model.set("playerType",$elem.data("player-type"));model.set("isPreview",$elem.data("is-preview"));publisher.subscribe("channelCorrection",function(e){if(e.channelId==self.$elem.data("channel-id")){return}self.$elem.data("channel-id",e.channelId);self.$elem.data("channel-name",e.channelName);self.initialize(e.channelId)});self.view=view=new VideoPlayerView(elem,model,publisher);self.initialize();orion.app.addthis.done(function addThisLoaded(){function checkOnAddThis(){var socialBox=$(".video-social-overlay");if(socialBox.find(".addthis_button_facebook").hasClass("at300b")){socialBox.find(".error").addClass("hidden");socialBox.find(".addthis_toolbox").removeClass("hidden")}else{setTimeout(checkOnAddThis,2000)}}checkOnAddThis()})}VideoPlayer.prototype.initialize=function(channelId){var self=this;var model=self.model;var view=self.view;var channelRequest;var mediaItemRequest;self.subscribeToVideoEvents();if(model.get("playerType")=="channel"){model.set("channelId",channelId?channelId:self.$elem.data("channel-id"));if(!model.get("channelId")){return}channelRequest=orion.oesp.channelEndpoint.requestChannel(model.get("channelId"));channelRequest.done(function(channel){model.set("channel",channel);self.channelSetup();view.handlers("channel")});channelRequest.fail(function(){log("orion.modules.VideoPlayer:","There was an error aquiring the channel from the OESP.","channelId:",model.channelId)})}else{mediaItemRequest=orion.oesp.mediaItemEndpoint.requestMediaItem(self.$elem.data("media-id"));mediaItemRequest.done(function(mediaItem){model.set("mediaItem",mediaItem);self.vodSetup();self.relatedItemSetup();view.handlers("mediaItem")});mediaItemRequest.fail(function(mediaItem){log("orion.modules.VideoPlayer: error aquiring the mediaItem (",mediaItem,")")})}};VideoPlayer.prototype.channelSetup=function(){var self=this;var model=self.model;var channel=model.get("channel");var view=self.view;var player=view.player;if(channel){var bg=channel.getBackgroundImageUrl("station-background-tile");if(bg){$("#backgrounds-div-container").css("background-image","url("+bg+")")}}orion.oesp.session.done(function(session){var permission=session.getPermissionToPlayChannel(channel);permission.done(function(){player.stop();view.showPlayerScreen();player.playChannel(channel)});permission.fail(function(reason){log("orion.modules.VideoPlayer: there was a permission failure for this channel: ",reason);if($.inArray(reason,player.errorTypes)===-1){player.trigger("permission.fail.generic",reason)}else{player.trigger("permission.fail."+reason)}})})};VideoPlayer.prototype.vodSetup=function(){var self=this;var mediaItem=self.model.get("mediaItem");var view=self.view;var player=view.player;orion.oesp.session.done(function(session){var permission=session.getPermissionToPlayMediaItem(mediaItem);permission.done(function(){view.showPlayerScreen();if(session.isAuthenticated()){var bookmarkRequest=orion.oesp.bookmarkEndpoint.requestBookmarks(mediaItem.id);bookmarkRequest.done(function(bookmark){var bookmarkDialog;if(bookmark.offset>0){bookmarkDialog=orion.app.dialogManager.getDialog("resume");bookmarkDialog.centerOn(view.playerScreen.get(0));bookmarkDialog.bind("resume",function(){player.loadMediaItem(mediaItem,{offset:bookmark.offset});return false});bookmarkDialog.bind("replay",function(){player.loadMediaItem(mediaItem);return false});bookmarkDialog.show()}else{player.loadMediaItem(mediaItem)}}).fail(function(){log("VideoPlayer.vodSetup -> no bookmark found");player.loadMediaItem(mediaItem)})}else{player.loadMediaItem(mediaItem)}}).fail(function(reason){log("VideoPlayer.vodSetup -> there was a permission failure for this video: ",reason);if($.inArray(reason,player.errorTypes)===-1){player.trigger("permission.fail.generic",reason)}else{player.trigger("permission.fail."+reason)}})})};VideoPlayer.prototype.relatedItemSetup=function(){var self=this;var mediaItem=self.model.get("mediaItem");var model=self.model;var view=self.view;var relatedItem,relatedItemRequest;var categories=[];for(i=0;i<mediaItem.categories.length;i++){categories.push(mediaItem.categories[i].id)}relatedItemRequest=orion.oesp.mediaItemEndpoint.get({byCategoryIds:categories.join("|"),sort:"playCount30|desc",range:"0-1"});relatedItemRequest.done(function(related){view.relatedItemTemplate=new orion.util.MediaTemplate();relatedItem=view.relatedItemTemplate.formatData(related.mediaItems,{imgType:"boxart-small"});model.set("relatedItem",relatedItem);view.showRelatedItem()})};VideoPlayer.prototype.processPlayerErrors=function(error){};VideoPlayer.prototype.subscribeToVideoEvents=function(){var vp=this;var self=this;var view=self.view;var model=self.model;var player=view.player;var mediaItem=self.model.get("mediaItem");player.bind("contentEnd",function(){view.showEndScreen()});player.bind("errorOccurred",function(vp,e){var error=player.errors.pop();log("MODULE:VIDEOPLAYER: Error Occurred on the video player:",error,e);switch(e.errorCode){case"PLAYER_PROGRAM_NOT_FOUND":orion.oesp.session.done(function(session){var channel=model.get("channel");var p=session.getPermissionToPlayChannel(channel,false);p.fail(function(reason){player.trigger("permission.fail."+reason)})});break;case"LINEAR_BLACKOUT_OCCURRED":var currentTime,retryTime;if(typeof e.eventDetails=="string"){retryTime=jQuery.parseJSON(e.eventDetails).retryTime}else{retryTime=e.eventDetails.retryTime}if(e.causedPlaybackFailure){currentTime=$.now();setTimeout(function(){view.player.remove();view.showPlayerScreen();channel=model.get("channel");orion.oesp.session.done(function(session){var p=session.getPermissionToPlayChannel(channel,self.isPlayerVerified);p.done(function(){player.loadChannel(channel.id)});p.fail(function(reason){player.trigger("permission.fail."+reason)})})},retryTime-currentTime)}break}if(e.causedPlaybackFailure&&e.errorCode!=="PLAYER_LANGUAGE_PACK_BADLY_FORMED"){view.showErrorScreen(error)}});player.bind("inactivityTimeout",function(vp,e){view.showErrorScreen("INACTIVITY_TIMEOUT")});player.bind("parentalPINUnverified",function(e){log("MODULE:VIDEOPLAYER: Need to enter parental PIN");view.showPinScreen("parentalPin")});player.bind("shareClicked",function(e){if(model.get("playerType")!=="channel"){player.pause()}view.showSocialOverlay();return false});vp.publisher.subscribe("addedToPlaylist",function(e){var id=vp.model.mediaItem.id;var updateHandler=function(e){if(e.mediaId===id){log("MODULE:VIDEOPLAYER: item successfully added to playlist.");player.playlistSuccess();vp.publisher.unsubscribe("playlistUpdated",updateHandler)}};log("MODULE:VIDEOPLAYER: Adding",id,"to the playlist.");vp.publisher.trigger("updatePlaylist",{action:"add",mediaId:id});vp.publisher.subscribe("playlistUpdated",updateHandler)});vp.publisher.subscribe("likeUpdated",function(status){player.likeClicked(status.state==="reset"?"removed":status.state)});vp.publisher.subscribe("updatePlaylist",function(ev){if(ev.action==="remove"&&model.mediaItem&&ev.mediaId===model.mediaItem.id){var orionPlayer=view.$.find("object").get(0);orionPlayer.playlistRemoved();log("Removed playlist item from orion player")}});player.bind("assetLoaded",function(event){if(model.mediaItem!==undefined){var mediaGroupId=model.mediaItem.mediaGroupId;var isPreview=model.get("isPreview");if(!isPreview){return}$.when(orion.oesp.session,orion.oesp.mediaGroupEndpoint.requestFormattedMediaGroup(mediaGroupId)).done(function(session,mediaGroup){model.set("mediaGroup",mediaGroup);if(!session.hasEntitlement(model.mediaItem.entitlements)){if(session.isAuthenticated()){}else{view.showMessage($("#login-overlay-content").html())}}})}});player.errorTypes=["login","upgrade","purchase","adultpin","noadultpin","parentalpin","youthpin"];player.bind("permission.fail.login",function(){view.showLoginScreen()});player.bind("permission.fail.upgrade",function(){view.showUpgradeScreen()});player.bind("permission.fail.purchase",function(){view.showUpgradeScreen()});player.bind("permission.fail.adultpin",function(){view.showPinScreen("adultPin")});player.bind("permission.fail.noadultpin",function(){view.showPinScreen("adultPinNotRegistered")});player.bind("permission.fail.parentalpin",function(){view.showPinScreen("parentalPin")});player.bind("permission.fail.youthpin",function(){view.showPinScreen("youthPin")});player.bind("permission.fail.generic",function(e,reason){view.showErrorScreen(reason)});return this};return VideoPlayer})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").SLVideoPlayer=orion.modules.SLVideoPlayer||(function($,Model,View){function SLVideoPlayerModel(){var self=this;this._isShown=false;Model.call(this)}orion.util.inherits(SLVideoPlayerModel,Model);function SLVideoPlayerView(elem,model){var self=this;var playerType;self.$=$(elem);View.call(self,model);orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.isAuthenticated=true}});self.publisher=orion.app;self._firstErrorOccured=false;self.background=$("#backgrounds-div");self.background.removeClass().addClass("vod-bg").hide();self.playerScreen=self.$.find(".video-player");self.$.find("#login-overlay-content .learn-more").attr("href",BBV.settings.site.urls.learnmore);self.animateParams={height:529,marginBottom:40,opacity:1};self.containerShowCSS={width:"",height:"",position:"",overflow:""};self.containerHideCSS={width:"0px",height:"0px",overflow:"hidden",position:"absolute"};self.playerScreenShowCSS={width:"auto",height:"auto",overflow:"visible"};self.playerScreenHideCSS={height:"0px",overflow:"hidden"};self.playerScreen.css(self.playerScreenHideCSS);self.endScreen=self.$.find(".video-finished").hide();self.errorScreen=self.$.find(".player-error").hide();self.loaderOverlay=$(".video-player-module > .loader").hide();self.screens=[self.playerScreen,self.endScreen,self.errorScreen];self.placeholderId="player-placeholder";self.placeholder=$("#"+self.placeholderId).get(0);self.$.show();self.loadVideoPlayer()}orion.util.inherits(SLVideoPlayerView,View);SLVideoPlayerView.prototype.handlers=function(viewType){var self=this;var model=self.model;var mediaItem;self.$.delegate(".just-watched .replay","click",function(e){e.preventDefault();self.trigger("vodSetup");self.showPlayerScreen();self.endScreen.initialized=false;return false});self.$.delegate(".buffering-error .replay","click",function(e){e.preventDefault();self.trigger("channelSetup");self.showPlayerScreen();return false})};SLVideoPlayerView.prototype.loadVideoPlayer=function(){var self=this;self.player=new orion.widgets.SLVideoPlayerWidget(self.model.playerType);return self};SLVideoPlayerView.prototype.setScreen=function(screen){var self=this;var i=self.screens.length;while(i--){if(self.screens[i]!=screen){if(self.screens[i]==self.playerScreen){self.screens[i].css(self.playerScreenHideCSS)}else{self.screens[i].hide()}}}if(screen==self.playerScreen){screen.css(self.playerScreenShowCSS)}else{screen.show()}return self};SLVideoPlayerView.prototype.showSocialOverlay=function(){var self=this;var content=$(".video-social-overlay");var social=orion.app.dialogManager.getDialog("video-social-overlay");var assetId=self.$.data("media-id");if(social.contentArea.find(".video-social-overlay").length===0){social.setHtmlContent(content)}social.contentArea.show();social.contentArea.find(".video-social-overlay").show();if(self.playerScreen.is(":visible")){social.centerOn(self.playerScreen.get(0))}else{social.centerOn(self.endScreen.get(0))}social.show();orion.util.analytics.trackEvent("action",{pageName:"Engagement/Social/Share",channel:"Engagement/Social/Share",prop23:"Engagement",prop24:"Social",prop26:"Share",eVar32:assetId,events:"event9,event34"});return self};SLVideoPlayerView.prototype.showPlayerScreen=function(){var self=this;self.setScreen(self.playerScreen);self.ensurePlayerIsEmbedded();return self};SLVideoPlayerView.prototype.hideScreen=function(){var self=this;self.background.hide();this.$.animate({height:0,margin:0},1500,function(){self.$.css(self.containerHideCSS)})};SLVideoPlayerView.prototype.showEndScreen=function(){var self=this;var endScreen=self.endScreen;var feedContainerElem;var mediaItem=self.model.get("mediaItem");var mediaGroup=self.model.get("mediaGroup");var mediaItemId=mediaItem.id;feedContainerElem=endScreen.find(".feed-container");if(!self.endScreen.initialized){self.$.delegate(".share","click",function(e){e.preventDefault();self.showSocialOverlay()});if(orion.Playlist.containsProgramId({id:mediaItemId})){orion.Playlist.getNext({id:mediaItemId,count:4,callback:function(){var nextItems=this;var nextUp=[nextItems.shift()];var nextUpElem=endScreen.find(".related ul");var nextUpParent=nextUpElem.parent();endScreen.feedContainer=new orion.widgets.FeedContainer(feedContainerElem,{feedData:nextItems});new orion.widgets.FeedContainer(nextUpElem,{feedData:nextUp,pageSize:0,enablePaging:false})}});endScreen.initialized=true}else{if(mediaItem.isTrailer()){log("istrailer");self.publisher.trigger("trailerEnd");self.endScreen.initialized=false}else{log("SLVideoPlayer:: end playing. Not from playlist.");endScreen.feedContainer=new orion.widgets.FeedContainer(feedContainerElem,{imgType:"boxart-small",loaderHeight:200,loaderWidth:450});self.setScreen(endScreen);self.background.hide();$(".video-finished .no-hover .title a").ellipsis({setTitle:"onEllipsis"});endScreen.initialized=true}}}self.background.hide();return self};SLVideoPlayerView.prototype.showRelatedItem=function(){var self=this;var relatedItem=self.model.get("relatedItem");var $relatedItem;if(self.endScreen.find(".related").length){$relatedItem=self.relatedItemTemplate.getMarkup(relatedItem,{template:"MediaGrid",disabledHover:true,isThumb:true});self.endScreen.find(".related").append($relatedItem)}return self};SLVideoPlayerView.prototype.showPinScreen=function(pinType,onVerified,onCanceled){var self=this;pinType=pinType||"parental";onVerified=onVerified||function(){log("Pin verified.");pinDialog.close();orion.app.reInitialize()};onCanceled=onCanceled||function(){if(pinType==="adultPinNotRegistered"){self.showUpgradeScreen();log("pin not registered dialog closed, showing upgrade screen")}else{self.showErrorScreen("PIN_ERROR");self.loaderOverlay.hide();log("pin dialog closed, showing error screen")}};self.player.stop();var pinDialog=orion.app.dialogManager.getDialog("pin-verification");pinDialog.showDialog(pinType);pinDialog.onVerified(onVerified);pinDialog.onCanceled(onCanceled);return self};SLVideoPlayerView.prototype.showErrorScreen=function(errorType){var self=this;self.errorScreen.find(".error").hide();log("Module:VideoPlayer: Showing errorType",errorType);switch(errorType){case"PLAYER_PROGRAM_NOT_FOUND":self.errorScreen.find(".listing-error").show();break;case"TP_GEO_BLOCKED":case"RESTRICTION_POLICY_FAILED":self.errorScreen.find(".geo-error").show();break;case"WV_CONCURRENT_HB_FAILURE":case"LICENSE_CONCURRENT_HB_FAILURE":self.errorScreen.find(".concurrency-error").show();break;case"INACTIVITY_TIMEOUT":self.errorScreen.find(".inactivity-error").show();break;case"VIDEO_BUFFERING_PLAY_STOPPED":self.errorScreen.find(".buffering-error").show();break;case"LINEAR_BLACKOUT_OCCURRED":self.errorScreen.find(".blackout-error").show();break;default:self.errorScreen.find(".generic-error").show();break}self.setScreen(self.errorScreen)};SLVideoPlayerView.prototype.showMessage=function(message){var self=this;if(self.currentMessage){self.currentMessage.remove()}self.currentMessage=new orion.widgets.VideoMessage(message,"left");self.currentMessage.appendTo(self.playerScreen);return self};SLVideoPlayerView.prototype.ensurePlayerIsEmbedded=function(){var self=this;if(!self.player.isEmbeded()){self.player.embed(self.placeholder)}};function SLVideoPlayer(elem,playerType){orion.util.PubSub.call(this);if(!(this instanceof SLVideoPlayer)){return new SLVideoPlayer(elem,publisher)}var self=this;var view,model;var $elem=$(elem);self.publisher=orion.app;self.$elem=$elem;self.model=model=new SLVideoPlayerModel();model.set("playerType",playerType);self.publisher.subscribe("channelCorrection",function(e){if(e.channelId==self.model.get("channel").id){return}model.set("channel",e.channel);self.initializeChannel(e.channel)});self.view=view=new SLVideoPlayerView(elem,model);model.set("i18nTitleCardSocial",orioni18n.titleCardSocial);view.bind("vodSetup",function(){self._vodSetup()});view.bind("channelSetup",function(){self._channelSetup()});orion.app.addthis.done(function addThisLoaded(){function checkOnAddThis(){var socialBox=$(".video-social-overlay");if(socialBox.find(".addthis_button_facebook").hasClass("at300b")){socialBox.find(".error").addClass("hidden");socialBox.find(".addthis_toolbox").removeClass("hidden")}else{setTimeout(checkOnAddThis,2000)}}checkOnAddThis()});self._initialize()}orion.util.inherits(SLVideoPlayer,orion.util.PubSub);SLVideoPlayer.prototype._initialize=function(){var self=this;var model=self.model;var view=self.view;self._subscribeToVideoEvents()};SLVideoPlayer.prototype.initializeReplayTV=function(mediaItem){var self=this;var view=self.view;var model=self.model;model.set("mediaGroup","");model.set("mediaItem",BBV.extend(mediaItem,orion.util.mediamethods));model.set("isPreview",false);model.set("i18nTitleCardMovie",orioni18n.titleCardMovie);self._vodSetup();view.handlers("mediaItem");view.endScreen.initialized=false};SLVideoPlayer.prototype.initializeChannel=function(channel){var self=this;var model=self.model;var view=self.view;model.set("channel",channel);self._channelSetup();view.handlers("channel")};SLVideoPlayer.prototype.initializeVideo=function(mediaGroup,mediaItem){var self=this;var view=self.view;var model=self.model;model.set("mediaGroup",mediaGroup);model.set("mediaItem",BBV.extend(mediaItem,orion.util.mediamethods));model.set("isPreview",mediaItem.isPreview());model.set("i18nTitleCardMovie",orioni18n.titleCardMovie);self._vodSetup();self._relatedItemSetup();view.handlers("mediaItem");view.endScreen.initialized=false};SLVideoPlayer.prototype.show=function(animation){var self=this;var view=self.view;var model=self.model;var isShown=model.get("_isShown");view.background.show();view.$.css(view.containerShowCSS);if(isShown){view.showPlayerScreen();return}view.$.css(view.animateParams);view.loaderOverlay.show();view.showPlayerScreen();model.set("_isShown",true)};SLVideoPlayer.prototype.hide=function(animation){var self=this;var view=self.view;view.background.hide();view.$.css(view.containerHideCSS)};SLVideoPlayer.prototype.play=function(){var self=this,view=self.view,model=self.model,player=view.player,channel,mediaItem;if(self.model.get("playerType")=="live"){player.stop();view.loaderOverlay.show();channel=model.get("channel");player.playChannel(channel)}else{player.play()}};SLVideoPlayer.prototype.pause=function(){var self=this,view=self.view,player=view.player;player.pause()};SLVideoPlayer.prototype.stop=function(){var self=this,view=self.view,player=view.player;player.stop()};SLVideoPlayer.prototype.remove=function(){var self=this,view=self.view,player=view.player;player.remove()};SLVideoPlayer.prototype._channelSetup=function(){var self=this;var model=self.model;var channel=model.get("channel");var view=self.view;var player=view.player;if(channel){var bg=channel.getBackgroundImageUrl("station-background-tile");if(bg){$("#backgrounds-div-container").css("background-image","url("+bg+")")}}view._firstErrorOccured=false;orion.oesp.session.done(function(session){var permission=session.getPermissionToPlayChannel(channel);permission.done(function(){player.stop();player.playChannel(channel);view.loaderOverlay.hide()});permission.fail(function(reason){log("orion.modules.VideoPlayer: there was a permission failure for this channel: ",reason);view.loaderOverlay.show();if($.inArray(reason,player.errorTypes)===-1){player.trigger("permission.fail.generic",reason)}else{player.trigger("permission.fail."+reason)}})})};SLVideoPlayer.prototype._vodSetup=function(){var self=this;var mediaItem=self.model.get("mediaItem");var view=self.view;var player=view.player;orion.oesp.session.done(function(session){var permission=session.getPermissionToPlayMediaItem(mediaItem);permission.done(function(){if(session.isAuthenticated()&&!view.endScreen.initialized){var bookmarkRequest=orion.oesp.bookmarkEndpoint.requestBookmarks(mediaItem.id);bookmarkRequest.done(function(bookmark){var bookmarkDialog;if(bookmark.offset>0){bookmarkDialog=orion.app.dialogManager.getDialog("resume");bookmarkDialog.centerOn(view.playerScreen.get(0));bookmarkDialog.bind("resume",function(){player.loadMediaItem(mediaItem,{offset:bookmark.offset});return false});bookmarkDialog.bind("replay",function(){player.loadMediaItem(mediaItem);return false});bookmarkDialog.show()}else{player.loadMediaItem(mediaItem)}}).fail(function(){log("VideoPlayer.vodSetup -> no bookmark found");player.loadMediaItem(mediaItem)})}else{player.loadMediaItem(mediaItem)}}).fail(function(reason){log("VideoPlayer.vodSetup -> there was a permission failure for this video: ",reason);if($.inArray(reason,player.errorTypes)===-1){player.trigger("permission.fail.generic",reason)}else{player.trigger("permission.fail."+reason)}})})};SLVideoPlayer.prototype._relatedItemSetup=function(){var self=this;var mediaItem=self.model.get("mediaItem");var model=self.model;var view=self.view;var relatedItem,relatedItemRequest;var categories=[];for(i=0;i<mediaItem.categories.length;i++){categories.push(mediaItem.categories[i].id)}relatedItemRequest=orion.oesp.mediaItemEndpoint.get({byCategoryIds:categories.join("|"),sort:"playCount30|desc",range:"0-1"});relatedItemRequest.done(function(related){var $container=view.$.find(".video-finished");view.relatedItemTemplate=new orion.util.MediaTemplate();relatedItem=view.relatedItemTemplate.formatData(related.mediaItems,{imgType:"boxart-small"});model.set("relatedItem",relatedItem);$tmp=$(Mustache.to_html(orion.templates.VideoPlayerEndScreen,{model:model}));$container.html($tmp);view.showRelatedItem()})};SLVideoPlayer.prototype._subscribeToVideoEvents=function(){var vp=this;var self=this;var view=self.view;var model=self.model;var player=view.player;self.publisher.subscribe(BBV.player.generateSLEventName("contentEnd"),function(){view.showEndScreen()});self.publisher.subscribe(BBV.player.generateSLEventName("errorOccurred"),function(e){if(view._firstErrorOccured){return}var showErrorScreen=true;switch(e.errorCode){case"LICENSE_PARENTAL_PIN_NOT_VERIFIED":self.stop();self.remove();view.showErrorScreen();player.trigger("permission.fail.parentalpin");break;case"LICENSE_ADULT_PIN_NOT_VERIFIED":orion.oesp.session.done(function(session){player.trigger("permission.fail."+(session.hasAdultPin()?"adultpin":"noadultpin"))});break;case"PLAYER_PROGRAM_NOT_FOUND":orion.oesp.session.done(function(session){var channel=model.get("channel");var p=session.getPermissionToPlayChannel(channel,false);p.fail(function(reason){player.trigger("permission.fail."+reason)})});break;case"LINEAR_BLACKOUT_OCCURRED":var currentTime,retryTime=jQuery.parseJSON(e.eventDetails).retryTime;if(e.causedPlaybackFailure){currentTime=$.now();setTimeout(function(){view.showPlayerScreen();self._channelSetup()},retryTime-currentTime)}break;case"DEVICE_REGISTRATION_ERROR":showErrorScreen=false;view._firstErrorOccured=true;view.loaderOverlay.show();if(e.eventDetails=="deviceUnregistered"){$.when(player.getDeviceId(),orion.oesp.deviceEndpoint.getDevicesRegistrationStatusInfo()).done(function(deviceId,status){var d=orion.app.dialogManager.getDialog("register-device");d.setData({deviceIdToRegister:deviceId,deviceRegistrationStatus:status});d.setCloseBehavior(function(){view.showErrorScreen();d.hide()});d.setDeviceRegisteredBehavior(function(){view.showPlayerScreen();if(model.get("playerType")=="live"){self._channelSetup()}else{self._vodSetup()}d.hide()});d.centerOn("window");d.show()}).fail(function(){view.showErrorScreen()})}else{if(e.eventDetails=="deviceUnregisteredDeviceLimitReached"){$.when(player.getDeviceId()).done(function(deviceId){var d=orion.app.dialogManager.getDialog("replace-device");d.setData({replaceWithDeviceId:deviceId});d.setCloseBehavior(function(){view.showErrorScreen();d.hide()});d.centerOn("window");d.show()}).fail(function(){view.showErrorScreen()})}else{if(e.eventDetails=="deviceUnregisteredActionLimitReached"){$.when(orion.oesp.deviceEndpoint.getDevicesRegistrationStatusInfo()).done(function(latestStatus){var d=orion.app.dialogManager.getDialog("cannot-register-device");d.setData({deviceRegistrationStatus:latestStatus});d.setCloseBehavior(function(){view.showErrorScreen();d.hide()});d.centerOn("window");d.show()}).fail(function(){view.showErrorScreen()})}}}break}if(showErrorScreen&&e.causedPlaybackFailure&&e.errorCode!=="PLAYER_LANGUAGE_PACK_BADLY_FORMED"){view._firstErrorOccured=true;view.loaderOverlay.hide();view.showErrorScreen(e.errorCode)}});self.publisher.subscribe(BBV.player.generateSLEventName("inactivityTimeout"),function(){view.showErrorScreen("INACTIVITY_TIMEOUT")});self.publisher.subscribe(BBV.player.generateSLEventName("parentalPINUnverified"),function(){log("MODULE:VIDEOPLAYER: Need to enter parental PIN");view.showPinScreen("parentalPin")});self.publisher.subscribe(BBV.player.generateSLEventName("shareClicked"),function(){if(model.get("playerType")!=="live"){player.pause()}view.showSocialOverlay();return false});self.publisher.subscribe(BBV.player.generateSLEventName("addedToPlaylist"),function(e){var id=vp.model.mediaItem.id;var updateHandler=function(e){if(e.mediaId===id){log("MODULE:VIDEOPLAYER: item successfully added to playlist.");player.playlistSuccess();self.publisher.unsubscribe("playlistUpdated",updateHandler)}};log("MODULE:VIDEOPLAYER: Adding",id,"to the playlist.");self.publisher.trigger("updatePlaylist",{action:"add",mediaId:id});self.publisher.subscribe("playlistUpdated",updateHandler)});self.publisher.subscribe("likeUpdated",function(status){player.likeClicked(status.state==="reset"?"removed":status.state)});self.publisher.subscribe("updatePlaylist",function(ev){if(ev.action==="remove"&&model.mediaItem&&ev.mediaId===model.mediaItem.id){window.orionPlayer.playlistRemoved();log("Removed playlist item from orion player")}});self.publisher.subscribe(BBV.player.generateSLEventName("programChanged"),function(){var channel=model.get("channel");orion.oesp.session.done(function(session){var p=session.getPermissionToPlayChannel(channel,self.isPlayerVerified);self.isPlayerVerified=false;p.fail(function(reason){self.trigger("permission.fail."+reason)})})});self.publisher.subscribe(BBV.player.generateSLEventName("assetLoaded"),function(event){if(model.mediaItem!==undefined){var isPreview=model.get("isPreview");if(!isPreview){return}orion.oesp.session.done(function(session){if(!session.hasEntitlement(model.mediaItem.entitlements)){if(!session.isAuthenticated()){view.showMessage($("#login-overlay-content").html())}}})}});player.errorTypes=["adultpin","noadultpin","parentalpin","youthpin"];player.bind("permission.fail.adultpin",function(){view.showPinScreen("adultPin")});player.bind("permission.fail.noadultpin",function(){view.showPinScreen("adultPinNotRegistered")});player.bind("permission.fail.parentalpin",function(){view.showPinScreen("parentalPin")});player.bind("permission.fail.youthpin",function(){view.showPinScreen("youthPin")});player.bind("permission.fail.generic",function(e,reason){view.showErrorScreen(reason)});return this};return SLVideoPlayer})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").Promo=orion.modules.Promo||(function($){function Promo(elem,publisher){var promo,view;if(!elem){throw new Error("Please provide an element to use for the promo.")}if(!(this instanceof Promo)){throw new Error("Promo called without new.")}promo=this;promo.view=view={elem:elem,$:$(elem)};orion.util.oesp.aquireCredentials(function(){if(BBV.user().isLoggedIn){promo.showLoggedInView()}else{promo.showLoggedOutView()}})}Promo.prototype.showLoggedInView=function(){this.view.$.find(".signed-in").show();this.view.$.find(".signed-out").hide()};Promo.prototype.showLoggedOutView=function(){this.view.$.find(".signed-out").show();this.view.$.find(".signed-in").hide()};return Promo})(jQuery);
BBV.namespace("orion.modules").MyOrionBar=orion.modules.MyOrionBar||(function($){function MyOrionBar(elem,publisher){var self=this;if(!(self instanceof MyOrionBar)){return new MyOrionBar(elem,publisher)}orion.modules.MyOrionBar.loading=[];self.elem=elem;self.$=$(self.elem);self.publisher=publisher;self.$container=self.$.find("ul");self.$containerDialogs=$("#dialog-container");self.$loadingWrapper=self.$containerDialogs.find(".loading-wrapper");self.dialogMap={recommendations:{module:"Recommendations","module-id":"recommendations-module"},playlist:{module:"Playlist","module-id":"playlist-module"},"recently-viewed":{module:"RecentlyViewed"},"my-rentals":{module:"MyRentals","module-id":"my-rentals-module"}};if(!elem){throw new Error("Please provide an element to use for the orionBar.")}self.initialize()}MyOrionBar.prototype.initialize=function(){var self=this;self.render();self.handlers();new orion.Playlist(self.publisher);for(dialog in self.dialogMap){if($("#"+self.dialogMap[dialog]["module-id"]).length){new orion[self.dialogMap[dialog]["module"]](self.publisher)}}};MyOrionBar.prototype.handlers=function(){var self=this;self.$.delegate("li a","click",function(event){self.toggleDialog(event)});self.$containerDialogs.delegate("a.close-dialog, a.cancel","click",function(event){self.dialogClose(event)});self.$containerDialogs.delegate(".myorionbar-sub-functionality .view-toggle a","click",function(event){event.preventDefault();var $container=$(event.target).closest(".dialog-content");var hash=orion.util.modules.getHash(event);orion.util.modules.toggleView($container,hash)});self.publisher.subscribe("updatePlaylist",function pointToPlaylist(){self.pointArrowTo($(".my-orion-list").find('[data-dialog="playlist"] .my-orion-link'))})};MyOrionBar.prototype.render=function(){var self=this;self.localStrings=orioni18n.myOrionBar;self.$template=$(Mustache.to_html(orion.templates.MyOrionBarDialogWrapper,{localStrings:self.localStrings}));self.$containerDialogs.append(self.$template);self.$myorionbarDialogs=$("#myorionbar-dialog");self.$myorionbarDialogs.loader({flow:["overlay"],target:".dialog-inner",minheight:475,minwidth:926})};MyOrionBar.prototype.pointArrowTo=function(elem){var self=this;var arrowMoveSpeed=($("#myorionbar-dialog").css("display")=="none")?0:600;var $arrow=self.$myorionbarDialogs.find("#dialog-arrow");var dialogLeft=$("#myorionbar-dialog").offset().left;var buttonLeft=elem.parent().offset().left+(elem.parent().width()/2);var arrowPos=buttonLeft-dialogLeft-13;setTimeout(function(){$arrow.stop().animate({left:arrowPos},arrowMoveSpeed)},1)};MyOrionBar.prototype.toggleDialog=function(event){var self=this;var elem=event.target;var $elem=$(elem);var $dialogs=$(".dialog, .dialog-content");var dialog=$elem.closest("li").data("dialog");var loginDialog;var showDialog=$("#"+dialog).is(":visible")?false:true;event.preventDefault();orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.$myorionbarDialogs.trigger("loaded");self.$loadingWrapper.hide();$dialogs.hide();if(!$("#"+dialog).length){orion.modules.MyOrionBar.loading.push(dialog);self.$myorionbarDialogs.show();self.$myorionbarDialogs.trigger("loading");var orionBarObj=new orion[self.dialogMap[dialog]["module"]](self.publisher,showDialog)}else{if(showDialog){self.$myorionbarDialogs.show();$("#"+dialog).show()}}if(showDialog){self.pointArrowTo($elem);if(dialog==="playlist"){orion.util.analytics.trackEvent("action",{pageName:"Playlist/Overlay",channel:"Playlist/Overlay",prop23:"Playlist",prop24:"Playlist",prop26:"Overlay",events:"event9"})}else{if(dialog==="recommendations"){orion.util.analytics.trackEvent("action",{pageName:"Recommendations/Overlay",channel:"Recommendations/Overlay",prop23:"Recommendations",prop24:"Recommendations",prop26:"Overlay",events:"event9"})}else{if(dialog==="recently-viewed"){orion.util.analytics.trackEvent("action",{pageName:"Recently Viewed/Overlay",channel:"Recently Viewed/Overlay",prop23:"Recently Viewed",prop24:"Recently Viewed",prop26:"Overlay",events:"event9"})}else{if(dialog==="my-rentals"){orion.util.analytics.trackEvent("action",{pageName:"My Rentals/Overlay",channel:"My Rentals/Overlay",prop23:"My Rentals",prop24:"My Rentals",prop26:"Overlay",events:"event9"})}}}}}}else{if(self.$container.attr("class")==dialog){self.$container.attr("class","")}else{self.$container.attr("class",dialog);loginDialog=orion.app.dialogManager.getDialog("login");loginDialog.pointTo(elem,"down");loginDialog.$.show()}}})};MyOrionBar.showDialog=function(dialog){if($.inArray(dialog,orion.modules.MyOrionBar.loading)<0&&orion.modules.MyOrionBar.loading.length){$("#"+dialog).hide()}if($.inArray(dialog,orion.modules.MyOrionBar.loading)>=0){orion.modules.MyOrionBar.loading=[]}};MyOrionBar.prototype.dialogClose=function(event){event.preventDefault();var content=this;var $dialogs=$(".dialog");$dialogs.hide();content.$container.attr("class","")};return MyOrionBar})(jQuery);
BBV.namespace("orion.modules").Playlist=orion.modules.Playlist||(function($){function Playlist(elem,publisher){var content,model,view;content=this;content.elem=elem;content.$=$(content.elem);if(!elem){throw new Error("Please provide an element to use for the orionBar.")}if(!(this instanceof Playlist)){throw new Error("Playlist called without new.")}content.publisher=publisher}Playlist.prototype={constructor:Playlist};return Playlist})(jQuery);
BBV.namespace("orion.modules").RecommendedForYou=orion.modules.RecommendedForYou||(function($,Model,View){function RecommendedForYouModel(elem){this.$=$(elem);this.i18n=orioni18n.recommendedForYou;this.pageSize=this.$.data("page-size")||6;this.allLink=this.$.data("showalllink");this.hideViewToggling=!!this.$.data("data-hide-view-toggling");this.viewstates=[{name:"GRID",template:"MediaGrid",size:this.pageSize,active:true},{name:"LIST",template:"MediaList",size:this.pageSize,active:false}];Model.call(this);return this}orion.util.inherits(RecommendedForYouModel,Model);function RecommendedForYouView(elem,model,publisher){this.$=$(elem);this.model=model;this.template=orion.templates.RecommendedForYou;this.publisher=publisher;View.call(this,model);this._handlers();return this}orion.util.inherits(RecommendedForYouView,View);RecommendedForYouView.prototype._handlers=function(){var self=this;this.$.on("click",".view-toggle a",function(){var $this=$(this);var $root=$this.closest(".view-toggle");var selected=this.parentNode.getAttribute("class").toUpperCase();var active=self._getActiveViewstate();if(active&&active.name!==selected){self._changeActiveItem(self.model.viewstates,"name",selected);self._renderItems();$root.find(".active").removeClass("active");$this.addClass("active")}return false})};RecommendedForYouView.prototype._getActiveViewstate=function(){var viewTpl=this.model.viewstates;for(var i=0;i<viewTpl.length;i++){if(viewTpl[i].active){return viewTpl[i]}}};RecommendedForYouView.prototype._changeActiveItem=function(items,keyParam,id){for(var i=0;i<items.length;i++){items[i].active=false;if(items[i][keyParam]===id){items[i].active=true}}};RecommendedForYouView.prototype._renderModuleBox=function(){var template=this.template;var i18n=this.model.get("i18n");var allLink=this.model.get("allLink");var data={title:i18n.titleHeading||"",preview:i18n.viewAsText||"",grid:i18n.gridOptionText||"",list:i18n.listOptionText||"",alllink:allLink||"",all:i18n.showAllText||"",hideView:this.hideViewToggling};var tpl=$(Mustache.to_html(template,data));this.$.html(tpl)};RecommendedForYouView.prototype._renderItems=function(){this.updateFeedContainer();this.$.find(".content-list ul").show()};function RecommendedForYou(elem,publisher){this.elem=elem;this.$=$(this.elem);if(!elem){throw new Error("Please provide an element to use for the orionBar.")}this.model=new RecommendedForYouModel(elem);this.view=new RecommendedForYouView(elem,this.model,publisher);this.publisher=publisher;this.initialize()}RecommendedForYou.prototype.initialize=function(){var self=this;orion.oesp.session.withSession(function(session){if(session.isAuthenticated()){self.view._renderModuleBox();self.update()}else{self.$.hide()}})};RecommendedForYou.prototype.update=function(session){var self=this;var feedReady=this._getFeed();feedReady.done(function(feedUrl){self.$.show();self.model.set("feedUrl",feedUrl,true);self.view.updateFeedContainer()}).fail(function(error){log("initRelated:",error);self.$.hide()})};RecommendedForYou.prototype._getFeed=function(){var self=this;var feedReady=new $.Deferred();var feed=self.$.data("baseurl");var additionalParams=self.$.data("params");var query=additionalParams?[additionalParams]:[];var params={origin:self.$.data("origin"),byTypes:self.$.data("types"),byVodSubtypes:self.$.data("vod-sub-types")};for(var item in params){query.push(item+"="+params[item])}if(query.length){query="?"+query.join("&");feed=feed+query}if(feed){feedReady.resolve(feed)}else{feedReady.reject("no feed for recommendations")}return feedReady};RecommendedForYouView.prototype.updateFeedContainer=function(){var self=this;var feedUrl=this.model.get("feedUrl");var $feedContainer=this.$.find(".content-list");var options={onRawDataReceived:function(rawData){if(rawData.results){rawData.entryCount=rawData.results.length;rawData.totalResults=rawData.results.length;self.model.set("items",rawData,true)}},feedData:self.model.get("items")||"",pageSize:self.model.get("pageSize"),isThumb:false};var viewstate=self._getActiveViewstate();$feedContainer.data("feed-url",feedUrl);$feedContainer.data("template",viewstate.template);new orion.widgets.FeedContainer($feedContainer,options);this.publisher.subscribe("feedLoaded:"+feedUrl,function(entryCount){if(!entryCount){self.$.hide();log("No recommendations")}});this.publisher.subscribe("feedFailed:"+feedUrl,function(){self.$.hide();log("No recommendations")})};return RecommendedForYou})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").Recommendations=orion.modules.Recommendations||(function($){function Recommendations(elem,publisher){var content,model,view;content=this;content.elem=elem;content.$=$(content.elem);if(!elem){throw new Error("Please provide an element to use for the orionBar.")}if(!(this instanceof Recommendations)){throw new Error("Recommendations called without new.")}content.publisher=publisher}Recommendations.prototype={constructor:Recommendations};return Recommendations})(jQuery);
BBV.namespace("orion.modules").MyDevices=orion.modules.MyDevices||(function($){function MyDevices(elem,publisher){var self=this;self.$=$(elem);self.$.content=$(elem).find(".content");self.templatesHolder=".device-dialog-templates";self.editTemplate='[data-role="edit-device"]';self.replaceTemplate='[data-role="replace-device"]';self.language=orioni18n.myDevices;self.publisher=publisher;self.createLoader();self.initialize();self.handlers()}MyDevices.prototype.initialize=function(){var self=this;self.$.trigger("loading");$.when(orion.oesp.deviceEndpoint.getDevicesRegistrationStatusInfo()).done(function(latestStatus){self.model=self.formatModel(latestStatus);self.$.trigger("loaded");self.render()})};MyDevices.prototype.editDevice=function(evt){evt.preventDefault();var self=this;var type="rename";var $me=$(evt.currentTarget);var id=$me.parents("[data-device-id]").data("device-id");self.render();var $node=$('[data-device-id="'+id+'"]');var $parent=$node.find(".placeholder-nav-wrap");var $editBody=$node.find(".device-body");var $title=$editBody.find(".device-title");var textValue=$title.text();var $editTpl=self.$.find(self.templatesHolder).find(self.editTemplate).clone();var titleInput=$editTpl.find(".device-input");titleInput.val(textValue);$editBody.prepend($editTpl);$parent.hide();$node.addClass("edit active");$title.hide();$editTpl.fadeIn();$editTpl.on("click",'[data-action="rename"]',this.renameOrReplace.bind(this,type));$editTpl.on("click",'[data-action="rename-cancel"]',this.closeRename.bind(this))};MyDevices.prototype.closeRename=function(evt){evt.preventDefault();var self=this;var $me=$(evt.currentTarget);var $node=$me.parents("[data-device-id]");var $parent=$node.find(".placeholder-nav-wrap");var $dialog=$node.find(self.editTemplate);var $editBody=$node.find(".device-body");var $title=$editBody.find(".device-title");$dialog.slideUp(300,function(){$node.removeClass("edit active");$title.fadeIn();$parent.show();$(this).remove()})};MyDevices.prototype.replaceDevice=function(type,evt){var self=this;evt.preventDefault();var $me=$(evt.currentTarget);var id=$me.parents("[data-device-id]").data("device-id");self.render();var $node=$('[data-device-id="'+id+'"]');var $parent=$node.find(".placeholder-nav-wrap");var $dialog=self.$.find(self.templatesHolder).find(this[type+"Template"]).clone();$node.addClass("replace active");$parent.hide();$parent.after($dialog);$dialog.fadeIn(450);$dialog.on("click",'[data-action="'+type+'-ok"]',this.renameOrReplace.bind(this,type));$dialog.on("click",'[data-action="'+type+'-cancel"]',this.closeDialog.bind(this,type))};MyDevices.prototype.renameOrReplace=function(type,evt){evt.preventDefault();var self=this;var $me=$(evt.currentTarget);var $node=$me.parents("[data-device-id]");var $editBody=$node.find(".device-body");var $title=$editBody.find(".device-title");var deviceToRegister={deviceId:self.getReplaceDeviceId(),deviceName:"My Computer",customerDefinedName:"My Computer",deviceClass:orion.oesp.req.DeviceEndpoint.DeviceClass.DESKTOP};var renameParams={deviceId:$node.data("device-id"),deviceName:$node.data("device-name"),customerDefinedName:$node.find(".device-input").val(),deviceClass:$node.data("device-class")};var requestParams=type==="rename"?renameParams:deviceToRegister;var targetDeviceId=renameParams.deviceId;$.when(orion.oesp.deviceEndpoint.updateOrReplaceDevice(requestParams,targetDeviceId)).done(function(){self.initialize();if(type==="replace"){self.doCallback()}})};MyDevices.prototype.closeReplace=function(evt){evt.preventDefault();var $me=$(evt.currentTarget);var $node=$me.parents("[data-device-id]");var $parent=$node.find(".placeholder-nav-wrap");var $dialog=$node.find(this.replaceTemplate);$dialog.slideUp(300,function(){$parent.fadeIn();$node.removeClass("replace active");$(this).remove()})};MyDevices.prototype.refresh=function(evt){var $me=$(evt.currentTarget);if($me.hasClass("active")){$me.removeClass("active")}else{$me.addClass("active")}this.initialize()};MyDevices.prototype.closeDialog=function(type,evt){evt.preventDefault();var $me=$(evt.currentTarget);var $node=$me.parents("[data-device-id]");var $dialog=$node.find(this[type+"Template"]);var $prevVisibleItems=$node.find(".placeholder-nav-wrap");$dialog.slideUp(300,function(){$prevVisibleItems.fadeIn();$node.removeClass(type+" active");$(this).remove()})};MyDevices.prototype.handlers=function(){var self=this;self.$.content.on("click",'[data-action="edit"]',this.editDevice.bind(this));self.$.content.on("click",'[data-action="replace"]',this.replaceDevice.bind(this,"replace"));self.$.content.on("click",'[data-action="refresh"]',this.refresh.bind(this))};MyDevices.prototype.isReplaceWorkflow=function(){return(/\/replace\/.+/.test(window.location.pathname))};MyDevices.prototype.getReplaceDeviceId=function(){var uriComponents=window.location.pathname.split("/");var deviceId=uriComponents[uriComponents.length-1];return deviceId};MyDevices.prototype.doCallback=function(){var callbackURL=orion.util.url.getParam(window.location.href,"callback");if(callbackURL){window.location.href=callbackURL}};MyDevices.prototype.render=function(){var self=this;var partials={DeviceGridDialog:orion.templates.DeviceGridDialog,DeviceGridItem:orion.templates.DeviceGridItem,DeviceGrid:orion.templates.DeviceGrid};var html=Mustache.to_html(orion.templates.MyDevices,self.model,partials);self.$.content.html(html)};MyDevices.prototype.formatModel=function(data){var self=this;var isReplaceWorkflow=self.isReplaceWorkflow();var formattedModel=data;var devicesCount=formattedModel.devices.length;var fakedDevice={fakedDevice:true};var lang={};BBV.extend(lang,self.language);while(devicesCount<formattedModel.maxRegisteredDevices){formattedModel.devices.push(fakedDevice);devicesCount++}$.each(formattedModel.devices,function(){this["isReplaceWorkflow"]=isReplaceWorkflow});formattedModel.isReplaceWorkflow=isReplaceWorkflow;if(self.isReplaceWorkflow()){formattedModel.replaceDeviceId=self.getReplaceDeviceId()}formattedModel.infoLink=self.$.data("info-link");if(lang.mydevicesregisteredbodytext&&data){lang.mydevicesregisteredbodytext=Mustache.to_html(lang.mydevicesregisteredbodytext,{"0":data.currentRegisteredDevices?data.currentRegisteredDevices:"0","1":data.maxRegisteredDevices?data.maxRegisteredDevices:""})}formattedModel.i18n=lang;return formattedModel};MyDevices.prototype.createLoader=function(){var self=this;self.loader=self.$.loader({element:{overlay:"<div/>"},flow:["overlay"],target:self.$.content,minwidth:"100%",minheight:200,img:{top:"120px"}})};return MyDevices})(jQuery);
BBV.namespace("orion.modules").MyRentals=orion.modules.MyRentals||(function($){function MyRentals(elem,publisher){var content,model,view;content=this;content.elem=elem;content.$=$(content.elem);if(!elem){throw new Error("Please provide an element to use for the orionBar.")}if(!(this instanceof MyRentals)){throw new Error("MyRentals called without new.")}content.publisher=publisher}MyRentals.prototype={constructor:MyRentals};return MyRentals})(jQuery);
BBV.namespace("orion.modules").ASpot=orion.modules.ASpot||(function($){var instanceCounter=0;var params={menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"transparent"};var attributes={id:"Liberty"};function monkeyPatch(flashVars,data){var mediaItems=data.mediaItems||[];if(mediaItems.length>0){var mediaItem=mediaItems[0];mediaItem=BBV.extend(mediaItem,orion.util.mediamethods);if(mediaItem.isMyPrime()){var patchedURLs=BBV.settings.site.urls;patchedURLs.category.tv=patchedURLs.category.myprime.tv;patchedURLs.media.tv=patchedURLs.media.myprime.tv;patchedURLs.media.movie=patchedURLs.media.myprime.movie;patchedURLs.mediagroup.tv=patchedURLs.mediagroup.myprime.tv;patchedURLs.mediagroup.movie=patchedURLs.mediagroup.myprime.movie;if(BBV.settings.myPrime.backgroundImageUrlForASpot){flashVars.background=BBV.settings.myPrime.backgroundImageUrlForASpot}flashVars.siteURLs=encodeURIComponent(JSON.stringify(patchedURLs))}else{if(mediaItem.isTVMissed()){var patchedURLs=BBV.settings.site.urls;patchedURLs.category.tv=patchedURLs.category.tvmissed;patchedURLs.media.tv=patchedURLs.media.tvmissed;patchedURLs.mediagroup.tv=patchedURLs.mediagroup.tvmissed;flashVars.siteURLs=encodeURIComponent(JSON.stringify(patchedURLs))}else{var patchedURLs=BBV.settings.site.urls;patchedURLs.category.tv=patchedURLs.category.ondemand.tv;patchedURLs.media.tv=patchedURLs.media.ondemand.tv;patchedURLs.media.movie=patchedURLs.media.ondemand.movie;patchedURLs.mediagroup.tv=patchedURLs.mediagroup.ondemand.tv;patchedURLs.mediagroup.movie=patchedURLs.mediagroup.ondemand.movie;flashVars.siteURLs=encodeURIComponent(JSON.stringify(patchedURLs))}}}}function ASpot(elem,publisher){var aspot=this,model,view;var $elem=$(elem);var placeholder=$elem.find(".aspot-placeholder");var placeholderId="aspot-placeholder"+instanceCounter++;placeholder.attr("id",placeholderId);var pathContext=$elem.data("module-path-context");var flashVars={debug:false,siteURLs:encodeURIComponent(JSON.stringify(BBV.settings.site.urls)),stacked:$elem.data("stacked"),providers:$elem.data("providers"),i18n:$elem.data("i18n"),posterOrientation:$elem.data("poster-orientation"),countryCode:BBV.settings.oespRoutes.countryCode,languageCode:BBV.settings.oespRoutes.languageCode};var background=$elem.data("background");if(background){flashVars.background=background}var feed=$elem.data("feed-url");var swfPath=$elem.data("swf-path");var isAspotForMediaGroup=feed.indexOf("byMediaGroupId")!==-1;if(isAspotForMediaGroup){feed+="&sort=secondaryTitle"}if(pathContext&&(pathContext==="tv_tv-series"||pathContext==="ondemand_tv-series")){feed+="&byMediaType=Episode"}orion.util.oesp.get(feed,{success:function(data){flashVars.jsonData=encodeURIComponent(JSON.stringify(data));flashVars.token=orion.util.oesp.token;flashVars.username=orion.util.oesp.username;flashVars.iscenter=false;if(isAspotForMediaGroup){monkeyPatch(flashVars,data)}swfobject.embedSWF(swfPath,placeholderId,"100%","100%","10.0.0","expressInstall.swf",flashVars,params,attributes,function(e){if(e.success){log("ASpot: done embedding the swf: success.")}else{log("ASpot: there was an error embedding the swf.")}})},error:function(jqXHR,textStatus,errorThrown){log("ASpot: there was an error aquiring the feed.");log("ASpot error report:");log("jqXHR:",jqXHR);log(textStatus+": "+errorThrown)}});if($.isFunction(checkFlash)){checkFlash()}}return ASpot})(jQuery);
BBV.namespace("orion.modules").HorizonInspiredASpot=orion.modules.HorizonInspiredASpot||(function($){var instanceCounter=0;function initializeBasicAspot(timeout){var basicAspot=new LGI.BasicAspot("#template_basicaspot",{effect:"fade",fadeSpeed:500,autoplay:true,timeout:timeout})}HorizonInspiredASpot.prototype.alignAspotWithSubmenu=function(elem){var aspotHeight=0,submenuHeight=0,horizonAspot=elem.parent();if(!window.CQ&&$("#site-sub-navigation-bar").length){submenuHeight=$("#site-sub-navigation-bar").height();aspotHeight=horizonAspot.height();horizonAspot.height(aspotHeight-submenuHeight)}};HorizonInspiredASpot.prototype.makeBackgroundClickable=function($elem){$elem.find(".upc-aspot-item").click(function(e){var $link=$(this).find(".upc-aspot-content").data("location");if($link){window.location=$link;return false}});$elem.find(".upc-aspot-item").find("span, a, .button").click(function(e){e.stopPropagation()})};function HorizonInspiredASpot(elem,publisher){var aspot=this,model,view;var $elem=$(elem);this.alignAspotWithSubmenu($elem);var placeholder=$elem.find(".aspot-placeholder");var placeholderId="aspot-placeholder"+instanceCounter++;placeholder.attr("id",placeholderId);var pathContext=$elem.data("module-path-context");var feed=$elem.data("feed-url");var feedType=$elem.data("feed-type");var timeout=$elem.data("timeout")||8;if(feed.indexOf("byMediaGroupId")!==-1){feed+="&sort=secondaryTitle"}if(feedType==="cq"){feed+="?c="+new Date().getTime()}if(pathContext&&(pathContext==="tv_tv-series"||pathContext==="ondemand_tv-series")){feed+="&byMediaType=Episode"}orion.util.oesp.get(feed,{success:function(data){var idx=1;$.extend(true,data,{i18n:{prev:orioni18n.horizonInspiredAspot.i18n_Previous,next:orioni18n.horizonInspiredAspot.i18n_Next,rent:orioni18n.horizonInspiredAspot.i18n_Rent,more:orioni18n.horizonInspiredAspot.i18n_More},getBg:function(){return function(text){if(text.indexOf("aspot-large")>-1){return"style=\"background-image: url('"+text.replace("aspot-large","")+"');\""}}},getBoxart:function(){return function(text){if(text.indexOf("boxart-large")>-1){return"style=\"display:block;background-image: url('"+text.replace("boxart-large","")+"');\""}}},hasBoxart:function(){var retVal=false;var images=this.images;for(index in images){if(images[index]["assetType"]==="boxart-large"&&images[index]["url"]){retVal=true;break}}return retVal},idx:function(){return idx++},getUrl:function(){return function(text){return BBVSettingsObject.site.urls.mediagroup[text.toLowerCase()]}},isVisible:function(){return function(text){return parseInt(text)<2?'style="display:none;"':""}},getFormattedBroadcastDate:function(){return function(text){return BBV.utils.date(parseInt(text)).format(BBV.settings.l10n.date.shortformat)}},getCSSColorForField:function(){return function(field){var default_color="white";var colorVal=default_color;if(field==="title"){colorVal=this.config.assetColor||default_color}else{if(field==="description"){colorVal=this.config.assetDescriptionColor||default_color}}return colorVal}}});var $templ=null;if(data.source==="cq"){$templ=$(Mustache.to_html(orion.templates.HorizonInspiredASpotCQData,data))}else{$templ=$(Mustache.to_html(orion.templates.HorizonInspiredASpotFeedData,data))}$elem.html($templ);if(data.source==="cq"){aspot.makeBackgroundClickable($elem)}else{$elem.find(".description").ellipsis({live:true})}$elem.find(".upc-aspot-item").find(".button").click(function(e){$link=$(this).find("a:first");$link[0].click()});var lambda=function(){initializeBasicAspot(timeout)};if(window.CQ&&CQ.Ext){CQ.Ext.onReady(lambda)}else{$(document).ready(lambda)}},error:function(jqXHR,textStatus,errorThrown){log("HorizonInspiredASpot: there was an error aquiring the feed.");log("HorizonInspiredASpot error report:");log("jqXHR:",jqXHR);log(textStatus+": "+errorThrown)}})}return HorizonInspiredASpot})(jQuery);
BBV.namespace("orion.modules").SearchResults=orion.modules.SearchResults||(function($){var $searchResultBox=$("#search-results-tabs");var searchEndpoint=new orion.oesp.req.SearchEndpoint();var viewstates={ONLINE:{template:"SearchResultsOnline",url:searchEndpoint.getVODSearchURL(),size:10},TV:{template:"SearchResultsTv",url:searchEndpoint.getEPGSearchURL(),size:10}};function readUrlString(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}}function parseParam(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj}function SearchResultsModel(content){var self=this;self.content=content;self.data=null;self.datamedia=[]}SearchResultsModel.prototype.getMediaRange=function(strt,stp){var model=this;return{medias:model.datamedia.slice(strt,stp)}};SearchResultsModel.prototype.areSameDate=function(d1,d2){return d1.getFullYear()==d2.getFullYear()&&d1.getMonth()==d2.getMonth()&&d1.getDate()==d2.getDate()};SearchResultsModel.prototype.isItNow=function(startTimestamp,endTimestamp){var now=this.currentTime;return now>startTimestamp&&now<endTimestamp};SearchResultsModel.prototype.getDateCaption=function(listingStartTimestamp,listingEndTimestamp,localStrings){var df=BBV.settings.i18n.dateformat,model=this,now=new Date(model.currentTime),tomorrowDate=new Date(now),rt=null;tomorrowDate.setDate(tomorrowDate.getDate()+1);rt=new Date(listingStartTimestamp);if(model.isItNow(listingStartTimestamp,listingEndTimestamp)){return localStrings.now}if(model.areSameDate(rt,now)){return localStrings.today}if(model.areSameDate(rt,tomorrowDate)){return localStrings.tomorrow}return df.dayNames[rt.getDay()+7]+" "+rt.getDate()+" "+df.monthNames[rt.getMonth()+12]};SearchResultsModel.prototype.update=function(data){var model=this;var content=model.content;var view=content.view;orion.oesp.session.done(function(session){var epgSearch=false,dateCaption=null;model.data=data;model.datamedia=[];if(view.element.attr("id")=="tv"&&!content.stations){setTimeout(function(){content.model.update(data)},250);return}$.each(model.data.results,function(index,group){if(group.listing){epgSearch=true}return true});if(epgSearch){var listings=[];$.each(model.data.results,function(index,group){listings.push(group.listing)});model.data.results=[];model.data.results.push({listings:listings})}$.each(model.data.results,function(index,group){if(group.catchup){group=group.catchup}else{if(group.ondemand){group=group.ondemand}}if(!group.mediaGroup){group.mediaGroup={title:"Missing mediaGroup"}}BBV.each(group,function(name,item){if(!item){log(name);log(item);log(group)}if(BBV.isArray(item)){BBV.each(item,function(index,items){BBV.each(content.stations,function(index,station){if(items.stationId==station.stationId){items.channelNumber=station.channelNumber;items.channelTitle=station.channelTitle;items.stationTitle=station.stationTitle;items.entitlements=station.entitlements;items.rbIsEntitled=session.hasRbEntitlement(station.entitlements)&&session.isAuthenticated()}});dateCaption=model.getDateCaption(items.startTime,items.endTime,content.localStrings);if(!model.linearGroup||(dateCaption!=model.linearGroup)){items.linearGroup=dateCaption;model.linearGroup=dateCaption}items.index=index;items.length=item.length;items.groupTitle=group.mediaGroup.title;items.localStrings=content.localStrings;BBV.extend(items,orion.util.mediamethods)})}else{if(item){item.index=0;item.length=group.length;item.groupTitle=group.mediaGroup.title;item.localStrings=content.localStrings}BBV.extend(item,orion.util.mediamethods)}});model.datamedia.push(group)});view.counts(view.element.attr("id"),model.data.totalResults);content.$.trigger("loaded");if(model.data.entryCount==0){$("#"+view.element.attr("id")).find(".no-results").show()}else{$("#"+view.element.attr("id")).find(".no-results").hide();model.content.view.notify(data)}view.RemoteBookings.getRemoteBookings()})};function SearchResultsView(c){var view=this,content;view.notifications={};view.content=content=c;view.model=content.model;view.initialized=false;view.root=view.content.$;view.currentview=(function(){if(window.location.hash.substr(1).toUpperCase()==="TV"){view.root.find(".tabs > li").removeClass("active");view.root.find(".tabs > li:eq(1)").addClass("active");view.root.find(".panel").removeClass("active");view.root.find(".panel:eq(1)").addClass("active")}var current=view.root.find(".tabs > li.active > a").attr("href").substr(1);if(current){return viewstates[current.toUpperCase()]}})();view.element=$(view.root.find(".tabs > li.active > a").attr("href"));view.start=1;view.end=view.currentview.size;return view}SearchResultsView.prototype.bind=function(){var view=this,model=view.model,feed=Mustache.to_html(orion.templates[view.currentview.template],model.getMediaRange(0,view.currentview.size)),selector=$(".active .results .results-list").length>0?".results .results-list>ul":".results";feed=$(".active .results .results-list").length>0?$($(feed).html()).html():feed;view.element=$(view.root.find(".tabs > li.active > a").attr("href"));view.element.find(selector).append(feed)};SearchResultsView.prototype.handlers=function(){var view=this,content=view.content,model=content.model,controller=content.controller;view.subscribe("bind",view.bind).subscribe("rendered",function(data){if($.isArray(data)){return}var selectors=content.$.find(".panel.active .list-view>li:not(.header)");var selector=content.$.find(".panel.active .list-view>li:not(.loading-wrapper, .header)").last();var idx=selectors.index(selector)+1;content.$.off("inview",".results-list");selector.on("inview",function(e,isInView){var current=view.root.find(".tabs > li.active > a").attr("href").substr(1).toUpperCase();if(view.end===idx&&view.end<controller.getTotalResult()&&isInView){view.scroll();selector.off("inview")}else{if(idx>=controller.getTotalResult()){selector.off("inview")}}});$(".cut-description").ellipsis({live:false})});content.$.loader({flow:["insert"],target:".panel:visible .results",minheight:200,minwidth:926});if(content.$.find(".tabs").find(".tab").length){var $first=content.$.find(".tabs .tab:eq(0)"),$active=content.$.find(".tabs .active a");if(!$active.length){$first.addClass("active")}}this.RemoteBookings.delegate(".searchresults",[".btn-record","#dvr-settings-link"]);this.RemoteBookings.delegate(".user-options",["#dvr-settings-link"]);content.$.find(".tabs").delegate("a","click",function(e){var $root=content.$.find(".tabs"),$this=$(this),$active=$root.find(".active"),$parent=$($this.context.parentNode),currentview=$this.attr("href").substr(1);controller.abortedId=controller.abort?view.element.attr("id"):"";orion.util.oesp.abortRequest(orion.util.oesp.xhr[view.element.attr("id")]);view.element=$($this.attr("href"));$(view.element).find(".no-results").hide();if(!$parent.hasClass("active")){$active.removeClass("active");$active=$parent.addClass("active")}content.$.trigger("loaded");if(viewstates[currentview.toUpperCase()]!==view.currentview){$(".results .results-list").remove();view.currentview=viewstates[currentview.toUpperCase()];view.root.find(".panel").removeClass("active");view.root.find("#"+currentview).addClass("active");var tab=$(".tabs").find("a");if(tab.length>1){var onlineTabCount=$(tab[0]).children(".count").data("itemCount");var tvTabCount=$(tab[1]).children(".count").data("itemCount");if((onlineTabCount==0&&currentview.toUpperCase()=="ONLINE")||(tvTabCount==0&&currentview.toUpperCase()=="TV")){$("#"+view.element.attr("id")).find(".no-results").show();return}}if(!$($this.attr("href")).find(".results-list").length){view.start=1;view.end=view.currentview.size;content.view.initialized=false;controller.page={};controller.page.tv=1;controller.page.online=1;if(model.linearGroup){delete model.linearGroup}controller.load()}else{var page=controller.page[controller.getActiveTab()];var actualResults=$(".panel.active .list-view>li:not(.loading-wrapper)").length;view.start=page*view.currentview.size-view.currentview.size+1;view.end=actualResults<(page*view.currentview.size)?actualResults:(page*view.currentview.size);controller.update()}}return false});content.$.find(".show-more a").live("click",function(e){e.preventDefault();var $this=$(this),$hiddenItems=$this.closest(".grouped-media-items").find(".hidden-items");model=view.model;$hiddenItems.slideToggle();$.trim($this.find(".toggler").text())==$.trim($this.attr("data-text-expand"))?$this.find(".toggler").text($.trim($this.attr("data-text-collapse"))):$this.find(".toggler").text($.trim($this.attr("data-text-expand")));return false})};SearchResultsView.prototype.pagination=function(){};SearchResultsView.prototype.counts=function(view,count){var $tab=$(".tabs a[href=#"+view+"] .count");$tab.text("("+count+")").data("itemCount",count);this.numCounts=this.numCounts||0;this.numCounts++;if(this.numCounts==2){this.setActiveTab()}};SearchResultsView.prototype.setActiveTab=function(){var tab=$(".tabs").find("a");var self=this;for(i=0;i<tab.length;i++){var onlineTabCount=$(tab[0]).children(".count").data("itemCount");var tvTabCount=$(tab[1]).children(".count").data("itemCount");if(onlineTabCount&&tvTabCount>0){return}if(onlineTabCount===0&&tvTabCount>0){self.content.controller.abort=false;$(".tabs a[href=#tv]").trigger("click")}}};SearchResultsView.prototype.notify=function(name,data_){var view=this,data=(BBV.type(name)==="string")?data_||{}:name;if(BBV.type(name)==="string"){view.notifications[name].call(view,data);return}BBV.each(view.notifications,function(name,notification){notification.call(view,data)})};SearchResultsView.prototype.scroll=function(){var view=this,controller=view.content.controller;view.start=view.end+1;view.end=view.end+view.size;controller.update(view.currentview.url)};SearchResultsView.prototype.subscribe=function(name,fn){var view=this;view.notifications[name]=fn;return view};function SearchResultsController(content,url){var self=this;self.page={};self.page.tv=1;self.page.online=1;self.content=content;self.abort=true;self.feed=new BBV.feed(self.content.$.attr("id"),{xhrId:content.view.element.attr("id"),url:readUrlString(url).url,withoutCache:true,callback:function(){content.model.update(this.data)}})}SearchResultsController.prototype.createFeed=function(paramxhrId){var self=this;var hash=window.location.hash.substr(1).toUpperCase();if(!hash){hash="ONLINE"}return new BBV.feed(self.content.$.attr("id"),{xhrId:paramxhrId,url:readUrlString(viewstates[hash].url).url,withoutCache:true,callback:function(){if(this.query.xhrId!=self.abortedId){self.content.model.update(this.data)}}})};SearchResultsController.prototype.clearParams=function(){var controller=this,content=controller.content;content.appliedFilters.params={};return controller};SearchResultsController.prototype.removeParam=function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.each(content.appliedFilters.params,function(name,value){if(content.appliedFilters.params[name]){delete content.appliedFilters.params[name]}});return controller};SearchResultsController.prototype.serializeParams=function(){var controller=this,qs=[];if(controller.content.appliedFilters.default_){qs.push(controller.content.appliedFilters.default_)}BBV.each(controller.content.appliedFilters.params,function(name,val){qs.push(val)});controller.feed.settings.data=qs.join("&")};SearchResultsController.prototype.setParam=function(param_){var controller=this,content=controller.content,param=parseParam(param_);BBV.extend(content.appliedFilters.params,param);return controller};SearchResultsController.prototype.load=function(){var controller=this,content=controller.content,model=content.model,view=content.view,searchTerm=BBV.utils.uri.builder(window.location.href).params.q,current=view.root.find(".tabs > li.active > a").attr("href").substr(1).toUpperCase();model.datamedia=[];$(".search-terms").text(searchTerm.replace(/\+/gi," "));if(!content.view.initialized){var url,viewId;if(window.location.hash.substr(1).toUpperCase()==="TV"){url=viewstates.ONLINE.url;viewId="online"}else{url=viewstates.TV.url;viewId="tv"}orion.oesp.session.done(function(session){var params="&q="+encodeURIComponent(searchTerm)+"&range=1-1";if(session.isAuthenticated()){params+="&personalised=true"}orion.util.oesp.get(url+params,{success:function(data){view.counts(viewId,data.totalResults)},error:function(){content.$.trigger("loaded")}});content.view.initialized=true;controller.load()})}else{var feed=controller.createFeed(content.view.element.attr("id"));orion.oesp.session.done(function(session){var params="&q="+encodeURIComponent(searchTerm)+"&range="+view.start+"-"+view.end;if(session.isAuthenticated()){params+="&personalised=true"}feed.update(view.currentview.url+params)});content.$.trigger("loading")}};SearchResultsController.prototype.update=function(startViewUrl){var controller=this,content=controller.content,actualTab=controller.getActiveTab(),view=content.view,page=controller.page[actualTab]+1,model=content.model,current=view.root.find(".tabs > li.active > a").attr("href").substr(1).toUpperCase(),searchTerm=BBV.utils.uri.builder(window.location.href).params.q;if(window.location.hash.substr(1).toUpperCase()==="TV"){url=viewstates.ONLINE.url;viewId="online"}else{url=viewstates.TV.url;viewId="tv"}orion.oesp.session.done(function(session){var params="&q="+encodeURIComponent(searchTerm)+"&range=1-1";if(session.isAuthenticated()){params+="&personalised=true"}orion.util.oesp.get(url+params,{success:function(data){view.counts(viewId,data.totalResults)},error:function(){content.$.trigger("loaded")}});content.view.initialized=true;view.start=page*view.currentview.size-view.currentview.size+1;view.end=controller.getTotalResult()<(page*view.currentview.size)?controller.getTotalResult():(page*view.currentview.size);var params="&q="+encodeURIComponent(searchTerm)+"&range="+view.start+"-"+view.end;var feed=controller.createFeed(content.view.element.attr("id"),content);controller.feed.settings.xhrId=content.view.element.attr("id");if(session.isAuthenticated()){params+="&personalised=true"}feed.update(view.currentview.url+params);content.$.trigger("loading");$(".results .loading-wrapper").css("position","relative");controller.page[actualTab]=controller.page[actualTab]+1})};SearchResultsController.prototype.getActiveTab=function(){return $(".searchresults .tab.active a").attr("href").split("#")[1]};SearchResultsController.prototype.getTotalResult=function(){return parseInt($(".searchresults .tab.active a span").text().replace("(",""))};SearchResultsController.prototype.getChannels=function(){var controller=this,content=controller.content,model=content.model,view=content.view;orion.util.oesp.get(orion.oesp.routes.channels,{xhrId:"oespChannels",success:function(data){content.stations=[];$.each(data.channels,function(index,channel){$.each(channel.stationSchedules,function(index,station){var stationData={};stationData.channelNumber=channel.channelNumber;stationData.channelTitle=channel.title;stationData.stationId=station.station.id;stationData.stationTitle=station.station.title;stationData.entitlements=station.station.entitlements;content.stations.push(stationData)})})}})};SearchResults.prototype.init=function(elem,publisher){orion.oesp.timeEndpoint=orion.oesp.timeEndpoint||new orion.oesp.req.TimeEndpoint();var self=this;var url;var hash=window.location.hash.substr(1).toUpperCase();if(!hash){hash="ONLINE"}url=viewstates[hash].url;self.root=elem;self.$=$(elem);self.localStrings=orioni18n.searchResults;self.model=new SearchResultsModel(self);var nowOnServer=orion.oesp.timeEndpoint.getTimeForRequest();nowOnServer.done(function(date){viewstates.ONLINE.url=searchEndpoint.getVODSearchURL()+"&byBroadcastTime=0-"+date;viewstates.TV.url=searchEndpoint.getEPGSearchURL()+"&byBroadcastTime="+date+"-"+(date+7*24*60*60*1000);self.model.currentTime=date;self.view=new SearchResultsView(self);self.controller=new SearchResultsController(self,url);self.appliedFilters={default_:readUrlString(url).query,params:{}};self.view.RemoteBookings=new orion.modules.EPG.RemoteBookings(publisher);self.view.RemoteBookings.initialize();self.view.handlers();self.controller.load();self.controller.getChannels()})};function SearchResults(elem,publisher){var self=this;self.init(elem,publisher);orion.app.subscribe("loggedIn",function(){$(".results .results-list").remove();self.controller.content.$.find(".tabs").undelegate();self.init(elem,publisher)})}return SearchResults})(jQuery);
BBV.namespace("orion.modules").TitleCard=orion.modules.TitleCard||(function($){var $sectionWrapper,$tabWrapper,$tabs,$sections;var viewstates={GRID:{size:10},LIST:{size:20}};function TitleCard(elem){var self=this,model,view,$elem=$(elem);if(!elem){throw new Error("Please provide an element to use for the TitleCard.")}if(!(self instanceof TitleCard)){throw new Error("TitleCard called without new.")}self.$=$elem;self.model=model={};self.view=view={root:elem,$:$elem};self.currentview=(function(){var current=view.$.find(".view-toggle > li").has(".active").attr("class");if(current){return viewstates[current.toUpperCase()]}})();self.initialize()}TitleCard.prototype.initialize=function(){var self=this;var isNetworkCard=$("div[data-module-type=NetworkCard]").length;$mediaItemTitleCard=$("[data-module-type=MediaItemTitleCard]");$tabs=self.$.find(".tab");$sectionWrapper=self.$.children(".section");$tabWrapper=self.$.find(".tabs");$sections=$sectionWrapper.children(".section");$groupsections=$(".title-card.group.module, div[data-module-type=NetworkCard] .tab");orion.oesp.session.done(function(session){self.$.find(".feed-container").each(function(){var $feedContainer=$(this);if(!$feedContainer.data("feedUrl")){$feedContainer.data("feedUrl",session.isAuthenticated()?$feedContainer.data("feedLoggedInUrl"):$feedContainer.data("feedLoggedOutUrl"))}var fc=new orion.widgets.FeedContainer($feedContainer);$groupsections.each(function(){var $section=$(this);if((isNetworkCard&&$section.find("a").attr("href")==="#"+$feedContainer.closest(".section:not(.content-list)").attr("id")||!isNetworkCard)){if($section.hasClass("hidden")){orion.app.subscribe("feedLoaded:"+$feedContainer.data("feedUrl"),function(entryCount,mediaGroups){var grouped=false;if(mediaGroups){if(mediaGroups[0].groupType==undefined||mediaGroups[0].groupType==""){grouped=false}else{grouped=true}}if((isNetworkCard&&entryCount>0)||(!isNetworkCard&&entryCount>1)||grouped){$section.removeClass("hidden")}})}}})});self.$.find(".listing-container").each(function(){var $listingContainer=$(this);var lc=new orion.widgets.ListingContainer($listingContainer)});self.bindEvents();if(isNetworkCard){self.checkHashForTabId()}})};TitleCard.prototype.activateTab=function($tab){if(!(!!$tab.jquery&&$tab.length===1&&$tab[0].tagName==="LI"&&$tab.hasClass("tab"))){!!window.console&&!!console.error&&console.error("Problem details: ",!!$tab.jquery,$tab.length===1,$tab[0].tagName==="LI",$tab.hasClass("tab"));throw new Error("Please provide a tab element to activate.")}var self=this;var idToActivate=$tab.find("a").attr("href");var sectionToActivate=$sections.filter(idToActivate);var tabsCurrentView=sectionToActivate.find(".active").parent().attr("class");if($tabs.filter(".active").eq(0).is($tab)&&sectionToActivate.css("display")==="block"){return false}if(sectionToActivate.length<1){throw new Error("Could not find a section associated with the selected tab.")}$tabs.removeClass("active");$tab.addClass("active");$sections.hide();sectionToActivate.show();if(typeof tabsCurrentView!=="undefined"){self.currentview=viewstates[tabsCurrentView.toUpperCase()]}facebook.parse();return true};TitleCard.prototype.checkHashForTabId=function(){var self=this,$selectedTab=$tabs.filter(':has(a[href="'+location.hash+'"])');if($selectedTab.length>0){self.activateTab($selectedTab)}else{self.activateTab($tabs.eq(0))}};TitleCard.prototype.bindEvents=function(){var self=this;$tabWrapper.undelegate(".tab","click").delegate(".tab","click",function(){var $this=$(this);return self.activateTab($this)});self.$.find(".meta-info .cast a").click(function(){var $castContainer=$(this).closest(".cast");if($castContainer.hasClass("less")){$castContainer.removeClass("less").addClass("more")}else{$castContainer.removeClass("more").addClass("less")}});self.$.find(".view-toggle").delegate("a","click",function(e){var $this=$(this);var $targetTab=$this.closest(".section");var $viewToggle=$targetTab.find(".view-toggle");var $feedContainer=$targetTab.find(".feed-container");var currentview=$this.context.parentNode.getAttribute("class");if(viewstates[currentview.toUpperCase()]!==self.currentview){self.currentview=viewstates[currentview.toUpperCase()];$feedContainer.children().hide();$feedContainer.find("."+currentview+"-view").show();$viewToggle.find(".active").removeClass("active");$this.addClass("active")}return false});$(window).hashchange(function(){})};return TitleCard})(jQuery);
BBV.namespace("orion.modules").TitleCardNG=orion.modules.TitleCardNG||(function($,Model,View,actionBar,offers){function TitleCardNGModel(){var self=this;Model.call(self)}orion.util.inherits(TitleCardNGModel,Model);function TitleCardNGView(model,elem,publisher){this.$=$(elem);this.model=model;this._listingsContainer="#listings";this.moreEpisodesBtnClass=".more .more-btn";this.titlecardDescriptionTemplate=orion.templates.TitleCardDescription;View.call(self,model);this._handlers()}orion.util.inherits(TitleCardNGView,View);TitleCardNGView.prototype.showMoreText=function(evt){evt.preventDefault();var $me=$(evt.currentTarget);var txt=$me.closest(".value");txt.html(txt.data("original"))};TitleCardNGView.prototype._handlers=function(){this.$.on("click",".more-btn",this.showMoreText.bind(this))};TitleCardNGView.prototype.renderListings=function(options){var elem=this.$.parent().find(this._listingsContainer);var settings=options||{};var model=this.model;if(options&&model.get("listingEndTime")){settings.startTime=model.get("listingEndTime")}var listings=new orion.widgets.ListingContainer(elem,settings);return listings};function TitleCardNG(elem,publisher){$("#backgrounds-div-container").hide();var self=this;this.publisher=publisher;this.$=$(elem);this.listingsContainer="#listings-wrap";this._listingsDefaultDisplaySize=5;if(!(this instanceof TitleCardNG)){return new TitleCardNG(elem)}this.model=new TitleCardNGModel();this.view=new TitleCardNGView(self.model,elem,publisher);orion.oesp.timeEndpoint=orion.oesp.timeEndpoint||new orion.oesp.req.TimeEndpoint();this._offers=new offers();this._actionBar=new actionBar();this._relatedContainer=".title-card.related";this.changeBookmarks=this.changeBookmarks.bind(this);this.createLoader()}TitleCardNG.prototype.createLoader=function(){var self=this;self.loader=self.$.loader({element:{overlay:"<div/>"},flow:["append","overlay"],location:"outside",target:"#item",minwidth:"100%",minheight:300,img:{top:"150px"}})};TitleCardNG.prototype.createPlayer=function(playerType){this._slplayer=new orion.modules.SLVideoPlayer($(".video-player-module"),playerType);this._playerType=playerType};TitleCardNG.prototype.renderDescription=function(data){this.$.empty();this.$.data("listing-id",data.id);$tmp=$(Mustache.to_html(this.view.titlecardDescriptionTemplate,data));this.$.html($tmp.hide().fadeIn("slow"));var stringChars=50;var moreText=orioni18n.titleCardCommon.moreText;this.view.$.find(".additional-info span.value").each(function(){if($(this).text().length>stringChars){$(this).data("original",$(this).text());var text=$(this).text().slice(0,stringChars-(moreText.length+5));text=text.split(", ");text.pop();$(this).html(text.join(", ")+' <a href="#" class="more-btn">'+moreText+"</a>")}});orion.app.trigger("titlecardDescriptionRendered")};TitleCardNG.prototype.initRelated=function(mediaGroup,mediaItems){var self=this;var $relatedContainer=$(self._relatedContainer);var $feedContainer=$relatedContainer.find(".feed-container");var $relatedTitle=$relatedContainer.find(".related-title");var rengVersion=parseInt($relatedContainer.data("reng-version"),10);var relatedFeedURLResolved=new $.Deferred();if(rengVersion==2){orion.oesp.session.withSession(function(session){var relatedFeed=$relatedContainer.data("default-feed");if(session.isAuthenticated()){var rengBaseURL=$relatedContainer.data("reng-baseurl");var rengOrigin=$relatedContainer.data("reng-origin");var rengTypes=$relatedContainer.data("reng-types");var rengVodSubTypes=$relatedContainer.data("reng-vod-sub-types");relatedFeed=rengBaseURL;relatedFeed+=((relatedFeed.indexOf("?")==-1)?"?":"&");if(rengOrigin){relatedFeed=relatedFeed+"origin="+rengOrigin;relatedFeed+="&"}if(rengTypes){relatedFeed=relatedFeed+"byTypes="+rengTypes;relatedFeed+="&"}if(rengVodSubTypes){relatedFeed=relatedFeed+"byVodSubtypes="+rengVodSubTypes;relatedFeed+="&"}relatedFeed=relatedFeed+"byMediaGroupId="+mediaGroup.id}if(relatedFeed){relatedFeedURLResolved.resolve(relatedFeed)}else{relatedFeedURLResolved.reject("no feed for recommendations")}})}else{if(rengVersion==1){orion.oesp.session.withSession(function(session){var mediaGroupGenre=mediaGroup.getMajorGenre();var relatedFeed=$relatedContainer.data("default-feed");if(relatedFeed){var addGenre=!!$relatedContainer.data("default-feed-add-genre");if(addGenre&&mediaGroupGenre){relatedFeed+="&byCategoryIds="+mediaGroupGenre.id}}else{relatedFeed=BBV.settings.oespRoutes.mediagroups;if(mediaGroupGenre){relatedFeed+="?byCategoryIds="+mediaGroupGenre.id}}$feedContainer.data("exclude-id",mediaGroup.id);var isAdult=mediaGroup.isAdult;if(session.isAuthenticated()&&!isAdult){var byRecId=mediaGroup.id;var items=mediaItems||[];if(!mediaGroup.isMovie()&&items.length){byRecId=items[0].id}relatedFeed=BBV.settings.oespRoutes.recommendationsrelated+"/"+byRecId+"/?origin=1";$feedContainer.data("exclude-id","")}if(isAdult){relatedFeed+="&includeAdult=true"}if(relatedFeed){relatedFeedURLResolved.resolve(relatedFeed)}else{relatedFeedURLResolved.reject("no feed for recommendations")}})}else{relatedFeedURLResolved.reject("no recommendation module")}}$.when(relatedFeedURLResolved).done(function(feedUrl){if(!$feedContainer.data("feedUrl")){$feedContainer.data("feedUrl",feedUrl)}var options={isThumb:false,beforeRender:function(items){$.each(items,function(){this.buildMediaUrl=function(){var self=this;var assetId=self.mediaGroupId||self.id;var url;url=[encodeURIComponent(assetId),self.encodeTitle()];if(self.medium){if(self.isMyPrime()){url.unshift(BBV.settings.site.urls.mediagroup.myprime[self.medium.toLowerCase()])}else{if(self.isTVMissed()){url.unshift(BBV.settings.site.urls.mediagroup.tvmissed)}else{url.unshift(BBV.settings.site.urls.mediagroup.ondemand[self.medium.toLowerCase()])}}}else{log("Broken mediagroup, missing medium on id: "+encodeURIComponent(assetId)+" title: "+self.encodeTitle())}return url===undefined?"#":url.join("/")+".html"}})},onRawDataReceived:function(rawData){if(rengVersion==2&&rawData.results){rawData.entryCount=rawData.results.length;rawData.totalResults=rawData.results.length}}};var fc=new orion.widgets.FeedContainer($feedContainer,options);orion.app.subscribe("feedLoaded:"+feedUrl,function(entryCount){if(entryCount){fc.$.parents(".related-module").slideDown();$relatedTitle.fadeIn()}else{fc.$.parents(".related-module").hide();log("No recommendations")}});orion.app.subscribe("feedFailed:"+feedUrl,function(){fc.$.parents(".related-module").hide();log("No recommendations")})}).fail(function(error){log("initRelated:",error);$relatedContainer.hide()});return};TitleCardNG.prototype.getBookmarks=function(groupId){var self=this;var publisher=orion.app;var bookmarksData=$.Deferred();var bookmarkQueryParams={byMediaGroupId:groupId};orion.oesp.session.done(function(session){if(!session.isAuthenticated()){bookmarksData.resolve("");return}var bookmarksRequest=orion.oesp.bookmarkEndpoint.get(bookmarkQueryParams);bookmarksRequest.done(function(data){self.model.set("bookmarks",data.bookmarks,true);log("TitleCard::","Bookmarks loaded",data.bookmarks);bookmarksData.resolve(data.bookmarks);publisher.trigger("bookmarksLoaded")});bookmarksRequest.fail(function(){bookmarksData.resolve("");log("MediaTitleCard::","Bookmarks cannot be loaded!")})});return bookmarksData.promise()};TitleCardNG.prototype.setBookmarks=function(items){var bookmarks=this.model.get("bookmarks");if(bookmarks&&items){var i;var state;var bookmarkid;var bookmarkesIds={};for(i=0;i<bookmarks.length;i++){bookmarkid=bookmarks[i].mediaItemId;bookmarkesIds[bookmarkid]=bookmarks[i].playState}for(i=0;i<items.length;i++){if(items[i].id in bookmarkesIds){state=bookmarkesIds[items[i].id];if(state==="paused"){state=orioni18n.titleCardCommon.listingscontinuetext;items[i].bookmarkPaused=state}else{if(state==="stopped"){state=orioni18n.titleCardCommon.listingswatchedtext;items[i].bookmarkWatched=state}else{if(state==="playing"){state=""}}}}}}};TitleCardNG.prototype.changeBookmarks=function(){var itemId=this.model.get("mediaItemId");var bookmarks=this.model.get("bookmarks");var $listings=$(this.listingsContainer);var itemForPlayingId="";if(!bookmarks){return}for(var i=0;i<bookmarks.length;i++){var status=bookmarks[i].playState;if(status==="paused"){itemForPlayingId=bookmarks[i].mediaItemId;status=orioni18n.titleCardCommon.listingscontinuetext}else{if(status==="stopped"){status=orioni18n.titleCardCommon.listingswatchedtext}else{if(status==="playing"){status=""}}}$listings.find('[data-media-id="'+bookmarks[i].mediaItemId+'"]').find(".status").text(status)}};TitleCardNG.prototype.updateMeta=function(){var self=this;var mediatype=this.model.get("mediatype");var mediaItem;var mediaObject;var title;if(mediatype==="Channel"){mediaObject=this.model.get("channel");title=mediaObject.stationSchedules[0].station.title}else{if(mediaItem){mediaObject=mediaItem;title=mediaObject.secondaryTitle?mediaObject.secondaryTitle:mediaObject.title}else{mediaObject=this.model.get("mediaGroup");title=mediaObject.title}}document.title=title;var metas=document.getElementsByTagName("meta");for(var i=0;i<metas.length;i++){var metaTag=metas[i];if(metaTag.getAttribute("property")=="og:title"){metaTag.setAttribute("og:title",title);metaTag.setAttribute("Content",title)}}document.getElementsByTagName("head")[0].setAttribute("data-page-title",title);document.getElementsByTagName("title")[0].innerText=title};TitleCardNG.prototype.getLandingPageURL=function(){return $("#site-navigation-bar .nav-item.active > a:first-child").attr("href")||"/"};return TitleCardNG})(jQuery,orion.util.mvc.Model,orion.util.mvc.View,orion.widgets.ActionBar,orion.widgets.Offers);
BBV.namespace("orion.modules").LinearTitleCard=orion.modules.LinearTitleCard||(function($,TitleCardNG){function LinearTitleCard(elem,publisher){var self=this;TitleCardNG.call(this,elem,publisher);this.ModeType={LIVE:"live",REPLAY:"replay",FUTURE:"future"};self.RemoteBookings=new orion.modules.EPG.RemoteBookings(publisher);self.RemoteBookings.initialize();self.subscribeToEvents(publisher);self.initialize()}orion.util.inherits(LinearTitleCard,TitleCardNG);LinearTitleCard.prototype.initialize=function(){var self=this;var pathPrefix=self.$.data("media-path-prefix");this.model.set("pathPrefix",pathPrefix,true);Path.map(pathPrefix+"/:stationId(/:startTime)").to(function(){var id=this.params.stationId;var startTime=this.params.startTime;self.model.set("listingStartTime",startTime,true);self.model.set("mediatype","Channel",true);self.model.set("isProgramChanged",false,true);self.mediaChange(id)});Path.routes.current="";Path.dispatch(location.pathname+location.hash);Path.history.listen();this.createPlayer("live")};LinearTitleCard.prototype.subscribeToEvents=function(publisher){var self=this;var $listings=$(this.listingsContainer);$listings.on("click",self.view.moreEpisodesBtnClass,$.proxy(self.showMoreEpisodes,self));publisher.subscribe(BBV.player.generateSLEventName("channelSelected"),$.proxy(self.channelSelected,self));publisher.subscribe(BBV.player.generateSLEventName("programChanged"),$.proxy(self.programChanged,self));publisher.subscribe("offersResolved",$.proxy(self.playerStateHandler,self));self.RemoteBookings.delegate("#linearTitleCard",[".button.record",".record-btn"]);self.RemoteBookings.delegate(".user-options",["#dvr-settings-link"])};LinearTitleCard.prototype.unbindEvents=function(publisher){var self=this;var $listings=$(this.listingsContainer);publisher.unsubscribe(BBV.player.generateSLEventName("channelSelected"),self.channelSelected,self);publisher.unsubscribe(BBV.player.generateSLEventName("programChanged"),self.programChanged);publisher.unsubscribe("offersResolved",self.playerStateHandler);$listings.off("click",self.view.moreEpisodesBtnClass,$.proxy(self.showMoreEpisodes,self))};LinearTitleCard.prototype.playerStateHandler=function(status){var self=this;var mode=this.model.get("mode");var channel=this.model.get("channel");if(status==="playable"&&mode!==this.ModeType.FUTURE){if(mode==="replay"){var mediaItem=self.model.get("listingWithProgram");self._slplayer.initializeReplayTV(mediaItem)}else{self._slplayer.initializeChannel(channel)}self._slplayer.show()}else{self._slplayer.stop();self._slplayer.hide()}};LinearTitleCard.prototype.programChanged=function(program,channelName){if(!this.model.get("programId")){this.model.set("programId",program.programId,true)}var prevProgramId=this.model.get("programId");if(prevProgramId!==program.programId){this.model.set("isProgramChanged",true,true);this.model.set("programId",program.programId,true);this.update()}};LinearTitleCard.prototype.channelSelected=function(channel){var self=this;var channelId=channel.channelId;if(this.model.get("channel").id===channelId){return}$.when(orion.oesp.channelEndpoint.requestChannel(channelId)).done(function(channel){var station=channel.getStation();self.model.set("programId","",true);self.setUrl(station.id,channel.getName())})};LinearTitleCard.prototype.setUrl=function(stationId,name){if(!!(window.history&&history.pushState)){var pathPrefix=this.model.get("pathPrefix");var url=pathPrefix+"/"+stationId;if(name){Path.history.pushState({},name,url)}else{Path.history.pushState({},"",url)}}};LinearTitleCard.prototype.mediaChange=function(stationId){var self=this;var model=self.model;var channelData;channelData=this.getChannelData(stationId);channelData.done(function(channel){model.set("channel",channel);self.update()})};LinearTitleCard.prototype.setMode=function(listingsForProgramDescription){var mode;var listingWithProgram=this.getListingWithProgram(listingsForProgramDescription);var assetStartTime=this.model.get("listingStartTime");var nowTimestamp=+new Date();if(!assetStartTime||(nowTimestamp>=listingWithProgram.startTime&&nowTimestamp<=listingWithProgram.endTime)){mode=this.ModeType.LIVE}else{if(listingWithProgram.replayTvAvailable){mode=this.ModeType.REPLAY}else{mode=this.ModeType.FUTURE;this.model.unset("listingStartTime")}}this.model.set("mode",mode,true);return mode};LinearTitleCard.prototype.update=function(){var self=this;var listingsForProgram=$.Deferred();var listingStartTime=this.model.get("listingStartTime");var mode;if(listingStartTime){listingsForProgram=self.getListingsForProgramDescription(listingStartTime)}else{listingsForProgram=self.getCurrentTimeListings()}listingsForProgram.done(function(listingsForProgramData){self.model.set("listingsForProgram",listingsForProgramData,true);self.getListingWithProgram(listingsForProgramData);mode=self.setMode(listingsForProgramData);var templateData=self.buildTemplateData();self.updateMeta();self.renderDescription(templateData);self.initOffers();self.initActionBar();self.initRelated();self.listingsInit()})};LinearTitleCard.prototype.initActionBar=function(){var self=this;var endTime=this.model.get("listingWithProgram").endTime;var channel=this.model.get("channel");var actionBar=this._actionBar;var publisher=orion.app;var id=[];var localization={actionBar:orioni18n.titleCardActionBar};id.push(channel.id);var actionBarOptions={mediaObjectId:id,items:{buttons:[]}};var recordBtn={title:"record",text:localization.actionBar.recordText,name:"recordings",action:"recordings",disabled:false,status:"",id:this.$.find(".title-card-ng").data("data-media-id")};var shareBtn={title:"share",text:localization.actionBar.shareText,name:"share",action:"share"};self.clearActionBarModel=function(){self.RemoteBookings.hasRecordingDvr=false;self.changeActionBarModel()};var timeToHideRecordButton=300000;var assetLeftTime=new Date(endTime)-new Date();if(assetLeftTime<timeToHideRecordButton){assetLeftTime=timeToHideRecordButton}setTimeout(self.clearActionBarModel,assetLeftTime-timeToHideRecordButton);actionBar.model.set("titlecardRenderStatus",false,true);self.changeActionBarModel=function(){actionBarOptions.items.buttons=[];self.RemoteBookings.hasRecordingDvr===true?actionBarOptions.items.buttons.push(recordBtn):"";actionBarOptions.items.buttons.push(shareBtn);actionBar.model.set("options",actionBarOptions)};self.changeActionBarModel();publisher.subscribe("recordings",function(data,id){if(id==recordBtn.id){recordBtn.disabled=data==="disabled";recordBtn.status=data}});self.RemoteBookings.getRemoteBookings()};LinearTitleCard.prototype.initOffers=function(){var offers=this._offers;var mode=this.model.get("mode");var channel=this.model.get("channel");var offersType="live";if(mode===this.ModeType.REPLAY){var listingWithProgram=this.model.get("listingWithProgram");offers.model.set("mediaItem",listingWithProgram);offersType="media"}offers.model.set("titlecardRenderStatus",false,true);offers.model.set("channel",channel);offers.model.set("type",offersType);offers.model.set("mode",mode);offers.getData()};LinearTitleCard.prototype.getListingWithProgram=function(dataListings){var listing={};var hasProgram=false;var programId="";for(var i=0;i<dataListings.listings.length;i++){listing=dataListings.listings[i];if(listing.program){programId=listing.program.id;hasProgram=true;break}}if(!hasProgram){log("LinearTitleCard:: Sorry! Listings has no program.")}this.model.set("listingWithProgram",listing,true);return listing};LinearTitleCard.prototype.getChannelData=function(stationId){var self=this;var channelRequest=orion.oesp.channelEndpoint.requestChannelByStationId(stationId);var channelLoaded=$.Deferred();self.$.empty();self.$.trigger("loading");channelRequest.done(function(channel){channelData=channel;self.model.set("channel",channel);$.each(channel.getStation().images,function(){if(this.assetType==="station-logo-large"){self.model.logo={url:this.url,width:this.width,height:this.height}}if(this.assetType==="station-titlecard-background"){self.model.background=this.url}});channelLoaded.resolve(channel)});channelRequest.fail(function(error){channelLoaded.rejectWith(error)});return channelLoaded.promise()};LinearTitleCard.prototype.buildTemplateData=function(){var listing=this.model.get("listingWithProgram");if(!listing){return}var logo={};var channel=this.model.get("channel");var program=listing.program;self.model.set("listingEndTime",listing.endTime,true);var utils=orion.modules.EPG.TemplateHelperMethods;logo=utils.getLogo(channel.getStation().images);BBV.extend(logo,{title:channel.getStation().title});var data={id:listing.id,title:program.title?program.title:channel.getStation().title,time:listing.getFormattedDateTime(BBV.settings.l10n.date.shortdotdateformat)+", "+listing.getFormattedTime(),boxArtLarge:program.images!==[]?utils.listings.getBoxArtLarge(program.images):logo,defaultPoster:utils.getDefaultPoster(),description:program.longDescription,logo:logo,i18nActivePage:orioni18n.titleCardLinear,i18nTitleCardCommon:orioni18n.titleCardCommon,linear:{channelTitle:channel.getStation().title,genre:utils.listings.buildGenreLinks(program.categories),duration:((listing.endTime-listing.startTime)/1000/60).toString()+" "+orioni18n.titleCardCommon.minutesText,year:program.year?program.year:"",ageRating:program.parentalRating?program.parentalRating:"",station:channel.getStation(),actors:program.cast?program.cast.join(", "):"",directors:program.directors?program.directors.join(", "):""}};return data};LinearTitleCard.prototype.getCurrentTimeListings=function(){var self=this,range={start:1,end:10},stationId;var byTimeParam;var listingsLoaded=$.Deferred();var queryForListings={};var channel=this.model.get("channel");var isProgramChangedEvent=this.model.get("isProgramChanged");var getByTime=orion.oesp.timeEndpoint.getTimeForRequest();getByTime.done(function(byTime){byTime=new Date(byTime);byTime.setSeconds(0);byTime.setMilliseconds(0);byTime=[+byTime,""].join("~");stationId=channel.getStation().id;byTimeParam=isProgramChangedEvent?"byStartTime":"byEndTime";queryForListings={byStationId:stationId,range:range.start+"-"+range.end,sort:"startTime"};queryForListings[byTimeParam]=byTime;$.when(orion.oesp.listingEndpoint.requestListings(queryForListings)).done(function(data){log("Successfully aquired current listing for station:",stationId);listingsLoaded.resolve(data)}).fail(function(){log("There was an error aquiring the listing for station:",stationId)})});return listingsLoaded.promise()};LinearTitleCard.prototype.getListingsForProgramDescription=function(startTime){var self=this,range={start:1,end:10},stationId;var byTime;var programLoaded=$.Deferred();var channel=this.model.get("channel");byTime=parseInt(startTime,10);byTime=new Date(byTime);stationId=channel.getStation().id;var queryForListings={byStationId:stationId,range:range.start+"-"+range.end,sort:"startTime"};queryForListings.byStartTime=+byTime+"~";$.when(orion.oesp.listingEndpoint.requestListings(queryForListings)).done(function(data){log("Successfully aquired current listing for station:",stationId);programLoaded.resolve(data)}).fail(function(){log("There was an error aquiring the listing for station:",stationId)});return programLoaded.promise()};LinearTitleCard.prototype.destroy=function(){this.unbindEvents(orion.app);this._offers.destroy()};LinearTitleCard.prototype.listingsInit=function(){var self=this;var listingWithProgram=this.model.get("listingWithProgram");var mediaType=this.model.get("mediatype");var mode=this.model.get("mode");var channel=this.model.get("channel");var mediaGroupId=listingWithProgram.mediaGroupId;var channelMethods=orion.modules.EPG.TemplateHelperMethods.channels;var listings=this.model.get("listingsForProgram");var channelData=$.Deferred();var bookmarksData=$.Deferred();var listingsData=$.Deferred();orion.oesp.session.withSession(function(session){var listingOpts={live:{template:"TitleCardChannelListings",query:{byStationId:channel.getStation().id,byLocationId:session.locationId,byStartTime:new Date(new Date().setSeconds(0)).setMilliseconds(0)+"~",range:"2-6",sort:"startTime"},data:listings},future:{template:"TitleCardChannelListings",query:{byStationId:channel.getStation().id,byLocationId:session.locationId,sort:"startTime"},data:listings},replay:{template:"TitleCardReplayListings",query:{byMediaGroupId:mediaGroupId,byLocationId:session.locationId,sort:"startTime"},data:""}};var options=listingOpts[mode].query;var template=listingOpts[mode].template;self.model.set("listingsTemplate",template,true);if(mode===self.ModeType.REPLAY&&mediaGroupId){bookmarksData=self.getBookmarks(mediaGroupId)}else{bookmarksData.resolve("")}if(!listingOpts[mode].data&&mediaGroupId){listingsData=orion.oesp.listingEndpoint.requestListings(options)}else{listingsData.resolve(listingOpts[mode].data)}$.when(listingsData,bookmarksData).done(function(listingsItems){if(!listingsItems||listingsItems.listings.length<=1){return}self.model.set("items",listingsItems,true);self.listingsDisplaySize=self._listingsDefaultDisplaySize;self.renderListings()})})};LinearTitleCard.prototype.renderListings=function(){var self=this;var channel=this.model.get("channel");var data=BBV.extend({},this.model.get("items"));var listings=data.listings;var mode=this.model.get("mode");var listingWithProgram=this.model.get("listingWithProgram");var stations=[];var bookmarks=this.model.get("bookmarks");var listingsTemplate=this.model.get("listingsTemplate");var opts={};opts.additional={programTitle:listingWithProgram.program?listingWithProgram.program.title:"",channelTitle:channel.getStation().title,channelId:channel.id,i18nActivePage:orioni18n.titleCardLinear,i18nTitleCardCommon:orioni18n.titleCardCommon,morebtn:false,tvGuidePath:BBVSettingsObject.site.urls.channels.tvguides};var getLogotypes=function(listing){var stationId=listing.stationId;if(stations.indexOf(stationId)===-1){stations.push(stationId);channelData=orion.oesp.channelEndpoint.requestChannelByStationId(stationId);channelData.done(function(channel){var utils=orion.modules.EPG.TemplateHelperMethods;var logo=utils.getLogo(channel.getStation().images);var img=new Image();img.onload=function(){$('[data-station-id="'+channel.getStation().id+'"]').find(".channel-logo-wrap").html(img).addClass("channel-active")};img.src=logo.url})}};if(mode===self.ModeType.REPLAY){opts.additional.morebtn=listings.length>self.listingsDisplaySize?true:false;opts.additional.tvGuidePath=false;if(bookmarks){this.setBookmarks(listings)}}listings=listings.filter(function(item){return item.id!==listingWithProgram.id}).slice(0,self.listingsDisplaySize);for(var i=0;i<listings.length;i++){BBV.extend(listings[i],BBV.utils.listings);if(mode===self.ModeType.REPLAY){if(listings[i].id===listingWithProgram.id){listings[i].active=true}listings[i].title=opts.additional.programTitle;listings[i].broadcast=BBV.utils.date(listings[i].startTime).format("DDD D MMM YYYY");getLogotypes(listings[i])}}data.listings=listings;BBV.extend(data,opts.additional);var tpl=$(Mustache.to_html(orion.templates.TitleCardListings,opts.additional));var tmpTpl=$(Mustache.to_html(orion.templates[listingsTemplate],data));$("#listings-wrap").html(tpl);this.$.parent().find(this.view._listingsContainer).html(tmpTpl);var $moreBtn=$(this.listingsContainer).find(this.view.moreEpisodesBtnClass);opts.additional.morebtn?$moreBtn.show():$moreBtn.hide()};LinearTitleCard.prototype.showMoreEpisodes=function(evt){evt.preventDefault();var items=this.model.get("items");this.listingsDisplaySize=items.listings.length;this.renderListings();if(this._slplayer){this.setAssetPlayingState({state:this._slplayer.view.player.playState})}};LinearTitleCard.prototype.initRelated=function(){var self=this;var publisher=orion.app;var relatedData;var listing=this.model.get("listingWithProgram");publisher.trigger("updateRelated",relatedData);var $relatedContainer=$(self._relatedContainer);var $feedContainer=$relatedContainer.find(".feed-container");var $relatedTitle=$relatedContainer.find(".related-title");var rengVersion=parseInt($relatedContainer.data("reng-version"),10);var relatedFeedURLResolved=new $.Deferred();if(rengVersion==2){orion.oesp.session.withSession(function(session){var relatedFeed=$relatedContainer.data("default-feed");if(session.isAuthenticated()){var rengBaseURL=$relatedContainer.data("reng-baseurl");var rengOrigin=$relatedContainer.data("reng-origin");var rengTypes=$relatedContainer.data("reng-types");var rengVodSubTypes=$relatedContainer.data("reng-vod-sub-types");relatedFeed=rengBaseURL;relatedFeed+=((relatedFeed.indexOf("?")==-1)?"?":"&");if(rengOrigin){relatedFeed=relatedFeed+"origin="+rengOrigin;relatedFeed+="&"}if(rengTypes){relatedFeed=relatedFeed+"byTypes="+rengTypes;relatedFeed+="&"}if(rengVodSubTypes){relatedFeed=relatedFeed+"byVodSubtypes="+rengVodSubTypes;relatedFeed+="&"}relatedFeed=relatedFeed+"byListingId="+listing.id;var isLive=self.model.get("mode")!=="future";if(isLive){relatedFeed+="&byTime="+listing.startTime+"~"+listing.endTime}}if(relatedFeed){relatedFeedURLResolved.resolve(relatedFeed)}else{relatedFeedURLResolved.reject("no feed for recommendations")}})}else{if(rengVersion==1){relatedFeedURLResolved.reject("RENG 1.0 is not supported for linear")}else{relatedFeedURLResolved.reject("no recommendation module")}}$.when(relatedFeedURLResolved,orion.oesp.channelEndpoint.requestChannels({includeInvisible:true})).done(function(feedUrl,channelsResponse){if(!$feedContainer.data("feedUrl")){$feedContainer.data("feedUrl",feedUrl)}var options={isThumb:false,beforeRender:function(items){$.each(items,function(){if(this instanceof orion.oesp.res.Listing){}else{this.buildMediaUrl=function(){var self=this;var assetId=self.mediaGroupId||self.id;var url;url=[encodeURIComponent(assetId),self.encodeTitle()];if(self.medium){if(self.isMyPrime()){url.unshift(BBV.settings.site.urls.mediagroup.myprime[self.medium.toLowerCase()])}else{if(self.isTVMissed()){url.unshift(BBV.settings.site.urls.mediagroup.tvmissed)}else{url.unshift(BBV.settings.site.urls.mediagroup.ondemand[self.medium.toLowerCase()])}}}else{log("Broken mediagroup, missing medium on id: "+encodeURIComponent(assetId)+" title: "+self.encodeTitle())}return url===undefined?"#":url.join("/")+".html"}}})},onRawDataReceived:function(rawData){if(rengVersion==2&&rawData.results){rawData.entryCount=rawData.results.length;rawData.totalResults=rawData.results.length}}};var fc=new orion.widgets.FeedContainer($feedContainer,options);orion.app.subscribe("feedLoaded:"+feedUrl,function(entryCount){if(entryCount){fc.$.parents(".related-module").slideDown();$relatedTitle.fadeIn()}else{fc.$.parents(".related-module").hide();log("No recommendations")}});orion.app.subscribe("feedFailed:"+feedUrl,function(){fc.$.parents(".related-module").hide();log("No recommendations")})}).fail(function(error){log("initRelated:",error);$relatedContainer.hide()});return};return LinearTitleCard})(jQuery,orion.modules.TitleCardNG);
BBV.namespace("orion.modules").MediaTitleCard=orion.modules.MediaTitleCard||(function($,TitleCardNG){function MediaTitleCardView(elem,model){var self=this;this.$=$(elem);this.model=model;this.logoPlaceholder=".logo";this.assetBgContainer="#site-wrapper";this.pageGradient="#site-wrapper > .pagegradient"}MediaTitleCardView.prototype.setAssetBg=function(mediaObject){var self=this;var bgImage=mediaObject.getBackgroundImageUrl();if(bgImage){$(this.pageGradient).hide();$(this.assetBgContainer).css("background-position","50% -400px");var img=new Image();img.src=bgImage;img.onload=function(){$(self.assetBgContainer).css({"background-position":"50% 0","background-image":"url("+bgImage+")"})}}else{$(this.assetBgContainer).css("background-image","none");$(this.pageGradient).show()}};MediaTitleCardView.prototype.setProviderLogo=function(providerDetails){if(!providerDetails){return}var logo={};var img="";var utils=orion.modules.EPG.TemplateHelperMethods;logo=utils.getLogo(providerDetails.images);if(logo){BBV.extend(logo,{title:providerDetails.title});img=$("<img />").attr("src",logo.url).attr("alt",logo.title);this.$.find(this.logoPlaceholder).append(img)}};function MediaTitleCard(elem,publisher){var self=this;this._elem=elem;this.$=$(elem);TitleCardNG.call(this,elem,publisher);BBV.extend(this.view,new MediaTitleCardView(elem,this.model));self.subscribeToEvents();self.initialize()}orion.util.inherits(MediaTitleCard,TitleCardNG);MediaTitleCard.prototype.initialize=function(){var self=this;var pathPrefix=self.$.data("media-path-prefix");this.listingsDisplaySize=this._listingsDefaultDisplaySize;this.model.set("pathPrefix",pathPrefix,true);Path.map(pathPrefix+"/:groupId/:pagename/:itemId/:pagename").to(function(){var groupId=this.params.groupId;var itemId=this.params.itemId;var pageName=this.params.pagename;self.model.set("mediaPageName",pageName,true);self.mediaChange(groupId,itemId)});Path.map(pathPrefix+"/:groupId/:pagename").to(function(){var groupId=this.params.groupId;var itemId="";var pageName=this.params.pagename;self.model.set("mediaPageName",pageName,true);self.mediaChange(groupId,itemId)});Path.routes.current="";Path.dispatch(location.pathname+location.hash);Path.history.listen();this.createPlayer("standard");self.$.trigger("loading")};MediaTitleCard.prototype.trailerEndHandler=function(){var self=this;var model=self.model;console.log("trailerEndHandler");var prefix=model.get("pathPrefix");var mediaGroupId=model.get("mediaGroupId");var pageName=model.get("mediaPageName");var url=prefix+"/"+mediaGroupId+"/"+pageName;Path.history.pushState({},"",url)};MediaTitleCard.prototype.subscribeToEvents=function(){var self=this;var $listings=$(this.listingsContainer);var publisher=orion.app;this.playerStateHandler=this.playerStateHandler.bind(this);this.setAssetPlayingState=this.setAssetPlayingState.bind(this);publisher.subscribe("offersResolved",this.playerStateHandler,this);publisher.subscribe("trailerEnd",$.proxy(self.trailerEndHandler,self));publisher.subscribe("listingsRendered",this.changeBookmarks,this);publisher.subscribe(BBV.player.generateSLEventName("stateChange"),this.setAssetPlayingState);this.$.on("click",".media",function(evt){evt.preventDefault();var selectedEpisodeId=self.model.get("mediaItemId");var mediaGroupitems=[];if(!selectedEpisodeId){mediaGroupitems=self.model.get("items");if(mediaGroupitems.length){selectedEpisodeId=mediaGroupitems[0].id}else{log("MediaTitleCard Warning:::","No media items in this media group!")}}self.changeEpisode(selectedEpisodeId)});$listings.on("click",self.view.moreEpisodesBtnClass,$.proxy(self.showMoreEpisodes,self));$listings.on("click",'[data-role="episode"]',$.proxy(self.episodeSelected,self))};MediaTitleCard.prototype.setAssetPlayingState=function(evt){var mediaItem=self.model.get("mediaItem");var states={playing:orioni18n.titleCardCommon.listingsplayingtext,paused:orioni18n.titleCardCommon.listingscontinuetext,complete:orioni18n.titleCardCommon.listingswatchedtext};var status=states[evt.state];if(status){$(this.listingsContainer).find('[data-media-id="'+mediaItem.id+'"]').find(".status").text(status)}};MediaTitleCard.prototype.episodeSelected=function(evt){if(!evt.target.hasAttribute("href")){var target=evt.currentTarget;var id=$(target).data("media-id");$(target).siblings().removeClass("active");$(target).addClass("active");this.changeEpisode(id)}};MediaTitleCard.prototype.changeEpisode=function(id){if(this._slplayer){this._slplayer.pause()}var groupId=this.model.get("mediaGroupId");var pageName=this.model.get("mediaPageName");var nodeOffset=this.$.parents(".titlecard").offset();var headerOffset=0;if(!$(".utilitybar").hasClass("pinned")){headerOffset={a:$(".NavigationBar").offset(),b:$(".UtilityBar").offset()};headerOffset.a=headerOffset.a?headerOffset.a.top:0;headerOffset.b=headerOffset.b?headerOffset.b.top:0;headerOffset=headerOffset.a+headerOffset.b}var offsetY=nodeOffset?nodeOffset.top-headerOffset:80;$("html, body").animate({scrollTop:0},500,"swing");var url=this.model.get("pathPrefix")+"/"+groupId+"/"+pageName+"/"+id+"/"+pageName;Path.history.pushState({},"",url)};MediaTitleCard.prototype.showMoreEpisodes=function(evt){evt.preventDefault();var items=this.model.get("items");var prevListingsBottomBorderOffset=$(this.listingsContainer).height();this.listingsDisplaySize=items.length;this.listingsInit();if(this._slplayer){this.setAssetPlayingState({state:this._slplayer.view.player.playState})}};MediaTitleCard.prototype.playerStateHandler=function(status){var self=this;var mediaItem=self.model.get("mediaItem");var mediaGroup=self.model.get("mediaGroup");if(status==="playable"){self._slplayer.initializeVideo(mediaGroup,mediaItem);self._slplayer.show()}else{self._slplayer.stop();self._slplayer.hide()}};MediaTitleCard.prototype.mediaChange=function(groupId,itemId){var self=this;var mediaData;self.init(groupId,itemId)};MediaTitleCard.prototype.getProvider=function(providerId){if(!providerId){return""}var self=this;var queryParams={id:providerId};var provider=orion.oesp.ProviderEndpoint.get(queryParams);provider.done(function(data){self.view.setProviderLogo(data)})};MediaTitleCard.prototype.buildTemplateData=function(){var mediaItem=this.model.get("mediaItem");var mediaGroup=this.model.get("mediaGroup");var mediaObject=mediaItem!==""?mediaItem:mediaGroup;var utils=orion.modules.EPG.TemplateHelperMethods;var data={id:mediaObject.id,title:mediaObject.title,secondaryTitle:mediaObject.secondaryTitle?mediaObject.secondaryTitle:"",episodesCount:mediaObject.currentChildMediaTypeCounts?mediaObject.currentChildMediaTypeCounts.Episode:"",time:mediaObject.startTime?BBV.utils.date(mediaObject.startTime).format("DDDD DD MMMM")+", "+utils.listings.getStartEndTime(listing.startTime,listing.endTime):"",boxArtLarge:utils.listings.getBoxArtLarge(mediaObject.images),defaultPoster:utils.getDefaultPoster(),logo:"",description:mediaObject.longDescription,i18nActivePage:orioni18n.titleCardSeries,i18nTitleCardCommon:orioni18n.titleCardCommon,media:{language:mediaObject.getAudioLanguage(),genre:mediaObject.getGenre(),duration:mediaObject.formatLength(),broadcast:mediaObject.getLatestBroadcastTime(),year:mediaObject.getYear(),ageRating:mediaObject.highestParentalRating(),actors:mediaObject.getCast(),directors:mediaObject.getDirectors()}};this.renderDescription(data);this.getProvider(mediaObject.providerId);this.view.setAssetBg(mediaGroup)};MediaTitleCard.prototype.init=function(groupId,itemId){var self=this;var mediaData=self.getMediaGroup(groupId);var bookmarksData=self.getBookmarks(groupId);self.model.set("mediaGroupId",groupId,true);self.model.set("mediaItemId",itemId,true);self.model.set("mediaItem","",true);var initContinue=function(){self.setAsset(itemId);self.updateMeta();self.initOffers();self.initActionBar();self.buildTemplateData();self.listingsInit();self.initRelated(self.model.get("mediaGroup"),self.model.get("items"))};var adultPermsCheckingCanceled=function(){window.location=self.getLandingPageURL()};$.when(mediaData,bookmarksData,orion.oesp.session).done(function(undefined,undefined,session){var currentMediaGroup=self.model.get("mediaGroup");if(currentMediaGroup.isAdult){if(session.isAuthenticated()&&session.isAdultPinVerified(true)){initContinue()}else{orion.util.AdultAdapter.showAdultDialogs(function(){orion.app.reInitialize()},function(){adultPermsCheckingCanceled()})}}else{initContinue()}})};MediaTitleCard.prototype.setAsset=function(itemId){var asset;if(itemId){asset=this.getMovieItem();this.model.set("mediaItemFilm",asset,true);this.getMediaItemById(itemId);if(this.model.get("mediatype")==="Series"){var items=this.model.get("items");for(i=0;i<items.length;i++){if(items[i].id===itemId){if(i>=this._listingsDefaultDisplaySize){this.listingsDisplaySize=items.length}break}}}}else{if(this.model.get("mediatype")==="Series"){itemId=this.getAvailableMediaItems();var pageName=this.model.get("mediaPageName");var url=this.model.get("pathPrefix")+"/"+this.model.get("mediaGroupId")+"/"+pageName+"/"+itemId+"/"+pageName;history.replaceState({},"",url);this.getMediaItemById(itemId);this.model.set("mediaItemId",itemId,true)}else{asset=this.getMovieItem();this.model.set("mediaItem",asset,true)}}};MediaTitleCard.prototype.getMovieItem=function(){var self=this;var items=this.model.get("items");var mediaItem="";for(var i=0;i<items.length;i++){if(items[i].isFeatureFilm()){mediaItem=items[i]}}return mediaItem};MediaTitleCard.prototype.getAvailableMediaItems=function(){var itemId;var mediaItems;var items=this.model.get("items");var bookmarks=this.model.get("bookmarks");var i=0;if(bookmarks){bookmarks=bookmarks.slice(0);mediaItems=items.slice(0);mediaItems=mediaItems.filter(function(item){var hasBookmark=false;for(i=0;i<bookmarks.length;i++){if(bookmarks[i].playState==="stopped"&&item.id===bookmarks[i].mediaItemId){bookmarks.splice(i,1);hasBookmark=true;break}}if(!hasBookmark){return item}});for(i=0;i<bookmarks.length;i++){if(bookmarks[i].playState==="playing"){return bookmarks[i].mediaItemId}}var pausedItems=mediaItems.filter(function(item){var hasBookmark=false;for(i=0;i<bookmarks.length;i++){if(bookmarks[i].playState==="paused"&&item.id===bookmarks[i].mediaItemId){hasBookmark=true}}if(hasBookmark){return item}});if(pausedItems.length){itemId=pausedItems[0].id}else{if(mediaItems.length){itemId=mediaItems[0].id}else{itemId=items[0]}}}else{if(items&&items.length){itemId=items[0].id}}for(i=0;i<items.length;i++){if(items[i].id===itemId){if(i>=this._listingsDefaultDisplaySize){this.listingsDisplaySize=items.length}break}}return itemId};MediaTitleCard.prototype.listingsInit=function(){var self=this;var items=this.model.get("items");var mediaType=this.model.get("mediatype");var itemId=this.model.get("mediaItemId");var $listings=$(this.listingsContainer);if(mediaType!=="Series"||!items.length){return}var data={i18nActivePage:orioni18n.titleCardSeries,i18nTitleCardCommon:orioni18n.titleCardCommon,type:"Series",morebtn:mediaType==="Series"?true:false};var tpl=$(Mustache.to_html(orion.templates.TitleCardListings,data));self.setBookmarks(items);var options={pageSize:this.listingsDisplaySize,enablePaging:false,listingData:items};items.length>1?$listings.html(tpl):$listings.hide().html(tpl);var listings=this.view.renderListings(options);var $moreBtn=$listings.find(this.view.moreEpisodesBtnClass);var applyListingsUIstyles=function(){if(itemId){$listings.find('[data-media-id="'+itemId+'"]').addClass("active")}if(items.length>self.listingsDisplaySize){$moreBtn.show()}else{$moreBtn.hide()}};applyListingsUIstyles()};MediaTitleCard.prototype.getMediaItemById=function(mediaItemId){var self=this;var model=self.model;var items=model.get("items");var mediaItemArray=null;mediaItemArray=$.grep(items,function(item){return item.id==decodeURIComponent(mediaItemId)});if(mediaItemArray&&mediaItemArray.length>0){model.set("mediaItem",mediaItemArray[0],true)}};MediaTitleCard.prototype.getMediaGroup=function(mediaGroupId){var self=this;var mediaData=orion.oesp.mediaGroupEndpoint.requestFormattedMediaGroup(mediaGroupId);var mediaItemsData=$.Deferred();var mediaType;mediaData.done(function(mediaGroup){if(mediaGroup.isMovie()){mediaType="Movie"}else{mediaType="Series"}self.model.set("mediaGroup",mediaGroup,true);self.model.set("mediatype",mediaType,true);self.getItemsInGroup(mediaGroupId,mediaType).done(function(){mediaItemsData.resolve()})});return mediaItemsData.promise()};MediaTitleCard.prototype.getItemsInGroup=function(id,mediaType){var self=this;var publisher=orion.app;var queryParams={byMediaGroupId:id};if(mediaType==="Series"){queryParams=$.extend(queryParams,{sort:"secondaryTitle",byMediaType:"Episode"})}var mediaItemsData=orion.oesp.mediaItemEndpoint.requestMediaItems(queryParams);mediaItemsData.done(function(data){if(data.mediaItems){var items=data.mediaItems;self.model.set("items",items)}}).fail(function(){log("MediaTitleCard:: Failed to get mediaItems by mediaGroupId")});return mediaItemsData};MediaTitleCard.prototype.initActionBar=function(){var self=this;var id=[];var mediaItemsIds=[];var actionBar=this._actionBar;var items=this.model.get("items");var mediaItem=this.model.get("mediaItem");var mediaGroup=this.model.get("mediaGroup");var publisher=orion.app;if(items&&!mediaItem){for(var i=0;i<items.length;i++){mediaItemsIds.push(items[i].id)}}id.push(mediaItem.id?mediaItem.id:mediaGroup.id);var actionBarOptions={mediaIds:mediaItemsIds.length?mediaItemsIds:id,mediaObjectId:id,items:{buttons:[]}};var i18n=orioni18n.titleCardActionBar;var shareBtn={title:"share",text:i18n.shareText,name:"share",action:"share"};var trailerBtn={id:"",title:"trailer",text:"",name:"trailer",action:"trailer"};var watchlistBtn={title:"watchlist",text:i18n.playlistText,textActive:i18n.onWatchlistText,name:"watchlist",action:"watchlistAdd",active:false,isGroup:false};(function hasTrailer(){if(items){BBV.extend(items,orion.util.mediamethods);var trailerId=items.getTrailerId();if(trailerId===""){return}self.model.set("trailerId",trailerId);trailerBtn.id=trailerId;actionBarOptions.items.buttons=[trailerBtn]}})();actionBarOptions.items.buttons.push(shareBtn);if(mediaItem===""){watchlistBtn.isGroup=true}actionBarOptions.items.buttons.push(watchlistBtn);actionBar.model.set("titlecardRenderStatus",false,true);actionBar.model.set("options",actionBarOptions)};MediaTitleCard.prototype.initOffers=function(){var self=this,offers=self._offers;offers.model.set("titlecardRenderStatus",false,true);offers.model.set("mediaItem",self.model.get("mediaItem"));offers.model.set("mediaItemFilm",self.model.get("mediaItemFilm"));offers.model.set("mediaGroup",self.model.get("mediaGroup"));offers.model.set("type","media");offers.getData()};MediaTitleCard.prototype.unbindEvents=function(){var self=this;var publisher=orion.app;var $listings=$(this.listingsContainer);publisher.unsubscribe("offersResolved",this.playerStateHandler);publisher.unsubscribe("trailerEnd",this.playerStateHandler);publisher.unsubscribe("listingsRendered",this.changeBookmarks);publisher.unsubscribe(BBV.player.generateSLEventName("stateChange"));$listings.off("click",self.view.moreEpisodesBtnClass,$.proxy(self.showMoreEpisodes,self));$listings.off("click",'[data-role="episode"]',$.proxy(self.episodeSelected,self))};MediaTitleCard.prototype.destroy=function(){this._offers.destroy();this.unbindEvents()};return MediaTitleCard})(jQuery,orion.modules.TitleCardNG);
BBV.namespace("orion.modules").MediaItemTitleCard=orion.modules.MediaItemTitleCard||(function($,Model,View){function MediaItemTitleCardModel(){var self=this;Model.call(self)}orion.util.inherits(MediaItemTitleCardModel,Model);function MediaItemTitleCardView(model,elem,publisher){var self=this;var $elem;self.publisher=publisher;View.call(self,model);self.$=$(elem);self.localStrings=orioni18n.mediaItemTitleCard;self.monitorModel();self.bindEvents();self.setPlaylistState();$(document).ready(MediaItemTitleCardView.decodePreview)}MediaItemTitleCardView.decodePreview=function(){var previewHref;var counter;$(".preview-link-button > a, .aspot-messaging .message .buttons .button > a").each(function(){counter=0;previewHref=$(this).attr("href");if(previewHref){while(MediaItemTitleCardView.isDoubleEncoded(previewHref)){if(counter>=2){log("Fail to decode crid after two attempts.");break}previewHref=decodeURIComponent(previewHref);counter++}if(counter>0){$(this).attr("href",previewHref)}}})};MediaItemTitleCardView.isDoubleEncoded=function(href){return href.match(/%25([0-9a-fA-F]{2})/)!=null};orion.util.inherits(MediaItemTitleCardView,View);MediaItemTitleCardView.formatPrice=function(price){var priceLength=price.length;var whole,fraction;if(priceLength<5){for(i=0;i<5-priceLength;i++){price="0"+price}}whole=price.slice(0,price.length-4);fraction=price.slice(price.length-4,price.length-2);price=whole+","+fraction;return price};MediaItemTitleCardView.prototype.monitorModel=function(){var self=this;var model=self.model;model.bind("change.offers change.rentalTime",$.proxy(self.renderOffers,self));model.bind("change.inPlaylist",$.proxy(self.renderPlaylistLinks,self));orion.app.recommendations.updateRatedItems(self.$)};MediaItemTitleCardView.prototype.bindEvents=function(){var self=this;var assetId=self.$.data("media-id");self.$.delegate(".offer-button-login","click",function(event){if($(event.target).closest("span").is(".disabled")){return}self.publisher.trigger("requestDialog",{dialogName:"login",centerOn:self.$.get(0)});return false});self.$.delegate(".offer-button-link","click",function(event){$buyButton=$(this);self.trigger("purchase",{offerId:$buyButton.data("offer-id"),productId:$buyButton.data("product-id")});return false});self.$.delegate(".playlists-wrapper .add","click",function(event){self.trigger("addToPlaylist");return false});self.$.delegate(".playlists-wrapper .remove","click",function(event){self.trigger("removeFromPlaylist");return false});self.$.delegate(".share-link","click",function(event){self.trigger("share");orion.util.analytics.trackEvent("action",{pageName:"Engagement/Social/Share",channel:"Engagement/Social/Share",prop23:"Engagement",prop24:"Social",prop26:"Share",eVar32:assetId,events:"event9,event34"});return false})};MediaItemTitleCardView.prototype.renderOffers=function(){var self=this;var model=self.model;var offers=model.get("offers");var rentalTime=model.get("rentalTime");var loginRequired=model.get("loginToSeeOffers");var mediaItem=model.get("mediaItem");var offersContainer=self.$.find(".offers");var viewModel={products:[],offers_link:BBV.settings.site.urls.offers.upcoming};var html,i18nFor,i18nBuy;var numberOfOffers=0;offersContainer.empty();orion.oesp.session.done(function(session){if(!(rentalTime||loginRequired||offers||(!rentalTime&&model.mediaItem&&session.hasEntitlement(model.mediaItem.entitlements)))||session.hasEntitlement("VIP")){if(self.$.hasClass("has-offers")){self.$.removeClass("has-offers")}return}else{if(rentalTime){viewModel.rental_message=self.localStrings.tvodrentaltime;var df=BBV.settings.i18n.dateformat;var rt=new Date(rentalTime+$.now());viewModel.rental_time=df.dayNames[rt.getDay()+7]+" "+rt.getDate()+" "+df.monthNames[rt.getMonth()+12]+" "+rt.getHours()+":"+rt.getMinutes()+" "+rt.getFullYear();html=Mustache.to_html(orion.templates.RentalTime,viewModel)}else{if(loginRequired){viewModel.i18n_buy=self.localStrings.buy;viewModel.i18n_offers_head=self.localStrings.offers_heading_logged_out;viewModel.i18n_offers_text=self.localStrings.offers_text_logged_out;viewModel.i18n_offers_link=self.localStrings.offers_link_logged_out;viewModel.show_login_button=true;html=Mustache.to_html(orion.templates.Offers,viewModel)}else{if(offers){if(offers.products){i18nFor=self.localStrings["for"];i18nBuy=self.localStrings.buy;viewModel.i18n_offers_head=self.localStrings.offers_heading;viewModel.i18n_offers_text=self.localStrings.offers_text;viewModel.i18n_offers_link=self.localStrings.offers_link;$.each(offers.products,function(productIndex,product){if(!product.offers){log("MediaItemTitleCard:: product.offers is null - exiting rendering of offer",product);return}var rentalDays=product.rentalPeriodInSeconds/(60*60*24);var rentalDuration=rentalDays+" "+self.localStrings[rentalDays>1?"days":"day"];$.each(product.offers,function(offerIndex,offer){if(numberOfOffers<3){viewModel.products.push({name:product.title,currency:BBV.settings.currency.symbol,price:MediaItemTitleCardView.formatPrice(offer.price),i18n_for:i18nFor,i18n_buy:i18nBuy,rentalDuration:rentalDuration,offerId:offer.id,productId:product.id});numberOfOffers++}else{return false}})})}else{viewModel.i18n_buy=self.localStrings.buy;viewModel.i18n_offers_head=self.localStrings.offers_heading_not_entitled;viewModel.i18n_offers_text=self.localStrings.offers_text_not_entitled;viewModel.i18n_offers_link=self.localStrings.offers_link_not_entitled;viewModel.show_login_button=true;viewModel.not_entitled=true;if(mediaItem.isTVOD()){viewModel.i18n_offers_text=self.localStrings.offers_text_not_entitled_cannot_purchase}}html=Mustache.to_html(orion.templates.Offers,viewModel)}}}}if(html){self.$.addClass("has-offers");offersContainer.append(html).show();self.adjustFacebookWidgetSize()}})};MediaItemTitleCardView.prototype.adjustFacebookWidgetSize=function(){var self=this;var fbLike=self.$.find(".fb-like");var infoWidth=self.$.find(".info").width();if(fbLike.data("width")>infoWidth){fbLike.data("width",infoWidth);fbLike.attr("data-width",infoWidth);facebook.parse()}};MediaItemTitleCardView.prototype.setPlaylistState=function(){var self=this;orion.Playlist.setState(".mediaitemtitlecard");if($("[data-media-id]",".mediaitemtitlecard").is(".in-playlist")){self.model.set("inPlaylist",true)}};MediaItemTitleCardView.prototype.renderPlaylistLinks=function(){var self=this;var add=self.$.find(".playlists-wrapper .add");var remove=self.$.find(".playlists-wrapper .remove");if(self.model.get("inPlaylist")){add.hide();remove.show()}else{add.show();remove.hide()}};MediaItemTitleCardView.prototype.showSocialOverlay=function(){var self=this;var content=$(".video-social-overlay");var social=orion.app.dialogManager.getDialog("video-social-overlay");if(social.contentArea.find(".video-social-overlay").length===0){social.setHtmlContent(content)}social.contentArea.show();social.contentArea.find(".video-social-overlay").show();social.centerOn(window);social.show();$(".addthis_toolbox").delegate("a","click",function(e){$(".dialog").hide()});return self};MediaItemTitleCardView.prototype.showLockout=function(options){var self=this;var pinDialog=orion.app.dialogManager.getDialog("pin-verification");options=$.extend({pinType:"parentalPin",credentialType:"password",minutesRemaining:BBV.settings.pin.defaultLockoutDuration},options);pinDialog.trigger("pinRejected",{pinType:options.pinType,credentialType:options.credentialType,reason:"prohibited",minutesRemaining:options.minutesRemaining});pinDialog.showDialog()};MediaItemTitleCardView.prototype.showTvodDialog=function(purchaseMap){var self=this;var model=self.model;var id=purchaseMap.offerId;var productId=purchaseMap.productId;var tvodDialog=orion.app.dialogManager.getDialog("tvod");orion.util.analytics.set.offerId(id);var products=model.offers.products;var product,offer,item;$.each(products,function(){product=this;$.each(this.offers,function(){if(this.id==id){offer=this;return}});if(offer){return}});if(!offer){log("not able to find matching offer")}var rentalDays=product.rentalPeriodInSeconds/(60*60*24);var rentalDuration=rentalDays+" "+self.localStrings[rentalDays>1?"days":"day"];item={offerId:id,productId:productId,productIds:model.mediaItem.currentProductIds,isAdult:model.mediaItem.isAdult,tvodProductIds:model.mediaItem.currentTvodProductIds,title:product.title,secondary_title:offer.name||"",cost:BBV.settings.currency.symbol+" "+MediaItemTitleCardView.formatPrice(offer.price),rental_duration:rentalDuration};tvodDialog.setItem(item);tvodDialog.centerOn("window");tvodDialog.show();tvodDialog.setFocus()};function MediaItemTitleCard(elem,publisher){var self=this;var mediaItemId=$(elem).data("media-id");self.publisher=publisher;if(!(self instanceof MediaItemTitleCard)){return new MediaItemTitleCard(elem)}self.model=new MediaItemTitleCardModel();self.view=new MediaItemTitleCardView(self.model,elem,publisher);self.monitorView();$.when(orion.oesp.session,orion.oesp.mediaItemEndpoint.requestMediaItem(mediaItemId)).done($.proxy(self.configureModel,self))}MediaItemTitleCard.prototype.monitorView=function(){var self=this;var view=self.view;var model=self.model;view.bind("purchase",function(event,purchaseMap){var pinType=model.mediaItem.isAdult?"adultPin":"parentalPin";var credentialType=model.mediaItem.isAdult?"adultPin":"password";var credentialStatus=orion.oesp.profileEndpoint.getCredentialStatus(credentialType);var profileStatus;credentialStatus.done(function(status){if(status.isLocked){view.showLockout({pinType:pinType,credentialType:credentialType,minutesRemaining:status.minutesRemaining})}else{view.showTvodDialog(purchaseMap)}});return false});orion.app.subscribe("playlistUpdated",function(e){if(e.mediaId===model.mediaItem.id){if(e.action==="remove"){model.set("inPlaylist",false)}else{if(e.action==="add"){model.set("inPlaylist",true)}}}});view.bind("addToPlaylist",function(){orion.app.trigger("updatePlaylist",{action:"add",mediaId:model.mediaItem.id})});view.bind("removeFromPlaylist",function(){orion.app.trigger("updatePlaylist",{action:"remove",mediaId:model.mediaItem.id})});view.bind("share",function(){view.showSocialOverlay()})};MediaItemTitleCard.prototype.configureModel=function(session,mediaItem){var self=this;var model=self.model;var purchases=orion.oesp.purchaseEndpoint;var deferred=$.Deferred();var parentId=0;model.set("mediaItem",mediaItem);if(mediaItem.isTrailer()){parentId=mediaItem.mediaGroupId;mediaStatus=orion.oesp.mediaItemEndpoint.requestMediaItem(parentId);mediaStatus.done(function(item){deferred.resolve(item)})}else{deferred.resolve(mediaItem)}deferred.promise().done(function(mediaItem){if(mediaItem.isTVOD()){if(session.isAuthenticated()){purchaseStatus=purchases.requestPurchaseStatus(mediaItem);purchaseStatus.done(function(status,activePurchases){var purchases=orion.oesp.purchaseEndpoint;if(status==="isSVOD"){model.set("offers",{})}else{if(status==="purchaseRequired"){offersStatus=purchases.requestOffersStatus(mediaItem);offersStatus.done(function(status,offers){if(status==="upgradeRequired"){model.set("offers",{})}else{model.set("offers",offers)}})}else{var timeRemaining=0;var purchases=activePurchases.products;var i,length=purchases.length;for(i=0;i<length&&!timeRemaining;i++){if(mediaItem.hasCurrentTvodProductId(purchases[i].id)){if(purchases[i].isEntitled){timeRemaining=purchases[i].entitlementEnd-$.now()}}}if(timeRemaining){model.set("rentalTime",timeRemaining)}}}})}else{model.set("loginToSeeOffers",true)}}})};return MediaItemTitleCard})(jQuery,orion.util.mvc.Model,orion.util.mvc.View);
BBV.namespace("orion.modules").LiveChannels=orion.modules.LiveChannels||(function($){function LiveChannelsModel(view,collection){var self=this;self.view=view;self.collection=collection;self.liveChannels=[];return self}LiveChannelsModel.prototype.getLiveChannels=function(){var self=this;$.each(self.collection,function(){var model={channelID:this.id,channelNumber:this.channelNumber,channelUrl:this.getChannelUrl(),stationID:this.stationSchedules[0].station.id,title:this.stationSchedules[0].station.title,isOOH:this.stationSchedules[0].station.isOutOfHomeEnabled,entitlements:"[",stationImg:{}};$.each(this.stationSchedules[0].station.entitlements,function(idx,entitlement){if(idx===0){model.entitlements+="'"+entitlement+"'"}else{model.entitlements+=",'"+entitlement+"'"}});model.entitlements+="]";$.each(this.stationSchedules[0].station.images,function(){if(this.assetType==="station-logo-medium"){model.stationImg={url:this.url,width:this.width,height:this.height}}});self.liveChannels.push(model)});return self};function LiveChannels(elem){var self=this;self.$=$(elem);self.channelItemSelector=".channel-list > .channel-item";self.$list=self.$.find(".channel-list");self.localStrings=orioni18n.liveChannels;self.interval=60000*5;self.listingsRangeInHours=3;self.animationSettings={hideSpeed:300,showSpeed:300};self.eventsBound=false;self.stationListings={};self.initialize()}LiveChannels.prototype.initialize=function(){var self=this,playerName=BBV.settings.videoPlayer.playerName,params={sort:"channelNumber"};if(BBV.player.isSilverlight()){params.byAssetTypes="Orion-HSS"}else{params.byLiveStream=true}var maxChannels=self.$.data("channels-limit");if(maxChannels>0){params.endIndex=maxChannels}var getChannels=orion.oesp.channelEndpoint.requestChannels(params);self.loader=self.$.loader({element:{overlay:"<div/>"},elementClass:"grid-loading",flow:["append"],location:"outside",minheight:95,target:".channel-list",img:{top:"45px"}});self.$.trigger("loading");getChannels.done(function(response){response=self.fixedChannelList(response,maxChannels);self.model=new LiveChannelsModel(self,response.channels);self.model.getLiveChannels();self.render()})};LiveChannels.prototype.fixedChannelList=function(originResponse,maxChannels){var fixedResponse=originResponse;if(maxChannels>0){fixedResponse.entryCount=maxChannels;fixedResponse.totalResults=maxChannels;fixedResponse.channels=originResponse.channels.slice(0,maxChannels)}return fixedResponse};LiveChannels.prototype.render=function(){var self=this;$tmp=$(Mustache.to_html(orion.templates.LiveChannels,{channels:self.model.liveChannels}));self.$list.html($tmp);self.$.trigger("loaded");self.stationIds=self.getChannelsDataAsArray("station-id");self.heartbeat()};LiveChannels.prototype.addLocks=function(){var self=this;orion.oesp.session.done(function(session){$(self.channelItemSelector).each(function(){if(!session.hasEntitlement(someArray)){var $item=$(this)}})})};LiveChannels.prototype.heartbeat=function(){var self=this;self.updateModel();self.timer=setInterval(function heartbeatInterval(){self.updateModel()},self.interval)};LiveChannels.prototype.bindEvents=function(){var self=this;self.bindGenreFilterEvents()};LiveChannels.prototype.updateModel=function(){if(this.lastRequest){var nowMs=(new Date()).getTime();var msElapsedSinceLastRequest=nowMs-this.lastRequest.getTime();var listingsRangeInMs=this.listingsRangeInHours*3600000;log("LiveChannels.updateModel -> msElapsedSinceLastRequest: ",msElapsedSinceLastRequest);log("LiveChannels.updateModel -> listingsRangeInMs: ",listingsRangeInMs);if(msElapsedSinceLastRequest>listingsRangeInMs){this.requestModel()}else{this.updateView()}}else{this.lastRequest=new Date();this.requestModel()}};LiveChannels.prototype.requestModel=function(){var self=this;self.listingEndpoint=new orion.oesp.req.ListingEndpoint();function roundToNearest30Minutes(d){d.setMinutes(Math.floor(d.getMinutes()/30)*30);d.setSeconds(0);d.setMilliseconds(0)}var endTime=new Date();var startTime=new Date();roundToNearest30Minutes(endTime);roundToNearest30Minutes(startTime);startTime.setHours(startTime.getHours()+self.listingsRangeInHours);var chunkSize=14;var chunkingIds=self.stationIds;(function recursiveRequesting(){if(chunkingIds.length>0){var chunkedIds=chunkingIds.splice(0,chunkSize).join("|");var listingResponse=self.listingEndpoint.requestListings({byStartTime:"~"+startTime.getTime(),byEndTime:endTime.getTime()+"~",sort:"startTime|asc",byStationId:chunkedIds});listingResponse.done(function listingRequestDone(data){self.populateListingsData(data);self.updateGenresData();self.updateView();recursiveRequesting()})}else{if(!self.eventsBound){self.bindEvents();self.eventsBound=true}self.lastRequest=new Date()}})()};LiveChannels.prototype.getListingDuration=function(listing){var self=this;var duration;if(listing.program&&listing.startTime&&listing.endTime){return BBV.utils.date(listing.startTime+orion.oesp.timeEndpoint.offset*60*1000).format("H:m")+"-"+BBV.utils.date(listing.endTime+orion.oesp.timeEndpoint.offset*60*1000).format("H:m")}else{return undefined}};LiveChannels.prototype.updateView=function(){var self=this;self.updateTooltips();self.updateGenresSelect()};LiveChannels.prototype.sortTitles=function(unsortedArray){return(unsortedArray.sort(function(a,b){if(a[0]==b[0]){return 0}if(a[0]>b[0]){return 1}else{return -1}}))};LiveChannels.prototype.updateGenresSelect=function(){$select=$("#live-channels-genres-select");if(!$select.length){return}var self=this;var genreId;var genresArray=[];$select.empty();$select.append('<li class="genre-item" data-category-id="all"><a class="genre-link" href="#/all">'+self.localStrings.selectall+"</a></li>");for(genreId in self.genres){var genre=[];if(self.genres[genreId].hasOwnProperty("title")){genre.push(self.genres[genreId].title);genre.push(genreId)}genresArray.push(genre)}self.sortTitles(genresArray);for(var i=0;i<genresArray.length;i++){$select.append('<li class="genre-item" data-category-id="'+genresArray[i][1]+'"><a class="genre-link" href="#/'+genresArray[i][1]+'">'+genresArray[i][0]+"</a></option>")}};LiveChannels.prototype.updateTooltips=function(){var self=this;var $elem,$tip,tmpl,channelTitle,hasNextListing,nowListing,nextListing,model,stationId,nowIdx;for(stationId in self.stationListings){if(self.stationListings.hasOwnProperty(stationId)){nextListing={};nowListing={};nowIdx=0;if(self.stationListings[stationId].length){for(var i=0;i<self.stationListings[stationId].length;i++){var currentEndTime=self.stationListings[stationId][i].endTime;var currentStartTime=self.stationListings[stationId][i].startTime;var now=(new Date()).getTime();if(currentStartTime<=now&&currentEndTime>now){nowIdx=i;break}}}if(self.stationListings[stationId].length>nowIdx+1){nowListing=self.stationListings[stationId][nowIdx];nextListing=self.stationListings[stationId][nowIdx+1]}else{if(self.stationListings[stationId].length===nowIdx+1){nowListing=self.stationListings[stationId][nowIdx]}}$elem=$("#station-"+nowListing.stationId);$elem.addClass("ready");$tip=$elem.find(".channel-link");channelTitle=$elem.data("channel-title");if(nowListing.program){toolTipModel={title:nowListing.program&&nowListing.program.title,description:nowListing.program&&nowListing.program.description,duration:self.getListingDuration(nowListing),genreText:self.localStrings.genre,episodeText:self.localStrings.episode,seasonText:self.localStrings.season,onnextText:self.localStrings.onnext,seasonNumber:nowListing.program&&nowListing.program.seasonNumber,seasonEpisodeNumber:nowListing.program&&nowListing.program.seasonEpisodeNumber,channelTitle:channelTitle,nextTitle:nextListing.program&&nextListing.program.title,nextDuration:self.getListingDuration(nextListing)};tmpl=Mustache.to_html(orion.templates.LiveChannelsTooltip,toolTipModel);$tip.popover({container:"body",content:tmpl,html:true,placement:"auto bottom",trigger:"hover"})}else{if(!nowListing.program&&$elem){toolTipModel={title:nowListing.program&&nowListing.program.title,tba_text:orioni18n.liveChannels.tba};$elem.data("no-data","1");tmpl=Mustache.to_html(orion.templates.LiveChannelsTooltipEmpty,toolTipModel);$tip.html(tmpl)}}}}};LiveChannels.prototype.populateListingsData=function(data){var self=this;var li;for(li=0;li<data.listings.length;li++){var listing=data.listings[li];var listingStation=listing.stationId;if(self.stationListings[listingStation]===undefined){self.stationListings[listingStation]=[]}self.stationListings[listingStation].push(listing)}};LiveChannels.prototype.updateGenresData=function(){var self=this;var listing,program,ci,listingCategories,category,stationId;self.genres={};for(stationId in self.stationListings){if(self.stationListings.hasOwnProperty(stationId)){if(self.stationListings[stationId].length>0){listing=self.stationListings[stationId][0];if(listing.hasOwnProperty("program")&&listing.program.hasOwnProperty("categories")){listingCategories=listing.program.categories;for(ci=0;ci<listingCategories.length;ci++){category=listingCategories[ci];if(!self.genres.hasOwnProperty(category.id)&&BBV.settings.i18n.genreMap.hasOwnProperty(category.id)&&BBV.settings.i18n.genreMap[category.id].parentId=="null"){self.genres[category.id]=BBV.settings.i18n.genreMap[category.id]}}}}}}};LiveChannels.prototype.stationListingHasCategory=function(stationId,categoryId){var self=this;var ci,categories;var stationsListings=self.stationListings[stationId];if(stationsListings.length>0&&stationsListings[0].hasOwnProperty("program")){if(!stationsListings[0].program.hasOwnProperty("categories")){return false}categories=stationsListings[0].program.categories;for(ci=0;ci<categories.length;ci++){if(categories[ci].hasOwnProperty("id")){if(categories[ci].id==categoryId){return true}}}}return false};LiveChannels.prototype.filterChannelsByGenre=function(categoryId){var self=this;var stationId,listing;if(categoryId=="all"){$(self.channelItemSelector).show()}else{var stationIds=[];$(self.channelItemSelector).hide();for(stationId in self.stationListings){stationIds.push(stationId);if(self.stationListings.hasOwnProperty(stationId)){if(!self.stationListingHasCategory(stationId,categoryId)){$("#station-"+stationId).hide()}else{$("#station-"+stationId).show()}}}self.$list.each(function(){var $this=$(this);if(!BBV.inArray($this.data("stationId"),stationIds)){log("removing channel with no genre");$this.hide()}})}};LiveChannels.prototype.bindGenreFilterEvents=function(){var self=this;var categoryId;Path.map("#/(:categoryId)").to(function(){var $currentSort=$(".current");var categoryId=this.params.categoryId;$currentSort.html((categoryId=="all")?self.localStrings.selectall:BBV.settings.i18n.genreMap[categoryId].title);if(categoryId){self.filterChannelsByGenre(categoryId)}});Path.listen()};LiveChannels.prototype.getChannelsDataAsArray=function(dataKey){var self=this;var vals=[];var channelElems=$(self.channelItemSelector);channelElems.each(function(){var item=this;var $current=$(item);var dataVal=$current.data(dataKey);if(dataVal){vals.push(dataVal)}});return vals};return LiveChannels})(jQuery);
BBV.namespace("orion.modules").NetworkCard=orion.modules.NetworkCard||(function($){function NetworkCard(elem){var self=this;self.$=$(elem);self.setBackground()}NetworkCard.prototype.setBackground=function(){var self=this;var backgroundUrl=self.$.data("background");if(backgroundUrl&&backgroundUrl.length>0){self.backgroundContainer=$("#backgrounds-div-container").css("background-image","url("+backgroundUrl+")")}};return NetworkCard})(jQuery);
BBV.namespace("orion.modules").ChannelCard=orion.modules.ChannelCard||(function($){function ChannelCard(elem,publisher){var self=this;self.$=$(elem);self.elem=elem;self.pageTitle=self.$.data("page-title");self.createLoader();self.bindEvents(publisher);self.initRoutes()}ChannelCard.prototype.updateMeta=function(channelName){var self=this;var title=self.pageTitle+" - "+channelName;document.title=title;var metas=document.getElementsByTagName("meta");for(var i=0;i<metas.length;i++){var metaTag=metas[i];if(metaTag.getAttribute("property")=="og:title"){metaTag.setAttribute("og:title",title)}}document.getElementsByTagName("head")[0].setAttribute("data-page-title",title)};ChannelCard.prototype.initRoutes=function(){var self=this;self.router=Sammy("#page-wrapper",function(){this.get("#/:channelid/:channelname",function(){var channelId=this.params.channelid;var channelName=this.params.channelname;self.$.trigger("loading");self.$.data("channel-name",channelName);self.updateMeta(channelName);self.getData(channelId)})});self.router.run()};ChannelCard.prototype.bindEvents=function(publisher){publisher.subscribe("channelSelected",$.proxy(this.channelSelected,this))};ChannelCard.prototype.getData=function(channelId){var self=this;var channelRequest=orion.oesp.channelEndpoint.requestChannel(channelId);var dataLoaded=$.Deferred();var channelMethods=orion.modules.EPG.TemplateHelperMethods.channels;channelRequest.done(function(channel){var stationObj={id:channel.id,title:channel.extractName(),hasLiveStream:true};self.model={channelId:channelId,stationId:channel.stationSchedules[0].station.id,providerId:channel.stationSchedules[0].station.providerId,hasLiveStream:channelMethods.isLive(channel),title:channel.extractName(),description:channel.stationSchedules[0].station.description,tvGuidePath:self.$.data("tvguide-path"),dataFeedUrl:self.$.data("feed-url"),fbLinkUrl:orion.modules.EPG.TemplateHelperMethods.channels.getUrl(stationObj,true),routes:BBV.settings.oespRoutes,i18nChannelCard:orioni18n.channelCardListing};$.each(channel.stationSchedules[0].station.images,function(){if(this.assetType==="station-logo-large"){self.model.logo={url:this.url,width:this.width,height:this.height}}if(this.assetType==="station-titlecard-background"){self.model.background=this.url}});orion.app.trigger("channelCorrection",{channelId:stationObj.id,channelName:stationObj.title});self.render();dataLoaded.resolve()});channelRequest.fail(function(){var channelName=self.$.data("channel-name");var channelsDeferred=orion.oesp.channelEndpoint.requestChannels({sort:"channelNumber"});var foundChannelEquiv=false;channelsDeferred.done(function(data){if(data.channels.length>0){for(var i=0;i<data.channels.length;i++){var channel=data.channels[i];if(channel.extractName()===channelName){foundChannelEquiv=true;if(channel.id!==channelId){orion.app.trigger("channelCorrection",{channelId:channel.id,channelName:channel.extractName()})}}}}if(!foundChannelEquiv){document.location.href=BBV.settings.site.urls.channels.bygenre}})});channelRequest.always(function(){self.$.trigger("loaded")});return dataLoaded.promise()};ChannelCard.prototype.render=function(){var self=this;$tmp=$(Mustache.to_html(orion.templates.ChannelCard,self.model));$(self.elem).html($tmp);new orion.modules.TitleCard(self.elem)};ChannelCard.prototype.channelSelected=function(channel){channelId=BBV.player.isSilverlight()?channel.channelId:channel.channel;channelName=channel.channelName;window.location.hash="#/"+channelId+"/"+channelName};ChannelCard.prototype.createLoader=function(){var self=this;self.loader=self.$.loader({element:{overlay:"<div/>"},flow:["append"],location:"outside",target:".loader",minheight:95,img:{top:"45px"}})};return ChannelCard})(jQuery);
BBV.namespace("orion.modules.EPG").Favorite=orion.modules.EPG.Favorite||(function($){function Favorite(channelID){this.id=channelID;this.online=BBV.user().isLoggedIn}Favorite.prototype={constructor:Favorite,save:function(elem,fn){var f=this;orion.util.oesp.put(orion.modules.EPG.FavoriteManager.endpoint,{data:f.format(),success:fn})},format:function(){var f=this,data={favouriteChannels:[]},cookie=[];if(f.online){BBV.each(orion.modules.EPG.FavoriteManager.favorites,function(key,favorite){data.favouriteChannels.push({channelId:favorite.id})});return BBV.json.serialize(data)}else{BBV.each(orion.modules.EPG.FavoriteManager.favorites,function(key,favorite){cookie.push(favorite.id)});return cookie}}};return Favorite})(jQuery);
BBV.namespace("orion.modules.EPG").FavoriteManager=orion.modules.EPG.FavoriteManager||(function($){var display=[],channelIDs=[];var defaultGenreFilter=orion.modules.EPG.defaultGenreFilter;function FavoriteManager(options){if(!options||!options.url){throw {name:"MissingParameter",message:"URL is a required parameter"}}this.url=FavoriteManager.endpoint=options.url;this.favoritesContainer=options.favoritesContainer||null;this.channelsContainer=options.channelsContainer}FavoriteManager.prototype.add=function(_this){var self=this;var $this=$(_this);var $wrapper=$this.closest("dl");var stationID=$wrapper.attr("id");var channelID=$wrapper.data("channel-id");var channelName=$wrapper.data("channel-name");var sort=$wrapper.attr("data-sort");$wrapper.removeClass("current");FavoriteManager.favorites[sort]={dom:$wrapper.attr("id",stationID).get(0),id:channelID};channelIDs.push(channelID);FavoriteManager._length+=1;(new orion.modules.EPG.Favorite(channelID)).save($this,function(){$wrapper.find(".favorite").addClass("active");self.render()});orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Add favorite channel",channel:"TV Guide/Grid/Add favorite channel",prop23:"TV Guide",prop24:"Grid",prop26:"Add favorite channel",eVar43:channelID,eVar44:channelName,events:"event9,event46"});return false};FavoriteManager.prototype.collate=function(){var self=this,keys=[];display=[];BBV.each(FavoriteManager.favorites,function(key,val){keys.push(key)});keys.sort(function numericSortAsc(a,b){return parseInt(a,10)-parseInt(b,10)});BBV.each(keys,function(idx,val){if(FavoriteManager.favorites[val].domDetails){self.setActiveListing(FavoriteManager.favorites[val]);display.push(FavoriteManager.favorites[val].dom);display.push(FavoriteManager.favorites[val].domDetails)}else{display.push(FavoriteManager.favorites[val].dom)}});return self};FavoriteManager.prototype.setActiveListing=function(channel){var activeListingId=$(channel.domDetails).attr("data-listing-id");var $activeChannel=$(channel.dom);var $activeListing=$activeChannel.find('li.listing[data-listing-id="'+activeListingId+'"]');$activeChannel.addClass("details");$activeListing.addClass("active")};FavoriteManager.prototype.getFavorites=function(){var self=this;var defer=new $.Deferred();$.when(orion.oesp.session).done(function(session){if(session.isAuthenticated()){BBV.utils.cookie.remove("favorites");BBV.ajax.load(FavoriteManager.endpoint,{type:"GET",success:function(_favorites){BBV.each(_favorites.favouriteChannels,function(idx,itm){channelIDs.push(itm.channelId)});FavoriteManager._length=channelIDs.length;defer.resolve()}})}});return defer};FavoriteManager.prototype.load=function(){var self=this;var favoritesRequest=self.getFavorites();favoritesRequest.done(function(){self.render();BBV.events.trigger("favoritesComplete")})};FavoriteManager.prototype.parse=function(_favorites){var ids=_favorites;BBV.each(ids,function(idx,itm){var d=$("#station-"+itm)})};FavoriteManager.prototype.render=function(){var self=this,$wrapper,stationID,sort,channelID,$this;FavoriteManager.favorites={};BBV.each(channelIDs,function(idx,itm){$wrapper=$('dl[data-channel-id="'+itm+'"]');$programDetails=$('.program-details-wrap[data-channel-id="'+itm+'"]');$wrapper.each(function(){$this=$(this);stationID=$this.attr("id");$this.find(".favorite").addClass("active");channelID=itm;sort=$this.attr("data-sort");FavoriteManager.favorites[sort]={dom:$this.attr("id",stationID).get(0),id:channelID};if($programDetails.length){FavoriteManager.favorites[sort].domDetails=$programDetails.get(0)}})});self.collate();self.favoritesContainer.html(display);self.show();return self};FavoriteManager.prototype.show=function(){if(!defaultGenreFilter()){$(".channel-listing",".favorite-list").show()}return this};FavoriteManager.prototype.remove=function(_this){var self=this;var $this=$(_this);var $favoriteEl=$this.closest(".favorite");var $wrapper=$this.closest("dl");var channelID=$wrapper.data("channel-id");var channelName=$wrapper.data("channel-name");var stationID=$wrapper.attr("id").match(/station\-[0-9]+/gi);var favoriteSort=$wrapper.attr("data-sort");delete FavoriteManager.favorites[favoriteSort];channelIDs=$.grep(channelIDs,function(value){return value!=channelID});FavoriteManager._length-=1;(new orion.modules.EPG.Favorite(channelID)).save($this,function(){$wrapper.removeClass("current").find(".favorite").removeClass("active");self.insert($wrapper);self.render()});orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Remove favorite channel",channel:"TV Guide/Grid/Remove favorite channel",prop23:"TV Guide",prop24:"Grid",prop26:"Remove favorite channel",eVar43:channelID,eVar44:channelName,events:"event9,event47"});return false};FavoriteManager.prototype.insert=function($element){var self=this;var favoriteSort=$element.data("sort");var $channels=$(self.channelsContainer.children(".channel-listing"));$.each($channels,function(index,element){var channelSort=$(element).data("sort");var nextSort;if(index+1<$channels.length){nextSort=$($channels[index+1]).data("sort")}if(favoriteSort<channelSort){self.channelsContainer.prepend($element);return false}else{if(favoriteSort>channelSort&&typeof(nextSort)!=="undefined"&&favoriteSort<nextSort){$(element).after($element);return false}else{if(favoriteSort>channelSort&&typeof(nextSort)==="undefined"){self.channelsContainer.append($element);return false}}}})};FavoriteManager._length=0;FavoriteManager.favorites={};FavoriteManager.endpoint=null;return FavoriteManager})(jQuery);
BBV.namespace("orion.modules.EPG").RemoteBookings=orion.modules.EPG.RemoteBookings||(function($){function RemoteBookings(publisher,onlyRecords){var self=this;self.publisher=publisher;self.$epg=$(".channel-guide");self.dvrStatus=$.Deferred();self.onlyRecords=onlyRecords;var utilityBar=$("#site-utility-bar");self.url=utilityBar.data("remote-bookings-url")}RemoteBookings.prototype.initialize=function(){var self=this;if(BBV.user().isLoggedIn){self.manager=new orion.modules.EPG.RemoteBookingsManager(self.publisher);$.when(self.getProfile()).done(function(){self.triggerSettings();self.setDvrStatus()}).fail(function(data){log("RemoteBookings.initialize -> error on getProfile");log(" -> data: ",data);self.setDvrStatus()})}else{orion.app.subscribe("loggedIn",function(){self.initialize()})}return self};RemoteBookings.prototype.delegate=function(selector,delegateSelectors){var self=this;self.selector=selector;self.delegateSelectors=delegateSelectors.join(", ");self.handlers()};RemoteBookings.prototype.handlers=function(){var self=this;$(self.selector).on("click",self.delegateSelectors,function(e){log("RemoteBookings.onClick -> clicked e.currentTarget: ",e.currentTarget);e.preventDefault();self.addDataToModals(e);self.showModals(e)});return self};RemoteBookings.prototype.bookDirect=function(e){var self=this;var $elem=$(e.currentTarget);var listingId="";var show="";var channel="";var $progDetails=$elem.closest(".program-details-wrap");if($progDetails.length==0){$progDetails=$elem.closest(".program-details-linear-wrap")}if($progDetails.length==0){$progDetails=$elem.closest("#item")}if($progDetails.length==0){$progDetails=$elem.closest(".listing")}if(!$elem.is("#dvr-settings-link")){listingId=$progDetails.data("listing-id");show=$progDetails.find(".description h3").text();channel=$progDetails.data("channel-name")}var rbUrl=$("#site-utility-bar").data("remote-bookings-url");var $listing=$("            li.listing[data-listing-id='"+listingId+"'] .notifications .btn-record,            div.program-details-wrap[data-listing-id='"+listingId+"'] .user-functionality .btn-record,            li.program-details-linear-wrap[data-listing-id='"+listingId+"'] .user-functionality .btn-record,            .title-card-ng[data-media-id='"+listingId+"'] .action-bar-item [data-name='recordings'],            .listing[data-id='"+listingId+"'] td.nav a.record-btn        ");var program={name:show,channelId:$progDetails.data("channel-id"),channelName:channel};var recordingStatuses=["recordings-pending","recordings-confirmed","recordings-success","recordings-failed"];var hasStatus=false;for(var i=0;i<recordingStatuses.length;i++){if($elem.hasClass(recordingStatuses[i])){hasStatus=true;break}}if(hasStatus){return}$elem.attr("disabled","disabled").addClass("disabled");if($elem.hasClass("record")||$elem.hasClass("record-btn")||self.onlyRecords){var bookingType="recordings",bookingData=JSON.stringify({listingId:listingId,overwriteExisting:true});var errorHandler=function(data){$listing.each(function(idx,icon){$(icon).addClass(bookingType+"-failed");self.manager.setPopover(icon,"failed",self.manager.localization.tooltips.tooltiptextrecordfailure)});self.publisher.trigger("requestDialog",{dialogName:"booking-error",centerOn:"window",destroyOnClose:true});if(data[bookingType]){var errorMsg=orioni18n.RemoteBookingMessages.bookingErrors[data[bookingType][0].reason]}else{var errorMsg=orioni18n.RemoteBookingMessages.bookingErrors.unknown}$("#booking-error .show").text($("#booking-error").data("show"));$("#booking-error .channel").text($("#booking-error").data("channel"));$("#booking-error .error").text(errorMsg);orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set recording failed",channel:"TV Guide/Set Recording/Set Recording failed",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording failed",prop41:errorMsg,eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event48"})};orion.util.oesp.post(rbUrl+"/"+bookingType+"/",{data:bookingData,success:function(data){var status=data[bookingType][0].status;var errorMsg=data[bookingType][0].reason;if(status=="failure"){errorHandler(data);return}$elem.removeAttr("disabled").removeClass("disabled");$listing.each(function(idx,icon){$(icon).addClass(bookingType+"-pending");self.manager.setPopover(icon,"pending",self.manager.localization.tooltips.tooltiptextrecordpending)});if(bookingType==="recordings"&&(status==="success"||status==="pending")){orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set recording success",channel:"TV Guide/Set Recording/Set Recording success",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording success",prop44:"[INSERT EPG transaction ID]",eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event43"})}else{if(bookingType==="recordings"&&status==="failure"){orion.util.analytics.trackEvent("action",{pageName:"TV Guide/Set recording failed",channel:"TV Guide/Set Recording/Set Recording failed",prop23:"TV Guide",prop24:"Set Recording",prop26:"Set Recording failed",prop41:errorMsg,eVar42:program.name,eVar43:program.channelId,eVar44:program.channelName,events:"event9,event48"})}}self.getRemoteBookings(bookingType)},error:errorHandler})}};RemoteBookings.prototype.addDataToModals=function(e){var self=this;var target=e.currentTarget;var $target=$(e.currentTarget);if($target.is("#dvr-settings-link")){$("#dvr-settings").data("trigger",target);$("#dvr-booking").data("listing-id","").data("trigger","").data("show","").data("channel","")}else{var $elem=$target.closest(".program-details-wrap");if($elem.length==0){$elem=$target.closest(".program-details-linear-wrap")}if($elem.length==0){$elem=$target.closest("#item")}if($elem.length==0){$elem=$target.closest(".listing")}$("#dvr-settings").data("trigger","");$("#dvr-booking").data("listing-id",$elem.data("listing-id")).data("trigger",target).data("show",$elem.find(".description h3").text()).data("channel",$elem.data("channel-name"));$("#booking-error").data("listing-id",$elem.data("listing-id")).data("trigger",target).data("show",$elem.find(".description h3").text()).data("channel",$elem.data("channel-name"))}};RemoteBookings.prototype.showModals=function(e){var self=this;if(!BBV.user().isLoggedIn){self.publisher.trigger("requestDialog",{dialogName:"login",pointTo:{target:$(e.currentTarget),direction:"down"}})}else{if($(e.currentTarget).is("#dvr-settings-link")||$("body.no-dvr-enabled").length){self.publisher.trigger("requestDialog",{dialogName:"dvr-settings",centerOn:"window"})}else{self.bookDirect(e)}}};RemoteBookings.prototype.getProfile=function(){var self=this,dfd=$.Deferred();orion.util.oesp.get(self.url+"/profile/",{success:function(data){self.profile=data;dfd.resolve()},error:function(data){self.profile={};dfd.reject(data)}});return dfd.promise()};RemoteBookings.prototype.triggerSettings=function(){var self=this;if(window.location.hash=="#dvr"){$("#dvr-settings").data("trigger",$("#dvr-settings-link"));$("#dvr-booking").data("listing-id","").data("trigger","").data("show","").data("channel","");self.publisher.trigger("requestDialog",{dialogName:"dvr-settings",centerOn:"window",destroyOnClose:true})}};RemoteBookings.prototype.setDvrStatus=function(){var self=this;if(self.profile.isAccountEnabled){$("body").addClass("dvr-enabled")}else{$("body").addClass("no-dvr-enabled")}self.setRecordingCapability(false);if(self.profile.boxes&&self.profile.boxes.length){$.each(self.profile.boxes,function(idx,box){if(self.profile.defaultSmartCardId!==box.smartCardId){return}if(box.isRemoteRecordingCapable){self.setRecordingCapability(true);return false}})}$("#dvr-settings").data("profile",self.profile);self.dvrStatus.resolve()};RemoteBookings.prototype.setRecordingCapability=function(isCapable){var self=this;if(isCapable){self.hasRecordingDvr=true;$("body").removeClass("no-recording-capable")}else{self.hasRecordingDvr=false;$("body").addClass("no-recording-capable")}};RemoteBookings.prototype.pollingInitialized=false;RemoteBookings.prototype.getRemoteBookings=function(){var self=this;self.dvrStatus.done(function(){if(self.hasRecordingDvr){self.publisher.trigger("getRemoteBookings","recordings")}})};return RemoteBookings})(jQuery);
BBV.namespace("orion.modules.EPG").RemoteBookingsManager=orion.modules.EPG.RemoteBookingsManager||(function($){function RemoteBookingsManager(publisher){if(!publisher){throw new Error("RemoteBookingsManager called without publisher.")}var self=this;self.publisher=publisher;self.$epg=$(".channel-guide");self.bookingTypes=["recordings"];self.pending={};self.pollingDelay=5*60*1000;self.localization={tooltips:orioni18n.RemoteBookingMessages.bookingErrors};var utilityBar=$("#site-utility-bar");self.url=utilityBar.data("remote-bookings-url");if(!(self instanceof RemoteBookingsManager)){throw new Error("RemoteBookingsManager called without new.")}$.each(self.bookingTypes,function(idx,bookingType){self.pending[bookingType]=[]});self.publisher.subscribe("getRemoteBookings",function(bookingType){if(!RemoteBookingsManager.pendingCnt){self.getRemoteBookings(bookingType)}})}RemoteBookingsManager.prototype.getRemoteBookings=function(bookingType){var self=this;self.rBookings={};orion.util.oesp.get(self.url+"/"+bookingType+"/",{cache:false,success:function(data){self.rBookings[bookingType]=data[bookingType]||false;self.setStatus(bookingType)},error:function(data){log("RemoteBookingsManager.getRemoteBookings -> error: ",data);self.pending[bookingType]=[]}})};RemoteBookingsManager.prototype.setPopover=function(elem,status,localization){var icons={pending:"",success:"success-tick-icon",failed:"failed-icon",failure:"failed-icon"};var data={icon:icons[status],text:localization};var html=Mustache.to_html(orion.templates.RemoteBookingTooltip,data);$(elem).popover("destroy");$(".popover").remove();$(elem).popover({container:"body",content:html,placement:"top",trigger:"hover",html:true})};RemoteBookingsManager.prototype.setStatus=function(bookingType){var self=this;var remoteBookings=self.rBookings[bookingType];var activeRecordings=[];var defaultRecordBtn=$('[data-name="'+bookingType+'"]');this.setPopover(defaultRecordBtn,"",self.localization.tooltips.tooltiptextnonrecorded);$.each(self.rBookings[bookingType],function(idx,remoteBooking){if(bookingType==="recordings"){activeRecordings.push(remoteBooking.listingId)}self.publisher.trigger(bookingType,remoteBooking.status,remoteBooking.listingId);var listingIsPending=$.inArray(remoteBooking.listingId,self.pending[bookingType])>=0,$listing=$("                li.listing[data-listing-id='"+remoteBooking.listingId+"'] .btn-record,                div.program-details-wrap[data-listing-id='"+remoteBooking.listingId+"'] .user-functionality .btn-record,                li.program-details-linear-wrap[data-listing-id='"+remoteBooking.listingId+"'] .user-functionality .btn-record,                .horizoninspiredaspot .upc-aspot-content .user-functionality,                .title-card-ng[data-media-id='"+remoteBooking.listingId+"'] .action-bar-item [data-name='"+bookingType+"'],                .listing[data-id='"+remoteBooking.listingId+"'] td.nav a.record-btn            ");if(remoteBooking.status=="success"&&!$listing.is("."+bookingType+"-confirmed")){if(self.pending[bookingType].length&&listingIsPending){BBV.remove(self.pending[bookingType],$.inArray(remoteBooking.listingId,self.pending[bookingType]))}$listing.each(function(idx,icon){$(icon).addClass(bookingType+"-confirmed");$(icon).removeClass(bookingType+"-pending");self.setPopover(icon,remoteBooking.status,self.localization.tooltips.tooltiptextrecorded)})}else{if(remoteBooking.status=="failed"||remoteBooking.status=="failure"){if($("#booking-error").length&&$("#booking-error").data("listing-id")==remoteBooking.listingId){self.publisher.trigger("requestDialog",{dialogName:"booking-error",centerOn:"window",destroyOnClose:true});var errorMsg=orioni18n.RemoteBookingMessages.bookingErrors[remoteBooking.reason];$("#booking-error .show").text($("#booking-error").data("show"));$("#booking-error .channel").text($("#booking-error").data("channel"));$("#booking-error .error").text(errorMsg)}if(self.pending[bookingType].length&&listingIsPending){BBV.remove(self.pending[bookingType],$.inArray(remoteBooking.listingId,self.pending[bookingType]))}$listing.each(function(idx,icon){$(icon).removeClass(bookingType+"-pending");$(icon).addClass(bookingType+"-failed");self.setPopover(icon,remoteBooking.status,self.localization.tooltips.tooltiptextrecordfailure)})}else{if(remoteBooking.status=="pending"){if(!listingIsPending){self.pending[bookingType].push(remoteBooking.listingId)}$listing.each(function(idx,icon){$(icon).removeClass(bookingType+"-failed");$(icon).addClass(bookingType+"-pending");self.setPopover(icon,remoteBooking.status,self.localization.tooltips.tooltiptextrecordpending)})}}}});if(bookingType==="recordings"){$(".notifications.recordings-confirmed").each(function(){var listing=$(this).closest(".listing");var listingId=listing.data("listing-id");var isActive=$.inArray(listingId,activeRecordings)>-1;if(!isActive){$('[data-listing-id="'+listingId+'"]').find(".notifications, .user-functionality").removeClass("recordings-confirmed")}})}if(self.pending[bookingType].length){RemoteBookingsManager.pendingCnt=self.pending[bookingType].length;setTimeout(function(){self.getRemoteBookings(bookingType)},self.pollingDelay)}};return RemoteBookingsManager})(jQuery);
BBV.namespace("orion.modules.EPG").TemplateHelperMethods=orion.modules.EPG.TemplateHelperMethods||(function($){var timeFrameInHours=orion.modules.EPG.timeFrameInHours;var keyTime=orion.modules.EPG.keyTime;function runtimeToWidth(minutes){var width=Math.ceil(minutes*keyTime.minutesWidth-keyTime.add),limit=keyTime.totalWidth;if(width>limit){width=limit}return width}function msToTime(time){var n=new Date(time),hours=n.getHours(),minutes=n.getMinutes();return[(hours<10)?"0"+hours:+hours,":",(minutes<10)?"0"+minutes:+minutes].join("")}var utilMethods={msToTime:msToTime,readUrlString:function(url){var keyValue=url.split("?");return{url:keyValue[0],query:keyValue[1]}},parseParam:function(p){var custom=/\}\{/,obj={},tmp_;if(p&&custom.test(p)){tmp_=p.replace(/\}\{/,"}${");tmp_=tmp_.split("$");obj[tmp_[0]]=p}else{if(p&&p.indexOf("=")>-1){tmp_=p.split("=");obj[tmp_[0]]=p}else{if(p){obj[p]=p}}}return obj},parseServerDateToStart:function(_time){return utilMethods.parseDateToStart(_time+orion.oesp.timeEndpoint.offset*60*1000)},parseDateToStart:function(_time){var n=(BBV.type(_time)==="number")?new Date(_time):new Date();n.setMinutes(Math.floor(n.getMinutes()/30)*30);n.setSeconds(0);n.setMilliseconds(0);return n.getTime()},getDefaultPoster:function(){var imgPath="/etc/designs/orion/upc/nl/img/";var img=imgPath+"placeholders/noposter.png";return img},getLogo:function(imgs){if(!imgs){return""}var logo;BBV.each(imgs,function(idx,val){if(val.assetType==="station-logo-medium"){logo=val}});return(logo&&logo.url)?logo:""},channels:{formatChannel:function(channel){var lngth=3,toFormat=channel.toString(),l=toFormat.length;for(;l<lngth;l++){toFormat="0"+toFormat}return toFormat},getImages:function(imgs){var active,inactive;BBV.each(imgs,function(idx,val){if(val.assetType==="station-logo-medium"){active=val}if(val.assetType==="station-logo-small"){inactive=val}});return{active:(active&&active.url)?active.url:undefined,inactive:(inactive&&inactive.url)?inactive.url:undefined}},isLive:function(channel){return((BBV.player.isSilverlight()&&this.hasHSSStream(channel))||(!BBV.player.isSilverlight()&&channel.hasLiveStream))},getUrl:function(station,isAbsolute){var id=station.id;var channels=BBV.settings.site.urls.channels;var path;if((BBV.player.isSilverlight()&&station.hasHSSStream)||(!BBV.player.isSilverlight()&&station.hasLiveStream)){path=channels.live+"/"+id}else{path=channels.vod+"/"+id}if(isAbsolute){return location.protocol+"//"+location.host+path}else{return path}},hasHSSStream:function(channel){var i,j,station,stream;for(i=0;i<channel.stationSchedules.length;i++){station=channel.stationSchedules[i].station;for(j=0;j<station.videoStreams.length;j++){stream=station.videoStreams[j];if(stream.assetType==="Orion-HSS"){return true}}}return false}},listings:{checkIfAlreadyEnded:function(endTime){var now=+new Date();var padding=1000*60*2;var hasShowEnded=endTime-padding<now;return(hasShowEnded)},isCurrentListing:function(listing){return listing&&$.now()>listing.startTime&&$.now()<listing.endTime},checkIfAlreadyStarted:function(startTime){var now=+new Date();var padding=1000*60*2;var hasShowStarted=startTime-padding<now;return(hasShowStarted)},checkIfLiveStream:function(hasLiveStream,hasHSSStream,startTime,endTime){var now=+new Date();var isShowLive=(startTime<now&&endTime>now);return(((BBV.player.isSilverlight()&&hasHSSStream)||(!BBV.player.isSilverlight()&&hasLiveStream))&&isShowLive)},genreHighlight:function(genres){var filter=defaultGenreFilter;var genreList=this.getGenres(genres);var genresSplit=genreList.split(" ");var willFilter=(BBV.inArray(filter(),genresSplit)>-1);return willFilter},getBoxArtMedium:function(images){var img=false;for(var i=0;i<images.length;i++){if(images[i].assetType==="boxart-medium"){img=images[i].url;return img}}return img},getBoxArtLarge:function(images){var img=false;for(var i=0;i<images.length;i++){if(images[i].assetType==="boxart-xlarge"){img=images[i].url;return img}}return img},getGenres:function(genres){if(!genres){return""}var categories=[];for(var i=0;i<genres.length;i++){categories.push(genres[i].id||"")}return categories.join(" ")},getGenresTitles:function(genres){if(!genres){return""}var categories=[];for(var i=0;i<genres.length;i++){categories.push(genres[i].title||"")}return categories.join(", ")},buildGenreLinks:function(genres){if(!genres){return""}var categories=[];for(var i=0;i<genres.length;i++){categories.push('<a href="'+BBV.settings.site.urls.channels.bygenre+"#/"+genres[i].id+'">'+genres[i].title+"</a>"||"")}return categories.join(", ")},getGenresArray:function(genres){if(!genres){return""}var categories=[];for(var i=0;i<genres.length;i++){categories.push(genres[i].id||"")}return categories},getServerStartEndTime:function(startTime,endTime){return msToTime(startTime+orion.oesp.timeEndpoint.offset*60*1000)+"-"+msToTime(endTime+orion.oesp.timeEndpoint.offset*60*1000)},getStartEndTime:function(startTime,endTime){return msToTime(startTime)+"-"+msToTime(endTime)},getUpcomingLink:function(title){var link=[BBV.settings.site.urls.search.tvresults,"?q="];var title=title||"";link.push(encodeURIComponent(title.replace(/\s/g,"+")));return link.join("")},getWidth:function(startTime,endTime,viewStart){var viewStop=(timeFrameInHours*1000*60*60)+viewStart;var start=(startTime<viewStart)?viewStart:startTime;var end=(endTime>viewStop)?viewStop:endTime;var ms=end-start;var runtime=ms/1000/60;return runtimeToWidth(runtime)}}};return utilMethods})(jQuery);
BBV.namespace("orion.modules.EPG").ListingsView=orion.modules.EPG.ListingsView||(function($){function ListingsView(elem,publisher){this.$=$(elem);this.publisher=publisher;this.$container=this.$.find(".grid-container");this.bindHandlers();this.activeGenre=0}ListingsView.prototype.bindHandlers=function bindHandlers(){this.$container.on("mouseenter mouseleave",".channel-listing",{timer:null},$.proxy(this.channelHighlight,this));this.$container.on("click",".listing",$.proxy(this.activateDetails,this));this.$container.on("click",".close-details",$.proxy(this.destroyDetailsSingle,this));this.publisher.subscribe("EPG.genreChanged",$.proxy(this.destroyDetailsAll,this));this.publisher.subscribe("EPG.genreChanged",$.proxy(this.changeGenrefilter,this));this.publisher.subscribe("EPG.resetCategories",$.proxy(this.stopRender,this));var timer=0;var self=this;$(window).scroll(function(){if(timer){clearTimeout(timer)}var pinHeader=function(){self.pinHeader(".pin")};timer=setTimeout(pinHeader,100)})};ListingsView.prototype.changeGenrefilter=function(genre){this.activeGenre=genre;if(this.rendered!==0){this.applyGenreFilter()}};ListingsView.prototype.applyGenreFilter=function(elem){if(!this.activeGenre){if(elem){return true}else{this.$.find("li.highlight").removeClass("highlight");this.$.find(".channel-listing").stop().fadeIn(150)}}else{if(elem){elem.find('li[data-categories*="'+this.activeGenre+'"]').addClass("highlight");return !!(elem.find('li[data-categories*="'+this.activeGenre+'"]').length)}else{this.$.find("li.highlight").removeClass("highlight");this.$.find(".channel-listing").stop().fadeOut(150);this.$.find('li[data-categories*="'+this.activeGenre+'"]').addClass("highlight").closest(".channel-listing").stop().fadeIn(150)}}};ListingsView.prototype.renderListings=function(channels){this.channels=channels;this.rendered=0;this.$container.empty();clearInterval(this.timer);var interval=(this.activeGenre&&1)||50;this.timer=setInterval($.proxy(this.renderChannel,this),interval)};ListingsView.prototype.renderChannel=function(){var $channel;if(this.channels.length){var channel=this.channels.splice(0,1);$channel=$(Mustache.to_html(orion.templates.EPGListSummary,channel[0])).hide();if(this.applyGenreFilter($channel)){$channel.fadeIn(150);this.rendered++}this.$container.append($channel);if(this.rendered>Math.ceil($(window).scrollTop()/60)+15){this.$.trigger("loaded")}}else{clearInterval(this.timer);this.$.trigger("loaded");this.publisher.trigger("getRemoteBookings","recordings")}};ListingsView.prototype.stopRender=function(){if(this.timer&&this.rendered){clearInterval(this.timer)}};ListingsView.prototype.pinHeader=function pinHeader(elem){var $pinned=$(elem);var intPinnedHeight=$pinned.outerHeight();var intElemAfterPinnedOffset=$pinned.next().offset().top;var intPinnablePxTracker=intElemAfterPinnedOffset-$(window).scrollTop();var navBar=$(".navigationbar");var utilityBar=$(".utilitybar");if(intPinnablePxTracker>=0){$pinned.removeClass("pinned");$pinned.next().css("margin-top","0")}if(($pinned.offset().top-$(window).scrollTop())-(navBar.height()+utilityBar.height())<=0){$pinned.addClass("pinned");$pinned.next().css("margin-top",intPinnedHeight+"px")}};ListingsView.prototype.channelHighlight=function channelHighlight(e){var $elem=$(e.currentTarget);if(e.type==="mouseenter"){$elem.addClass("current")}else{$elem.removeClass("current")}};ListingsView.prototype.activateDetails=function activateDetails(e){var self=this;var $listing=$(e.currentTarget);var $channel=$listing.closest(".channel-listing");var imi=$listing.data("listing-id");var $activeListing=$('.program-details-wrap[data-listing-id="'+imi+'"]:visible');var isVisible=$activeListing.length;var hasNoInformation=$listing.data("imi")==="";var listingDeferred=orion.services.LinearDataService.getActiveListing(imi);var listingRequestSent=true;var html;if(hasNoInformation){return}if(isVisible){self.destroyDetailsSingle($activeListing);return}self.destroyDetailsAll();orion.oesp.session.withSession(function(session){if(listingRequestSent){var detailsLoader=self.showDetailsLoader(imi);listingDeferred.done(function clearLoading(){detailsLoader.trigger("loaded");if($listing.hasClass("active")){detailsLoader.remove()}})}listingDeferred.done(function getCurrentListing(currentListing){if($listing.hasClass("active")||!listingRequestSent){currentListing.channelTitle=$channel.data("channel-name");currentListing=self.getFormattedDetailsData(currentListing,session);html=self.generateDetailsMarkup(currentListing);self.appendDetails($channel,html);self.showDetails(imi)}}).fail(function(){self.destroyDetailsAll()})})};ListingsView.prototype.getFormattedDetailsData=function getFormattedDetailsData(currentListing,session){var channelMethods=orion.modules.EPG.TemplateHelperMethods.channels;var listingMethods=orion.modules.EPG.TemplateHelperMethods.listings;var listingId=-1;if(!currentListing){return}$.extend(true,currentListing,{listingId:listingId,URL:channelMethods.getUrl({id:currentListing.stationId,title:currentListing.channelTitle,hasLiveStream:currentListing.channelHasLiveStream,hasHSSStream:currentListing.channelHasHSSStream}),genres:listingMethods.getGenres(currentListing.program.categories),time:listingMethods.getServerStartEndTime(currentListing.startTime,currentListing.endTime),channelIsEntitled:(session.hasEntitlement(currentListing.channelEntitlements)&&session.isAuthenticated()),rbIsEntitled:(session.hasRbEntitlement(currentListing.channelEntitlements)&&session.isAuthenticated()),isLocked:(!session.hasEntitlement(currentListing.channelEntitlements)&&session.isAuthenticated()),isLoggedIn:session.isAuthenticated(),isEnded:listingMethods.checkIfAlreadyEnded(currentListing.endTime),isLiveStream:listingMethods.checkIfLiveStream(currentListing.channelHasLiveStream,currentListing.channelHasHSSStream,currentListing.startTime,currentListing.endTime),boxArtMedium:listingMethods.getBoxArtMedium(currentListing.program.images),upcomingLink:listingMethods.getUpcomingLink(currentListing.program.title),i18n:{episode:orioni18n.EPG.episode,learnMore:orioni18n.EPG.learnMore,learnMoreLink:BBV.settings.site.urls.learnmore,liveRequired:orioni18n.EPG.liveRequired,recordButton:orioni18n.RemoteBookingMessages.bookingButtons.recordbuttontext,recordFailed:orioni18n.RemoteBookingMessages.bookingButtons.recordfailedtext,recordPending:orioni18n.RemoteBookingMessages.bookingButtons.recordpendingtext,recordSet:orioni18n.RemoteBookingMessages.bookingButtons.recordsettext,season:orioni18n.EPG.season,signIn:orioni18n.EPG.signIn,subscription:orioni18n.EPG.subscription,tba:orioni18n.EPG.TBA,upcoming:orioni18n.EPG.upcoming,watchNow:orioni18n.EPG.watchnowtext}});currentListing.channelOrRbIsEntitled=currentListing.channelIsEntitled||currentListing.rbIsEntitled;return currentListing};ListingsView.prototype.generateDetailsMarkup=function generateDetailsMarkup(data){return $(Mustache.to_html(orion.templates.EPGListDetails,data))};ListingsView.prototype.appendDetails=function appendDetails($channel,html){$channel.after(html)};ListingsView.prototype.showDetailsLoader=function showDetailsLoader(imi){var self=this;var $listing=$('.listing[data-listing-id="'+imi+'"]');var $channel=$listing.closest(".channel-listing");var $loader=$('<div class="program-details-wrap details-loader" data-imi="'+imi+'"></div>');$loader.loader({element:{overlay:"<div/>"},elementClass:"details-loading",flow:["append"],location:"outside",minheight:150,minwidth:920,target:".program-details-wrap",img:{top:"70px"}});$loader.trigger("loading");self.appendDetails($channel,$loader);$listing.addClass("active");$channel.addClass("details");$loader.fadeIn(500);return $loader};ListingsView.prototype.showDetails=function showDetails(imi){var recordingStatuses=["recordings-pending","recordings-confirmed","recordings-success","recordings-failed"];var $listing=$('.listing[data-listing-id="'+imi+'"]');var $channel=$listing.closest(".channel-listing");var $programDetails=$channel.next(".program-details-wrap");var $recordBtn=$listing.find(".notifications .btn-record");var remoteBookingsStatus;var hasStatus=false;var popover;if($recordBtn.length){for(var i=0;i<recordingStatuses.length;i++){remoteBookingsStatus=recordingStatuses[i];if($recordBtn.hasClass(remoteBookingsStatus)){hasStatus=true;break}}popover=$recordBtn.data("bs.popover")}if(!hasStatus){remoteBookingsStatus=""}$listing.addClass("active");$channel.addClass("details");$programDetails.fadeIn(500);var $innerRecordBtn=$programDetails.find(".user-functionality .btn-record");$innerRecordBtn.addClass(remoteBookingsStatus);if(popover){$innerRecordBtn.popover({container:"body",content:popover.options.content,placement:"top",trigger:"hover",html:true})}};ListingsView.prototype.destroyDetailsAll=function destroyDetailsAll(){var self=this;var $programDetails=self.$container.find(".program-details-wrap");var $channels=self.$container.find(".channel-listing");var $listings=self.$container.find(".listing");$programDetails.remove();$channels.removeClass("details");$listings.removeClass("active")};ListingsView.prototype.destroyDetailsSingle=function destroyDetailsSingle(e){var self=this;var $elem=e.currentTarget?$(e.currentTarget):e;var $programDetails=$elem.closest(".program-details-wrap");var $channels=$programDetails.prev(".channel-listing");var imi=$programDetails.data("imi");var $listings=$('.listing[data-imi="'+imi+'"]');$programDetails.fadeOut(200,function(){$channels.removeClass("details");$listings.removeClass("active");$programDetails.remove()})};return ListingsView})(jQuery);
BBV.namespace("orion.modules.EPG").TimeView=orion.modules.EPG.TimeView||(function($,time){function TimeView(elem,publisher,epg){this.$parent=$(elem);this.publisher=publisher;this.$=this.$parent.find(".time-slot-wrap").find(".band");this.$.next=this.$parent.find(".channel-guide-head .next");this.$.previous=this.$parent.find(".channel-guide-head .prev");this.$.currentTime=this.$parent.find(".current-time");this.epg=epg;this.bindHandlers()}TimeView.prototype={constructor:TimeView,bindHandlers:function bindHandlers(){this.$parent.on("click",this.$.next.selector,$.proxy(this.onNext,this));this.$parent.on("click",this.$.previous.selector,$.proxy(this.onPrevious,this));this.$parent.on("click",this.$.currentTime.selector,$.proxy(this.goNow,this))},goNow:function goNow(){this.publisher.trigger("TimeView.goNow");return false},onNext:function onNext(){this.publisher.trigger("TimeView.goNext");return false},onPrevious:function onPrevious(){this.publisher.trigger("TimeView.goPrevious");return false},goToDate:function goToDate(start,animate,date){var view=this;if(view.start!==start){var previousStart=view.start;view.start=start;var startDate=new Date(view.start);var previousDate=new Date(previousStart);if(startDate.getDate()!==previousDate.getDate()){view.updateDateRange(view.start)}var markup=TimeView.helpers.getRangedMarkup(start);if(animate){view.animate(view.$,"fadeOut",function onAnimate(){view.$.html(markup).fadeIn("fast")})}else{view.$.html(markup)}}view.setCurrentTime(start,date)},animate:function animate(el_,effect_,callback_){var view=this;var el=el_;var callback=callback_||function(){};el[effect_]({duration:"fast",complete:callback})},setupDateRange:function setupDateRange(start,daysCount,current){var dates=[];var days=daysCount?daysCount:7;var markup;var day=start;var plusDay=1000*60*60*24;var stop=start+TimeView.helpers.displayMilliseconds();current=current||new Date();var backwardDays=this.epg.availableReplayWindow+1;for(var i=1;i<=days;i+=1){dates.push({time:day,value:i-backwardDays,display:BBV.utils.date(day).format(BBV.settings.l10n.date.listingformat)});day=day+plusDay}markup=Mustache.to_html(orion.templates.DatePicker,{dates:dates});$(".channel-guide-head").find(".date").text(BBV.utils.date(current).format(BBV.settings.l10n.date.listingformat));$(".channel-guide-head").find(".end-date").text(BBV.utils.date(stop).format(BBV.settings.l10n.date.listingformat));$(".channel-guide-head").find(".select").html(markup)},setCurrentTime:function setCurrentTime(start,current){var view=this;current=current||(new Date()).getTime();var diffInMinutes=Math.floor((current-start)/1000/60);var minuteWidth=TimeView.helpers.keyTime.minutesWidth;if(diffInMinutes<0){diffInMinutes=0}if(diffInMinutes>TimeView.helpers.displayMilliseconds()/1000/60){diffInMinutes=Math.floor(TimeView.helpers.displayMilliseconds()/1000/60)}var leftValue=Math.ceil(172+(diffInMinutes*minuteWidth));view.$.currentTime.animate({left:leftValue+"px"},{duration:500,complete:function(){$(this).show()}});leftValue-=172;view.epg.$.find(".hightlight-current-time").animate({width:leftValue},500)},updateDateRange:function updateDateRange(start){var stop=start+TimeView.helpers.displayMilliseconds();$(".channel-guide-head").find(".date").text(BBV.utils.date(start).format(BBV.settings.l10n.date.listingformat));$(".channel-guide-head").find(".end-date").text(BBV.utils.date(stop).format(BBV.settings.l10n.date.listingformat))}};TimeView.helpers={};TimeView.helpers.getRangedMarkup=function getRangedMarkup(start){var range=TimeView.helpers.getRangeArray(start,TimeView.helpers.displayUnits());return Mustache.to_html(orion.templates.TimeSlot,{times:range})};TimeView.helpers.getRangeArray=function(date,count){var next=date;var timerange=[];var unit=TimeView.helpers.unit();for(var i=0;i<count;i++){timerange.push({time:next,display:TimeView.helpers.msToTime(next)});next=next+unit}return timerange};TimeView.helpers.unit=function(){return TimeView.helpers.displayMilliseconds()/(orion.modules.EPG.timeFrameInHours*2)};TimeView.helpers.displayUnits=function(){return orion.modules.EPG.timeFrameInHours*2};TimeView.helpers.displayMilliseconds=function(){return orion.util.time.timeFrameInMilliseconds(orion.modules.EPG.timeFrameInHours,"hours")};TimeView.helpers.msToTime=orion.modules.EPG.TemplateHelperMethods.msToTime;TimeView.helpers.keyTime=orion.modules.EPG.keyTime;return TimeView})(jQuery,orion.util.time);
window.LGI=window.LGI||{};LGI.BasicAspot=function(rootElement,config){this.init(rootElement,config)};LGI.BasicAspot.prototype={config:{},rootElement:null,wrapper:[],panes:[],bullets:[],previousButton:[],nextButton:[],currentIndex:0,timer:null,effect:{},init:function(rootElement,config){this.config=LGI.ApplyDefaults(config,{itemSelector:".upc-aspot-item",navSelector:".upc-aspot-nav",bulletSelector:"a.upc-aspot-bullet",previousSelector:".upc-aspot-previous",nextSelector:".upc-aspot-next",currentClassName:"upc-aspot-current",disabledClass:"upc-aspot-disabled",wrapper:".upc-aspot-wrapper",effect:"fade",fadeSpeed:500});if(this[config.effect]&&this[config.effect].next){this.effect=this[config.effect]}else{this.effect=this.fade}this.rootElement=$(rootElement);this.wrapper=this.rootElement.find(this.config.wrapper);this.panes=this.rootElement.find(this.config.itemSelector);this.bullets=this.rootElement.find(this.config.bulletSelector);this.previousButton=this.rootElement.find(this.config.previousSelector);this.nextButton=this.rootElement.find(this.config.nextSelector);this.currentIndex=0;this.panes.eq(0).css({display:"block"});this.panes.slice(1).css({display:"none"});this.bullets.eq(0).addClass(this.config.currentClassName);this.bullets.slice(1).removeClass(this.config.currentClassName);this.bindEvents();this.bindFragmentIdentifiers();if(this.config.autoplay){var self=this;this.timer=$.timer(function(){self.autoPlay()},this.config.timeout*1000,true)}},setCurrentIndex:function(targetIndex){this.currentIndex=targetIndex;this.panes.css({display:"none"});this.panes.eq(this.currentIndex).css({display:"block"});this.bullets.removeClass(this.config.currentClassName);this.bullets.eq(this.currentIndex).addClass(this.config.currentClassName)},getTargetIndex:function(targetIndex){if(targetIndex<0){return this.panes.length-1}else{if(targetIndex>=this.panes.length){return 0}else{return targetIndex}}},getViewportWidth:function(){return $("body").width()},bindEvents:function(){var self=this;this.wrapper.hover(function(event){self.pauseAutoPlay()},function(event){self.resumeAutoPlay()});this.previousButton.click(function(event){var nextIndex=self.getTargetIndex(self.currentIndex-1);self.stopAutoPlay();self.effect.previous(self,nextIndex)});this.nextButton.click(function(event){var nextIndex=self.getTargetIndex(self.currentIndex+1);self.stopAutoPlay();self.effect.next(self,nextIndex)});this.bullets.click(function(event){var nextIndex=self.bullets.index($(this));event.stopPropagation();event.preventDefault();self.stopAutoPlay();if(nextIndex<self.currentIndex){self.effect.previous(self,nextIndex)}else{if(nextIndex>self.currentIndex){self.effect.next(self,nextIndex)}}})},bindFragmentIdentifiers:function(){var self=this;this.panes.each(function(index,paneElement){})},autoPlay:function(){var nextIndex=this.getTargetIndex(this.currentIndex+1);this.effect.next(this,nextIndex)},pauseAutoPlay:function(){if(this.timer){this.timer.pause()}},resumeAutoPlay:function(){if(this.timer){this.timer.play(true)}},stopAutoPlay:function(){if(this.timer){this.timer.stop()}this.timer=null},fade:{doFade:function(basicAspot,targetIndex){var currentPane=basicAspot.panes.eq(basicAspot.currentIndex),targetPane=basicAspot.panes.eq(targetIndex);currentPane.stop(true).fadeOut(basicAspot.config.fadeSpeed);targetPane.stop(true).fadeIn(basicAspot.config.fadeSpeed,function(){basicAspot.setCurrentIndex(targetIndex)})},next:function(basicAspot,targetIndex){this.doFade(basicAspot,targetIndex)},previous:function(basicAspot,targetIndex){this.doFade(basicAspot,targetIndex)}},basicHorizontalSlide:{next:function(basicAspot,targetIndex){var viewPortWidth=basicAspot.getViewportWidth(),currentPane=basicAspot.panes.eq(basicAspot.currentIndex),targetPane=basicAspot.panes.eq(targetIndex);currentPane.stop(true).css({display:"block",left:0,right:0}).animate({left:-viewPortWidth+"px",right:viewPortWidth+"px"},basicAspot.config.fadeSpeed,"swing");targetPane.stop(true).css({display:"block",left:viewPortWidth+"px",right:-viewPortWidth+"px"}).animate({left:0,right:0},basicAspot.config.fadeSpeed,"swing",function(){basicAspot.setCurrentIndex(targetIndex)})},previous:function(basicAspot,targetIndex){var viewPortWidth=basicAspot.getViewportWidth(),currentPane=basicAspot.panes.eq(basicAspot.currentIndex),targetPane=basicAspot.panes.eq(targetIndex);currentPane.stop(true).css({display:"block",left:0,right:0}).animate({left:viewPortWidth+"px",right:-viewPortWidth+"px"},basicAspot.config.fadeSpeed,"swing");targetPane.stop(true).css({display:"block",left:-viewPortWidth+"px",right:viewPortWidth+"px"}).animate({left:0,right:0},basicAspot.config.fadeSpeed,"swing",function(){basicAspot.setCurrentIndex(targetIndex)})}}};window.LGI=window.LGI||{};LGI.BasicAspotResponsive=function(rootElement,config){this.init(rootElement,config)};LGI.BasicAspotResponsive.prototype={config:{},rootElement:null,wrapper:[],panes:[],bullets:[],currentIndex:0,init:function(rootElement,config){this.config=LGI.ApplyDefaults(config,{itemSelector:".upc-basic-aspot-responsive-item",bulletSelector:".upc-aspot-bullet",currentClassName:"upc-aspot-current",wrapper:".upc-basic-aspot-responsive-wrapper",margin:10,swipeTimeToGo:500,swipeDistanceToGo:0.3,fadeSpeed:500});this.rootElement=$(rootElement);this.wrapper=this.rootElement.find(this.config.wrapper);this.panes=this.rootElement.find(this.config.itemSelector);this.bullets=this.rootElement.find(this.config.bulletSelector);this.currentIndex=0;this.panes.eq(0).css({display:"block"});this.panes.slice(1).css({display:"none"});this.bullets.eq(0).addClass(this.config.currentClassName);this.bullets.slice(1).removeClass(this.config.currentClassName);this.bindEvents()},setCurrentIndex:function(targetIndex){this.currentIndex=targetIndex;this.panes.css({display:"none",width:this.getViewportWidth()+"px",left:0,right:0});this.panes.eq(this.currentIndex).css({display:"block"});this.bullets.removeClass(this.config.currentClassName);this.bullets.eq(this.currentIndex).addClass(this.config.currentClassName)},getTargetIndex:function(targetIndex){if(targetIndex<0){return this.panes.length-1}else{if(targetIndex>=this.panes.length){return 0}else{return targetIndex}}},getViewportWidth:function(){return $("body").width()},getContentHeight:function(){var height=0;$(this.config.itemSelector).each(function(index,element){height=Math.max(height,$(element).height())});return height},resizeWrapper:function(){if(this.getContentHeight()){this.wrapper.height(this.getContentHeight()).width(this.getViewportWidth())}this.panes.css({width:this.getViewportWidth()+"px"})},bindEvents:function(){var self=this;$(function(){self.resizeWrapper()});$(window).on("load resize orientationchange webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){self.resizeWrapper()});$.timer(function(){self.resizeWrapper()},1000,true);this.panes.on("click",function(event){event.stopPropagation();event.preventDefault()});this.rootElement.swipe({threshold:self.getViewportWidth()*self.config.swipeDistanceToGo,maxTimeThreshold:self.config.swipeTimeToGo,excludedElements:"",allowPageScroll:"vertical",tap:function(event){event.stopPropagation();event.preventDefault();if($(event.target).parent("a").length&&$(event.target).parent("a")[0].href){window.location=$(event.target).parent("a")[0].href}},swipeStatus:function(event,phase,direction,distance,duration,fingers){if(!/left|right/.test(direction)){return}event.stopPropagation();event.preventDefault();var goForward=(direction=="left"),viewportWidth=self.getViewportWidth(),percentageDone=distance/viewportWidth,timeLeft=self.config.fadeSpeed*(1-percentageDone),nextIndex=self.getTargetIndex(goForward?self.currentIndex+1:self.currentIndex-1),currentPane=self.panes.eq(self.currentIndex),nextPane=self.panes.eq(nextIndex),currentPanePosition=goForward?-distance:distance,nextPanePosition=goForward?currentPanePosition+viewportWidth+self.config.margin:currentPanePosition-viewportWidth-self.config.margin;if(phase=="end"||phase=="cancel"){if(distance>=(viewportWidth*self.config.swipeDistanceToGo)||duration<=self.config.swipeTimeToGo){phase="end"}else{phase="cancel"}}currentPane.css({display:"block",width:"auto",left:currentPanePosition+"px",right:-currentPanePosition+"px"});nextPane.css({display:"block",width:"auto",left:nextPanePosition+"px",right:-nextPanePosition+"px"});if(phase=="end"){currentPanePosition=goForward?-viewportWidth-self.config.margin:viewportWidth+self.config.margin;currentPane.animate({width:viewportWidth+"px",left:currentPanePosition+"px",right:-currentPanePosition+"px"},timeLeft,"swing");nextPane.animate({width:viewportWidth+"px",left:0,right:0},timeLeft,"swing",function(){self.setCurrentIndex(nextIndex)})}else{if(phase=="cancel"){nextPanePosition=goForward?viewportWidth+self.config.margin:-viewportWidth-self.config.margin;currentPane.animate({width:viewportWidth+"px",left:0,rigth:0},timeLeft,"swing");nextPane.animate({width:viewportWidth+"px",left:nextPanePosition+"px",right:-nextPanePosition+"px"},timeLeft,"swing",function(){self.setCurrentIndex(self.currentIndex)})}}}})}};window.LGI.ApplyDefaults=function(base,defaults){if(!defaults){return base}if(defaults instanceof Array||defaults instanceof RegExp||typeof defaults!=="object"){return(typeof base!=="undefined")?base:defaults}if(!base){base={}}for(var attr in defaults){if(defaults.hasOwnProperty(attr)){if(typeof defaults[attr]==="object"){base[attr]=window.LGI.ApplyDefaults(base[attr],defaults[attr])}else{if(!base.hasOwnProperty(attr)||typeof base[attr]==="undefined"){base[attr]=defaults[attr]}}}}return base};
BBV.namespace("orion.services").LinearDataService=orion.services.LinearDataService||(function($,undefined){var _channelsRequest;var _program;var _channelsMap={};var _offset;var _detailedCache={};function _getChannelsData(includeInvisible){if(_channelsRequest&&_channelsRequest.state()=="rejected"){_channelsRequest=undefined}if(!_channelsRequest){var params={sort:"channelNumber"};if(includeInvisible){params.includeInvisible=includeInvisible}_channelsRequest=orion.oesp.channelEndpoint.requestChannels(params)}return _channelsRequest.promise()}function _generateMap(channels){var channelsLength=channels.channels.length;for(var i=0;i<channelsLength;i++){if(!_channelsMap[channels.channels[i].getStation().id]){_channelsMap[channels.channels[i].getStation().id]=i}}}function _concat(list){var result=list[0];if(list.length>1){for(var i=1;i<list.length;i++){result.entries=result.entries.concat(list[i].entries);result.entryCount+=list[i].entryCount}}return result}function _cleanOutListings(listings,start,end){for(var i=0;i<listings.entries.length;i++){for(var j=0;j<listings.entries[i].l.length;j++){if(_checkForDate(listings.entries[i].l[j],start,end)){listings.entries[i].l[j]=_formatListing(listings.entries[i].l[j])}else{listings.entries[i].l.splice(j,1);j--}}}return listings}function _deleteCopies(listingsFirst,listingsSecond){for(var i=0;i<listingsFirst.length;i++){for(var j=0;j<listingsSecond.length;j++){if(listingsFirst[i].id==listingsSecond[j].id){listingsSecond.splice(j,1);j--}}}}function _mergeListingsToChannel(channels,listings){for(var i=0;i<channels.channels.length;i++){delete channels.channels[i].listings}for(i=0;i<listings.entries.length;i++){var index=_channelsMap[listings.entries[i].o];if(typeof index!="undefined"){if(channels.channels[index].listings){_deleteCopies(channels.channels[index].listings,listings.entries[i].l);channels.channels[index].listings=channels.channels[index].listings.concat(listings.entries[i].l)}else{channels.channels[index].listings=listings.entries[i].l}}}return channels}function _mergeListings(inputChannels,inputListings,start,end){var result;var channels=$.extend(true,{},inputChannels);var listings=$.extend(true,{},inputListings);listings.length=inputListings.length;_generateMap(channels);result=_cleanOutListings(_concat(listings),start,end);return _mergeListingsToChannel(channels,result)}function _checkForDate(listings,start,end){return !((listings.e<start)||(listings.s>end))}function _formatListing(listing){var map={t:"title",e:"endTime",s:"startTime",c:"categoryId",a:"adult",r:"replayTv",i:"id"};var result={};for(var i in listing){if(listing.hasOwnProperty(i)){if(map[i]){result[map[i]]=listing[i]}else{result[i]=listing[i]}}}return result}function _getChannelByStationId(stationId){var dfd=$.Deferred();_channelsRequest.done(function(channels){var neededChannel;for(var i=0;i<channels.channels.length;i++){if(channels.channels[i].getStation().id===stationId){neededChannel=channels.channels[i]}}dfd.resolve(neededChannel)});return dfd.promise()}function _extendListingWithChannelData(listing,channel){var channelMethods=orion.modules.EPG.TemplateHelperMethods.channels;return $.extend({channelId:channel.id,channelHasLiveStream:channel.hasLiveStream,channelHasHSSStream:channelMethods.hasHSSStream(channel),channelTitle:channel.getStation().title,channelEntitlements:channel.getStation().entitlements},listing)}function clearCache(){_channelsRequest=undefined;_channelsMap={};_detailedCache={}}function getData(start,end,includeInvisible){if(!_program){_program=new orion.oesp.req.ProgramEndpoint()}var dfd=$.Deferred();var channeldfd=_getChannelsData(includeInvisible);var schedulesdfd;_offset=orion.oesp.timeEndpoint.offset;schedulesdfd=_program.getRange(start,end,_offset);$.when(channeldfd,schedulesdfd).then(function success(channels,listings){dfd.resolve(_mergeListings(channels,listings,start,end))},function failed(){dfd.reject()});return dfd.promise()}function _getListingData(id){if(_detailedCache[id]&&_detailedCache[id].state()=="rejected"){_detailedCache[id]=undefined}if(!_detailedCache[id]){_detailedCache[id]=_detailedCache[id]||$.Deferred();orion.oesp.listingEndpoint.requestListing(id).done(function(listing){_getChannelByStationId(listing.stationId).done(function(channel){_detailedCache[id].resolve(listing,channel)}).fail(function(){_detailedCache[id].reject()})}).fail(function(){_detailedCache[id].reject()})}return _detailedCache[id].promise()}function getActiveListing(id){var dfd=$.Deferred();_getListingData(id).done(function(listing,channel){listing=_extendListingWithChannelData(listing,channel);dfd.resolve(listing)}).fail(function(){dfd.reject()});return dfd.promise()}return{getDataListings:getData,getActiveListing:getActiveListing,clearCache:clearCache}})(jQuery);
BBV.namespace("orion.services.models").LinearTimeSet=orion.services.models.LinearTimeSet||(function($,time){function LinearTimeSet(options){var self=this;self.model={};self._params={sort:"startTime"};self.timestamp=options.timestamp;self._d=$.Deferred();self._aborted=false;self._detailRequests=[];self._ranged=false;if(typeof options.model!=="undefined"){options.model.chunked=false;self._d.resolve(options.model,self.timestamp)}else{if(typeof options.channels!=="undefined"){orion.app.subscribe("abortTimeSet",$.proxy(function(timestamp){if(timestamp===this.timestamp){this.abort()}},self));self.model=self._cleanUsingConfig(options.channels,"channels");self._chunk=options.urgent===true;self.timestamp=options.timestamp;self.model.chunked=self._chunk;self._constructTimestamp(options.timestamp)}else{throw new Error("Requires channels object to construct with timestamp")}}orion.oesp.session.done(function(session){self.locationIdWhenRequested=session.locationId;if(options.urgent){var onLoggedIn=$.proxy(function(){var self=this;if(self._d.state()==="pending"&&self.locationIdWhenRequested!==orion.util.oesp.session.locationId){self.abort()}},self);orion.app.subscribe("loggedIn",onLoggedIn);self._d.always(function(){orion.app.unsubscribe("loggedIn",onLoggedIn)})}});return self._d}LinearTimeSet.prototype.abort=function(){var self=this;self._aborted=true;self._d.reject()};LinearTimeSet.prototype._constructTimestamp=function(timestamp){var requestOffset=1000;var startDate=new Date(timestamp+requestOffset);var endDate=time.addTime(new Date(timestamp-requestOffset),2.5,"hours");this._requestListings(startDate.getTime(),endDate.getTime())};LinearTimeSet.prototype._requestListings=function(start,end){var self=this;if(self._aborted){return}if(self._chunk){self._params.byStationId=self._getStationIds(20);if(self._params.byStationId===null){$.when.apply(self,self._detailRequests).done(function allDetailsAreDone(){self._d.notify("LinearTimeSet.timeSetComplete",self.model);self._d.resolve(self.model,self.timestamp)});return}}self._params.byStartTime="~"+end;self._params.byEndTime=start+"~";var summaryRequest;var params=$.extend({},self._params,{mode:"summary"});summaryRequest=orion.oesp.listingEndpoint.requestListings(params);summaryRequest.done(function summaryRequestDone(data){if(self._chunk){self._insertListings(data.listings);self._addShimListings();for(var i=0;i<data.listings.length;i++){self._cleanUsingConfig(data.listings[i],"listings")}self._d.notify("LinearTimeSet.detailComplete",data,self.model);self._requestListings(start,end)}else{self._insertListings(data.listings);if(!self._ranged&&data.entryCount<data.totalResults){self._ranged=true;self._params.range=(data.entryCount+1)+"-"+data.totalResults;self._requestListings(start,end)}else{if(self._ranged||data.entryCount==data.totalResults){self._addShimListings(true);self.model.expires=data.expires;self.model.updated=data.updated;self._d.notify("LinearTimeSet.timeSetComplete",self.model);self._d.resolve(self.model,self.timestamp)}}}})};LinearTimeSet.prototype._insertListings=function(listings){var self=this;for(var i=0;i<listings.length;i++){var listing=listings[i];var stationId=listing.stationId;var station=self._getStationById(stationId);if(station!==null){if(typeof station.listings==="undefined"){station.listings=[]}self._cleanUsingConfig(listing,"listings");station.listings.push(listing)}}};LinearTimeSet.prototype._addShimListings=function(timeSetComplete){var self=this;var shimAllChannels=timeSetComplete===true;var shimChannels="|"+(self._params.byStationId||"")+"|";var start=parseInt(self._params.byEndTime.replace("~",""),10)-1000;var end=parseInt(self._params.byStartTime.replace("~",""),10)+1000;var channels=self.model.channels;for(var i=0;i<channels.length;i++){var station=channels[i].stationSchedules[0].station;if((shimChannels.indexOf("|"+station.id+"|")!==-1||shimAllChannels)&&typeof station.listings==="undefined"){station.listings=[]}if(station.listings){var listings=station.listings;var lastEndTime=start;for(var l=0;l<listings.length;l++){if(lastEndTime<listings[l].startTime){listings.splice(l,0,{startTime:lastEndTime,endTime:listings[l].startTime});l++}lastEndTime=listings[l].endTime}if(lastEndTime<end){listings.push({startTime:lastEndTime,endTime:end})}}}};LinearTimeSet.prototype._getStationById=function(stationId){var self=this;for(var c=0;c<self.model.channels.length;c++){if(self.model.channels[c].stationSchedules[0].station.id===stationId){return self.model.channels[c].stationSchedules[0].station}}return null};LinearTimeSet.prototype._getStationIds=function(count){var self=this;if(typeof self._idSet==="undefined"){self._idSet=0}var min=self._idSet*count;var max=min+count;var ids=[];for(var i=min;i<max&&i<self.model.totalResults;i++){ids.push(self.model.channels[i].stationSchedules[0].station.id)}if(ids.length>0){self._idSet++;return ids.join("|")}else{return null}};LinearTimeSet.prototype._cleanUsingConfig=function(data,config){var self=this;config=orion.services.models.ModelCleanerConfigs[config];for(var i=0;i<config.length;i++){self._cleanData(config[i],data)}return data};var alerted=false;LinearTimeSet.prototype._cleanData=function(pathString,data,original){var self=this;var orig=original||{path:pathString,data:data};pathString=pathString.split(".");var path=pathString.splice(0,1)[0];var subItem;pathString=pathString.join(".");if(path.indexOf("[")!==-1){subItem=parseInt(path.split("[")[1].split("]").join(""),10);path=path.split("[")[0]}if(pathString.length>0){if(typeof data[path]!=="undefined"){data=data[path];if(data instanceof Array){if(typeof subItem!=="undefined"){self._cleanData(pathString,data[subItem],orig)}else{for(var i=0;i<data.length;i++){self._cleanData(pathString,data[i],orig)}}}else{self._cleanData(pathString,data,orig)}}else{}}else{if(typeof data[path]!=="undefined"){delete data[path]}else{}}};return LinearTimeSet})(jQuery,orion.util.time);
BBV.namespace("orion.services.models").ModelCleanerConfigs=orion.services.models.ModelCleanerConfigs||(function($){return{channels:["updated","title","channels.title","channels.countryCode","channels.languageCode","channels.deviceCode","channels.locationId","channels.stationSchedules[0].station.countryCode","channels.stationSchedules[0].station.language","channels.stationSchedules[0].station.locationId","channels.stationSchedules[0].station.serviceId"],listings:["countryCode","languageCode","deviceCode","id","locationId","program.countryCode","program.languageCode","program.deviceCode","program.mediaGroupId","program.mediaType","program.medium","program.shortDescription","program.longDescription","program.cast","program.directors","program.videos"]}})(jQuery);
BBV.namespace("orion").app=orion.app||(function($){function main(){var end,start=$.now(),app=this,module,modules=this.modules=[],moduleElements=$("[data-module-type]");this.resettingNow=false;if(typeof(addthis)!=="undefined"){addthis.addEventListener("addthis.ready",function addThisReady(){_addthis.resolve(arguments)})}orion.oesp.session=new orion.oesp.req.SessionEndpoint();orion.oesp.purchaseEndpoint=new orion.oesp.req.PurchaseEndpoint();orion.oesp.mediaItemEndpoint=new orion.oesp.req.MediaItemEndpoint();orion.oesp.mediaGroupEndpoint=new orion.oesp.req.MediaGroupEndpoint();orion.oesp.ProviderEndpoint=new orion.oesp.req.ProviderEndpoint();orion.oesp.bookmarkEndpoint=new orion.oesp.req.BookmarkEndpoint();orion.oesp.channelEndpoint=new orion.oesp.req.ChannelEndpoint();orion.oesp.listingEndpoint=new orion.oesp.req.ListingEndpoint();orion.oesp.profileEndpoint=new orion.oesp.req.ProfileEndpoint();orion.oesp.playlistEndpoint=new orion.oesp.req.PlaylistEndpoint();orion.oesp.deviceEndpoint=new orion.oesp.req.DeviceEndpoint();orion.oesp.searchEndpoint=new orion.oesp.req.SearchEndpoint();orion.oesp.timeEndpoint=new orion.oesp.req.TimeEndpoint();this.dialogManager=orion.widgets.DialogManager(app);this.recommendations=new orion.widgets.Recommendations();this.analytics=new orion.util.analytics();this.adultAdapter=new orion.util.AdultAdapter();if(!supportsBrowser()){var showUpgradeDialog=$("#upgrade-browser-dialog").length;if(showUpgradeDialog){var dialog=this.dialogManager.getDialog("upgradebrowser");dialog.setHtmlContent($("#upgrade-browser-dialog").html());dialog.setModal(true);dialog.centerOn(window);dialog.show()}}orion.oesp.timeEndpoint.getTime().done(function(){moduleElements.each(function(){module=app.createModule(this,app);if(module){modules.push(module)}})});this.main=function(){if(console&&console.trace){console.trace()}log("Warning: Attempting to run main function more than once!")};var processors=window.orionProcessors||{};for(var name in processors){if(processors.hasOwnProperty(name)){log("Calling processor: "+name);processors[name]()}}end=$.now();(function(){var on=$.fn.on;$.fn.on=function newOn(){var a=arguments;if(orion.app.resettingNow&&this.data("events")){var type=a[0].split(".")[0];var namespace=(a[0].indexOf(".")!==-1)?a[0].replace(type+".",""):"";var events=this.data("events")[type]||[];for(var i=0;i<events.length;i++){var e=events[i];if(e.type==type&&e.namespace==namespace&&e.selector==a[1]){this.off(a[0],e.selector,e.handler)}}}return on.apply(this,a)}})();log("Main completed in ",end-start+"ms.")}var _addthis=$.Deferred();var constructorResetConfig={UtilityBar:{markup:false},VideoPlayer:{markup:true},Playlist:{markup:false},MyOrionBar:{markup:false},PinManagement:{markup:false},MediaItemTitleCard:{markup:true},ChannelCard:{markup:false},ContentBrowse:{markup:true},LiveChannels:{markup:true},LinearTitleCard:{markup:true},MyChannelsLineUp:{markup:true},MediaTitleCard:{markup:true},RecommendedForYou:{markup:false}};function createModule(elem,pub){var moduleType=elem.getAttribute("data-module-type");var Constructor=orion.modules[moduleType];var module=null;var initialMarkup=elem.innerHTML;if(Constructor&&typeof Constructor=="function"){var resetConfig=constructorResetConfig[moduleType]||false;module=new Constructor(elem,pub);if(resetConfig){module.reset=function(html,elem,pub,resetConfig){return function(){if(resetConfig.markup){elem.innerHTML=html}return createModule(elem,pub)}}(initialMarkup,elem,pub,resetConfig)}}return module}function reInitialize(noNewSession){var self=this;noNewSession=noNewSession===true;self.resettingNow=true;if(noNewSession===false){orion.oesp.session=new orion.oesp.req.SessionEndpoint();orion.oesp.purchaseEndpoint=new orion.oesp.req.PurchaseEndpoint()}orion.oesp.session.done(function(session){for(var i=0,m=self.modules;i<m.length;i++){if(m[i].reset){if(m[i].destroy){m[i].destroy()}var newMod=m[i].reset();delete self.modules[i];self.modules[i]=newMod}}setTimeout(function(){orion.app.resettingNow=false;self.trigger("loggedIn",session);self.adultAdapter.initialize()},1)})}function trigger(eventType,eventOptions){var observers=this._observers[eventType];var i;if(observers){i=observers.length;setTimeout(function(){while(i--){if($.isFunction(observers[i])){observers[i](eventOptions)}}},0)}return this}function subscribe(eventType,callback,instance){var self=this,i;var observers=this._observers;if(!(eventType in observers)){observers[eventType]=[]}if(self.resettingNow){if(!(instance&&instance.destroy)){var o=observers[eventType];for(i=0;i<o.length;i++){if(""+o[i]==""+callback){delete o[i];o.splice(i,1);i--}}}}observers[eventType].push(callback);return this}function unsubscribe(eventType,handler){var i,observers=this._observers[eventType];if(observers){for(i=0;i<observers.length;i++){if(observers[i]==handler){delete observers[i];observers.splice(i,1);i--}}}return this}function once(eventType,callback){var publisher=this;var wrappedCallback=function(eventOptions){callback(eventOptions);publisher.unsubscribe(eventType,wrappedCallback)};publisher.subscribe(eventType,wrappedCallback);return this}var _credential=null;function setCredential(credential){if(credential){_credential=credential}}function getCredential(){if(_credential){var credential=_credential;_credential=null;return credential}return null}function hasCredential(){return _credential!==null}function supportsBrowser(){var currName=$.ua.browser.name;var currMajor=$.ua.browser.major;var len=BBV.settings.notSupportedBrowsers.length;for(var i=0;i<len;i++){var name=BBV.settings.notSupportedBrowsers[i][0];var major=BBV.settings.notSupportedBrowsers[i][1];var checkMajorVersion=major!==-1;if(currName.toLowerCase()===name.toLowerCase()){if(!checkMajorVersion){return false}if(parseInt(major,10)===parseInt(currMajor,10)){return false}}}return true}return{main:main,createModule:createModule,trigger:trigger,subscribe:subscribe,unsubscribe:unsubscribe,once:once,modules:[],_observers:{},constructors:[],reInitialize:reInitialize,resettingNow:this.resettingNow,setCredential:setCredential,getCredential:getCredential,hasCredential:hasCredential,addthis:_addthis}})(jQuery);
(function(d){var pageTitle=$("head").data("page-title");if(pageTitle&&pageTitle!==d.title){setTimeout(function(){d.title=$("head").data("page-title")},3000)}})(document);(function($){var $languageList=$("ul.user-language"),$languageLinks=$languageList.find(".language-item"),canonicalPath=$languageList.data("canonicalPath"),storageLanguage=localStorage.getItem("language"),windowLanguage=window.navigator.userLanguage||window.navigator.language,currentLanguage=$languageList.data("currentLanguage");windowLanguage=(windowLanguage)?windowLanguage.replace("-","_"):null;log("window.navigator Language: "+windowLanguage);log("localStorage Language: "+storageLanguage);log("Current pages Language: "+currentLanguage);if(BBV.settings.currentLanguage&&readCookie("language")!=BBV.settings.currentLanguage){createCookie("language",BBV.settings.currentLanguage,10)}if(currentLanguage&&typeof currentLanguage=="string"){if(storageLanguage&&typeof storageLanguage=="string"){if(currentLanguage.toLowerCase()!=storageLanguage.toLowerCase()){if(matchLanguageAndRedirect($languageLinks,canonicalPath,storageLanguage,currentLanguage)){return}else{log("Local storage language no longer valid. Continuing...")}}else{log("Local storage matches page language");return}}else{localStorage.setItem("language",currentLanguage)}if(windowLanguage&&typeof windowLanguage=="string"){if(currentLanguage.toLowerCase()!=windowLanguage.toLowerCase()){if(!matchLanguageAndRedirect($languageLinks,canonicalPath,windowLanguage,currentLanguage,true)){log("No language matching local machine")}}}else{log("No window language information, browser compatible?")}}else{log("CurrentLanguage data attribute is empty or null")}function convertLanguageLinks(){$languageLinks.each(function(){var $this=$(this),toLanguage=$this.data("language"),translatedHref=getUrlForLanguage(currentLanguage,toLanguage,location.href,location.pathname,canonicalPath);$this.attr("href",translatedHref)})}function matchLanguageAndRedirect($links,canonicalPath,toLanguage,currentPageLanguage,setStorage){for(var i=0;i<$links.length;i++){$link=$($links[i]);var linkLanguage=$link.data("language");if(toLanguage&&linkLanguage&&linkLanguage.toLowerCase()==toLanguage.toLowerCase()&&location.pathname.indexOf(currentPageLanguage.toLowerCase())>-1&&canonicalPath.indexOf(currentPageLanguage.toLowerCase())>-1){var href=getUrlForLanguage(currentPageLanguage,toLanguage,location.href,location.pathname,canonicalPath);if(href&&href.length>0){log("Found language match: "+linkLanguage+" : "+toLanguage);log("Redirecting to href: "+href);if(setStorage){localStorage.setItem("language",toLanguage)}window.location.href=href;return true}}}return false}function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString()}else{var expires=""}document.cookie=name+"="+value+expires+"; path=/"}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length)}}return null}function getUrlForLanguage(currentLanguage,toLanguage,href,pathname,canonicalPath){var locationUrlParts=pathname.split(currentLanguage.toLowerCase()),pathUrlParts=canonicalPath.split(currentLanguage.toLowerCase()),locationPartsAfterLanguage=locationUrlParts[1].split("/"),pathPartsAfterLanguage=pathUrlParts[1].split("/");for(var j=0;j<locationPartsAfterLanguage.length&&j<pathPartsAfterLanguage.length;j++){var lpal=locationPartsAfterLanguage[j],ppal=pathPartsAfterLanguage[j],indexOfDot=lpal.indexOf(".");if(indexOfDot>-1){locationPartsAfterLanguage[j]=lpal.replace(lpal.substr(0,indexOfDot),ppal)}else{locationPartsAfterLanguage[j]=ppal}}locationUrlParts[1]=locationPartsAfterLanguage.join("/");return href.replace(pathname,locationUrlParts.join(toLanguage.toLowerCase()))}})(jQuery);jQuery(document).ready(function(){orion.app.main()});

